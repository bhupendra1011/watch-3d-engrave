/**
 * @fileOverview Set up iwc namespace
 */

/**
 * @namespace
 */
var iwc = iwc || {};

/**
 * @namespace
 */
iwc.comp = iwc.comp || {};

/**
 * @namespace
 */
iwc.util = iwc.util || {};

/**
 * @namespace
 */
iwc.data = iwc.data || {};

/*globals iwc, base*/
/**
 * @fileOverview clean up 3rd party lib namespaces that pollute the global scope
 * e.g. Remove jQuery from the global scope so that two vesions of jQuery can coexist
 */

(function() {
    'use strict';
    // Assign base version of jQuery on maison namespace
    iwc.$ = base.$;
    window.jQuery = base.$;
})();

/*
  Polyfil for Array.findIndex: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/findIndex#Polyfill
*/
// https://tc39.github.io/ecma262/#sec-array.prototype.findIndex
if (!Array.prototype.findIndex) {
  Object.defineProperty(Array.prototype, 'findIndex', {
    value: function(predicate) {
     // 1. Let O be ? ToObject(this value).
      if (this == null) {
        throw new TypeError('"this" is null or not defined');
      }

      var o = Object(this);

      // 2. Let len be ? ToLength(? Get(O, "length")).
      var len = o.length >>> 0;

      // 3. If IsCallable(predicate) is false, throw a TypeError exception.
      if (typeof predicate !== 'function') {
        throw new TypeError('predicate must be a function');
      }

      // 4. If thisArg was supplied, let T be thisArg; else let T be undefined.
      var thisArg = arguments[1];

      // 5. Let k be 0.
      var k = 0;

      // 6. Repeat, while k < len
      while (k < len) {
        // a. Let Pk be ! ToString(k).
        // b. Let kValue be ? Get(O, Pk).
        // c. Let testResult be ToBoolean(? Call(predicate, T, « kValue, k, O »)).
        // d. If testResult is true, return k.
        var kValue = o[k];
        if (predicate.call(thisArg, kValue, k, o)) {
          return k;
        }
        // e. Increase k by 1.
        k++;
      }

      // 7. Return -1.
      return -1;
    }
  });
}
/*! npm.im/object-fit-images 3.1.3 */
var objectFitImages=function(){"use strict";function t(t,e){return"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='"+t+"' height='"+e+"'%3E%3C/svg%3E"}function e(t){if(t.srcset&&!p&&window.picturefill){var e=window.picturefill._;t[e.ns]&&t[e.ns].evaled||e.fillImg(t,{reselect:!0}),t[e.ns].curSrc||(t[e.ns].supported=!1,e.fillImg(t,{reselect:!0})),t.currentSrc=t[e.ns].curSrc||t.src}}function i(t){for(var e,i=getComputedStyle(t).fontFamily,r={};null!==(e=u.exec(i));)r[e[1]]=e[2];return r}function r(e,i,r){var n=t(i||1,r||0);b.call(e,"src")!==n&&h.call(e,"src",n)}function n(t,e){t.naturalWidth?e(t):setTimeout(n,100,t,e)}function c(t){var c=i(t),o=t[l];if(c["object-fit"]=c["object-fit"]||"fill",!o.img){if("fill"===c["object-fit"])return;if(!o.skipTest&&f&&!c["object-position"])return}if(!o.img){o.img=new Image(t.width,t.height),o.img.srcset=b.call(t,"data-ofi-srcset")||t.srcset,o.img.src=b.call(t,"data-ofi-src")||t.src,h.call(t,"data-ofi-src",t.src),t.srcset&&h.call(t,"data-ofi-srcset",t.srcset),r(t,t.naturalWidth||t.width,t.naturalHeight||t.height),t.srcset&&(t.srcset="");try{s(t)}catch(t){window.console&&console.log("http://bit.ly/ofi-old-browser")}}e(o.img),t.style.backgroundImage='url("'+(o.img.currentSrc||o.img.src).replace(/"/g,'\\"')+'")',t.style.backgroundPosition=c["object-position"]||"center",t.style.backgroundRepeat="no-repeat",/scale-down/.test(c["object-fit"])?n(o.img,function(){o.img.naturalWidth>t.width||o.img.naturalHeight>t.height?t.style.backgroundSize="contain":t.style.backgroundSize="auto"}):t.style.backgroundSize=c["object-fit"].replace("none","auto").replace("fill","100% 100%"),n(o.img,function(e){r(t,e.naturalWidth,e.naturalHeight)})}function s(t){var e={get:function(e){return t[l].img[e?e:"src"]},set:function(e,i){return t[l].img[i?i:"src"]=e,h.call(t,"data-ofi-"+i,e),c(t),e}};Object.defineProperty(t,"src",e),Object.defineProperty(t,"currentSrc",{get:function(){return e.get("currentSrc")}}),Object.defineProperty(t,"srcset",{get:function(){return e.get("srcset")},set:function(t){return e.set(t,"srcset")}})}function o(){function t(t,e){return t[l]&&t[l].img&&("src"===e||"srcset"===e)?t[l].img:t}d||(HTMLImageElement.prototype.getAttribute=function(e){return b.call(t(this,e),e)},HTMLImageElement.prototype.setAttribute=function(e,i){return h.call(t(this,e),e,String(i))})}function a(t,e){var i=!y&&!t;if(e=e||{},t=t||"img",d&&!e.skipTest||!m)return!1;"string"==typeof t?t=document.querySelectorAll(t):"length"in t||(t=[t]);for(var r=0;r<t.length;r++)t[r][l]=t[r][l]||{skipTest:e.skipTest},c(t[r]);i&&(document.body.addEventListener("load",function(t){"IMG"===t.target.tagName&&a(t.target,{skipTest:e.skipTest})},!0),y=!0,t="img"),e.watchMQ&&window.addEventListener("resize",a.bind(null,t,{skipTest:e.skipTest}))}var l="bfred-it:object-fit-images",u=/(object-fit|object-position)\s*:\s*([-\w\s%]+)/g,g="undefined"==typeof Image?{style:{"object-position":1}}:new Image,f="object-fit"in g.style,d="object-position"in g.style,m="background-size"in g.style,p="string"==typeof g.currentSrc,b=g.getAttribute,h=g.setAttribute,y=!1;return a.supportsObjectFit=f,a.supportsObjectPosition=d,o(),a}();

var objectFitVideos=function(){"use strict";function t(t){for(var e=getComputedStyle(t).fontFamily,o=null,n={};null!==(o=a.exec(e));)n[o[1]]=o[2];return n["object-position"]?i(n):n}function e(){for(var e=document.querySelectorAll("video"),i=-1;e[++i];){var n=t(e[i]);(n["object-fit"]||n["object-position"])&&(n["object-fit"]=n["object-fit"]||"fill",o(e[i],n))}}function o(t,e){function o(){var o=t.videoWidth,n=t.videoHeight,d=o/n,c=r.clientWidth,a=r.clientHeight,p=c/a,l=0,s=0;i.marginLeft=i.marginTop=0,(d<p?"contain"===e["object-fit"]:"cover"===e["object-fit"])?(l=a*d,s=c/d,i.width=Math.round(l)+"px",i.height=a+"px","left"===e["object-position-x"]?i.marginLeft=0:"right"===e["object-position-x"]?i.marginLeft=Math.round(c-l)+"px":i.marginLeft=Math.round((c-l)/2)+"px"):(s=c/d,i.width=c+"px",i.height=Math.round(s)+"px","top"===e["object-position-y"]?i.marginTop=0:"bottom"===e["object-position-y"]?i.marginTop=Math.round(a-s)+"px":i.marginTop=Math.round((a-s)/2)+"px")}if("fill"!==e["object-fit"]){var i=t.style,n=window.getComputedStyle(t),r=document.createElement("object-fit");r.appendChild(t.parentNode.replaceChild(r,t));var d={height:"100%",width:"100%",boxSizing:"content-box",display:"inline-block",overflow:"hidden"};"backgroundColor backgroundImage borderColor borderStyle borderWidth bottom fontSize lineHeight left opacity margin position right top visibility".replace(/\w+/g,function(t){d[t]=n[t]});for(var c in d)r.style[c]=d[c];i.border=i.margin=i.padding=0,i.display="block",i.opacity=1,t.addEventListener("loadedmetadata",o),window.addEventListener("optimizedResize",o),t.readyState>=1&&(t.removeEventListener("loadedmetadata",o),o())}}function i(t){return~t["object-position"].indexOf("left")?t["object-position-x"]="left":~t["object-position"].indexOf("right")?t["object-position-x"]="right":t["object-position-x"]="center",~t["object-position"].indexOf("top")?t["object-position-y"]="top":~t["object-position"].indexOf("bottom")?t["object-position-y"]="bottom":t["object-position-y"]="center",t}function n(t,e,o){o=o||window;var i=!1,n=null;try{n=new CustomEvent(e)}catch(t){n=document.createEvent("Event"),n.initEvent(e,!0,!0)}var r=function(){i||(i=!0,requestAnimationFrame(function(){o.dispatchEvent(n),i=!1}))};o.addEventListener(t,r)}var r=new Image,d="object-fit"in r.style,c="object-position"in r.style,a=/(object-fit|object-position)\s*:\s*([-\w\s%]+)/g;d&&c||(e(),n("resize","optimizedResize"))};"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=objectFitVideos);
/*! lazysizes - v4.0.1 */
!function(a,b){var c=b(a,a.document);a.lazySizes=c,"object"==typeof module&&module.exports&&(module.exports=c)}(window,function(a,b){"use strict";if(b.getElementsByClassName){var c,d,e=b.documentElement,f=a.Date,g=a.HTMLPictureElement,h="addEventListener",i="getAttribute",j=a[h],k=a.setTimeout,l=a.requestAnimationFrame||k,m=a.requestIdleCallback,n=/^picture$/i,o=["load","error","lazyincluded","_lazyloaded"],p={},q=Array.prototype.forEach,r=function(a,b){return p[b]||(p[b]=new RegExp("(\\s|^)"+b+"(\\s|$)")),p[b].test(a[i]("class")||"")&&p[b]},s=function(a,b){r(a,b)||a.setAttribute("class",(a[i]("class")||"").trim()+" "+b)},t=function(a,b){var c;(c=r(a,b))&&a.setAttribute("class",(a[i]("class")||"").replace(c," "))},u=function(a,b,c){var d=c?h:"removeEventListener";c&&u(a,b),o.forEach(function(c){a[d](c,b)})},v=function(a,d,e,f,g){var h=b.createEvent("CustomEvent");return e||(e={}),e.instance=c,h.initCustomEvent(d,!f,!g,e),a.dispatchEvent(h),h},w=function(b,c){var e;!g&&(e=a.picturefill||d.pf)?e({reevaluate:!0,elements:[b]}):c&&c.src&&(b.src=c.src)},x=function(a,b){return(getComputedStyle(a,null)||{})[b]},y=function(a,b,c){for(c=c||a.offsetWidth;c<d.minSize&&b&&!a._lazysizesWidth;)c=b.offsetWidth,b=b.parentNode;return c},z=function(){var a,c,d=[],e=[],f=d,g=function(){var b=f;for(f=d.length?e:d,a=!0,c=!1;b.length;)b.shift()();a=!1},h=function(d,e){a&&!e?d.apply(this,arguments):(f.push(d),c||(c=!0,(b.hidden?k:l)(g)))};return h._lsFlush=g,h}(),A=function(a,b){return b?function(){z(a)}:function(){var b=this,c=arguments;z(function(){a.apply(b,c)})}},B=function(a){var b,c=0,e=125,g=d.ricTimeout,h=function(){b=!1,c=f.now(),a()},i=m&&d.ricTimeout?function(){m(h,{timeout:g}),g!==d.ricTimeout&&(g=d.ricTimeout)}:A(function(){k(h)},!0);return function(a){var d;(a=a===!0)&&(g=33),b||(b=!0,d=e-(f.now()-c),0>d&&(d=0),a||9>d&&m?i():k(i,d))}},C=function(a){var b,c,d=99,e=function(){b=null,a()},g=function(){var a=f.now()-c;d>a?k(g,d-a):(m||e)(e)};return function(){c=f.now(),b||(b=k(g,d))}};!function(){var b,c={lazyClass:"lazyload",loadedClass:"lazyloaded",loadingClass:"lazyloading",preloadClass:"lazypreload",errorClass:"lazyerror",autosizesClass:"lazyautosizes",srcAttr:"data-src",srcsetAttr:"data-srcset",sizesAttr:"data-sizes",minSize:40,customMedia:{},init:!0,expFactor:1.5,hFac:.8,loadMode:2,loadHidden:!0,ricTimeout:300};d=a.lazySizesConfig||a.lazysizesConfig||{};for(b in c)b in d||(d[b]=c[b]);a.lazySizesConfig=d,k(function(){d.init&&F()})}();var D=function(){var g,l,m,o,p,y,D,F,G,H,I,J,K,L,M=/^img$/i,N=/^iframe$/i,O="onscroll"in a&&!/glebot/.test(navigator.userAgent),P=0,Q=0,R=0,S=-1,T=function(a){R--,a&&a.target&&u(a.target,T),(!a||0>R||!a.target)&&(R=0)},U=function(a,c){var d,f=a,g="hidden"==x(b.body,"visibility")||"hidden"!=x(a,"visibility");for(F-=c,I+=c,G-=c,H+=c;g&&(f=f.offsetParent)&&f!=b.body&&f!=e;)g=(x(f,"opacity")||1)>0,g&&"visible"!=x(f,"overflow")&&(d=f.getBoundingClientRect(),g=H>d.left&&G<d.right&&I>d.top-1&&F<d.bottom+1);return g},V=function(){var a,f,h,j,k,m,n,p,q,r=c.elements;if((o=d.loadMode)&&8>R&&(a=r.length)){f=0,S++,null==K&&("expand"in d||(d.expand=e.clientHeight>500&&e.clientWidth>500?500:370),J=d.expand,K=J*d.expFactor),K>Q&&1>R&&S>2&&o>2&&!b.hidden?(Q=K,S=0):Q=o>1&&S>1&&6>R?J:P;for(;a>f;f++)if(r[f]&&!r[f]._lazyRace)if(O)if((p=r[f][i]("data-expand"))&&(m=1*p)||(m=Q),q!==m&&(y=innerWidth+m*L,D=innerHeight+m,n=-1*m,q=m),h=r[f].getBoundingClientRect(),(I=h.bottom)>=n&&(F=h.top)<=D&&(H=h.right)>=n*L&&(G=h.left)<=y&&(I||H||G||F)&&(d.loadHidden||"hidden"!=x(r[f],"visibility"))&&(l&&3>R&&!p&&(3>o||4>S)||U(r[f],m))){if(ba(r[f]),k=!0,R>9)break}else!k&&l&&!j&&4>R&&4>S&&o>2&&(g[0]||d.preloadAfterLoad)&&(g[0]||!p&&(I||H||G||F||"auto"!=r[f][i](d.sizesAttr)))&&(j=g[0]||r[f]);else ba(r[f]);j&&!k&&ba(j)}},W=B(V),X=function(a){s(a.target,d.loadedClass),t(a.target,d.loadingClass),u(a.target,Z),v(a.target,"lazyloaded")},Y=A(X),Z=function(a){Y({target:a.target})},$=function(a,b){try{a.contentWindow.location.replace(b)}catch(c){a.src=b}},_=function(a){var b,c=a[i](d.srcsetAttr);(b=d.customMedia[a[i]("data-media")||a[i]("media")])&&a.setAttribute("media",b),c&&a.setAttribute("srcset",c)},aa=A(function(a,b,c,e,f){var g,h,j,l,o,p;(o=v(a,"lazybeforeunveil",b)).defaultPrevented||(e&&(c?s(a,d.autosizesClass):a.setAttribute("sizes",e)),h=a[i](d.srcsetAttr),g=a[i](d.srcAttr),f&&(j=a.parentNode,l=j&&n.test(j.nodeName||"")),p=b.firesLoad||"src"in a&&(h||g||l),o={target:a},p&&(u(a,T,!0),clearTimeout(m),m=k(T,2500),s(a,d.loadingClass),u(a,Z,!0)),l&&q.call(j.getElementsByTagName("source"),_),h?a.setAttribute("srcset",h):g&&!l&&(N.test(a.nodeName)?$(a,g):a.src=g),f&&(h||l)&&w(a,{src:g})),a._lazyRace&&delete a._lazyRace,t(a,d.lazyClass),z(function(){(!p||a.complete&&a.naturalWidth>1)&&(p?T(o):R--,X(o))},!0)}),ba=function(a){var b,c=M.test(a.nodeName),e=c&&(a[i](d.sizesAttr)||a[i]("sizes")),f="auto"==e;(!f&&l||!c||!a[i]("src")&&!a.srcset||a.complete||r(a,d.errorClass)||!r(a,d.lazyClass))&&(b=v(a,"lazyunveilread").detail,f&&E.updateElem(a,!0,a.offsetWidth),a._lazyRace=!0,R++,aa(a,b,f,e,c))},ca=function(){if(!l){if(f.now()-p<999)return void k(ca,999);var a=C(function(){d.loadMode=3,W()});l=!0,d.loadMode=3,W(),j("scroll",function(){3==d.loadMode&&(d.loadMode=2),a()},!0)}};return{_:function(){p=f.now(),c.elements=b.getElementsByClassName(d.lazyClass),g=b.getElementsByClassName(d.lazyClass+" "+d.preloadClass),L=d.hFac,j("scroll",W,!0),j("resize",W,!0),a.MutationObserver?new MutationObserver(W).observe(e,{childList:!0,subtree:!0,attributes:!0}):(e[h]("DOMNodeInserted",W,!0),e[h]("DOMAttrModified",W,!0),setInterval(W,999)),j("hashchange",W,!0),["focus","mouseover","click","load","transitionend","animationend","webkitAnimationEnd"].forEach(function(a){b[h](a,W,!0)}),/d$|^c/.test(b.readyState)?ca():(j("load",ca),b[h]("DOMContentLoaded",W),k(ca,2e4)),c.elements.length?(V(),z._lsFlush()):W()},checkElems:W,unveil:ba}}(),E=function(){var a,c=A(function(a,b,c,d){var e,f,g;if(a._lazysizesWidth=d,d+="px",a.setAttribute("sizes",d),n.test(b.nodeName||""))for(e=b.getElementsByTagName("source"),f=0,g=e.length;g>f;f++)e[f].setAttribute("sizes",d);c.detail.dataAttr||w(a,c.detail)}),e=function(a,b,d){var e,f=a.parentNode;f&&(d=y(a,f,d),e=v(a,"lazybeforesizes",{width:d,dataAttr:!!b}),e.defaultPrevented||(d=e.detail.width,d&&d!==a._lazysizesWidth&&c(a,f,e,d)))},f=function(){var b,c=a.length;if(c)for(b=0;c>b;b++)e(a[b])},g=C(f);return{_:function(){a=b.getElementsByClassName(d.autosizesClass),j("resize",g)},checkElems:g,updateElem:e}}(),F=function(){F.i||(F.i=!0,E._(),D._())};return c={cfg:d,autoSizer:E,loader:D,init:F,uP:w,aC:s,rC:t,hC:r,fire:v,gW:y,rAF:z}}});
/*! jQuery Validation Plugin - v1.15.0 - 2/24/2016
 * http://jqueryvalidation.org/
 * Copyright (c) 2016 Jörn Zaefferer; Licensed MIT */
!function(a){"function"==typeof define&&define.amd?define(["jquery","./jquery.validate.min"],a):"object"==typeof module&&module.exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){!function(){function b(a){return a.replace(/<.[^<>]*?>/g," ").replace(/&nbsp;|&#160;/gi," ").replace(/[.(),;:!?%#$'\"_+=\/\-“”’]*/g,"")}a.validator.addMethod("maxWords",function(a,c,d){return this.optional(c)||b(a).match(/\b\w+\b/g).length<=d},a.validator.format("Please enter {0} words or less.")),a.validator.addMethod("minWords",function(a,c,d){return this.optional(c)||b(a).match(/\b\w+\b/g).length>=d},a.validator.format("Please enter at least {0} words.")),a.validator.addMethod("rangeWords",function(a,c,d){var e=b(a),f=/\b\w+\b/g;return this.optional(c)||e.match(f).length>=d[0]&&e.match(f).length<=d[1]},a.validator.format("Please enter between {0} and {1} words."))}(),a.validator.addMethod("accept",function(b,c,d){var e,f,g,h="string"==typeof d?d.replace(/\s/g,""):"image/*",i=this.optional(c);if(i)return i;if("file"===a(c).attr("type")&&(h=h.replace(/[\-\[\]\/\{\}\(\)\+\?\.\\\^\$\|]/g,"\\$&").replace(/,/g,"|").replace("/*","/.*"),c.files&&c.files.length))for(g=new RegExp(".?("+h+")$","i"),e=0;e<c.files.length;e++)if(f=c.files[e],!f.type.match(g))return!1;return!0},a.validator.format("Please enter a value with a valid mimetype.")),a.validator.addMethod("alphanumeric",function(a,b){return this.optional(b)||/^\w+$/i.test(a)},"Letters, numbers, and underscores only please"),a.validator.addMethod("bankaccountNL",function(a,b){if(this.optional(b))return!0;if(!/^[0-9]{9}|([0-9]{2} ){3}[0-9]{3}$/.test(a))return!1;var c,d,e,f=a.replace(/ /g,""),g=0,h=f.length;for(c=0;h>c;c++)d=h-c,e=f.substring(c,c+1),g+=d*e;return g%11===0},"Please specify a valid bank account number"),a.validator.addMethod("bankorgiroaccountNL",function(b,c){return this.optional(c)||a.validator.methods.bankaccountNL.call(this,b,c)||a.validator.methods.giroaccountNL.call(this,b,c)},"Please specify a valid bank or giro account number"),a.validator.addMethod("bic",function(a,b){return this.optional(b)||/^([A-Z]{6}[A-Z2-9][A-NP-Z1-9])(X{3}|[A-WY-Z0-9][A-Z0-9]{2})?$/.test(a.toUpperCase())},"Please specify a valid BIC code"),a.validator.addMethod("cifES",function(a){"use strict";var b,c,d,e,f,g,h=[];if(a=a.toUpperCase(),!a.match("((^[A-Z]{1}[0-9]{7}[A-Z0-9]{1}$|^[T]{1}[A-Z0-9]{8}$)|^[0-9]{8}[A-Z]{1}$)"))return!1;for(d=0;9>d;d++)h[d]=parseInt(a.charAt(d),10);for(c=h[2]+h[4]+h[6],e=1;8>e;e+=2)f=(2*h[e]).toString(),g=f.charAt(1),c+=parseInt(f.charAt(0),10)+(""===g?0:parseInt(g,10));return/^[ABCDEFGHJNPQRSUVW]{1}/.test(a)?(c+="",b=10-parseInt(c.charAt(c.length-1),10),a+=b,h[8].toString()===String.fromCharCode(64+b)||h[8].toString()===a.charAt(a.length-1)):!1},"Please specify a valid CIF number."),a.validator.addMethod("cpfBR",function(a){if(a=a.replace(/([~!@#$%^&*()_+=`{}\[\]\-|\\:;'<>,.\/? ])+/g,""),11!==a.length)return!1;var b,c,d,e,f=0;if(b=parseInt(a.substring(9,10),10),c=parseInt(a.substring(10,11),10),d=function(a,b){var c=10*a%11;return 10!==c&&11!==c||(c=0),c===b},""===a||"00000000000"===a||"11111111111"===a||"22222222222"===a||"33333333333"===a||"44444444444"===a||"55555555555"===a||"66666666666"===a||"77777777777"===a||"88888888888"===a||"99999999999"===a)return!1;for(e=1;9>=e;e++)f+=parseInt(a.substring(e-1,e),10)*(11-e);if(d(f,b)){for(f=0,e=1;10>=e;e++)f+=parseInt(a.substring(e-1,e),10)*(12-e);return d(f,c)}return!1},"Please specify a valid CPF number"),a.validator.addMethod("creditcard",function(a,b){if(this.optional(b))return"dependency-mismatch";if(/[^0-9 \-]+/.test(a))return!1;var c,d,e=0,f=0,g=!1;if(a=a.replace(/\D/g,""),a.length<13||a.length>19)return!1;for(c=a.length-1;c>=0;c--)d=a.charAt(c),f=parseInt(d,10),g&&(f*=2)>9&&(f-=9),e+=f,g=!g;return e%10===0},"Please enter a valid credit card number."),a.validator.addMethod("creditcardtypes",function(a,b,c){if(/[^0-9\-]+/.test(a))return!1;a=a.replace(/\D/g,"");var d=0;return c.mastercard&&(d|=1),c.visa&&(d|=2),c.amex&&(d|=4),c.dinersclub&&(d|=8),c.enroute&&(d|=16),c.discover&&(d|=32),c.jcb&&(d|=64),c.unknown&&(d|=128),c.all&&(d=255),1&d&&/^(5[12345])/.test(a)?16===a.length:2&d&&/^(4)/.test(a)?16===a.length:4&d&&/^(3[47])/.test(a)?15===a.length:8&d&&/^(3(0[012345]|[68]))/.test(a)?14===a.length:16&d&&/^(2(014|149))/.test(a)?15===a.length:32&d&&/^(6011)/.test(a)?16===a.length:64&d&&/^(3)/.test(a)?16===a.length:64&d&&/^(2131|1800)/.test(a)?15===a.length:!!(128&d)},"Please enter a valid credit card number."),a.validator.addMethod("currency",function(a,b,c){var d,e="string"==typeof c,f=e?c:c[0],g=e?!0:c[1];return f=f.replace(/,/g,""),f=g?f+"]":f+"]?",d="^["+f+"([1-9]{1}[0-9]{0,2}(\\,[0-9]{3})*(\\.[0-9]{0,2})?|[1-9]{1}[0-9]{0,}(\\.[0-9]{0,2})?|0(\\.[0-9]{0,2})?|(\\.[0-9]{1,2})?)$",d=new RegExp(d),this.optional(b)||d.test(a)},"Please specify a valid currency"),a.validator.addMethod("dateFA",function(a,b){return this.optional(b)||/^[1-4]\d{3}\/((0?[1-6]\/((3[0-1])|([1-2][0-9])|(0?[1-9])))|((1[0-2]|(0?[7-9]))\/(30|([1-2][0-9])|(0?[1-9]))))$/.test(a)},a.validator.messages.date),a.validator.addMethod("dateITA",function(a,b){var c,d,e,f,g,h=!1,i=/^\d{1,2}\/\d{1,2}\/\d{4}$/;return i.test(a)?(c=a.split("/"),d=parseInt(c[0],10),e=parseInt(c[1],10),f=parseInt(c[2],10),g=new Date(Date.UTC(f,e-1,d,12,0,0,0)),h=g.getUTCFullYear()===f&&g.getUTCMonth()===e-1&&g.getUTCDate()===d):h=!1,this.optional(b)||h},a.validator.messages.date),a.validator.addMethod("dateNL",function(a,b){return this.optional(b)||/^(0?[1-9]|[12]\d|3[01])[\.\/\-](0?[1-9]|1[012])[\.\/\-]([12]\d)?(\d\d)$/.test(a)},a.validator.messages.date),a.validator.addMethod("extension",function(a,b,c){return c="string"==typeof c?c.replace(/,/g,"|"):"png|jpe?g|gif",this.optional(b)||a.match(new RegExp("\\.("+c+")$","i"))},a.validator.format("Please enter a value with a valid extension.")),a.validator.addMethod("giroaccountNL",function(a,b){return this.optional(b)||/^[0-9]{1,7}$/.test(a)},"Please specify a valid giro account number"),a.validator.addMethod("iban",function(a,b){if(this.optional(b))return!0;var c,d,e,f,g,h,i,j,k,l=a.replace(/ /g,"").toUpperCase(),m="",n=!0,o="",p="";if(c=l.substring(0,2),h={AL:"\\d{8}[\\dA-Z]{16}",AD:"\\d{8}[\\dA-Z]{12}",AT:"\\d{16}",AZ:"[\\dA-Z]{4}\\d{20}",BE:"\\d{12}",BH:"[A-Z]{4}[\\dA-Z]{14}",BA:"\\d{16}",BR:"\\d{23}[A-Z][\\dA-Z]",BG:"[A-Z]{4}\\d{6}[\\dA-Z]{8}",CR:"\\d{17}",HR:"\\d{17}",CY:"\\d{8}[\\dA-Z]{16}",CZ:"\\d{20}",DK:"\\d{14}",DO:"[A-Z]{4}\\d{20}",EE:"\\d{16}",FO:"\\d{14}",FI:"\\d{14}",FR:"\\d{10}[\\dA-Z]{11}\\d{2}",GE:"[\\dA-Z]{2}\\d{16}",DE:"\\d{18}",GI:"[A-Z]{4}[\\dA-Z]{15}",GR:"\\d{7}[\\dA-Z]{16}",GL:"\\d{14}",GT:"[\\dA-Z]{4}[\\dA-Z]{20}",HU:"\\d{24}",IS:"\\d{22}",IE:"[\\dA-Z]{4}\\d{14}",IL:"\\d{19}",IT:"[A-Z]\\d{10}[\\dA-Z]{12}",KZ:"\\d{3}[\\dA-Z]{13}",KW:"[A-Z]{4}[\\dA-Z]{22}",LV:"[A-Z]{4}[\\dA-Z]{13}",LB:"\\d{4}[\\dA-Z]{20}",LI:"\\d{5}[\\dA-Z]{12}",LT:"\\d{16}",LU:"\\d{3}[\\dA-Z]{13}",MK:"\\d{3}[\\dA-Z]{10}\\d{2}",MT:"[A-Z]{4}\\d{5}[\\dA-Z]{18}",MR:"\\d{23}",MU:"[A-Z]{4}\\d{19}[A-Z]{3}",MC:"\\d{10}[\\dA-Z]{11}\\d{2}",MD:"[\\dA-Z]{2}\\d{18}",ME:"\\d{18}",NL:"[A-Z]{4}\\d{10}",NO:"\\d{11}",PK:"[\\dA-Z]{4}\\d{16}",PS:"[\\dA-Z]{4}\\d{21}",PL:"\\d{24}",PT:"\\d{21}",RO:"[A-Z]{4}[\\dA-Z]{16}",SM:"[A-Z]\\d{10}[\\dA-Z]{12}",SA:"\\d{2}[\\dA-Z]{18}",RS:"\\d{18}",SK:"\\d{20}",SI:"\\d{15}",ES:"\\d{20}",SE:"\\d{20}",CH:"\\d{5}[\\dA-Z]{12}",TN:"\\d{20}",TR:"\\d{5}[\\dA-Z]{17}",AE:"\\d{3}\\d{16}",GB:"[A-Z]{4}\\d{14}",VG:"[\\dA-Z]{4}\\d{16}"},g=h[c],"undefined"!=typeof g&&(i=new RegExp("^[A-Z]{2}\\d{2}"+g+"$",""),!i.test(l)))return!1;for(d=l.substring(4,l.length)+l.substring(0,4),j=0;j<d.length;j++)e=d.charAt(j),"0"!==e&&(n=!1),n||(m+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ".indexOf(e));for(k=0;k<m.length;k++)f=m.charAt(k),p=""+o+f,o=p%97;return 1===o},"Please specify a valid IBAN"),a.validator.addMethod("integer",function(a,b){return this.optional(b)||/^-?\d+$/.test(a)},"A positive or negative non-decimal number please"),a.validator.addMethod("ipv4",function(a,b){return this.optional(b)||/^(25[0-5]|2[0-4]\d|[01]?\d\d?)\.(25[0-5]|2[0-4]\d|[01]?\d\d?)\.(25[0-5]|2[0-4]\d|[01]?\d\d?)\.(25[0-5]|2[0-4]\d|[01]?\d\d?)$/i.test(a)},"Please enter a valid IP v4 address."),a.validator.addMethod("ipv6",function(a,b){return this.optional(b)||/^((([0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){6}:[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){5}:([0-9A-Fa-f]{1,4}:)?[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){4}:([0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){3}:([0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){2}:([0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){6}((\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b)\.){3}(\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b))|(([0-9A-Fa-f]{1,4}:){0,5}:((\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b)\.){3}(\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b))|(::([0-9A-Fa-f]{1,4}:){0,5}((\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b)\.){3}(\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b))|([0-9A-Fa-f]{1,4}::([0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})|(::([0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){1,7}:))$/i.test(a)},"Please enter a valid IP v6 address."),a.validator.addMethod("lettersonly",function(a,b){return this.optional(b)||/^[a-z]+$/i.test(a)},"Letters only please"),a.validator.addMethod("letterswithbasicpunc",function(a,b){return this.optional(b)||/^[a-z\-.,()'"\s]+$/i.test(a)},"Letters or punctuation only please"),a.validator.addMethod("mobileNL",function(a,b){return this.optional(b)||/^((\+|00(\s|\s?\-\s?)?)31(\s|\s?\-\s?)?(\(0\)[\-\s]?)?|0)6((\s|\s?\-\s?)?[0-9]){8}$/.test(a)},"Please specify a valid mobile number"),a.validator.addMethod("mobileUK",function(a,b){return a=a.replace(/\(|\)|\s+|-/g,""),this.optional(b)||a.length>9&&a.match(/^(?:(?:(?:00\s?|\+)44\s?|0)7(?:[1345789]\d{2}|624)\s?\d{3}\s?\d{3})$/)},"Please specify a valid mobile number"),a.validator.addMethod("nieES",function(a){"use strict";return a=a.toUpperCase(),a.match("((^[A-Z]{1}[0-9]{7}[A-Z0-9]{1}$|^[T]{1}[A-Z0-9]{8}$)|^[0-9]{8}[A-Z]{1}$)")?/^[T]{1}/.test(a)?a[8]===/^[T]{1}[A-Z0-9]{8}$/.test(a):/^[XYZ]{1}/.test(a)?a[8]==="TRWAGMYFPDXBNJZSQVHLCKE".charAt(a.replace("X","0").replace("Y","1").replace("Z","2").substring(0,8)%23):!1:!1},"Please specify a valid NIE number."),a.validator.addMethod("nifES",function(a){"use strict";return a=a.toUpperCase(),a.match("((^[A-Z]{1}[0-9]{7}[A-Z0-9]{1}$|^[T]{1}[A-Z0-9]{8}$)|^[0-9]{8}[A-Z]{1}$)")?/^[0-9]{8}[A-Z]{1}$/.test(a)?"TRWAGMYFPDXBNJZSQVHLCKE".charAt(a.substring(8,0)%23)===a.charAt(8):/^[KLM]{1}/.test(a)?a[8]===String.fromCharCode(64):!1:!1},"Please specify a valid NIF number."),jQuery.validator.addMethod("notEqualTo",function(b,c,d){return this.optional(c)||!a.validator.methods.equalTo.call(this,b,c,d)},"Please enter a different value, values must not be the same."),a.validator.addMethod("nowhitespace",function(a,b){return this.optional(b)||/^\S+$/i.test(a)},"No white space please"),a.validator.addMethod("pattern",function(a,b,c){return this.optional(b)?!0:("string"==typeof c&&(c=new RegExp("^(?:"+c+")$")),c.test(a))},"Invalid format."),a.validator.addMethod("phoneNL",function(a,b){return this.optional(b)||/^((\+|00(\s|\s?\-\s?)?)31(\s|\s?\-\s?)?(\(0\)[\-\s]?)?|0)[1-9]((\s|\s?\-\s?)?[0-9]){8}$/.test(a)},"Please specify a valid phone number."),a.validator.addMethod("phoneUK",function(a,b){return a=a.replace(/\(|\)|\s+|-/g,""),this.optional(b)||a.length>9&&a.match(/^(?:(?:(?:00\s?|\+)44\s?)|(?:\(?0))(?:\d{2}\)?\s?\d{4}\s?\d{4}|\d{3}\)?\s?\d{3}\s?\d{3,4}|\d{4}\)?\s?(?:\d{5}|\d{3}\s?\d{3})|\d{5}\)?\s?\d{4,5})$/)},"Please specify a valid phone number"),a.validator.addMethod("phoneUS",function(a,b){return a=a.replace(/\s+/g,""),this.optional(b)||a.length>9&&a.match(/^(\+?1-?)?(\([2-9]([02-9]\d|1[02-9])\)|[2-9]([02-9]\d|1[02-9]))-?[2-9]([02-9]\d|1[02-9])-?\d{4}$/)},"Please specify a valid phone number"),a.validator.addMethod("phonesUK",function(a,b){return a=a.replace(/\(|\)|\s+|-/g,""),this.optional(b)||a.length>9&&a.match(/^(?:(?:(?:00\s?|\+)44\s?|0)(?:1\d{8,9}|[23]\d{9}|7(?:[1345789]\d{8}|624\d{6})))$/)},"Please specify a valid uk phone number"),a.validator.addMethod("postalCodeCA",function(a,b){return this.optional(b)||/^[ABCEGHJKLMNPRSTVXY]\d[ABCEGHJKLMNPRSTVWXYZ] *\d[ABCEGHJKLMNPRSTVWXYZ]\d$/i.test(a)},"Please specify a valid postal code"),a.validator.addMethod("postalcodeBR",function(a,b){return this.optional(b)||/^\d{2}.\d{3}-\d{3}?$|^\d{5}-?\d{3}?$/.test(a)},"Informe um CEP válido."),a.validator.addMethod("postalcodeIT",function(a,b){return this.optional(b)||/^\d{5}$/.test(a)},"Please specify a valid postal code"),a.validator.addMethod("postalcodeNL",function(a,b){return this.optional(b)||/^[1-9][0-9]{3}\s?[a-zA-Z]{2}$/.test(a)},"Please specify a valid postal code"),a.validator.addMethod("postcodeUK",function(a,b){return this.optional(b)||/^((([A-PR-UWYZ][0-9])|([A-PR-UWYZ][0-9][0-9])|([A-PR-UWYZ][A-HK-Y][0-9])|([A-PR-UWYZ][A-HK-Y][0-9][0-9])|([A-PR-UWYZ][0-9][A-HJKSTUW])|([A-PR-UWYZ][A-HK-Y][0-9][ABEHMNPRVWXY]))\s?([0-9][ABD-HJLNP-UW-Z]{2})|(GIR)\s?(0AA))$/i.test(a)},"Please specify a valid UK postcode"),a.validator.addMethod("require_from_group",function(b,c,d){var e=a(d[1],c.form),f=e.eq(0),g=f.data("valid_req_grp")?f.data("valid_req_grp"):a.extend({},this),h=e.filter(function(){return g.elementValue(this)}).length>=d[0];return f.data("valid_req_grp",g),a(c).data("being_validated")||(e.data("being_validated",!0),e.each(function(){g.element(this)}),e.data("being_validated",!1)),h},a.validator.format("Please fill at least {0} of these fields.")),a.validator.addMethod("skip_or_fill_minimum",function(b,c,d){var e=a(d[1],c.form),f=e.eq(0),g=f.data("valid_skip")?f.data("valid_skip"):a.extend({},this),h=e.filter(function(){return g.elementValue(this)}).length,i=0===h||h>=d[0];return f.data("valid_skip",g),a(c).data("being_validated")||(e.data("being_validated",!0),e.each(function(){g.element(this)}),e.data("being_validated",!1)),i},a.validator.format("Please either skip these fields or fill at least {0} of them.")),a.validator.addMethod("stateUS",function(a,b,c){var d,e="undefined"==typeof c,f=e||"undefined"==typeof c.caseSensitive?!1:c.caseSensitive,g=e||"undefined"==typeof c.includeTerritories?!1:c.includeTerritories,h=e||"undefined"==typeof c.includeMilitary?!1:c.includeMilitary;return d=g||h?g&&h?"^(A[AEKLPRSZ]|C[AOT]|D[CE]|FL|G[AU]|HI|I[ADLN]|K[SY]|LA|M[ADEINOPST]|N[CDEHJMVY]|O[HKR]|P[AR]|RI|S[CD]|T[NX]|UT|V[AIT]|W[AIVY])$":g?"^(A[KLRSZ]|C[AOT]|D[CE]|FL|G[AU]|HI|I[ADLN]|K[SY]|LA|M[ADEINOPST]|N[CDEHJMVY]|O[HKR]|P[AR]|RI|S[CD]|T[NX]|UT|V[AIT]|W[AIVY])$":"^(A[AEKLPRZ]|C[AOT]|D[CE]|FL|GA|HI|I[ADLN]|K[SY]|LA|M[ADEINOST]|N[CDEHJMVY]|O[HKR]|PA|RI|S[CD]|T[NX]|UT|V[AT]|W[AIVY])$":"^(A[KLRZ]|C[AOT]|D[CE]|FL|GA|HI|I[ADLN]|K[SY]|LA|M[ADEINOST]|N[CDEHJMVY]|O[HKR]|PA|RI|S[CD]|T[NX]|UT|V[AT]|W[AIVY])$",d=f?new RegExp(d):new RegExp(d,"i"),this.optional(b)||d.test(a)},"Please specify a valid state"),a.validator.addMethod("strippedminlength",function(b,c,d){return a(b).text().length>=d},a.validator.format("Please enter at least {0} characters")),a.validator.addMethod("time",function(a,b){return this.optional(b)||/^([01]\d|2[0-3]|[0-9])(:[0-5]\d){1,2}$/.test(a)},"Please enter a valid time, between 00:00 and 23:59"),a.validator.addMethod("time12h",function(a,b){return this.optional(b)||/^((0?[1-9]|1[012])(:[0-5]\d){1,2}(\ ?[AP]M))$/i.test(a)},"Please enter a valid time in 12-hour am/pm format"),a.validator.addMethod("url2",function(a,b){return this.optional(b)||/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)*(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a)},a.validator.messages.url),a.validator.addMethod("vinUS",function(a){if(17!==a.length)return!1;var b,c,d,e,f,g,h=["A","B","C","D","E","F","G","H","J","K","L","M","N","P","R","S","T","U","V","W","X","Y","Z"],i=[1,2,3,4,5,6,7,8,1,2,3,4,5,7,9,2,3,4,5,6,7,8,9],j=[8,7,6,5,4,3,2,10,0,9,8,7,6,5,4,3,2],k=0;for(b=0;17>b;b++){if(e=j[b],d=a.slice(b,b+1),8===b&&(g=d),isNaN(d)){for(c=0;c<h.length;c++)if(d.toUpperCase()===h[c]){d=i[c],d*=e,isNaN(g)&&8===c&&(g=h[c]);break}}else d*=e;k+=d}return f=k%11,10===f&&(f="X"),f===g},"The specified vehicle identification number (VIN) is invalid."),a.validator.addMethod("zipcodeUS",function(a,b){return this.optional(b)||/^\d{5}(-\d{4})?$/.test(a)},"The specified US ZIP Code is invalid"),a.validator.addMethod("ziprange",function(a,b){return this.optional(b)||/^90[2-5]\d\{2\}-\d{4}$/.test(a)},"Your ZIP-code must be in the range 902xx-xxxx to 905xx-xxxx")});
/**
 * Rotate360
 * @fileOverview This plugin allows view images in 360 degree view by drawing images on canvas 
 * Reference: http://tikslus.com/tikslus360/demo
 * Reference: AKQA 360 https://bitbucket.akqa.net/projects/GLWD/repos/akqa-360-image-navigator-component/browse
 */

(function($) {

    'use strict';
    /**
     * Rotate360 Base class for the plugin
     * @param {HTMLElement} element
     * @param {Object} options options defining the path, max limit etc
     */
    function Rotate360(element, options) {

        var self = this;
        this.$elem = $(element),

        this.canvas = null;
        this.$loader = null;
        this.loaded = false;
        this.context = null;

        this.bMouseDown = false;
        this.iMouseX = 1;
        this.iMouseY = 1;
        this.tx;

        this.imagesArr = [];
        this.fullRotation = true;
        this.startTime = 0;

        this.isAnimating = false;
        this.autoPlayTimer = 0;

        this.currentFrame = 1;
        this.prefix = '';
        this.path = '';
        this.isAnimating = false; // keep track of frame animation
        this.controlWidth = 0;
        this.buffer = (window.screen && window.screen.width) > 767 ? 40 : 0;

        this.defaults = {
            path: 'images',
            ext: 'png', //could be png,jpg,bmp
            baseIndex: 1,
            max: 72,
            fullRotation: true,
            autoRotateInterval: 50,
            fadeInInterval: 400,
            canvasWidth: 640,
            canvasHeight: 480,
            canvasID: 'iwc-canvas',
            showControl: true,
            loader: '<span class="iwc-loader-gif"></span>'
        };

        // Tells the app if the user is dragging the pointer
        this.dragging = false;

        this.draggingtoggle = false;
        this.$control = this.$elem.siblings('.stage-controls');
        this.$dragButton = this.$control.find('.iwc-stage-control-arrow');

        // Extend our default options with those provided.
        this.options = $.extend({}, this.defaults, options);

        if (this.options.fullRotation) {
            this.options.max = this.options.max + 1; // 73 images
        }

        this.adaptiveImage = options.adaptiveImage || '';
        this.tx = (this.options.canvasWidth/this.options.max);

        // controls
        this.controlBarWidth = this.$control.width();
        this.slideFactor = Math.ceil(this.controlBarWidth / this.options.max);

        this.init.apply(this);
        //bind touch/drag events
        $.subscribe('iwc:360:loaded', function() {
            self.initEvents();
        });
    };

    Rotate360.prototype = {
        /**
         * Initialise rotation component
         * @function init
         * @private
         * @memberOf Rotate360
        */
        init: function() {
            var self = this;

            //show loader while images are being loaded
            this.$loader = $(this.options.loader);
            this.$elem.append(this.$loader);

            if (this.options.canvasHeight < 260) {
                this.options.canvasHeight = 260;
            }

            this.$elem
            .append("<canvas id='" + this.options.canvasID + "' aria-hidden='true' width='" + this.options.canvasWidth + "' height='" + this.options.canvasHeight + "'></canvas>");

            this.$elem.css({
                width: (this.options.canvasWidth + this.buffer) + "px",
                height: this.options.canvasHeight + "px",
                position: 'relative'
            });

            this.canvas = document.getElementById(this.options.canvasID);
            this.context = this.canvas.getContext('2d');

            this.loadImages();
        },
        /**
         * Clear canvas
         * @function clearCanvas
         * @private
         * @memberOf Rotate360
         */
        clearCanvas: function() {
            this.context.clearRect(0, 0, this.context.canvas.width, this.context.canvas.height);
        },
        /**
         * Resize Canvas
         * @function updateCanvas
         * @param {[type]} [varname] [description]
         * @private
         * @memberOf Rotate360
         */
        updateCanvas: function(width, height) {
            var self = this;

            if (height < 260) {
                height = 260;
            }

            this.$elem.css({
                width: (width + this.buffer) + "px",
                height: height + "px",
            });

            this.canvas.width = width;
            this.canvas.height = height;
            this.rotate360(this.currentFrame);
        },
        /**
         * move to desired frame
         * @param {Number} num frame number
         * @param {Number} key direction or rotation [backward -1, forward +1]
         * @function moveFrames
         * @public
         * @memberOf Rotate360
         */
        moveFrames: function(num, key) {

            var self = this,
                distance = Math.floor((this.options.max - num) / 12),
                speed = distance > 1 ? 30 : self.options.autoRotateInterval,
                direction = key || num > self.currentFrame ? 1 : -1;

            if (num > this.options.max || num < 0) {
                clearInterval(self.autoPlayTimer);
                return;
            }

            if (this.isAnimating) {
                return false;
            }

            // animate frames
            self.autoPlayTimer = setInterval(function() {

                self.isAnimating = true;

                if (self.currentFrame === num) {

                    self.isAnimating = false;
                    clearInterval(self.autoPlayTimer);
                    return;

                } else if(self.currentFrame === self.options.max ) {

                    self.currentFrame = 1;
                    self.rotate360(self.currentFrame);
                    clearInterval(self.autoPlayTimer);
                    return;
                } else {
                    self.rotate360(direction + self.currentFrame);
                }
            }, speed);
        },
        /**
         * Update canvas if frame number exits
         * @function rotate360
         * @param {Number} num Index of Image Array
         * @private
         * @memberOf Rotate360
         */
        rotate360: function(num) {
            var self = this,
                image = self.imagesArr[num];

            if (!self.imagesArr[num]) {
                return;
            }

            this.clearCanvas();
            this.drawImageOnCanvas(image);

            this.currentFrame = num;
            $.publish('iwc:360:drawImage', [num]);
        },

        /**
         * Draw image on canvas
         * @function drawImageOnCanvas
         * @private
         * @memberOf Rotate360
         */
        drawImageOnCanvas: function(image) {
            var cw = this.canvas.width,
                ch = this.canvas.height;

            this.context.drawImage(image, parseInt((cw - image.width) / 2), parseInt((ch - image.height) / 2));
        },

        /**
         * Image loader
         * @function loadImages
         * @private
         * @memberOf Rotate360
         */
        loadImages: function() {

            var image,
                path,
                baseIndex = this.options.baseIndex,
                max = this.options.max,
                imagesLoaded = 0,
                self = this;
                this.imagesArr = [];

                this.clearCanvas();

            for (var i = baseIndex, len = max; i <= len; i++) {

                this.prefix = i < 10 ? '0' : '';
                path = this.options.path + this.options.imgName + this.prefix + i + "." + this.options.ext + this.adaptiveImage;

                image = new Image();
                this.imagesArr.push(image);

                if (this.options.fullRotation && i === len) {
                    image.src = this.imagesArr[0].src; // add first image as last frame
                } else {
                    image.src = path;
                }

                image.onload = function() {
                    imagesLoaded += 1;
                    var percentage = Math.ceil((imagesLoaded / max) * 100);
                    self.$loader.text(percentage + '%');

                    if (imagesLoaded === max) {
                        self.$loader.remove();
                        self.rotate360(0);
                        self.loaded = true;
                        $.publish('iwc:360:loaded');
                    }
                }

                image.onerror = function() {
                    console.log('Failed to Load Image '+ path);
                }
            }
        },
        /**
         * Set control knob position
         * @function moveHanlde
         * @param  {HTMLElemnt} elem HTMLElemen on which event is triggered
         * @param  {object} event event object
         * @private
         * @memberOf Rotate360
         */
        moveHanlde: function(elem, event) {

            if (!this.dragging) {
                return;
            }
            // We need to find out the position left we do this by getthg the parents position and the childs pos, with Zepto
            var $handle = this.$dragButton,
                dragWidth= this.controlBarWidth,
                childPos = $handle.offset(),
                parentPos = $handle.parent().offset(),
                childOffset = {
                    top: childPos.top - parentPos.top,
                    left: childPos.left - parentPos.left
                },
                currpos = this.getPointerEvent(event).pageX,
                csspos = childOffset.left + (currpos - window.lastpos),
                frame;

            if (!this.draggingtoggle || csspos < 0 || csspos > dragWidth) {
                return;
            }

            if (this.isAnimating) {
                clearInterval(this.autoPlayTimer);
                this.autoPlayTimer = null;
                this.isAnimating = false;
            }

            if (csspos) {
                $handle
                .css({transform: 'translateX(' + csspos + 'px)'})
                .parent().addClass('drag');
            }

            frame = Math.ceil(csspos/ Math.ceil(dragWidth / this.defaults.max, 10),10);
            this.rotate360(frame);
            window.lastpos = currpos;
        },
        /**
        * Returns a simple event regarding the original event is a mouse event or a touch event.
         * @function getPointerEvent
         * @param  {object} event event object
         * @private
         * @memberOf Rotate360
        */
        getPointerEvent: function(event) {
            // bail out if event is undefined
            if (!event) {
                return;
            }

            //need to wrap platform in here as zatos and jquery are different
            if (event.targetTouches ) {
                return event.targetTouches ? event.targetTouches[0] : event;
            } else if (event.type === 'mousemove') {
                return event;
            } else if (event.originalEvent && event.originalEvent.targetTouches) {
                return event.originalEvent.targetTouches[0];
            } else {
                return event;
            }
        },
        /**
         * Handler for touchend/mouseup
         * @function onEngageClickEnd
         * @param  {Object} event event object
         * @private
         * @memberOf Rotate360
         */
        onEngageClickEnd: function (event){
            // Prevents the original event handler behaciour
            event.preventDefault();
            event.stopPropagation();
            // Tells the pointer tracking function that the user finished dragging the pointer and it doesn't need to track the pointer changes anymore
            this.dragging = false;
            this.$elem.removeClass('iwc-dragging');
        },
        /**
         * Handler for touchstart/mousedown
         * @function onStart
         * @param  {Object} event event object
         * @private
         * @memberOf Rotate360
         */
        onStart: function (event) {
            event.preventDefault();
            event.stopPropagation();

            this.dragging = true;
            window.lastpos = this.getPointerEvent(event).pageX;
            this.draggingtoggle = true;
            $(document).one('mouseup.galdrag touchend.galdrag mouseleave.galdrag', this.onDragEnd.bind(this));
        },
        /**
         * Handler for touchmove/mousemove
         * @function onMove
         * @param  {Object} event event object
         * @private
         * @memberOf Rotate360
         */
        onMove: function(event) {
            event.preventDefault();
            event.stopPropagation();
            this.moveHanlde(this.$control, event);
        },
        /**
         * Handler for touchend/mouseup
         * @function onEnd
         * @param  {Object} event event object
         * @private
         * @memberOf Rotate360
         */
        onEnd: function (event) {
            event.preventDefault();
            event.stopPropagation();
            this.draggingtoggle = false;
            this.dragging = false;
        },
        /**
         * Handler for touchend/mouseleave
         * @function onDragEnd
         * @param  {Object} event event object
         * @private
         * @memberOf Rotate360
         */
        onDragEnd: function(event) {
            event.preventDefault();
            event.stopPropagation();
            this.draggingtoggle = false;
            this.$control.removeClass('drag');
        },
        /**
         * Handler for touchleave/mouseleave
         * @function onLeave
         * @param  {Object} event event object
         * @private
         * @memberOf Rotate360
         */
        onLeave: function (event) {
            event.preventDefault();
            event.stopPropagation();
            this.draggingtoggle = false;
            this.dragging = false;
            this.$control.removeClass('drag');
        },
        /**
         * Handler for touchmove/mousemove
         * @function onMouseMove
         * @param  {Object} event event object
         * @private
         * @memberOf Rotate360
         */
        onMouseMove: function(e) {

            var canvasOffset = this.$elem.offset(),
                csspos;

            this.iMouseX = Math.floor(e.pageX - canvasOffset.left);
            this.iMouseY = Math.floor(e.pageY - canvasOffset.top);
            this.modulus = Math.ceil(this.iMouseX / this.tx);

            if (this.modulus <= 0) {
                this.modulus = 0;
            } else if(this.modulus > this.options.max - 1) {
                this.modulus = this.options.max - 1;
            }

            if (this.dragging) {

                var timeelapsed = new Date().getTime() - this.startTime;

                if (timeelapsed <= 5) {
                    this.dragging = false;
                    return;
                }

                this.rotate360(this.modulus);
                csspos = this.modulus * this.slideFactor;
                this.$dragButton.css({transform: 'translateX(' + csspos + 'px)'});
            }
        },
        /**
         * Handler for touchleave/mouseleave
         * @function onMouseDown
         * @param  {Object} event event object
         * @private
         * @memberOf Rotate360
         */
        onMouseDown: function(e) {
            this.dragging = true;
            window.lastpos = this.getPointerEvent(event).pageX;
            this.startTime = new Date().getTime();
            this.$elem.addClass('iwc-dragging');
        },
        /**
         * Initialise events for the plugin
         * @function initEvents
         * @private
         * @memberOf Rotate360
         */
        initEvents: function() {

            var supportsTouch = typeof window.ontouchstart !== "undefined",
                EVENT_END = supportsTouch ? 'touchend' : 'mouseup',
                EVENT_START = supportsTouch ? 'touchstart' : 'mousedown',
                EVENT_LEAVE = supportsTouch ? 'touchleave' : 'mouseleave',
                EVENT_MOVE = supportsTouch ? 'touchmove' : 'mousemove';

            this.$dragButton
            .on(EVENT_START, this.onStart.bind(this))
            .on(EVENT_MOVE, this.onMove.bind(this))
            .on(EVENT_END, this.onEnd.bind(this));

            this.$elem
            .on('mousedown', this.onMouseDown.bind(this)) //events are required in desktop only
            .on(EVENT_END, this.onEngageClickEnd.bind(this))
            .on(EVENT_LEAVE, this.onLeave.bind(this))
            .on(EVENT_MOVE, this.onMouseMove.bind(this));
        }

    }; // end of prototype
    /**
     * Instantiate plugin
     * @param  {Object} options
     * @return {Object} return instantiated object
     */
    $.fn.rotate360 = function(options) {

        return this.each(function() {

            var $elem = $(this);

            if ($elem.data('rt360')) return;

            // instantiate plugin
            var RT360 = new Rotate360(this, options);

            // Store plugin object in this elem's data
            $elem.data('rt360', RT360);

        });
    };

})(window.jQuery);
/**
 * @license jquery.panzoom.js v@VERSION
 * Updated: @DATE
 * Add pan and zoom functionality to any element
 * Copyright (c) timmy willison
 * Released under the MIT license
 * https://github.com/timmywil/jquery.panzoom/blob/master/MIT-License.txt
 */

(function(global, factory) {
	// AMD
	if (typeof define === 'function' && define.amd) {
		define([ 'jquery' ], function(jQuery) {
			return factory(global, jQuery);
		});
	// CommonJS/Browserify
	} else if (typeof exports === 'object') {
		factory(global, require('jquery'));
	// Global
	} else {
		factory(global, global.jQuery);
	}
}(typeof window !== 'undefined' ? window : this, function(window, $) {
	'use strict';

	var document = window.document;
	var datakey = '__pz__';
	var slice = Array.prototype.slice;
	var rIE11 = /trident\/7./i;
	var supportsInputEvent = (function() {
		// IE11 returns a false positive
		if (rIE11.test(navigator.userAgent)) {
			return false;
		}
		var input = document.createElement('input');
		input.setAttribute('oninput', 'return');
		return typeof input.oninput === 'function';
	})();

	// Regex
	var rupper = /([A-Z])/g;
	var rsvg = /^http:[\w\.\/]+svg$/;

	var floating = '(\\-?\\d[\\d\\.e-]*)';
	var commaSpace = '\\,?\\s*';
	var rmatrix = new RegExp(
		'^matrix\\(' +
		floating + commaSpace +
		floating + commaSpace +
		floating + commaSpace +
		floating + commaSpace +
		floating + commaSpace +
		floating + '\\)$'
	);

	/**
	 * Utility for determining transform matrix equality
	 * Checks backwards to test translation first
	 * @param {Array} first
	 * @param {Array} second
	 */
	function matrixEquals(first, second) {
		var i = first.length;
		while(--i) {
			if (Math.round(+first[i]) !== Math.round(+second[i])) {
				return false;
			}
		}
		return true;
	}

	/**
	 * Creates the options object for reset functions
	 * @param {Boolean|Object} opts See reset methods
	 * @returns {Object} Returns the newly-created options object
	 */
	function createResetOptions(opts) {
		var options = { range: true, animate: true };
		if (typeof opts === 'boolean') {
			options.animate = opts;
		} else {
			$.extend(options, opts);
		}
		return options;
	}

	/**
	 * Represent a transformation matrix with a 3x3 matrix for calculations
	 * Matrix functions adapted from Louis Remi's jQuery.transform (https://github.com/louisremi/jquery.transform.js)
	 * @param {Array|Number} a An array of six values representing a 2d transformation matrix
	 */
	function Matrix(a, b, c, d, e, f, g, h, i) {
		if ($.type(a) === 'array') {
			this.elements = [
				+a[0], +a[2], +a[4],
				+a[1], +a[3], +a[5],
				    0,     0,     1
			];
		} else {
			this.elements = [
				a, b, c,
				d, e, f,
				g || 0, h || 0, i || 1
			];
		}
	}

	Matrix.prototype = {
		/**
		 * Multiply a 3x3 matrix by a similar matrix or a vector
		 * @param {Matrix|Vector} matrix
		 * @return {Matrix|Vector} Returns a vector if multiplying by a vector
		 */
		x: function(matrix) {
			var isVector = matrix instanceof Vector;

			var a = this.elements,
				b = matrix.elements;

			if (isVector && b.length === 3) {
				// b is actually a vector
				return new Vector(
					a[0] * b[0] + a[1] * b[1] + a[2] * b[2],
					a[3] * b[0] + a[4] * b[1] + a[5] * b[2],
					a[6] * b[0] + a[7] * b[1] + a[8] * b[2]
				);
			} else if (b.length === a.length) {
				// b is a 3x3 matrix
				return new Matrix(
					a[0] * b[0] + a[1] * b[3] + a[2] * b[6],
					a[0] * b[1] + a[1] * b[4] + a[2] * b[7],
					a[0] * b[2] + a[1] * b[5] + a[2] * b[8],

					a[3] * b[0] + a[4] * b[3] + a[5] * b[6],
					a[3] * b[1] + a[4] * b[4] + a[5] * b[7],
					a[3] * b[2] + a[4] * b[5] + a[5] * b[8],

					a[6] * b[0] + a[7] * b[3] + a[8] * b[6],
					a[6] * b[1] + a[7] * b[4] + a[8] * b[7],
					a[6] * b[2] + a[7] * b[5] + a[8] * b[8]
				);
			}
			return false; // fail
		},
		/**
		 * Generates an inverse of the current matrix
		 * @returns {Matrix}
		 */
		inverse: function() {
			var d = 1 / this.determinant(),
				a = this.elements;
			return new Matrix(
				d * ( a[8] * a[4] - a[7] * a[5]),
				d * (-(a[8] * a[1] - a[7] * a[2])),
				d * ( a[5] * a[1] - a[4] * a[2]),

				d * (-(a[8] * a[3] - a[6] * a[5])),
				d * ( a[8] * a[0] - a[6] * a[2]),
				d * (-(a[5] * a[0] - a[3] * a[2])),

				d * ( a[7] * a[3] - a[6] * a[4]),
				d * (-(a[7] * a[0] - a[6] * a[1])),
				d * ( a[4] * a[0] - a[3] * a[1])
			);
		},
		/**
		 * Calculates the determinant of the current matrix
		 * @returns {Number}
		 */
		determinant: function() {
			var a = this.elements;
			return a[0] * (a[8] * a[4] - a[7] * a[5]) - a[3] * (a[8] * a[1] - a[7] * a[2]) + a[6] * (a[5] * a[1] - a[4] * a[2]);
		}
	};

	/**
	 * Create a vector containing three values
	 */
	function Vector(x, y, z) {
		this.elements = [ x, y, z ];
	}

	/**
	 * Get the element at zero-indexed index i
	 * @param {Number} i
	 */
	Vector.prototype.e = Matrix.prototype.e = function(i) {
		return this.elements[ i ];
	};

	/**
	 * Create a Panzoom object for a given element
	 * @constructor
	 * @param {Element} elem - Element to use pan and zoom
	 * @param {Object} [options] - An object literal containing options to override default options
	 *  (See Panzoom.defaults for ones not listed below)
	 * @param {jQuery} [options.$zoomIn] - zoom in buttons/links collection (you can also bind these yourself
	 *  e.g. $button.on('click', function(e) { e.preventDefault(); $elem.panzoom('zoomIn'); });)
	 * @param {jQuery} [options.$zoomOut] - zoom out buttons/links collection on which to bind zoomOut
	 * @param {jQuery} [options.$zoomRange] - zoom in/out with this range control
	 * @param {jQuery} [options.$reset] - Reset buttons/links collection on which to bind the reset method
	 * @param {Function} [options.on[Start|Change|Zoom|Pan|End|Reset] - Optional callbacks for panzoom events
	 */
	function Panzoom(elem, options) {

		// Allow instantiation without `new` keyword
		if (!(this instanceof Panzoom)) {
			return new Panzoom(elem, options);
		}

		// Sanity checks
		if (elem.nodeType !== 1) {
			$.error('Panzoom called on non-Element node');
		}
		if (!$.contains(document, elem)) {
			$.error('Panzoom element must be attached to the document');
		}

		// Don't remake
		var d = $.data(elem, datakey);
		if (d) {
			return d;
		}

		// Extend default with given object literal
		// Each instance gets its own options
		this.options = options = $.extend({}, Panzoom.defaults, options);
		this.elem = elem;
		var $elem = this.$elem = $(elem);
		this.$set = options.$set && options.$set.length ? options.$set : $elem;
		this.$doc = $(elem.ownerDocument || document);
		this.$parent = $elem.parent();

		// This is SVG if the namespace is SVG
		// However, while <svg> elements are SVG, we want to treat those like other elements
		this.isSVG = rsvg.test(elem.namespaceURI) && elem.nodeName.toLowerCase() !== 'svg';

		this.panning = false;

		// Save the original transform value
		// Save the prefixed transform style key
		// Set the starting transform
		this._buildTransform();

		// Build the appropriately-prefixed transform style property name
		// De-camelcase
		this._transform = $.cssProps.transform.replace(rupper, '-$1').toLowerCase();

		// Build the transition value
		this._buildTransition();

		// Build containment dimensions
		this.resetDimensions();

		// Add zoom and reset buttons to `this`
		var $empty = $();
		var self = this;
		$.each([ '$zoomIn', '$zoomOut', '$zoomRange', '$reset' ], function(i, name) {
			self[ name ] = options[ name ] || $empty;
		});

		this.enable();

		this.scale = this.getMatrix()[0];
		this._checkPanWhenZoomed();

		// Save the instance
		$.data(elem, datakey, this);
	}

	// Attach regex for possible use (immutable)
	Panzoom.rmatrix = rmatrix;

	Panzoom.defaults = {
		// Should always be non-empty
		// Used to bind jQuery events without collisions
		// A guid is not added here as different instantiations/versions of panzoom
		// on the same element is not supported, so don't do it.
		eventNamespace: '.panzoom',

		// Whether or not to transition the scale
		transition: true,

		// Default cursor style for the element
		cursor: 'move',

		// There may be some use cases for zooming without panning or vice versa
		disablePan: false,
		disableZoom: false,

		// Pan only on the X or Y axes
		disableXAxis: false,
		disableYAxis: false,

		// Set whether you'd like to pan on left (1), middle (2), or right click (3)
		which: 1,

		// The increment at which to zoom
		// adds/subtracts to the scale each time zoomIn/Out is called
		increment: 0.3,

		// Turns on exponential zooming
		// If false, zooming will be incremented linearly
		exponential: true,

		// Pan only when the scale is greater than minScale
		panOnlyWhenZoomed: false,

		// min and max zoom scales
		minScale: 0.3,
		maxScale: 6,

		// The default step for the range input
		// Precendence: default < HTML attribute < option setting
		rangeStep: 0.05,

		// Animation duration (ms)
		duration: 200,
		// CSS easing used for scale transition
		easing: 'ease-in-out',

		// Indicate that the element should be contained within it's parent when panning
		// Note: this does not affect zooming outside of the parent
		// Set this value to 'invert' to only allow panning outside of the parent element (basically the opposite of the normal use of contain)
		// 'invert' is useful for a large panzoom element where you don't want to show anything behind it
		contain: false
	};

	Panzoom.prototype = {
		constructor: Panzoom,

		/**
		 * @returns {Panzoom} Returns the instance
		 */
		instance: function() {
			return this;
		},

		/**
		 * Enable or re-enable the panzoom instance
		 */
		enable: function() {
			// Unbind first
			this._initStyle();
			this._bind();
			this.disabled = false;
		},

		/**
		 * Disable panzoom
		 */
		disable: function() {
			this.disabled = true;
			this._resetStyle();
			this._unbind();
		},

		/**
		 * @returns {Boolean} Returns whether the current panzoom instance is disabled
		 */
		isDisabled: function() {
			return this.disabled;
		},

		/**
		 * Destroy the panzoom instance
		 */
		destroy: function() {
			this.disable();
			$.removeData(this.elem, datakey);
		},

		/**
		 * Builds the restricing dimensions from the containment element
		 * Also used with focal points
		 * Call this method whenever the dimensions of the element or parent are changed
		 */
		resetDimensions: function() {
			// Reset container properties
			this.container = this.$parent[0].getBoundingClientRect();

			// Set element properties
			var elem = this.elem;
			// getBoundingClientRect() works with SVG, offsetWidth does not
			var dims = elem.getBoundingClientRect();
			var absScale = Math.abs(this.scale);
			this.dimensions = {
				width: dims.width,
				height: dims.height,
				left: $.css(elem, 'left', true) || 0,
				top: $.css(elem, 'top', true) || 0,
				// Borders and margins are scaled
				border: {
					top: $.css(elem, 'borderTopWidth', true) * absScale || 0,
					bottom: $.css(elem, 'borderBottomWidth', true) * absScale || 0,
					left: $.css(elem, 'borderLeftWidth', true) * absScale || 0,
					right: $.css(elem, 'borderRightWidth', true) * absScale || 0
				},
				margin: {
					top: $.css(elem, 'marginTop', true) * absScale || 0,
					left: $.css(elem, 'marginLeft', true) * absScale || 0
				}
			};
		},

		/**
		 * Return the element to it's original transform matrix
		 * @param {Boolean} [options] If a boolean is passed, animate the reset (default: true). If an options object is passed, simply pass that along to setMatrix.
		 * @param {Boolean} [options.silent] Silence the reset event
		 */
		reset: function(options) {
			options = createResetOptions(options);
			// Reset the transform to its original value
			var matrix = this.setMatrix(this._origTransform, options);
			if (!options.silent) {
				this._trigger('reset', matrix);
			}
		},

		/**
		 * Only resets zoom level
		 * @param {Boolean|Object} [options] Whether to animate the reset (default: true) or an object of options to pass to zoom()
		 */
		resetZoom: function(options) {
			options = createResetOptions(options);
			var origMatrix = this.getMatrix(this._origTransform);
			options.dValue = origMatrix[ 3 ];
			this.zoom(origMatrix[0], options);
		},

		/**
		 * Only reset panning
		 * @param {Boolean|Object} [options] Whether to animate the reset (default: true) or an object of options to pass to pan()
		 */
		resetPan: function(options) {
			var origMatrix = this.getMatrix(this._origTransform);
			this.pan(origMatrix[4], origMatrix[5], createResetOptions(options));
		},

		/**
		 * Sets a transform on the $set
		 * For SVG, the style attribute takes precedence
		 * and allows us to animate
		 * @param {String} transform
		 */
		setTransform: function(transform) {
			var $set = this.$set;
			var i = $set.length;
			while(i--) {
				$.style($set[i], 'transform', transform);

				// Support IE9-11, Edge 13-14+
				// Set attribute alongside style attribute
				// since IE and Edge do not respect style settings on SVG
				// See https://css-tricks.com/transforms-on-svg-elements/
				if (this.isSVG) {
					$set[i].setAttribute('transform', transform);
				}
			}
		},

		/**
		 * Retrieving the transform is different for SVG
		 *  (unless a style transform is already present)
		 * Uses the $set collection for retrieving the transform
		 * @param {String} [transform] Pass in an transform value (like 'scale(1.1)')
		 *  to have it formatted into matrix format for use by Panzoom
		 * @returns {String} Returns the current transform value of the element
		 */
		getTransform: function(transform) {
			var $set = this.$set;
			var transformElem = $set[0];
			if (transform) {
				this.setTransform(transform);
			} else {

				// IE and Edge still set the transform style properly
				// They just don't render it on SVG
				// So we get a correct value here
				transform = $.style(transformElem, 'transform');

				if (this.isSVG && (!transform || transform === 'none')) {
					transform = $.attr(transformElem, 'transform') || 'none';
				}
			}

			// Convert any transforms set by the user to matrix format
			// by setting to computed
			if (transform !== 'none' && !rmatrix.test(transform)) {

				// Get computed and set for next time
				this.setTransform(transform = $.css(transformElem, 'transform'));
			}

			return transform || 'none';
		},

		/**
		 * Retrieve the current transform matrix for $elem (or turn a transform into it's array values)
		 * @param {String} [transform] matrix-formatted transform value
		 * @returns {Array} Returns the current transform matrix split up into it's parts, or a default matrix
		 */
		getMatrix: function(transform) {
			var matrix = rmatrix.exec(transform || this.getTransform());
			if (matrix) {
				matrix.shift();
			}
			return matrix || [ 1, 0, 0, 1, 0, 0 ];
		},

		/**
		 * Given a matrix object, quickly set the current matrix of the element
		 * @param {Array|String} matrix
		 * @param {Boolean} [animate] Whether to animate the transform change
		 * @param {Object} [options]
		 * @param {Boolean|String} [options.animate] Whether to animate the transform change, or 'skip' indicating that it is unnecessary to set
		 * @param {Boolean} [options.contain] Override the global contain option
		 * @param {Boolean} [options.range] If true, $zoomRange's value will be updated.
		 * @param {Boolean} [options.silent] If true, the change event will not be triggered
		 * @returns {Array} Returns the newly-set matrix
		 */
		setMatrix: function(matrix, options) {
			if (this.disabled) { return; }
			if (!options) { options = {}; }
			// Convert to array
			if (typeof matrix === 'string') {
				matrix = this.getMatrix(matrix);
			}
			var scale = +matrix[0];
			var contain = typeof options.contain !== 'undefined' ? options.contain : this.options.contain;

			// Apply containment
			if (contain) {
				var dims = options.dims;
				if (!dims) {
					this.resetDimensions();
					dims = this.dimensions;
				}
				var container = this.container;
				var width = dims.width;
				var height = dims.height;
				var conWidth = container.width;
				var conHeight = container.height;
				var zoomAspectW = conWidth / width;
				var zoomAspectH = conHeight / height;

				var marginW = ((width - conWidth) / 2);
				var marginH = ((height - conHeight) / 2);

				if (contain === 'invert' || contain === 'automatic' && zoomAspectW < 1.01) {
					matrix[4] = Math.max(Math.min(matrix[4], marginW), -marginW);
				} else {
					matrix[4] = Math.min(Math.max(matrix[4], marginW), -marginW);
				}

				if (contain === 'invert' || (contain === 'automatic' && zoomAspectH < 1.01)) {
					matrix[5] = Math.max(Math.min(matrix[5], marginH), -marginH);
				} else {
					matrix[5] = Math.min(Math.max(matrix[5], marginH), -marginH);
				}
			}

			// Animate
			if (options.animate !== 'skip') {
				// Set transition
				this.transition(!options.animate);
			}

			// Update range element
			if (options.range) {
				this.$zoomRange.val(scale);
			}

			// Set the matrix on this.$set
			if (this.options.disableXAxis || this.options.disableYAxis) {
				var originalMatrix = this.getMatrix();
				if (this.options.disableXAxis) {
					matrix[4] = originalMatrix[4];
				}
				if (this.options.disableYAxis) {
					matrix[5] = originalMatrix[5];
				}
			}
			this.setTransform('matrix(' + matrix.join(',') + ')');

			this.scale = scale;

			// Disable/enable panning if zooming is at minimum and panOnlyWhenZoomed is true
			this._checkPanWhenZoomed(scale);

			if (!options.silent) {
				this._trigger('change', matrix);
			}

			return matrix;
		},

		/**
		 * @returns {Boolean} Returns whether the panzoom element is currently being dragged
		 */
		isPanning: function() {
			return this.panning;
		},

		/**
		 * Apply the current transition to the element, if allowed
		 * @param {Boolean} [off] Indicates that the transition should be turned off
		 */
		transition: function(off) {
			if (!this._transition) { return; }
			var transition = off || !this.options.transition ? 'none' : this._transition;
			var $set = this.$set;
			var i = $set.length;
			while(i--) {
				// Avoid reflows when zooming
				if ($.style($set[i], 'transition') !== transition) {
					$.style($set[i], 'transition', transition);
				}
			}
		},

		/**
		 * Pan the element to the specified translation X and Y
		 * Note: this is not the same as setting jQuery#offset() or jQuery#position()
		 * @param {Number} x
		 * @param {Number} y
		 * @param {Object} [options] These options are passed along to setMatrix
		 * @param {Array} [options.matrix] The matrix being manipulated (if already known so it doesn't have to be retrieved again)
		 * @param {Boolean} [options.silent] Silence the pan event. Note that this will also silence the setMatrix change event.
		 * @param {Boolean} [options.relative] Make the x and y values relative to the existing matrix
		 */
		pan: function(x, y, options) {
			if (this.options.disablePan) { return; }
			if (!options) { options = {}; }
			var matrix = options.matrix;
			if (!matrix) {
				matrix = this.getMatrix();
			}
			// Cast existing matrix values to numbers
			if (options.relative) {
				x += +matrix[4];
				y += +matrix[5];
			}
			matrix[4] = x;
			matrix[5] = y;
			this.setMatrix(matrix, options);
			if (!options.silent) {
				this._trigger('pan', matrix[4], matrix[5]);
			}
		},

		/**
		 * Zoom in/out the element using the scale properties of a transform matrix
		 * @param {Number|Boolean} [scale] The scale to which to zoom or a boolean indicating to transition a zoom out
		 * @param {Object} [opts] All global options can be overwritten by this options object. For example, override the default increment.
		 * @param {Boolean} [opts.noSetRange] Specify that the method should not set the $zoomRange value (as is the case when $zoomRange is calling zoom on change)
		 * @param {jQuery.Event|Object} [opts.focal] A focal point on the panzoom element on which to zoom.
		 *  If an object, set the clientX and clientY properties to the position relative to the parent
		 * @param {Boolean} [opts.animate] Whether to animate the zoom (defaults to true if scale is not a number, false otherwise)
		 * @param {Boolean} [opts.silent] Silence the zoom event
		 * @param {Array} [opts.matrix] Optionally pass the current matrix so it doesn't need to be retrieved
		 * @param {Number} [opts.dValue] Think of a transform matrix as four values a, b, c, d
		 *  where a/d are the horizontal/vertical scale values and b/c are the skew values
		 *  (5 and 6 of matrix array are the tx/ty transform values).
		 *  Normally, the scale is set to both the a and d values of the matrix.
		 *  This option allows you to specify a different d value for the zoom.
		 *  For instance, to flip vertically, you could set -1 as the dValue.
		 */
		zoom: function(scale, opts) {
			// Shuffle arguments
			if (typeof scale === 'object') {
				opts = scale;
				scale = null;
			} else if (!opts) {
				opts = {};
			}
			var options = $.extend({}, this.options, opts);
			// Check if disabled
			if (options.disableZoom) { return; }
			var animate = false;
			var matrix = options.matrix || this.getMatrix();
			var startScale = +matrix[0];

			// Calculate zoom based on increment
			if (typeof scale !== 'number') {
				// Just use a number a little greater than 1
				// Below 1 can use normal increments
				if (options.exponential && startScale - options.increment >= 1) {
					scale = Math[scale ? 'sqrt' : 'pow'](startScale, 2);
				} else {
					scale = startScale + (options.increment * (scale ? -1 : 1));
				}
				animate = true;
			}

			// Constrain scale
			if (scale > options.maxScale) {
				scale = options.maxScale;
			} else if (scale < options.minScale) {
				scale = options.minScale;
			}

			// Calculate focal point based on scale
			var focal = options.focal;
			if (focal && !options.disablePan) {
				// Adapted from code by Florian Günther
				// https://github.com/florianguenther/zui53
				this.resetDimensions();
				var dims = options.dims = this.dimensions;
				var clientX = focal.clientX;
				var clientY = focal.clientY;

				// Adjust the focal point for transform-origin 50% 50%
				// SVG elements have a transform origin of 0 0
				if (!this.isSVG) {
					clientX -= (dims.width / startScale) / 2;
					clientY -= (dims.height / startScale) / 2;
				}

				var clientV = new Vector(clientX, clientY, 1);
				var surfaceM = new Matrix(matrix);
				// Supply an offset manually if necessary
				var o = this.parentOffset || this.$parent.offset();
				var offsetM = new Matrix(1, 0, o.left - this.$doc.scrollLeft(), 0, 1, o.top - this.$doc.scrollTop());
				var surfaceV = surfaceM.inverse().x(offsetM.inverse().x(clientV));
				var scaleBy = scale / matrix[0];
				surfaceM = surfaceM.x(new Matrix([scaleBy, 0, 0, scaleBy, 0, 0]));
				clientV = offsetM.x(surfaceM.x(surfaceV));
				matrix[4] = +matrix[4] + (clientX - clientV.e(0));
				matrix[5] = +matrix[5] + (clientY - clientV.e(1));
			}

			// Set the scale
			matrix[0] = scale;
			matrix[3] = typeof options.dValue === 'number' ? options.dValue : scale;

			// Calling zoom may still pan the element
			this.setMatrix(matrix, {
				animate: typeof options.animate === 'boolean' ? options.animate : animate,
				// Set the zoomRange value
				range: !options.noSetRange
			});

			// Trigger zoom event
			if (!options.silent) {
				this._trigger('zoom', matrix[0], options);
			}
		},

		/**
		 * Get/set option on an existing instance
		 * @returns {Array|undefined} If getting, returns an array of all values
		 *   on each instance for a given key. If setting, continue chaining by returning undefined.
		 */
		option: function(key, value) {
			var options;
			if (!key) {
				// Avoids returning direct reference
				return $.extend({}, this.options);
			}

			if (typeof key === 'string') {
				if (arguments.length === 1) {
					return this.options[ key ] !== undefined ?
						this.options[ key ] :
						null;
				}
				options = {};
				options[ key ] = value;
			} else {
				options = key;
			}

			this._setOptions(options);
		},

		/**
		 * Internally sets options
		 * @param {Object} options - An object literal of options to set
		 */
		_setOptions: function(options) {
			$.each(options, $.proxy(function(key, value) {
				switch(key) {
					case 'disablePan':
						this._resetStyle();
						/* falls through */
					case '$zoomIn':
					case '$zoomOut':
					case '$zoomRange':
					case '$reset':
					case 'disableZoom':
					case 'onStart':
					case 'onChange':
					case 'onZoom':
					case 'onPan':
					case 'onEnd':
					case 'onReset':
					case 'eventNamespace':
						this._unbind();
				}
				this.options[ key ] = value;
				switch(key) {
					case 'disablePan':
						this._initStyle();
						/* falls through */
					case '$zoomIn':
					case '$zoomOut':
					case '$zoomRange':
					case '$reset':
						// Set these on the instance
						this[ key ] = value;
						/* falls through */
					case 'disableZoom':
					case 'onStart':
					case 'onChange':
					case 'onZoom':
					case 'onPan':
					case 'onEnd':
					case 'onReset':
					case 'eventNamespace':
						this._bind();
						break;
					case 'cursor':
						$.style(this.elem, 'cursor', value);
						break;
					case 'minScale':
						this.$zoomRange.attr('min', value);
						break;
					case 'maxScale':
						this.$zoomRange.attr('max', value);
						break;
					case 'rangeStep':
						this.$zoomRange.attr('step', value);
						break;
					case 'startTransform':
						this._buildTransform();
						break;
					case 'duration':
					case 'easing':
						this._buildTransition();
						/* falls through */
					case 'transition':
						this.transition();
						break;
					case 'panOnlyWhenZoomed':
						this._checkPanWhenZoomed();
						break;
					case '$set':
						if (value instanceof $ && value.length) {
							this.$set = value;
							// Reset styles
							this._initStyle();
							this._buildTransform();
						}
				}
			}, this));
		},

		/**
		 * Disable/enable panning depending on whether the current scale
		 * matches the minimum
		 * @param {Number} [scale]
		 * @private
		 */
		_checkPanWhenZoomed: function(scale) {
			if (!scale) {
				scale = this.getMatrix()[0];
			}
			var options = this.options;
			if (options.panOnlyWhenZoomed) {
				var toDisable = scale === options.minScale;
				if (options.disablePan !== toDisable) {
					this.option('disablePan', toDisable);
				}
			}
		},

		/**
		 * Initialize base styles for the element and its parent
		 */
		_initStyle: function() {
			var styles = {
				// Set the same default whether SVG or HTML
				// transform-origin cannot be changed to 50% 50% in IE9-11 or Edge 13-14+
				'transform-origin': this.isSVG ? '0 0' : '50% 50%'
			};
			// Set elem styles
			if (!this.options.disablePan) {
				styles.cursor = this.options.cursor;
			}
			this.$set.css(styles);

			// Set parent to relative if set to static
			var $parent = this.$parent;
			// No need to add styles to the body
			if ($parent.length && !$.nodeName($parent[0], 'body')) {
				styles = {
					overflow: 'hidden'
				};
				if ($parent.css('position') === 'static') {
					styles.position = 'relative';
				}
				$parent.css(styles);
			}
		},

		/**
		 * Undo any styles attached in this plugin
		 */
		_resetStyle: function() {
			this.$elem.css({
				'cursor': '',
				'transition': ''
			});
			this.$parent.css({
				'overflow': '',
				'position': ''
			});
		},

		/**
		 * Binds all necessary events
		 */
		_bind: function() {
			var self = this;
			var options = this.options;
			var ns = options.eventNamespace;
			var str_start = 'touchstart' + ns + ' mousedown' + ns;
			var str_click = 'touchend' + ns + ' click' + ns;
			var events = {};
			var $reset = this.$reset;
			var $zoomRange = this.$zoomRange;

			// Bind panzoom events from options
			$.each([ 'Start', 'Change', 'Zoom', 'Pan', 'End', 'Reset' ], function() {
				var m = options[ 'on' + this ];
				if ($.isFunction(m)) {
					events[ 'panzoom' + this.toLowerCase() + ns ] = m;
				}
			});

			// Bind $elem drag and click/touchdown events
			// Bind touchstart if either panning or zooming is enabled
			if (!options.disablePan || !options.disableZoom) {
				events[ str_start ] = function(e) {
					var touches;
					if (e.type === 'touchstart' ?
						// Touch
						(touches = e.touches || e.originalEvent.touches) &&
							((touches.length === 1 && !options.disablePan) || touches.length === 2) :
						// Mouse: Ignore right click
						!options.disablePan && e.which === options.which) {

						e.preventDefault();
						e.stopPropagation();
						self._startMove(e, touches);
					}
				};
				// Prevent the contextmenu event
				// if we're binding to right-click
				if (options.which === 3) {
					events.contextmenu = false;
				}
			}
			this.$elem.on(events);

			// Bind reset
			if ($reset.length) {
				$reset.on(str_click, function(e) {
					e.preventDefault();
					self.reset();
				});
			}

			// Set default attributes for the range input
			if ($zoomRange.length) {
				$zoomRange.attr({
					// Only set the range step if explicit or
					// set the default if there is no attribute present
					step: options.rangeStep === Panzoom.defaults.rangeStep &&
						$zoomRange.attr('step') ||
						options.rangeStep,
					min: options.minScale,
					max: options.maxScale
				}).prop({
					value: this.getMatrix()[0]
				});
			}

			// No bindings if zooming is disabled
			if (options.disableZoom) {
				return;
			}

			var $zoomIn = this.$zoomIn;
			var $zoomOut = this.$zoomOut;

			// Bind zoom in/out
			// Don't bind one without the other
			if ($zoomIn.length && $zoomOut.length) {
				// preventDefault cancels future mouse events on touch events
				$zoomIn.on(str_click, function(e) {
					e.preventDefault();
					self.zoom();
				});
				$zoomOut.on(str_click, function(e) {
					e.preventDefault();
					self.reset();
					self.zoom(true);
				});
			}

			if ($zoomRange.length) {
				events = {};
				// Cannot prevent default action here, just use mousedown
				events[ 'mousedown' + ns ] = function() {
					self.transition(true);
				};
				// Zoom on input events if available and change events
				// See https://github.com/timmywil/jquery.panzoom/issues/90
				events[ (supportsInputEvent ? 'input' : 'change') + ns ] = function() {
					self.zoom(+this.value, { noSetRange: true });
				};
				$zoomRange.on(events);
			}
		},

		/**
		 * Unbind all events
		 */
		_unbind: function() {
			this.$elem
				.add(this.$zoomIn)
				.add(this.$zoomOut)
				.add(this.$reset)
				.off(this.options.eventNamespace);
		},

		/**
		 * Builds the original transform value
		 */
		_buildTransform: function() {
			// Save the original transform
			// Retrieving this also adds the correct prefixed style name
			// to jQuery's internal $.cssProps
			return this._origTransform = this.getTransform(this.options.startTransform);
		},

		/**
		 * Set transition property for later use when zooming
		 */
		_buildTransition: function() {
			if (this._transform) {
				var options = this.options;
				this._transition = this._transform + ' ' + options.duration + 'ms ' + options.easing;
			}
		},

		/**
		 * Calculates the distance between two touch points
		 * Remember pythagorean?
		 * @param {Array} touches
		 * @returns {Number} Returns the distance
		 */
		_getDistance: function(touches) {
			var touch1 = touches[0];
			var touch2 = touches[1];
			return Math.sqrt(Math.pow(Math.abs(touch2.clientX - touch1.clientX), 2) + Math.pow(Math.abs(touch2.clientY - touch1.clientY), 2));
		},

		/**
		 * Constructs an approximated point in the middle of two touch points
		 * @returns {Object} Returns an object containing pageX and pageY
		 */
		_getMiddle: function(touches) {
			var touch1 = touches[0];
			var touch2 = touches[1];
			return {
				clientX: ((touch2.clientX - touch1.clientX) / 2) + touch1.clientX,
				clientY: ((touch2.clientY - touch1.clientY) / 2) + touch1.clientY
			};
		},

		/**
		 * Trigger a panzoom event on our element
		 * The event is passed the Panzoom instance
		 * @param {String|jQuery.Event} event
		 * @param {Mixed} arg1[, arg2, arg3, ...] Arguments to append to the trigger
		 */
		_trigger: function (event) {
			if (typeof event === 'string') {
				event = 'panzoom' + event;
			}
			this.$elem.triggerHandler(event, [this].concat(slice.call(arguments, 1)));
		},

		/**
		 * Starts the pan
		 * This is bound to mouse/touchmove on the element
		 * @param {jQuery.Event} event An event with pageX, pageY, and possibly the touches list
		 * @param {TouchList} [touches] The touches list if present
		 */
		_startMove: function(event, touches) {
			var move, moveEvent, endEvent,
				startDistance, startScale, startMiddle,
				startPageX, startPageY, touch;
			var self = this;
			var options = this.options;
			var ns = options.eventNamespace;
			var matrix = this.getMatrix();
			var original = matrix.slice(0);
			var origPageX = +original[4];
			var origPageY = +original[5];
			var panOptions = { matrix: matrix, animate: 'skip' };

			// Use proper events
			if (event.type === 'touchstart') {
				moveEvent = 'touchmove';
				endEvent = 'touchend';
			} else {
				moveEvent = 'mousemove';
				endEvent = 'mouseup';
			}

			// Add namespace
			moveEvent += ns;
			endEvent += ns;

			// Remove any transitions happening
			this.transition(true);

			// Indicate that we are currently panning
			this.panning = true;

			// Trigger start event
			this._trigger('start', event, touches);

			if (touches && touches.length === 2) {
				startDistance = this._getDistance(touches);
				startScale = +matrix[0];
				startMiddle = this._getMiddle(touches);
				move = function(e) {
					e.preventDefault();
					touches = e.touches || e.originalEvent.touches;

					// Calculate move on middle point
					var middle = self._getMiddle(touches);
					var diff = self._getDistance(touches) - startDistance;

					// Set zoom
					self.zoom(diff * (options.increment / 100) + startScale, {
						focal: middle,
						matrix: matrix,
						animate: false
					});

					// Set pan
					self.pan(
						+matrix[4] + middle.clientX - startMiddle.clientX,
						+matrix[5] + middle.clientY - startMiddle.clientY,
						panOptions
					);
					startMiddle = middle;
				};
			} else {
				if (touches && (touch = touches[0])) {
					startPageX = touch.pageX;
					startPageY = touch.pageY;
				} else {
					startPageX = event.pageX;
					startPageY = event.pageY;
				}

				/**
				 * Mousemove/touchmove function to pan the element
				 * @param {Object} e Event object
				 */
				move = function(e) {
					e.preventDefault();
					touches = e.touches || e.originalEvent.touches;
					var coords;
					if (touches) {
						coords = touches[0] || { pageX: 0, pageY: 0 };
					} else {
						coords = e;
					}

					self.pan(
						origPageX + coords.pageX - startPageX,
						origPageY + coords.pageY - startPageY,
						panOptions
					);
				};
			}

			// Bind the handlers
			$(document)
				.off(ns)
				.on(moveEvent, move)
				.on(endEvent, function(e) {
					e.preventDefault();
					// Unbind all document events
					$(this).off(ns);
					self.panning = false;
					// Trigger our end event
					// Simply set the type to "panzoomend" to pass through all end properties
					// jQuery's `not` is used here to compare Array equality
					e.type = 'panzoomend';
					self._trigger(e, matrix, !matrixEquals(matrix, original));
				});
		}
	};

	// Add Panzoom as a static property
	$.Panzoom = Panzoom;

	/**
	 * Extend jQuery
	 * @param {Object|String} options - The name of a method to call on the prototype
	 *  or an object literal of options
	 * @returns {jQuery|Mixed} jQuery instance for regular chaining or the return value(s) of a panzoom method call
	 */
	$.fn.panzoom = function(options) {
		var instance, args, m, ret;

		// Call methods widget-style
		if (typeof options === 'string') {
			ret = [];
			args = slice.call(arguments, 1);
			this.each(function() {
				instance = $.data(this, datakey);

				if (!instance) {
					ret.push(undefined);

				// Ignore methods beginning with `_`
				} else if (options.charAt(0) !== '_' &&
					typeof (m = instance[ options ]) === 'function' &&
					// If nothing is returned, do not add to return values
					(m = m.apply(instance, args)) !== undefined) {

					ret.push(m);
				}
			});

			// Return an array of values for the jQuery instances
			// Or the value itself if there is only one
			// Or keep chaining
			return ret.length ?
				(ret.length === 1 ? ret[0] : ret) :
				this;
		}

		return this.each(function() { new Panzoom(this, options); });
	};

	return Panzoom;
}));

/*
     _ _      _       _
 ___| (_) ___| | __  (_)___
/ __| | |/ __| |/ /  | / __|
\__ \ | | (__|   < _ | \__ \
|___/_|_|\___|_|\_(_)/ |___/
                   |__/

 Version: 1.6.0
  Author: Ken Wheeler
 Website: http://kenwheeler.github.io
    Docs: http://kenwheeler.github.io/slick
    Repo: http://github.com/kenwheeler/slick
  Issues: http://github.com/kenwheeler/slick/issues

 */
!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):"undefined"!=typeof exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){"use strict";var b=window.Slick||{};b=function(){function c(c,d){var f,e=this;e.defaults={accessibility:!0,adaptiveHeight:!1,appendArrows:a(c),appendDots:a(c),arrows:!0,asNavFor:null,prevArrow:'<button type="button" data-role="none" class="slick-prev" aria-label="Previous" tabindex="0" role="button">Previous</button>',nextArrow:'<button type="button" data-role="none" class="slick-next" aria-label="Next" tabindex="0" role="button">Next</button>',autoplay:!1,autoplaySpeed:3e3,centerMode:!1,centerPadding:"50px",cssEase:"ease",customPaging:function(b,c){return a('<button type="button" data-role="none" role="button" tabindex="0" />').text(c+1)},dots:!1,dotsClass:"slick-dots",draggable:!0,easing:"linear",edgeFriction:.35,fade:!1,focusOnSelect:!1,infinite:!0,initialSlide:0,lazyLoad:"ondemand",mobileFirst:!1,pauseOnHover:!0,pauseOnFocus:!0,pauseOnDotsHover:!1,respondTo:"window",responsive:null,rows:1,rtl:!1,slide:"",slidesPerRow:1,slidesToShow:1,slidesToScroll:1,speed:500,swipe:!0,swipeToSlide:!1,touchMove:!0,touchThreshold:5,useCSS:!0,useTransform:!0,variableWidth:!1,vertical:!1,verticalSwiping:!1,waitForAnimate:!0,zIndex:1e3},e.initials={animating:!1,dragging:!1,autoPlayTimer:null,currentDirection:0,currentLeft:null,currentSlide:0,direction:1,$dots:null,listWidth:null,listHeight:null,loadIndex:0,$nextArrow:null,$prevArrow:null,slideCount:null,slideWidth:null,$slideTrack:null,$slides:null,sliding:!1,slideOffset:0,swipeLeft:null,$list:null,touchObject:{},transformsEnabled:!1,unslicked:!1},a.extend(e,e.initials),e.activeBreakpoint=null,e.animType=null,e.animProp=null,e.breakpoints=[],e.breakpointSettings=[],e.cssTransitions=!1,e.focussed=!1,e.interrupted=!1,e.hidden="hidden",e.paused=!0,e.positionProp=null,e.respondTo=null,e.rowCount=1,e.shouldClick=!0,e.$slider=a(c),e.$slidesCache=null,e.transformType=null,e.transitionType=null,e.visibilityChange="visibilitychange",e.windowWidth=0,e.windowTimer=null,f=a(c).data("slick")||{},e.options=a.extend({},e.defaults,d,f),e.currentSlide=e.options.initialSlide,e.originalSettings=e.options,"undefined"!=typeof document.mozHidden?(e.hidden="mozHidden",e.visibilityChange="mozvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(e.hidden="webkitHidden",e.visibilityChange="webkitvisibilitychange"),e.autoPlay=a.proxy(e.autoPlay,e),e.autoPlayClear=a.proxy(e.autoPlayClear,e),e.autoPlayIterator=a.proxy(e.autoPlayIterator,e),e.changeSlide=a.proxy(e.changeSlide,e),e.clickHandler=a.proxy(e.clickHandler,e),e.selectHandler=a.proxy(e.selectHandler,e),e.setPosition=a.proxy(e.setPosition,e),e.swipeHandler=a.proxy(e.swipeHandler,e),e.dragHandler=a.proxy(e.dragHandler,e),e.keyHandler=a.proxy(e.keyHandler,e),e.instanceUid=b++,e.htmlExpr=/^(?:\s*(<[\w\W]+>)[^>]*)$/,e.registerBreakpoints(),e.init(!0)}var b=0;return c}(),b.prototype.activateADA=function(){var a=this;a.$slideTrack.find(".slick-active").attr({"aria-hidden":"false"}).find("a, input, button, select").attr({tabindex:"0"})},b.prototype.addSlide=b.prototype.slickAdd=function(b,c,d){var e=this;if("boolean"==typeof c)d=c,c=null;else if(0>c||c>=e.slideCount)return!1;e.unload(),"number"==typeof c?0===c&&0===e.$slides.length?a(b).appendTo(e.$slideTrack):d?a(b).insertBefore(e.$slides.eq(c)):a(b).insertAfter(e.$slides.eq(c)):d===!0?a(b).prependTo(e.$slideTrack):a(b).appendTo(e.$slideTrack),e.$slides=e.$slideTrack.children(this.options.slide),e.$slideTrack.children(this.options.slide).detach(),e.$slideTrack.append(e.$slides),e.$slides.each(function(b,c){a(c).attr("data-slick-index",b)}),e.$slidesCache=e.$slides,e.reinit()},b.prototype.animateHeight=function(){var a=this;if(1===a.options.slidesToShow&&a.options.adaptiveHeight===!0&&a.options.vertical===!1){var b=a.$slides.eq(a.currentSlide).outerHeight(!0);a.$list.animate({height:b},a.options.speed)}},b.prototype.animateSlide=function(b,c){var d={},e=this;e.animateHeight(),e.options.rtl===!0&&e.options.vertical===!1&&(b=-b),e.transformsEnabled===!1?e.options.vertical===!1?e.$slideTrack.animate({left:b},e.options.speed,e.options.easing,c):e.$slideTrack.animate({top:b},e.options.speed,e.options.easing,c):e.cssTransitions===!1?(e.options.rtl===!0&&(e.currentLeft=-e.currentLeft),a({animStart:e.currentLeft}).animate({animStart:b},{duration:e.options.speed,easing:e.options.easing,step:function(a){a=Math.ceil(a),e.options.vertical===!1?(d[e.animType]="translate("+a+"px, 0px)",e.$slideTrack.css(d)):(d[e.animType]="translate(0px,"+a+"px)",e.$slideTrack.css(d))},complete:function(){c&&c.call()}})):(e.applyTransition(),b=Math.ceil(b),e.options.vertical===!1?d[e.animType]="translate3d("+b+"px, 0px, 0px)":d[e.animType]="translate3d(0px,"+b+"px, 0px)",e.$slideTrack.css(d),c&&setTimeout(function(){e.disableTransition(),c.call()},e.options.speed))},b.prototype.getNavTarget=function(){var b=this,c=b.options.asNavFor;return c&&null!==c&&(c=a(c).not(b.$slider)),c},b.prototype.asNavFor=function(b){var c=this,d=c.getNavTarget();null!==d&&"object"==typeof d&&d.each(function(){var c=a(this).slick("getSlick");c.unslicked||c.slideHandler(b,!0)})},b.prototype.applyTransition=function(a){var b=this,c={};b.options.fade===!1?c[b.transitionType]=b.transformType+" "+b.options.speed+"ms "+b.options.cssEase:c[b.transitionType]="opacity "+b.options.speed+"ms "+b.options.cssEase,b.options.fade===!1?b.$slideTrack.css(c):b.$slides.eq(a).css(c)},b.prototype.autoPlay=function(){var a=this;a.autoPlayClear(),a.slideCount>a.options.slidesToShow&&(a.autoPlayTimer=setInterval(a.autoPlayIterator,a.options.autoplaySpeed))},b.prototype.autoPlayClear=function(){var a=this;a.autoPlayTimer&&clearInterval(a.autoPlayTimer)},b.prototype.autoPlayIterator=function(){var a=this,b=a.currentSlide+a.options.slidesToScroll;a.paused||a.interrupted||a.focussed||(a.options.infinite===!1&&(1===a.direction&&a.currentSlide+1===a.slideCount-1?a.direction=0:0===a.direction&&(b=a.currentSlide-a.options.slidesToScroll,a.currentSlide-1===0&&(a.direction=1))),a.slideHandler(b))},b.prototype.buildArrows=function(){var b=this;b.options.arrows===!0&&(b.$prevArrow=a(b.options.prevArrow).addClass("slick-arrow"),b.$nextArrow=a(b.options.nextArrow).addClass("slick-arrow"),b.slideCount>b.options.slidesToShow?(b.$prevArrow.removeClass("slick-hidden").removeAttr("aria-hidden tabindex"),b.$nextArrow.removeClass("slick-hidden").removeAttr("aria-hidden tabindex"),b.htmlExpr.test(b.options.prevArrow)&&b.$prevArrow.prependTo(b.options.appendArrows),b.htmlExpr.test(b.options.nextArrow)&&b.$nextArrow.appendTo(b.options.appendArrows),b.options.infinite!==!0&&b.$prevArrow.addClass("slick-disabled").attr("aria-disabled","true")):b.$prevArrow.add(b.$nextArrow).addClass("slick-hidden").attr({"aria-disabled":"true",tabindex:"-1"}))},b.prototype.buildDots=function(){var c,d,b=this;if(b.options.dots===!0&&b.slideCount>b.options.slidesToShow){for(b.$slider.addClass("slick-dotted"),d=a("<ul />").addClass(b.options.dotsClass),c=0;c<=b.getDotCount();c+=1)d.append(a("<li />").append(b.options.customPaging.call(this,b,c)));b.$dots=d.appendTo(b.options.appendDots),b.$dots.find("li").first().addClass("slick-active").attr("aria-hidden","false")}},b.prototype.buildOut=function(){var b=this;b.$slides=b.$slider.children(b.options.slide+":not(.slick-cloned)").addClass("slick-slide"),b.slideCount=b.$slides.length,b.$slides.each(function(b,c){a(c).attr("data-slick-index",b).data("originalStyling",a(c).attr("style")||"")}),b.$slider.addClass("slick-slider"),b.$slideTrack=0===b.slideCount?a('<div class="slick-track"/>').appendTo(b.$slider):b.$slides.wrapAll('<div class="slick-track"/>').parent(),b.$list=b.$slideTrack.wrap('<div aria-live="polite" class="slick-list"/>').parent(),b.$slideTrack.css("opacity",0),(b.options.centerMode===!0||b.options.swipeToSlide===!0)&&(b.options.slidesToScroll=1),a("img[data-lazy]",b.$slider).not("[src]").addClass("slick-loading"),b.setupInfinite(),b.buildArrows(),b.buildDots(),b.updateDots(),b.setSlideClasses("number"==typeof b.currentSlide?b.currentSlide:0),b.options.draggable===!0&&b.$list.addClass("draggable")},b.prototype.buildRows=function(){var b,c,d,e,f,g,h,a=this;if(e=document.createDocumentFragment(),g=a.$slider.children(),a.options.rows>1){for(h=a.options.slidesPerRow*a.options.rows,f=Math.ceil(g.length/h),b=0;f>b;b++){var i=document.createElement("div");for(c=0;c<a.options.rows;c++){var j=document.createElement("div");for(d=0;d<a.options.slidesPerRow;d++){var k=b*h+(c*a.options.slidesPerRow+d);g.get(k)&&j.appendChild(g.get(k))}i.appendChild(j)}e.appendChild(i)}a.$slider.empty().append(e),a.$slider.children().children().children().css({width:100/a.options.slidesPerRow+"%",display:"inline-block"})}},b.prototype.checkResponsive=function(b,c){var e,f,g,d=this,h=!1,i=d.$slider.width(),j=window.innerWidth||a(window).width();if("window"===d.respondTo?g=j:"slider"===d.respondTo?g=i:"min"===d.respondTo&&(g=Math.min(j,i)),d.options.responsive&&d.options.responsive.length&&null!==d.options.responsive){f=null;for(e in d.breakpoints)d.breakpoints.hasOwnProperty(e)&&(d.originalSettings.mobileFirst===!1?g<d.breakpoints[e]&&(f=d.breakpoints[e]):g>d.breakpoints[e]&&(f=d.breakpoints[e]));null!==f?null!==d.activeBreakpoint?(f!==d.activeBreakpoint||c)&&(d.activeBreakpoint=f,"unslick"===d.breakpointSettings[f]?d.unslick(f):(d.options=a.extend({},d.originalSettings,d.breakpointSettings[f]),b===!0&&(d.currentSlide=d.options.initialSlide),d.refresh(b)),h=f):(d.activeBreakpoint=f,"unslick"===d.breakpointSettings[f]?d.unslick(f):(d.options=a.extend({},d.originalSettings,d.breakpointSettings[f]),b===!0&&(d.currentSlide=d.options.initialSlide),d.refresh(b)),h=f):null!==d.activeBreakpoint&&(d.activeBreakpoint=null,d.options=d.originalSettings,b===!0&&(d.currentSlide=d.options.initialSlide),d.refresh(b),h=f),b||h===!1||d.$slider.trigger("breakpoint",[d,h])}},b.prototype.changeSlide=function(b,c){var f,g,h,d=this,e=a(b.currentTarget);switch(e.is("a")&&b.preventDefault(),e.is("li")||(e=e.closest("li")),h=d.slideCount%d.options.slidesToScroll!==0,f=h?0:(d.slideCount-d.currentSlide)%d.options.slidesToScroll,b.data.message){case"previous":g=0===f?d.options.slidesToScroll:d.options.slidesToShow-f,d.slideCount>d.options.slidesToShow&&d.slideHandler(d.currentSlide-g,!1,c);break;case"next":g=0===f?d.options.slidesToScroll:f,d.slideCount>d.options.slidesToShow&&d.slideHandler(d.currentSlide+g,!1,c);break;case"index":var i=0===b.data.index?0:b.data.index||e.index()*d.options.slidesToScroll;d.slideHandler(d.checkNavigable(i),!1,c),e.children().trigger("focus");break;default:return}},b.prototype.checkNavigable=function(a){var c,d,b=this;if(c=b.getNavigableIndexes(),d=0,a>c[c.length-1])a=c[c.length-1];else for(var e in c){if(a<c[e]){a=d;break}d=c[e]}return a},b.prototype.cleanUpEvents=function(){var b=this;b.options.dots&&null!==b.$dots&&a("li",b.$dots).off("click.slick",b.changeSlide).off("mouseenter.slick",a.proxy(b.interrupt,b,!0)).off("mouseleave.slick",a.proxy(b.interrupt,b,!1)),b.$slider.off("focus.slick blur.slick"),b.options.arrows===!0&&b.slideCount>b.options.slidesToShow&&(b.$prevArrow&&b.$prevArrow.off("click.slick",b.changeSlide),b.$nextArrow&&b.$nextArrow.off("click.slick",b.changeSlide)),b.$list.off("touchstart.slick mousedown.slick",b.swipeHandler),b.$list.off("touchmove.slick mousemove.slick",b.swipeHandler),b.$list.off("touchend.slick mouseup.slick",b.swipeHandler),b.$list.off("touchcancel.slick mouseleave.slick",b.swipeHandler),b.$list.off("click.slick",b.clickHandler),a(document).off(b.visibilityChange,b.visibility),b.cleanUpSlideEvents(),b.options.accessibility===!0&&b.$list.off("keydown.slick",b.keyHandler),b.options.focusOnSelect===!0&&a(b.$slideTrack).children().off("click.slick",b.selectHandler),a(window).off("orientationchange.slick.slick-"+b.instanceUid,b.orientationChange),a(window).off("resize.slick.slick-"+b.instanceUid,b.resize),a("[draggable!=true]",b.$slideTrack).off("dragstart",b.preventDefault),a(window).off("load.slick.slick-"+b.instanceUid,b.setPosition),a(document).off("ready.slick.slick-"+b.instanceUid,b.setPosition)},b.prototype.cleanUpSlideEvents=function(){var b=this;b.$list.off("mouseenter.slick",a.proxy(b.interrupt,b,!0)),b.$list.off("mouseleave.slick",a.proxy(b.interrupt,b,!1))},b.prototype.cleanUpRows=function(){var b,a=this;a.options.rows>1&&(b=a.$slides.children().children(),b.removeAttr("style"),a.$slider.empty().append(b))},b.prototype.clickHandler=function(a){var b=this;b.shouldClick===!1&&(a.stopImmediatePropagation(),a.stopPropagation(),a.preventDefault())},b.prototype.destroy=function(b){var c=this;c.autoPlayClear(),c.touchObject={},c.cleanUpEvents(),a(".slick-cloned",c.$slider).detach(),c.$dots&&c.$dots.remove(),c.$prevArrow&&c.$prevArrow.length&&(c.$prevArrow.removeClass("slick-disabled slick-arrow slick-hidden").removeAttr("aria-hidden aria-disabled tabindex").css("display",""),c.htmlExpr.test(c.options.prevArrow)&&c.$prevArrow.remove()),c.$nextArrow&&c.$nextArrow.length&&(c.$nextArrow.removeClass("slick-disabled slick-arrow slick-hidden").removeAttr("aria-hidden aria-disabled tabindex").css("display",""),c.htmlExpr.test(c.options.nextArrow)&&c.$nextArrow.remove()),c.$slides&&(c.$slides.removeClass("slick-slide slick-active slick-center slick-visible slick-current").removeAttr("aria-hidden").removeAttr("data-slick-index").each(function(){a(this).attr("style",a(this).data("originalStyling"))}),c.$slideTrack.children(this.options.slide).detach(),c.$slideTrack.detach(),c.$list.detach(),c.$slider.append(c.$slides)),c.cleanUpRows(),c.$slider.removeClass("slick-slider"),c.$slider.removeClass("slick-initialized"),c.$slider.removeClass("slick-dotted"),c.unslicked=!0,b||c.$slider.trigger("destroy",[c])},b.prototype.disableTransition=function(a){var b=this,c={};c[b.transitionType]="",b.options.fade===!1?b.$slideTrack.css(c):b.$slides.eq(a).css(c)},b.prototype.fadeSlide=function(a,b){var c=this;c.cssTransitions===!1?(c.$slides.eq(a).css({zIndex:c.options.zIndex}),c.$slides.eq(a).animate({opacity:1},c.options.speed,c.options.easing,b)):(c.applyTransition(a),c.$slides.eq(a).css({opacity:1,zIndex:c.options.zIndex}),b&&setTimeout(function(){c.disableTransition(a),b.call()},c.options.speed))},b.prototype.fadeSlideOut=function(a){var b=this;b.cssTransitions===!1?b.$slides.eq(a).animate({opacity:0,zIndex:b.options.zIndex-2},b.options.speed,b.options.easing):(b.applyTransition(a),b.$slides.eq(a).css({opacity:0,zIndex:b.options.zIndex-2}))},b.prototype.filterSlides=b.prototype.slickFilter=function(a){var b=this;null!==a&&(b.$slidesCache=b.$slides,b.unload(),b.$slideTrack.children(this.options.slide).detach(),b.$slidesCache.filter(a).appendTo(b.$slideTrack),b.reinit())},b.prototype.focusHandler=function(){var b=this;b.$slider.off("focus.slick blur.slick").on("focus.slick blur.slick","*:not(.slick-arrow)",function(c){c.stopImmediatePropagation();var d=a(this);setTimeout(function(){b.options.pauseOnFocus&&(b.focussed=d.is(":focus"),b.autoPlay())},0)})},b.prototype.getCurrent=b.prototype.slickCurrentSlide=function(){var a=this;return a.currentSlide},b.prototype.getDotCount=function(){var a=this,b=0,c=0,d=0;if(a.options.infinite===!0)for(;b<a.slideCount;)++d,b=c+a.options.slidesToScroll,c+=a.options.slidesToScroll<=a.options.slidesToShow?a.options.slidesToScroll:a.options.slidesToShow;else if(a.options.centerMode===!0)d=a.slideCount;else if(a.options.asNavFor)for(;b<a.slideCount;)++d,b=c+a.options.slidesToScroll,c+=a.options.slidesToScroll<=a.options.slidesToShow?a.options.slidesToScroll:a.options.slidesToShow;else d=1+Math.ceil((a.slideCount-a.options.slidesToShow)/a.options.slidesToScroll);return d-1},b.prototype.getLeft=function(a){var c,d,f,b=this,e=0;return b.slideOffset=0,d=b.$slides.first().outerHeight(!0),b.options.infinite===!0?(b.slideCount>b.options.slidesToShow&&(b.slideOffset=b.slideWidth*b.options.slidesToShow*-1,e=d*b.options.slidesToShow*-1),b.slideCount%b.options.slidesToScroll!==0&&a+b.options.slidesToScroll>b.slideCount&&b.slideCount>b.options.slidesToShow&&(a>b.slideCount?(b.slideOffset=(b.options.slidesToShow-(a-b.slideCount))*b.slideWidth*-1,e=(b.options.slidesToShow-(a-b.slideCount))*d*-1):(b.slideOffset=b.slideCount%b.options.slidesToScroll*b.slideWidth*-1,e=b.slideCount%b.options.slidesToScroll*d*-1))):a+b.options.slidesToShow>b.slideCount&&(b.slideOffset=(a+b.options.slidesToShow-b.slideCount)*b.slideWidth,e=(a+b.options.slidesToShow-b.slideCount)*d),b.slideCount<=b.options.slidesToShow&&(b.slideOffset=0,e=0),b.options.centerMode===!0&&b.options.infinite===!0?b.slideOffset+=b.slideWidth*Math.floor(b.options.slidesToShow/2)-b.slideWidth:b.options.centerMode===!0&&(b.slideOffset=0,b.slideOffset+=b.slideWidth*Math.floor(b.options.slidesToShow/2)),c=b.options.vertical===!1?a*b.slideWidth*-1+b.slideOffset:a*d*-1+e,b.options.variableWidth===!0&&(f=b.slideCount<=b.options.slidesToShow||b.options.infinite===!1?b.$slideTrack.children(".slick-slide").eq(a):b.$slideTrack.children(".slick-slide").eq(a+b.options.slidesToShow),c=b.options.rtl===!0?f[0]?-1*(b.$slideTrack.width()-f[0].offsetLeft-f.width()):0:f[0]?-1*f[0].offsetLeft:0,b.options.centerMode===!0&&(f=b.slideCount<=b.options.slidesToShow||b.options.infinite===!1?b.$slideTrack.children(".slick-slide").eq(a):b.$slideTrack.children(".slick-slide").eq(a+b.options.slidesToShow+1),c=b.options.rtl===!0?f[0]?-1*(b.$slideTrack.width()-f[0].offsetLeft-f.width()):0:f[0]?-1*f[0].offsetLeft:0,c+=(b.$list.width()-f.outerWidth())/2)),c},b.prototype.getOption=b.prototype.slickGetOption=function(a){var b=this;return b.options[a]},b.prototype.getNavigableIndexes=function(){var e,a=this,b=0,c=0,d=[];for(a.options.infinite===!1?e=a.slideCount:(b=-1*a.options.slidesToScroll,c=-1*a.options.slidesToScroll,e=2*a.slideCount);e>b;)d.push(b),b=c+a.options.slidesToScroll,c+=a.options.slidesToScroll<=a.options.slidesToShow?a.options.slidesToScroll:a.options.slidesToShow;return d},b.prototype.getSlick=function(){return this},b.prototype.getSlideCount=function(){var c,d,e,b=this;return e=b.options.centerMode===!0?b.slideWidth*Math.floor(b.options.slidesToShow/2):0,b.options.swipeToSlide===!0?(b.$slideTrack.find(".slick-slide").each(function(c,f){return f.offsetLeft-e+a(f).outerWidth()/2>-1*b.swipeLeft?(d=f,!1):void 0}),c=Math.abs(a(d).attr("data-slick-index")-b.currentSlide)||1):b.options.slidesToScroll},b.prototype.goTo=b.prototype.slickGoTo=function(a,b){var c=this;c.changeSlide({data:{message:"index",index:parseInt(a)}},b)},b.prototype.init=function(b){var c=this;a(c.$slider).hasClass("slick-initialized")||(a(c.$slider).addClass("slick-initialized"),c.buildRows(),c.buildOut(),c.setProps(),c.startLoad(),c.loadSlider(),c.initializeEvents(),c.updateArrows(),c.updateDots(),c.checkResponsive(!0),c.focusHandler()),b&&c.$slider.trigger("init",[c]),c.options.accessibility===!0&&c.initADA(),c.options.autoplay&&(c.paused=!1,c.autoPlay())},b.prototype.initADA=function(){var b=this;b.$slides.add(b.$slideTrack.find(".slick-cloned")).attr({"aria-hidden":"true"}).find("a, input, button, select").attr({tabindex:"0"}),b.$slideTrack.attr("role","listbox"),b.$slides.not(b.$slideTrack.find(".slick-cloned")).each(function(c){a(this).attr({role:"option","aria-describedby":"slick-slide"+b.instanceUid+c})}),null!==b.$dots&&b.$dots.attr("role","tablist").find("li").each(function(c){a(this).attr({role:"presentation","aria-selected":"false","aria-controls":"navigation"+b.instanceUid+c,id:"slick-slide"+b.instanceUid+c})}).first().attr("aria-selected","true").end().find("button").attr("role","button").end().closest("div").attr("role","toolbar"),b.activateADA()},b.prototype.initArrowEvents=function(){var a=this;a.options.arrows===!0&&a.slideCount>a.options.slidesToShow&&(a.$prevArrow.off("click.slick").on("click.slick",{message:"previous"},a.changeSlide),a.$nextArrow.off("click.slick").on("click.slick",{message:"next"},a.changeSlide))},b.prototype.initDotEvents=function(){var b=this;b.options.dots===!0&&b.slideCount>b.options.slidesToShow&&a("li",b.$dots).on("click.slick",{message:"index"},b.changeSlide),b.options.dots===!0&&b.options.pauseOnDotsHover===!0&&a("li",b.$dots).on("mouseenter.slick",a.proxy(b.interrupt,b,!0)).on("mouseleave.slick",a.proxy(b.interrupt,b,!1))},b.prototype.initSlideEvents=function(){var b=this;b.options.pauseOnHover&&(b.$list.on("mouseenter.slick",a.proxy(b.interrupt,b,!0)),b.$list.on("mouseleave.slick",a.proxy(b.interrupt,b,!1)))},b.prototype.initializeEvents=function(){var b=this;b.initArrowEvents(),b.initDotEvents(),b.initSlideEvents(),b.$list.on("touchstart.slick mousedown.slick",{action:"start"},b.swipeHandler),b.$list.on("touchmove.slick mousemove.slick",{action:"move"},b.swipeHandler),b.$list.on("touchend.slick mouseup.slick",{action:"end"},b.swipeHandler),b.$list.on("touchcancel.slick mouseleave.slick",{action:"end"},b.swipeHandler),b.$list.on("click.slick",b.clickHandler),a(document).on(b.visibilityChange,a.proxy(b.visibility,b)),b.options.accessibility===!0&&b.$list.on("keydown.slick",b.keyHandler),b.options.focusOnSelect===!0&&a(b.$slideTrack).children().on("click.slick",b.selectHandler),a(window).on("orientationchange.slick.slick-"+b.instanceUid,a.proxy(b.orientationChange,b)),a(window).on("resize.slick.slick-"+b.instanceUid,a.proxy(b.resize,b)),a("[draggable!=true]",b.$slideTrack).on("dragstart",b.preventDefault),a(window).on("load.slick.slick-"+b.instanceUid,b.setPosition),a(document).on("ready.slick.slick-"+b.instanceUid,b.setPosition)},b.prototype.initUI=function(){var a=this;a.options.arrows===!0&&a.slideCount>a.options.slidesToShow&&(a.$prevArrow.show(),a.$nextArrow.show()),a.options.dots===!0&&a.slideCount>a.options.slidesToShow&&a.$dots.show()},b.prototype.keyHandler=function(a){var b=this;a.target.tagName.match("TEXTAREA|INPUT|SELECT")||(37===a.keyCode&&b.options.accessibility===!0?b.changeSlide({data:{message:b.options.rtl===!0?"next":"previous"}}):39===a.keyCode&&b.options.accessibility===!0&&b.changeSlide({data:{message:b.options.rtl===!0?"previous":"next"}}))},b.prototype.lazyLoad=function(){function g(c){a("img[data-lazy]",c).each(function(){var c=a(this),d=a(this).attr("data-lazy"),e=document.createElement("img");e.onload=function(){c.animate({opacity:0},100,function(){c.attr("src",d).animate({opacity:1},200,function(){c.removeAttr("data-lazy").removeClass("slick-loading")}),b.$slider.trigger("lazyLoaded",[b,c,d])})},e.onerror=function(){c.removeAttr("data-lazy").removeClass("slick-loading").addClass("slick-lazyload-error"),b.$slider.trigger("lazyLoadError",[b,c,d])},e.src=d})}var c,d,e,f,b=this;b.options.centerMode===!0?b.options.infinite===!0?(e=b.currentSlide+(b.options.slidesToShow/2+1),f=e+b.options.slidesToShow+2):(e=Math.max(0,b.currentSlide-(b.options.slidesToShow/2+1)),f=2+(b.options.slidesToShow/2+1)+b.currentSlide):(e=b.options.infinite?b.options.slidesToShow+b.currentSlide:b.currentSlide,f=Math.ceil(e+b.options.slidesToShow),b.options.fade===!0&&(e>0&&e--,f<=b.slideCount&&f++)),c=b.$slider.find(".slick-slide").slice(e,f),g(c),b.slideCount<=b.options.slidesToShow?(d=b.$slider.find(".slick-slide"),g(d)):b.currentSlide>=b.slideCount-b.options.slidesToShow?(d=b.$slider.find(".slick-cloned").slice(0,b.options.slidesToShow),g(d)):0===b.currentSlide&&(d=b.$slider.find(".slick-cloned").slice(-1*b.options.slidesToShow),g(d))},b.prototype.loadSlider=function(){var a=this;a.setPosition(),a.$slideTrack.css({opacity:1}),a.$slider.removeClass("slick-loading"),a.initUI(),"progressive"===a.options.lazyLoad&&a.progressiveLazyLoad()},b.prototype.next=b.prototype.slickNext=function(){var a=this;a.changeSlide({data:{message:"next"}})},b.prototype.orientationChange=function(){var a=this;a.checkResponsive(),a.setPosition()},b.prototype.pause=b.prototype.slickPause=function(){var a=this;a.autoPlayClear(),a.paused=!0},b.prototype.play=b.prototype.slickPlay=function(){var a=this;a.autoPlay(),a.options.autoplay=!0,a.paused=!1,a.focussed=!1,a.interrupted=!1},b.prototype.postSlide=function(a){var b=this;b.unslicked||(b.$slider.trigger("afterChange",[b,a]),b.animating=!1,b.setPosition(),b.swipeLeft=null,b.options.autoplay&&b.autoPlay(),b.options.accessibility===!0&&b.initADA())},b.prototype.prev=b.prototype.slickPrev=function(){var a=this;a.changeSlide({data:{message:"previous"}})},b.prototype.preventDefault=function(a){a.preventDefault()},b.prototype.progressiveLazyLoad=function(b){b=b||1;var e,f,g,c=this,d=a("img[data-lazy]",c.$slider);d.length?(e=d.first(),f=e.attr("data-lazy"),g=document.createElement("img"),g.onload=function(){e.attr("src",f).removeAttr("data-lazy").removeClass("slick-loading"),c.options.adaptiveHeight===!0&&c.setPosition(),c.$slider.trigger("lazyLoaded",[c,e,f]),c.progressiveLazyLoad()},g.onerror=function(){3>b?setTimeout(function(){c.progressiveLazyLoad(b+1)},500):(e.removeAttr("data-lazy").removeClass("slick-loading").addClass("slick-lazyload-error"),c.$slider.trigger("lazyLoadError",[c,e,f]),c.progressiveLazyLoad())},g.src=f):c.$slider.trigger("allImagesLoaded",[c])},b.prototype.refresh=function(b){var d,e,c=this;e=c.slideCount-c.options.slidesToShow,!c.options.infinite&&c.currentSlide>e&&(c.currentSlide=e),c.slideCount<=c.options.slidesToShow&&(c.currentSlide=0),d=c.currentSlide,c.destroy(!0),a.extend(c,c.initials,{currentSlide:d}),c.init(),b||c.changeSlide({data:{message:"index",index:d}},!1)},b.prototype.registerBreakpoints=function(){var c,d,e,b=this,f=b.options.responsive||null;if("array"===a.type(f)&&f.length){b.respondTo=b.options.respondTo||"window";for(c in f)if(e=b.breakpoints.length-1,d=f[c].breakpoint,f.hasOwnProperty(c)){for(;e>=0;)b.breakpoints[e]&&b.breakpoints[e]===d&&b.breakpoints.splice(e,1),e--;b.breakpoints.push(d),b.breakpointSettings[d]=f[c].settings}b.breakpoints.sort(function(a,c){return b.options.mobileFirst?a-c:c-a})}},b.prototype.reinit=function(){var b=this;b.$slides=b.$slideTrack.children(b.options.slide).addClass("slick-slide"),b.slideCount=b.$slides.length,b.currentSlide>=b.slideCount&&0!==b.currentSlide&&(b.currentSlide=b.currentSlide-b.options.slidesToScroll),b.slideCount<=b.options.slidesToShow&&(b.currentSlide=0),b.registerBreakpoints(),b.setProps(),b.setupInfinite(),b.buildArrows(),b.updateArrows(),b.initArrowEvents(),b.buildDots(),b.updateDots(),b.initDotEvents(),b.cleanUpSlideEvents(),b.initSlideEvents(),b.checkResponsive(!1,!0),b.options.focusOnSelect===!0&&a(b.$slideTrack).children().on("click.slick",b.selectHandler),b.setSlideClasses("number"==typeof b.currentSlide?b.currentSlide:0),b.setPosition(),b.focusHandler(),b.paused=!b.options.autoplay,b.autoPlay(),b.$slider.trigger("reInit",[b])},b.prototype.resize=function(){var b=this;a(window).width()!==b.windowWidth&&(clearTimeout(b.windowDelay),b.windowDelay=window.setTimeout(function(){b.windowWidth=a(window).width(),b.checkResponsive(),b.unslicked||b.setPosition()},50))},b.prototype.removeSlide=b.prototype.slickRemove=function(a,b,c){var d=this;return"boolean"==typeof a?(b=a,a=b===!0?0:d.slideCount-1):a=b===!0?--a:a,d.slideCount<1||0>a||a>d.slideCount-1?!1:(d.unload(),c===!0?d.$slideTrack.children().remove():d.$slideTrack.children(this.options.slide).eq(a).remove(),d.$slides=d.$slideTrack.children(this.options.slide),d.$slideTrack.children(this.options.slide).detach(),d.$slideTrack.append(d.$slides),d.$slidesCache=d.$slides,void d.reinit())},b.prototype.setCSS=function(a){var d,e,b=this,c={};b.options.rtl===!0&&(a=-a),d="left"==b.positionProp?Math.ceil(a)+"px":"0px",e="top"==b.positionProp?Math.ceil(a)+"px":"0px",c[b.positionProp]=a,b.transformsEnabled===!1?b.$slideTrack.css(c):(c={},b.cssTransitions===!1?(c[b.animType]="translate("+d+", "+e+")",b.$slideTrack.css(c)):(c[b.animType]="translate3d("+d+", "+e+", 0px)",b.$slideTrack.css(c)))},b.prototype.setDimensions=function(){var a=this;a.options.vertical===!1?a.options.centerMode===!0&&a.$list.css({padding:"0px "+a.options.centerPadding}):(a.$list.height(a.$slides.first().outerHeight(!0)*a.options.slidesToShow),a.options.centerMode===!0&&a.$list.css({padding:a.options.centerPadding+" 0px"})),a.listWidth=a.$list.width(),a.listHeight=a.$list.height(),a.options.vertical===!1&&a.options.variableWidth===!1?(a.slideWidth=Math.ceil(a.listWidth/a.options.slidesToShow),a.$slideTrack.width(Math.ceil(a.slideWidth*a.$slideTrack.children(".slick-slide").length))):a.options.variableWidth===!0?a.$slideTrack.width(5e3*a.slideCount):(a.slideWidth=Math.ceil(a.listWidth),a.$slideTrack.height(Math.ceil(a.$slides.first().outerHeight(!0)*a.$slideTrack.children(".slick-slide").length)));var b=a.$slides.first().outerWidth(!0)-a.$slides.first().width();a.options.variableWidth===!1&&a.$slideTrack.children(".slick-slide").width(a.slideWidth-b)},b.prototype.setFade=function(){var c,b=this;b.$slides.each(function(d,e){c=b.slideWidth*d*-1,b.options.rtl===!0?a(e).css({position:"relative",right:c,top:0,zIndex:b.options.zIndex-2,opacity:0}):a(e).css({position:"relative",left:c,top:0,zIndex:b.options.zIndex-2,opacity:0})}),b.$slides.eq(b.currentSlide).css({zIndex:b.options.zIndex-1,opacity:1})},b.prototype.setHeight=function(){var a=this;if(1===a.options.slidesToShow&&a.options.adaptiveHeight===!0&&a.options.vertical===!1){var b=a.$slides.eq(a.currentSlide).outerHeight(!0);a.$list.css("height",b)}},b.prototype.setOption=b.prototype.slickSetOption=function(){var c,d,e,f,h,b=this,g=!1;if("object"===a.type(arguments[0])?(e=arguments[0],g=arguments[1],h="multiple"):"string"===a.type(arguments[0])&&(e=arguments[0],f=arguments[1],g=arguments[2],"responsive"===arguments[0]&&"array"===a.type(arguments[1])?h="responsive":"undefined"!=typeof arguments[1]&&(h="single")),"single"===h)b.options[e]=f;else if("multiple"===h)a.each(e,function(a,c){b.options[a]=c});else if("responsive"===h)for(d in f)if("array"!==a.type(b.options.responsive))b.options.responsive=[f[d]];else{for(c=b.options.responsive.length-1;c>=0;)b.options.responsive[c].breakpoint===f[d].breakpoint&&b.options.responsive.splice(c,1),c--;b.options.responsive.push(f[d])}g&&(b.unload(),b.reinit())},b.prototype.setPosition=function(){var a=this;a.setDimensions(),a.setHeight(),a.options.fade===!1?a.setCSS(a.getLeft(a.currentSlide)):a.setFade(),a.$slider.trigger("setPosition",[a])},b.prototype.setProps=function(){var a=this,b=document.body.style;a.positionProp=a.options.vertical===!0?"top":"left","top"===a.positionProp?a.$slider.addClass("slick-vertical"):a.$slider.removeClass("slick-vertical"),(void 0!==b.WebkitTransition||void 0!==b.MozTransition||void 0!==b.msTransition)&&a.options.useCSS===!0&&(a.cssTransitions=!0),a.options.fade&&("number"==typeof a.options.zIndex?a.options.zIndex<3&&(a.options.zIndex=3):a.options.zIndex=a.defaults.zIndex),void 0!==b.OTransform&&(a.animType="OTransform",a.transformType="-o-transform",a.transitionType="OTransition",void 0===b.perspectiveProperty&&void 0===b.webkitPerspective&&(a.animType=!1)),void 0!==b.MozTransform&&(a.animType="MozTransform",a.transformType="-moz-transform",a.transitionType="MozTransition",void 0===b.perspectiveProperty&&void 0===b.MozPerspective&&(a.animType=!1)),void 0!==b.webkitTransform&&(a.animType="webkitTransform",a.transformType="-webkit-transform",a.transitionType="webkitTransition",void 0===b.perspectiveProperty&&void 0===b.webkitPerspective&&(a.animType=!1)),void 0!==b.msTransform&&(a.animType="msTransform",a.transformType="-ms-transform",a.transitionType="msTransition",void 0===b.msTransform&&(a.animType=!1)),void 0!==b.transform&&a.animType!==!1&&(a.animType="transform",a.transformType="transform",a.transitionType="transition"),a.transformsEnabled=a.options.useTransform&&null!==a.animType&&a.animType!==!1},b.prototype.setSlideClasses=function(a){var c,d,e,f,b=this;d=b.$slider.find(".slick-slide").removeClass("slick-active slick-center slick-current").attr("aria-hidden","true"),b.$slides.eq(a).addClass("slick-current"),b.options.centerMode===!0?(c=Math.floor(b.options.slidesToShow/2),b.options.infinite===!0&&(a>=c&&a<=b.slideCount-1-c?b.$slides.slice(a-c,a+c+1).addClass("slick-active").attr("aria-hidden","false"):(e=b.options.slidesToShow+a,
d.slice(e-c+1,e+c+2).addClass("slick-active").attr("aria-hidden","false")),0===a?d.eq(d.length-1-b.options.slidesToShow).addClass("slick-center"):a===b.slideCount-1&&d.eq(b.options.slidesToShow).addClass("slick-center")),b.$slides.eq(a).addClass("slick-center")):a>=0&&a<=b.slideCount-b.options.slidesToShow?b.$slides.slice(a,a+b.options.slidesToShow).addClass("slick-active").attr("aria-hidden","false"):d.length<=b.options.slidesToShow?d.addClass("slick-active").attr("aria-hidden","false"):(f=b.slideCount%b.options.slidesToShow,e=b.options.infinite===!0?b.options.slidesToShow+a:a,b.options.slidesToShow==b.options.slidesToScroll&&b.slideCount-a<b.options.slidesToShow?d.slice(e-(b.options.slidesToShow-f),e+f).addClass("slick-active").attr("aria-hidden","false"):d.slice(e,e+b.options.slidesToShow).addClass("slick-active").attr("aria-hidden","false")),"ondemand"===b.options.lazyLoad&&b.lazyLoad()},b.prototype.setupInfinite=function(){var c,d,e,b=this;if(b.options.fade===!0&&(b.options.centerMode=!1),b.options.infinite===!0&&b.options.fade===!1&&(d=null,b.slideCount>b.options.slidesToShow)){for(e=b.options.centerMode===!0?b.options.slidesToShow+1:b.options.slidesToShow,c=b.slideCount;c>b.slideCount-e;c-=1)d=c-1,a(b.$slides[d]).clone(!0).attr("id","").attr("data-slick-index",d-b.slideCount).prependTo(b.$slideTrack).addClass("slick-cloned");for(c=0;e>c;c+=1)d=c,a(b.$slides[d]).clone(!0).attr("id","").attr("data-slick-index",d+b.slideCount).appendTo(b.$slideTrack).addClass("slick-cloned");b.$slideTrack.find(".slick-cloned").find("[id]").each(function(){a(this).attr("id","")})}},b.prototype.interrupt=function(a){var b=this;a||b.autoPlay(),b.interrupted=a},b.prototype.selectHandler=function(b){var c=this,d=a(b.target).is(".slick-slide")?a(b.target):a(b.target).parents(".slick-slide"),e=parseInt(d.attr("data-slick-index"));return e||(e=0),c.slideCount<=c.options.slidesToShow?(c.setSlideClasses(e),void c.asNavFor(e)):void c.slideHandler(e)},b.prototype.slideHandler=function(a,b,c){var d,e,f,g,j,h=null,i=this;return b=b||!1,i.animating===!0&&i.options.waitForAnimate===!0||i.options.fade===!0&&i.currentSlide===a||i.slideCount<=i.options.slidesToShow?void 0:(b===!1&&i.asNavFor(a),d=a,h=i.getLeft(d),g=i.getLeft(i.currentSlide),i.currentLeft=null===i.swipeLeft?g:i.swipeLeft,i.options.infinite===!1&&i.options.centerMode===!1&&(0>a||a>i.getDotCount()*i.options.slidesToScroll)?void(i.options.fade===!1&&(d=i.currentSlide,c!==!0?i.animateSlide(g,function(){i.postSlide(d)}):i.postSlide(d))):i.options.infinite===!1&&i.options.centerMode===!0&&(0>a||a>i.slideCount-i.options.slidesToScroll)?void(i.options.fade===!1&&(d=i.currentSlide,c!==!0?i.animateSlide(g,function(){i.postSlide(d)}):i.postSlide(d))):(i.options.autoplay&&clearInterval(i.autoPlayTimer),e=0>d?i.slideCount%i.options.slidesToScroll!==0?i.slideCount-i.slideCount%i.options.slidesToScroll:i.slideCount+d:d>=i.slideCount?i.slideCount%i.options.slidesToScroll!==0?0:d-i.slideCount:d,i.animating=!0,i.$slider.trigger("beforeChange",[i,i.currentSlide,e]),f=i.currentSlide,i.currentSlide=e,i.setSlideClasses(i.currentSlide),i.options.asNavFor&&(j=i.getNavTarget(),j=j.slick("getSlick"),j.slideCount<=j.options.slidesToShow&&j.setSlideClasses(i.currentSlide)),i.updateDots(),i.updateArrows(),i.options.fade===!0?(c!==!0?(i.fadeSlideOut(f),i.fadeSlide(e,function(){i.postSlide(e)})):i.postSlide(e),void i.animateHeight()):void(c!==!0?i.animateSlide(h,function(){i.postSlide(e)}):i.postSlide(e))))},b.prototype.startLoad=function(){var a=this;a.options.arrows===!0&&a.slideCount>a.options.slidesToShow&&(a.$prevArrow.hide(),a.$nextArrow.hide()),a.options.dots===!0&&a.slideCount>a.options.slidesToShow&&a.$dots.hide(),a.$slider.addClass("slick-loading")},b.prototype.swipeDirection=function(){var a,b,c,d,e=this;return a=e.touchObject.startX-e.touchObject.curX,b=e.touchObject.startY-e.touchObject.curY,c=Math.atan2(b,a),d=Math.round(180*c/Math.PI),0>d&&(d=360-Math.abs(d)),45>=d&&d>=0?e.options.rtl===!1?"left":"right":360>=d&&d>=315?e.options.rtl===!1?"left":"right":d>=135&&225>=d?e.options.rtl===!1?"right":"left":e.options.verticalSwiping===!0?d>=35&&135>=d?"down":"up":"vertical"},b.prototype.swipeEnd=function(a){var c,d,b=this;if(b.dragging=!1,b.interrupted=!1,b.shouldClick=b.touchObject.swipeLength>10?!1:!0,void 0===b.touchObject.curX)return!1;if(b.touchObject.edgeHit===!0&&b.$slider.trigger("edge",[b,b.swipeDirection()]),b.touchObject.swipeLength>=b.touchObject.minSwipe){switch(d=b.swipeDirection()){case"left":case"down":c=b.options.swipeToSlide?b.checkNavigable(b.currentSlide+b.getSlideCount()):b.currentSlide+b.getSlideCount(),b.currentDirection=0;break;case"right":case"up":c=b.options.swipeToSlide?b.checkNavigable(b.currentSlide-b.getSlideCount()):b.currentSlide-b.getSlideCount(),b.currentDirection=1}"vertical"!=d&&(b.slideHandler(c),b.touchObject={},b.$slider.trigger("swipe",[b,d]))}else b.touchObject.startX!==b.touchObject.curX&&(b.slideHandler(b.currentSlide),b.touchObject={})},b.prototype.swipeHandler=function(a){var b=this;if(!(b.options.swipe===!1||"ontouchend"in document&&b.options.swipe===!1||b.options.draggable===!1&&-1!==a.type.indexOf("mouse")))switch(b.touchObject.fingerCount=a.originalEvent&&void 0!==a.originalEvent.touches?a.originalEvent.touches.length:1,b.touchObject.minSwipe=b.listWidth/b.options.touchThreshold,b.options.verticalSwiping===!0&&(b.touchObject.minSwipe=b.listHeight/b.options.touchThreshold),a.data.action){case"start":b.swipeStart(a);break;case"move":b.swipeMove(a);break;case"end":b.swipeEnd(a)}},b.prototype.swipeMove=function(a){var d,e,f,g,h,b=this;return h=void 0!==a.originalEvent?a.originalEvent.touches:null,!b.dragging||h&&1!==h.length?!1:(d=b.getLeft(b.currentSlide),b.touchObject.curX=void 0!==h?h[0].pageX:a.clientX,b.touchObject.curY=void 0!==h?h[0].pageY:a.clientY,b.touchObject.swipeLength=Math.round(Math.sqrt(Math.pow(b.touchObject.curX-b.touchObject.startX,2))),b.options.verticalSwiping===!0&&(b.touchObject.swipeLength=Math.round(Math.sqrt(Math.pow(b.touchObject.curY-b.touchObject.startY,2)))),e=b.swipeDirection(),"vertical"!==e?(void 0!==a.originalEvent&&b.touchObject.swipeLength>4&&a.preventDefault(),g=(b.options.rtl===!1?1:-1)*(b.touchObject.curX>b.touchObject.startX?1:-1),b.options.verticalSwiping===!0&&(g=b.touchObject.curY>b.touchObject.startY?1:-1),f=b.touchObject.swipeLength,b.touchObject.edgeHit=!1,b.options.infinite===!1&&(0===b.currentSlide&&"right"===e||b.currentSlide>=b.getDotCount()&&"left"===e)&&(f=b.touchObject.swipeLength*b.options.edgeFriction,b.touchObject.edgeHit=!0),b.options.vertical===!1?b.swipeLeft=d+f*g:b.swipeLeft=d+f*(b.$list.height()/b.listWidth)*g,b.options.verticalSwiping===!0&&(b.swipeLeft=d+f*g),b.options.fade===!0||b.options.touchMove===!1?!1:b.animating===!0?(b.swipeLeft=null,!1):void b.setCSS(b.swipeLeft)):void 0)},b.prototype.swipeStart=function(a){var c,b=this;return b.interrupted=!0,1!==b.touchObject.fingerCount||b.slideCount<=b.options.slidesToShow?(b.touchObject={},!1):(void 0!==a.originalEvent&&void 0!==a.originalEvent.touches&&(c=a.originalEvent.touches[0]),b.touchObject.startX=b.touchObject.curX=void 0!==c?c.pageX:a.clientX,b.touchObject.startY=b.touchObject.curY=void 0!==c?c.pageY:a.clientY,void(b.dragging=!0))},b.prototype.unfilterSlides=b.prototype.slickUnfilter=function(){var a=this;null!==a.$slidesCache&&(a.unload(),a.$slideTrack.children(this.options.slide).detach(),a.$slidesCache.appendTo(a.$slideTrack),a.reinit())},b.prototype.unload=function(){var b=this;a(".slick-cloned",b.$slider).remove(),b.$dots&&b.$dots.remove(),b.$prevArrow&&b.htmlExpr.test(b.options.prevArrow)&&b.$prevArrow.remove(),b.$nextArrow&&b.htmlExpr.test(b.options.nextArrow)&&b.$nextArrow.remove(),b.$slides.removeClass("slick-slide slick-active slick-visible slick-current").attr("aria-hidden","true").css("width","")},b.prototype.unslick=function(a){var b=this;b.$slider.trigger("unslick",[b,a]),b.destroy()},b.prototype.updateArrows=function(){var b,a=this;b=Math.floor(a.options.slidesToShow/2),a.options.arrows===!0&&a.slideCount>a.options.slidesToShow&&!a.options.infinite&&(a.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false"),a.$nextArrow.removeClass("slick-disabled").attr("aria-disabled","false"),0===a.currentSlide?(a.$prevArrow.addClass("slick-disabled").attr("aria-disabled","true"),a.$nextArrow.removeClass("slick-disabled").attr("aria-disabled","false")):a.currentSlide>=a.slideCount-a.options.slidesToShow&&a.options.centerMode===!1?(a.$nextArrow.addClass("slick-disabled").attr("aria-disabled","true"),a.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false")):a.currentSlide>=a.slideCount-1&&a.options.centerMode===!0&&(a.$nextArrow.addClass("slick-disabled").attr("aria-disabled","true"),a.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false")))},b.prototype.updateDots=function(){var a=this;null!==a.$dots&&(a.$dots.find("li").removeClass("slick-active").attr("aria-hidden","true"),a.$dots.find("li").eq(Math.floor(a.currentSlide/a.options.slidesToScroll)).addClass("slick-active").attr("aria-hidden","false"))},b.prototype.visibility=function(){var a=this;a.options.autoplay&&(document[a.hidden]?a.interrupted=!0:a.interrupted=!1)},a.fn.slick=function(){var f,g,a=this,c=arguments[0],d=Array.prototype.slice.call(arguments,1),e=a.length;for(f=0;e>f;f++)if("object"==typeof c||"undefined"==typeof c?a[f].slick=new b(a[f],c):g=a[f].slick[c].apply(a[f].slick,d),"undefined"!=typeof g)return g;return a}});
/*! nouislider - 9.0.0 - 2016-09-29 21:44:02 */
/* https://refreshless.com/nouislider/ */
!function(a){"function"==typeof define&&define.amd?define([],a):"object"==typeof exports?module.exports=a():window.noUiSlider=a()}(function(){"use strict";function a(a,b){var c=document.createElement("div");return j(c,b),a.appendChild(c),c}function b(a){return a.filter(function(a){return!this[a]&&(this[a]=!0)},{})}function c(a,b){return Math.round(a/b)*b}function d(a,b){var c=a.getBoundingClientRect(),d=a.ownerDocument,e=d.documentElement,f=m();return/webkit.*Chrome.*Mobile/i.test(navigator.userAgent)&&(f.x=0),b?c.top+f.y-e.clientTop:c.left+f.x-e.clientLeft}function e(a){return"number"==typeof a&&!isNaN(a)&&isFinite(a)}function f(a,b,c){c>0&&(j(a,b),setTimeout(function(){k(a,b)},c))}function g(a){return Math.max(Math.min(a,100),0)}function h(a){return Array.isArray(a)?a:[a]}function i(a){a=String(a);var b=a.split(".");return b.length>1?b[1].length:0}function j(a,b){a.classList?a.classList.add(b):a.className+=" "+b}function k(a,b){a.classList?a.classList.remove(b):a.className=a.className.replace(new RegExp("(^|\\b)"+b.split(" ").join("|")+"(\\b|$)","gi")," ")}function l(a,b){return a.classList?a.classList.contains(b):new RegExp("\\b"+b+"\\b").test(a.className)}function m(){var a=void 0!==window.pageXOffset,b="CSS1Compat"===(document.compatMode||""),c=a?window.pageXOffset:b?document.documentElement.scrollLeft:document.body.scrollLeft,d=a?window.pageYOffset:b?document.documentElement.scrollTop:document.body.scrollTop;return{x:c,y:d}}function n(){return window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"}}function o(a,b){return 100/(b-a)}function p(a,b){return 100*b/(a[1]-a[0])}function q(a,b){return p(a,a[0]<0?b+Math.abs(a[0]):b-a[0])}function r(a,b){return b*(a[1]-a[0])/100+a[0]}function s(a,b){for(var c=1;a>=b[c];)c+=1;return c}function t(a,b,c){if(c>=a.slice(-1)[0])return 100;var d,e,f,g,h=s(c,a);return d=a[h-1],e=a[h],f=b[h-1],g=b[h],f+q([d,e],c)/o(f,g)}function u(a,b,c){if(c>=100)return a.slice(-1)[0];var d,e,f,g,h=s(c,b);return d=a[h-1],e=a[h],f=b[h-1],g=b[h],r([d,e],(c-f)*o(f,g))}function v(a,b,d,e){if(100===e)return e;var f,g,h=s(e,a);return d?(f=a[h-1],g=a[h],e-f>(g-f)/2?g:f):b[h-1]?a[h-1]+c(e-a[h-1],b[h-1]):e}function w(a,b,c){var d;if("number"==typeof b&&(b=[b]),"[object Array]"!==Object.prototype.toString.call(b))throw new Error("noUiSlider: 'range' contains invalid value.");if(d="min"===a?0:"max"===a?100:parseFloat(a),!e(d)||!e(b[0]))throw new Error("noUiSlider: 'range' value isn't numeric.");c.xPct.push(d),c.xVal.push(b[0]),d?c.xSteps.push(!isNaN(b[1])&&b[1]):isNaN(b[1])||(c.xSteps[0]=b[1]),c.xHighestCompleteStep.push(0)}function x(a,b,c){if(!b)return!0;c.xSteps[a]=p([c.xVal[a],c.xVal[a+1]],b)/o(c.xPct[a],c.xPct[a+1]);var d=(c.xVal[a+1]-c.xVal[a])/c.xNumSteps[a],e=Math.ceil(Number(d.toFixed(3))-1),f=c.xVal[a]+c.xNumSteps[a]*e;c.xHighestCompleteStep[a]=f}function y(a,b,c,d){this.xPct=[],this.xVal=[],this.xSteps=[d||!1],this.xNumSteps=[!1],this.xHighestCompleteStep=[],this.snap=b,this.direction=c;var e,f=[];for(e in a)a.hasOwnProperty(e)&&f.push([a[e],e]);for(f.length&&"object"==typeof f[0][0]?f.sort(function(a,b){return a[0][0]-b[0][0]}):f.sort(function(a,b){return a[0]-b[0]}),e=0;e<f.length;e++)w(f[e][1],f[e][0],this);for(this.xNumSteps=this.xSteps.slice(0),e=0;e<this.xNumSteps.length;e++)x(e,this.xNumSteps[e],this)}function z(a,b){if(!e(b))throw new Error("noUiSlider: 'step' is not numeric.");a.singleStep=b}function A(a,b){if("object"!=typeof b||Array.isArray(b))throw new Error("noUiSlider: 'range' is not an object.");if(void 0===b.min||void 0===b.max)throw new Error("noUiSlider: Missing 'min' or 'max' in 'range'.");if(b.min===b.max)throw new Error("noUiSlider: 'range' 'min' and 'max' cannot be equal.");a.spectrum=new y(b,a.snap,a.dir,a.singleStep)}function B(a,b){if(b=h(b),!Array.isArray(b)||!b.length)throw new Error("noUiSlider: 'start' option is incorrect.");a.handles=b.length,a.start=b}function C(a,b){if(a.snap=b,"boolean"!=typeof b)throw new Error("noUiSlider: 'snap' option must be a boolean.")}function D(a,b){if(a.animate=b,"boolean"!=typeof b)throw new Error("noUiSlider: 'animate' option must be a boolean.")}function E(a,b){if(a.animationDuration=b,"number"!=typeof b)throw new Error("noUiSlider: 'animationDuration' option must be a number.")}function F(a,b){var c,d=[!1];if(b===!0||b===!1){for(c=1;c<a.handles;c++)d.push(b);d.push(!1)}else{if(!Array.isArray(b)||!b.length||b.length!==a.handles+1)throw new Error("noUiSlider: 'connect' option doesn't match handle count.");d=b}a.connect=d}function G(a,b){switch(b){case"horizontal":a.ort=0;break;case"vertical":a.ort=1;break;default:throw new Error("noUiSlider: 'orientation' option is invalid.")}}function H(a,b){if(!e(b))throw new Error("noUiSlider: 'margin' option must be numeric.");if(0!==b&&(a.margin=a.spectrum.getMargin(b),!a.margin))throw new Error("noUiSlider: 'margin' option is only supported on linear sliders.")}function I(a,b){if(!e(b))throw new Error("noUiSlider: 'limit' option must be numeric.");if(a.limit=a.spectrum.getMargin(b),!a.limit||a.handles<2)throw new Error("noUiSlider: 'limit' option is only supported on linear sliders with 2 or more handles.")}function J(a,b){switch(b){case"ltr":a.dir=0;break;case"rtl":a.dir=1;break;default:throw new Error("noUiSlider: 'direction' option was not recognized.")}}function K(a,b){if("string"!=typeof b)throw new Error("noUiSlider: 'behaviour' must be a string containing options.");var c=b.indexOf("tap")>=0,d=b.indexOf("drag")>=0,e=b.indexOf("fixed")>=0,f=b.indexOf("snap")>=0,g=b.indexOf("hover")>=0;if(e){if(2!==a.handles)throw new Error("noUiSlider: 'fixed' behaviour must be used with 2 handles");H(a,a.start[1]-a.start[0])}a.events={tap:c||f,drag:d,fixed:e,snap:f,hover:g}}function L(a,b){if(b!==!1)if(b===!0){a.tooltips=[];for(var c=0;c<a.handles;c++)a.tooltips.push(!0)}else{if(a.tooltips=h(b),a.tooltips.length!==a.handles)throw new Error("noUiSlider: must pass a formatter for all handles.");a.tooltips.forEach(function(a){if("boolean"!=typeof a&&("object"!=typeof a||"function"!=typeof a.to))throw new Error("noUiSlider: 'tooltips' must be passed a formatter or 'false'.")})}}function M(a,b){if(a.format=b,"function"==typeof b.to&&"function"==typeof b.from)return!0;throw new Error("noUiSlider: 'format' requires 'to' and 'from' methods.")}function N(a,b){if(void 0!==b&&"string"!=typeof b&&b!==!1)throw new Error("noUiSlider: 'cssPrefix' must be a string or `false`.");a.cssPrefix=b}function O(a,b){if(void 0!==b&&"object"!=typeof b)throw new Error("noUiSlider: 'cssClasses' must be an object.");if("string"==typeof a.cssPrefix){a.cssClasses={};for(var c in b)b.hasOwnProperty(c)&&(a.cssClasses[c]=a.cssPrefix+b[c])}else a.cssClasses=b}function P(a,b){if(b!==!0&&b!==!1)throw new Error("noUiSlider: 'useRequestAnimationFrame' option should be true (default) or false.");a.useRequestAnimationFrame=b}function Q(a){var b,c={margin:0,limit:0,animate:!0,animationDuration:300,format:T};b={step:{r:!1,t:z},start:{r:!0,t:B},connect:{r:!0,t:F},direction:{r:!0,t:J},snap:{r:!1,t:C},animate:{r:!1,t:D},animationDuration:{r:!1,t:E},range:{r:!0,t:A},orientation:{r:!1,t:G},margin:{r:!1,t:H},limit:{r:!1,t:I},behaviour:{r:!0,t:K},format:{r:!1,t:M},tooltips:{r:!1,t:L},cssPrefix:{r:!1,t:N},cssClasses:{r:!1,t:O},useRequestAnimationFrame:{r:!1,t:P}};var d={connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal",cssPrefix:"noUi-",cssClasses:{target:"target",base:"base",origin:"origin",handle:"handle",horizontal:"horizontal",vertical:"vertical",background:"background",connect:"connect",ltr:"ltr",rtl:"rtl",draggable:"draggable",drag:"state-drag",tap:"state-tap",active:"active",tooltip:"tooltip",pips:"pips",pipsHorizontal:"pips-horizontal",pipsVertical:"pips-vertical",marker:"marker",markerHorizontal:"marker-horizontal",markerVertical:"marker-vertical",markerNormal:"marker-normal",markerLarge:"marker-large",markerSub:"marker-sub",value:"value",valueHorizontal:"value-horizontal",valueVertical:"value-vertical",valueNormal:"value-normal",valueLarge:"value-large",valueSub:"value-sub"},useRequestAnimationFrame:!0};Object.keys(b).forEach(function(e){if(void 0===a[e]&&void 0===d[e]){if(b[e].r)throw new Error("noUiSlider: '"+e+"' is required.");return!0}b[e].t(c,void 0===a[e]?d[e]:a[e])}),c.pips=a.pips;var e=[["left","top"],["right","bottom"]];return c.style=e[c.dir][c.ort],c.styleOposite=e[c.dir?0:1][c.ort],c}function R(c,e,i){function o(b,c){var d=a(b,e.cssClasses.origin),f=a(d,e.cssClasses.handle);return f.setAttribute("data-handle",c),d}function p(b,c){return!!c&&a(b,e.cssClasses.connect)}function q(a,b){ba=[],ca=[],ca.push(p(b,a[0]));for(var c=0;c<e.handles;c++)ba.push(o(b,c)),ha[c]=c,ca.push(p(b,a[c+1]))}function r(b){j(b,e.cssClasses.target),0===e.dir?j(b,e.cssClasses.ltr):j(b,e.cssClasses.rtl),0===e.ort?j(b,e.cssClasses.horizontal):j(b,e.cssClasses.vertical),aa=a(b,e.cssClasses.base)}function s(b,c){return!!e.tooltips[c]&&a(b.firstChild,e.cssClasses.tooltip)}function t(){var a=ba.map(s);Z("update",function(b,c,d){if(a[c]){var f=b[c];e.tooltips[c]!==!0&&(f=e.tooltips[c].to(d[c])),a[c].innerHTML=f}})}function u(a,b,c){if("range"===a||"steps"===a)return ia.xVal;if("count"===a){var d,e=100/(b-1),f=0;for(b=[];(d=f++*e)<=100;)b.push(d);a="positions"}return"positions"===a?b.map(function(a){return ia.fromStepping(c?ia.getStep(a):a)}):"values"===a?c?b.map(function(a){return ia.fromStepping(ia.getStep(ia.toStepping(a)))}):b:void 0}function v(a,c,d){function e(a,b){return(a+b).toFixed(7)/1}var f={},g=ia.xVal[0],h=ia.xVal[ia.xVal.length-1],i=!1,j=!1,k=0;return d=b(d.slice().sort(function(a,b){return a-b})),d[0]!==g&&(d.unshift(g),i=!0),d[d.length-1]!==h&&(d.push(h),j=!0),d.forEach(function(b,g){var h,l,m,n,o,p,q,r,s,t,u=b,v=d[g+1];if("steps"===c&&(h=ia.xNumSteps[g]),h||(h=v-u),u!==!1&&void 0!==v)for(h=Math.max(h,1e-7),l=u;l<=v;l=e(l,h)){for(n=ia.toStepping(l),o=n-k,r=o/a,s=Math.round(r),t=o/s,m=1;m<=s;m+=1)p=k+m*t,f[p.toFixed(5)]=["x",0];q=d.indexOf(l)>-1?1:"steps"===c?2:0,!g&&i&&(q=0),l===v&&j||(f[n.toFixed(5)]=[l,q]),k=n}}),f}function w(a,b,c){function d(a,b){var c=b===e.cssClasses.value,d=c?m:n,f=c?k:l;return b+" "+d[e.ort]+" "+f[a]}function f(a,b,c){return'class="'+d(c[1],b)+'" style="'+e.style+": "+a+'%"'}function g(a,d){d[1]=d[1]&&b?b(d[0],d[1]):d[1],i+="<div "+f(a,e.cssClasses.marker,d)+"></div>",d[1]&&(i+="<div "+f(a,e.cssClasses.value,d)+">"+c.to(d[0])+"</div>")}var h=document.createElement("div"),i="",k=[e.cssClasses.valueNormal,e.cssClasses.valueLarge,e.cssClasses.valueSub],l=[e.cssClasses.markerNormal,e.cssClasses.markerLarge,e.cssClasses.markerSub],m=[e.cssClasses.valueHorizontal,e.cssClasses.valueVertical],n=[e.cssClasses.markerHorizontal,e.cssClasses.markerVertical];return j(h,e.cssClasses.pips),j(h,0===e.ort?e.cssClasses.pipsHorizontal:e.cssClasses.pipsVertical),Object.keys(a).forEach(function(b){g(b,a[b])}),h.innerHTML=i,h}function x(a){var b=a.mode,c=a.density||1,d=a.filter||!1,e=a.values||!1,f=a.stepped||!1,g=u(b,e,f),h=v(c,b,g),i=a.format||{to:Math.round};return fa.appendChild(w(h,d,i))}function y(){var a=aa.getBoundingClientRect(),b="offset"+["Width","Height"][e.ort];return 0===e.ort?a.width||aa[b]:a.height||aa[b]}function z(a,b,c,d){var f=function(b){return!fa.hasAttribute("disabled")&&(!l(fa,e.cssClasses.tap)&&(b=A(b,d.pageOffset),!(a===ea.start&&void 0!==b.buttons&&b.buttons>1)&&((!d.hover||!b.buttons)&&(b.calcPoint=b.points[e.ort],void c(b,d)))))},g=[];return a.split(" ").forEach(function(a){b.addEventListener(a,f,!1),g.push([a,f])}),g}function A(a,b){a.preventDefault();var c,d,e=0===a.type.indexOf("touch"),f=0===a.type.indexOf("mouse"),g=0===a.type.indexOf("pointer"),h=a;if(0===a.type.indexOf("MSPointer")&&(g=!0),e){if(h.touches.length>1)return!1;c=a.changedTouches[0].pageX,d=a.changedTouches[0].pageY}return b=b||m(),(f||g)&&(c=a.clientX+b.x,d=a.clientY+b.y),h.pageOffset=b,h.points=[c,d],h.cursor=f||g,h}function B(a){var b=a-d(aa,e.ort),c=100*b/y();return e.dir?100-c:c}function C(a){var b=100,c=!1;return ba.forEach(function(d,e){if(!d.hasAttribute("disabled")){var f=Math.abs(ga[e]-a);f<b&&(c=e,b=f)}}),c}function D(a,b,c,d){var e=c.slice(),f=[!a,a],g=[a,!a];d=d.slice(),a&&d.reverse(),d.length>1?d.forEach(function(a,c){var d=M(e,a,e[a]+b,f[c],g[c]);d===!1?b=0:(b=d-e[a],e[a]=d)}):f=g=[!0];var h=!1;d.forEach(function(a,d){h=R(a,c[a]+b,f[d],g[d])||h}),h&&d.forEach(function(a){E("update",a),E("slide",a)})}function E(a,b,c){Object.keys(ka).forEach(function(d){var f=d.split(".")[0];a===f&&ka[d].forEach(function(a){a.call(da,ja.map(e.format.to),b,ja.slice(),c||!1,ga.slice())})})}function F(a,b){"mouseout"===a.type&&"HTML"===a.target.nodeName&&null===a.relatedTarget&&H(a,b)}function G(a,b){if(navigator.appVersion.indexOf("MSIE 9")===-1&&0===a.buttons&&0!==b.buttonsProperty)return H(a,b);var c=(e.dir?-1:1)*(a.calcPoint-b.startCalcPoint),d=100*c/b.baseSize;D(c>0,d,b.locations,b.handleNumbers)}function H(a,b){var c=aa.querySelector("."+e.cssClasses.active);null!==c&&k(c,e.cssClasses.active),a.cursor&&(document.body.style.cursor="",document.body.removeEventListener("selectstart",document.body.noUiListener)),document.documentElement.noUiListeners.forEach(function(a){document.documentElement.removeEventListener(a[0],a[1])}),k(fa,e.cssClasses.drag),P(),b.handleNumbers.forEach(function(a){E("set",a),E("change",a),E("end",a)})}function I(a,b){if(1===b.handleNumbers.length){var c=ba[b.handleNumbers[0]];if(c.hasAttribute("disabled"))return!1;j(c.children[0],e.cssClasses.active)}a.preventDefault(),a.stopPropagation();var d=z(ea.move,document.documentElement,G,{startCalcPoint:a.calcPoint,baseSize:y(),pageOffset:a.pageOffset,handleNumbers:b.handleNumbers,buttonsProperty:a.buttons,locations:ga.slice()}),f=z(ea.end,document.documentElement,H,{handleNumbers:b.handleNumbers}),g=z("mouseout",document.documentElement,F,{handleNumbers:b.handleNumbers});if(document.documentElement.noUiListeners=d.concat(f,g),a.cursor){document.body.style.cursor=getComputedStyle(a.target).cursor,ba.length>1&&j(fa,e.cssClasses.drag);var h=function(){return!1};document.body.noUiListener=h,document.body.addEventListener("selectstart",h,!1)}b.handleNumbers.forEach(function(a){E("start",a)})}function J(a){a.stopPropagation();var b=B(a.calcPoint),c=C(b);return c!==!1&&(e.events.snap||f(fa,e.cssClasses.tap,e.animationDuration),R(c,b,!0,!0),P(),E("slide",c,!0),E("set",c,!0),E("change",c,!0),E("update",c,!0),void(e.events.snap&&I(a,{handleNumbers:[c]})))}function K(a){var b=B(a.calcPoint),c=ia.getStep(b),d=ia.fromStepping(c);Object.keys(ka).forEach(function(a){"hover"===a.split(".")[0]&&ka[a].forEach(function(a){a.call(da,d)})})}function L(a){a.fixed||ba.forEach(function(a,b){z(ea.start,a.children[0],I,{handleNumbers:[b]})}),a.tap&&z(ea.start,aa,J,{}),a.hover&&z(ea.move,aa,K,{hover:!0}),a.drag&&ca.forEach(function(b,c){if(b!==!1&&0!==c&&c!==ca.length-1){var d=ba[c-1],f=ba[c],g=[b];j(b,e.cssClasses.draggable),a.fixed&&(g.push(d.children[0]),g.push(f.children[0])),g.forEach(function(a){z(ea.start,a,I,{handles:[d,f],handleNumbers:[c-1,c]})})}})}function M(a,b,c,d,f){return ba.length>1&&(d&&b>0&&(c=Math.max(c,a[b-1]+e.margin)),f&&b<ba.length-1&&(c=Math.min(c,a[b+1]-e.margin))),ba.length>1&&e.limit&&(d&&b>0&&(c=Math.min(c,a[b-1]+e.limit)),f&&b<ba.length-1&&(c=Math.max(c,a[b+1]-e.limit))),c=ia.getStep(c),c=g(c),c!==a[b]&&c}function N(a){return a+"%"}function O(a,b){ga[a]=b,ja[a]=ia.fromStepping(b);var c=function(){ba[a].style[e.style]=N(b),S(a),S(a+1)};window.requestAnimationFrame&&e.useRequestAnimationFrame?window.requestAnimationFrame(c):c()}function P(){ha.forEach(function(a){var b=ga[a]>50?-1:1,c=3+(ba.length+b*a);ba[a].childNodes[0].style.zIndex=c})}function R(a,b,c,d){return b=M(ga,a,b,c,d),b!==!1&&(O(a,b),!0)}function S(a){if(ca[a]){var b=0,c=100;0!==a&&(b=ga[a-1]),a!==ca.length-1&&(c=ga[a]),ca[a].style[e.style]=N(b),ca[a].style[e.styleOposite]=N(100-c)}}function T(a,b){null!==a&&a!==!1&&("number"==typeof a&&(a=String(a)),a=e.format.from(a),a===!1||isNaN(a)||R(b,ia.toStepping(a),!1,!1))}function U(a,b){var c=h(a),d=void 0===ga[0];b=void 0===b||!!b,c.forEach(T),e.animate&&!d&&f(fa,e.cssClasses.tap,e.animationDuration),ha.forEach(function(a){R(a,ga[a],!0,!1)}),P(),ha.forEach(function(a){E("update",a),null!==c[a]&&b&&E("set",a)})}function V(a){U(e.start,a)}function W(){var a=ja.map(e.format.to);return 1===a.length?a[0]:a}function X(){for(var a in e.cssClasses)e.cssClasses.hasOwnProperty(a)&&k(fa,e.cssClasses[a]);for(;fa.firstChild;)fa.removeChild(fa.firstChild);delete fa.noUiSlider}function Y(){return ga.map(function(a,b){var c=ia.getNearbySteps(a),d=ja[b],e=c.thisStep.step,f=null;e!==!1&&d+e>c.stepAfter.startValue&&(e=c.stepAfter.startValue-d),f=d>c.thisStep.startValue?c.thisStep.step:c.stepBefore.step!==!1&&d-c.stepBefore.highestStep,100===a?e=null:0===a&&(f=null);var g=ia.countStepDecimals();return null!==e&&e!==!1&&(e=Number(e.toFixed(g))),null!==f&&f!==!1&&(f=Number(f.toFixed(g))),[f,e]})}function Z(a,b){ka[a]=ka[a]||[],ka[a].push(b),"update"===a.split(".")[0]&&ba.forEach(function(a,b){E("update",b)})}function $(a){var b=a&&a.split(".")[0],c=b&&a.substring(b.length);Object.keys(ka).forEach(function(a){var d=a.split(".")[0],e=a.substring(d.length);b&&b!==d||c&&c!==e||delete ka[a]})}function _(a,b){var c=W(),d=["margin","limit","range","animate","snap","step","format"];d.forEach(function(b){void 0!==a[b]&&(i[b]=a[b])});var f=Q(i);d.forEach(function(b){void 0!==a[b]&&(e[b]=f[b])}),f.spectrum.direction=ia.direction,ia=f.spectrum,e.margin=f.margin,e.limit=f.limit,ga=[],U(a.start||c,b)}var aa,ba,ca,da,ea=n(),fa=c,ga=[],ha=[],ia=e.spectrum,ja=[],ka={};if(fa.noUiSlider)throw new Error("Slider was already initialized.");return r(fa),q(e.connect,aa),da={destroy:X,steps:Y,on:Z,off:$,get:W,set:U,reset:V,__moveHandles:function(a,b,c){D(a,b,ga,c)},options:i,updateOptions:_,target:fa,pips:x},L(e.events),U(e.start),e.pips&&x(e.pips),e.tooltips&&t(),da}function S(a,b){if(!a.nodeName)throw new Error("noUiSlider.create requires a single element.");var c=Q(b,a),d=R(a,c,b);return a.noUiSlider=d,d}y.prototype.getMargin=function(a){var b=this.xNumSteps[0];if(b&&a%b)throw new Error("noUiSlider: 'limit' and 'margin' must be divisible by step.");return 2===this.xPct.length&&p(this.xVal,a)},y.prototype.toStepping=function(a){return a=t(this.xVal,this.xPct,a)},y.prototype.fromStepping=function(a){return u(this.xVal,this.xPct,a)},y.prototype.getStep=function(a){return a=v(this.xPct,this.xSteps,this.snap,a)},y.prototype.getNearbySteps=function(a){var b=s(a,this.xPct);return{stepBefore:{startValue:this.xVal[b-2],step:this.xNumSteps[b-2],highestStep:this.xHighestCompleteStep[b-2]},thisStep:{startValue:this.xVal[b-1],step:this.xNumSteps[b-1],highestStep:this.xHighestCompleteStep[b-1]},stepAfter:{startValue:this.xVal[b-0],step:this.xNumSteps[b-0],highestStep:this.xHighestCompleteStep[b-0]}}},y.prototype.countStepDecimals=function(){var a=this.xNumSteps.map(i);return Math.max.apply(null,a)},y.prototype.convert=function(a){return this.getStep(this.toStepping(a))};var T={to:function(a){return void 0!==a&&a.toFixed(2)},from:Number};return{create:S}});
/*!
 * Masonry PACKAGED v4.2.0
 * Cascading grid layout library
 * http://masonry.desandro.com
 * MIT License
 * by David DeSandro
 */

!function(t,e){"function"==typeof define&&define.amd?define("jquery-bridget/jquery-bridget",["jquery"],function(i){return e(t,i)}):"object"==typeof module&&module.exports?module.exports=e(t,require("jquery")):t.jQueryBridget=e(t,t.jQuery)}(window,function(t,e){"use strict";function i(i,r,a){function h(t,e,n){var o,r="$()."+i+'("'+e+'")';return t.each(function(t,h){var u=a.data(h,i);if(!u)return void s(i+" not initialized. Cannot call methods, i.e. "+r);var d=u[e];if(!d||"_"==e.charAt(0))return void s(r+" is not a valid method");var l=d.apply(u,n);o=void 0===o?l:o}),void 0!==o?o:t}function u(t,e){t.each(function(t,n){var o=a.data(n,i);o?(o.option(e),o._init()):(o=new r(n,e),a.data(n,i,o))})}a=a||e||t.jQuery,a&&(r.prototype.option||(r.prototype.option=function(t){a.isPlainObject(t)&&(this.options=a.extend(!0,this.options,t))}),a.fn[i]=function(t){if("string"==typeof t){var e=o.call(arguments,1);return h(this,t,e)}return u(this,t),this},n(a))}function n(t){!t||t&&t.bridget||(t.bridget=i)}var o=Array.prototype.slice,r=t.console,s="undefined"==typeof r?function(){}:function(t){r.error(t)};return n(e||t.jQuery),i}),function(t,e){"function"==typeof define&&define.amd?define("ev-emitter/ev-emitter",e):"object"==typeof module&&module.exports?module.exports=e():t.EvEmitter=e()}("undefined"!=typeof window?window:this,function(){function t(){}var e=t.prototype;return e.on=function(t,e){if(t&&e){var i=this._events=this._events||{},n=i[t]=i[t]||[];return-1==n.indexOf(e)&&n.push(e),this}},e.once=function(t,e){if(t&&e){this.on(t,e);var i=this._onceEvents=this._onceEvents||{},n=i[t]=i[t]||{};return n[e]=!0,this}},e.off=function(t,e){var i=this._events&&this._events[t];if(i&&i.length){var n=i.indexOf(e);return-1!=n&&i.splice(n,1),this}},e.emitEvent=function(t,e){var i=this._events&&this._events[t];if(i&&i.length){var n=0,o=i[n];e=e||[];for(var r=this._onceEvents&&this._onceEvents[t];o;){var s=r&&r[o];s&&(this.off(t,o),delete r[o]),o.apply(this,e),n+=s?0:1,o=i[n]}return this}},t}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("get-size/get-size",[],function(){return e()}):"object"==typeof module&&module.exports?module.exports=e():t.getSize=e()}(window,function(){"use strict";function t(t){var e=parseFloat(t),i=-1==t.indexOf("%")&&!isNaN(e);return i&&e}function e(){}function i(){for(var t={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},e=0;u>e;e++){var i=h[e];t[i]=0}return t}function n(t){var e=getComputedStyle(t);return e||a("Style returned "+e+". Are you running this code in a hidden iframe on Firefox? See http://bit.ly/getsizebug1"),e}function o(){if(!d){d=!0;var e=document.createElement("div");e.style.width="200px",e.style.padding="1px 2px 3px 4px",e.style.borderStyle="solid",e.style.borderWidth="1px 2px 3px 4px",e.style.boxSizing="border-box";var i=document.body||document.documentElement;i.appendChild(e);var o=n(e);r.isBoxSizeOuter=s=200==t(o.width),i.removeChild(e)}}function r(e){if(o(),"string"==typeof e&&(e=document.querySelector(e)),e&&"object"==typeof e&&e.nodeType){var r=n(e);if("none"==r.display)return i();var a={};a.width=e.offsetWidth,a.height=e.offsetHeight;for(var d=a.isBorderBox="border-box"==r.boxSizing,l=0;u>l;l++){var c=h[l],f=r[c],m=parseFloat(f);a[c]=isNaN(m)?0:m}var p=a.paddingLeft+a.paddingRight,g=a.paddingTop+a.paddingBottom,y=a.marginLeft+a.marginRight,v=a.marginTop+a.marginBottom,_=a.borderLeftWidth+a.borderRightWidth,z=a.borderTopWidth+a.borderBottomWidth,E=d&&s,b=t(r.width);b!==!1&&(a.width=b+(E?0:p+_));var x=t(r.height);return x!==!1&&(a.height=x+(E?0:g+z)),a.innerWidth=a.width-(p+_),a.innerHeight=a.height-(g+z),a.outerWidth=a.width+y,a.outerHeight=a.height+v,a}}var s,a="undefined"==typeof console?e:function(t){console.error(t)},h=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],u=h.length,d=!1;return r}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("desandro-matches-selector/matches-selector",e):"object"==typeof module&&module.exports?module.exports=e():t.matchesSelector=e()}(window,function(){"use strict";var t=function(){var t=window.Element.prototype;if(t.matches)return"matches";if(t.matchesSelector)return"matchesSelector";for(var e=["webkit","moz","ms","o"],i=0;i<e.length;i++){var n=e[i],o=n+"MatchesSelector";if(t[o])return o}}();return function(e,i){return e[t](i)}}),function(t,e){"function"==typeof define&&define.amd?define("fizzy-ui-utils/utils",["desandro-matches-selector/matches-selector"],function(i){return e(t,i)}):"object"==typeof module&&module.exports?module.exports=e(t,require("desandro-matches-selector")):t.fizzyUIUtils=e(t,t.matchesSelector)}(window,function(t,e){var i={};i.extend=function(t,e){for(var i in e)t[i]=e[i];return t},i.modulo=function(t,e){return(t%e+e)%e},i.makeArray=function(t){var e=[];if(Array.isArray(t))e=t;else if(t&&"object"==typeof t&&"number"==typeof t.length)for(var i=0;i<t.length;i++)e.push(t[i]);else e.push(t);return e},i.removeFrom=function(t,e){var i=t.indexOf(e);-1!=i&&t.splice(i,1)},i.getParent=function(t,i){for(;t!=document.body;)if(t=t.parentNode,e(t,i))return t},i.getQueryElement=function(t){return"string"==typeof t?document.querySelector(t):t},i.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},i.filterFindElements=function(t,n){t=i.makeArray(t);var o=[];return t.forEach(function(t){if(t instanceof HTMLElement){if(!n)return void o.push(t);e(t,n)&&o.push(t);for(var i=t.querySelectorAll(n),r=0;r<i.length;r++)o.push(i[r])}}),o},i.debounceMethod=function(t,e,i){var n=t.prototype[e],o=e+"Timeout";t.prototype[e]=function(){var t=this[o];t&&clearTimeout(t);var e=arguments,r=this;this[o]=setTimeout(function(){n.apply(r,e),delete r[o]},i||100)}},i.docReady=function(t){var e=document.readyState;"complete"==e||"interactive"==e?setTimeout(t):document.addEventListener("DOMContentLoaded",t)},i.toDashed=function(t){return t.replace(/(.)([A-Z])/g,function(t,e,i){return e+"-"+i}).toLowerCase()};var n=t.console;return i.htmlInit=function(e,o){i.docReady(function(){var r=i.toDashed(o),s="data-"+r,a=document.querySelectorAll("["+s+"]"),h=document.querySelectorAll(".js-"+r),u=i.makeArray(a).concat(i.makeArray(h)),d=s+"-options",l=t.jQuery;u.forEach(function(t){var i,r=t.getAttribute(s)||t.getAttribute(d);try{i=r&&JSON.parse(r)}catch(a){return void(n&&n.error("Error parsing "+s+" on "+t.className+": "+a))}var h=new e(t,i);l&&l.data(t,o,h)})})},i}),function(t,e){"function"==typeof define&&define.amd?define("outlayer/item",["ev-emitter/ev-emitter","get-size/get-size"],e):"object"==typeof module&&module.exports?module.exports=e(require("ev-emitter"),require("get-size")):(t.Outlayer={},t.Outlayer.Item=e(t.EvEmitter,t.getSize))}(window,function(t,e){"use strict";function i(t){for(var e in t)return!1;return e=null,!0}function n(t,e){t&&(this.element=t,this.layout=e,this.position={x:0,y:0},this._create())}function o(t){return t.replace(/([A-Z])/g,function(t){return"-"+t.toLowerCase()})}var r=document.documentElement.style,s="string"==typeof r.transition?"transition":"WebkitTransition",a="string"==typeof r.transform?"transform":"WebkitTransform",h={WebkitTransition:"webkitTransitionEnd",transition:"transitionend"}[s],u={transform:a,transition:s,transitionDuration:s+"Duration",transitionProperty:s+"Property",transitionDelay:s+"Delay"},d=n.prototype=Object.create(t.prototype);d.constructor=n,d._create=function(){this._transn={ingProperties:{},clean:{},onEnd:{}},this.css({position:"absolute"})},d.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},d.getSize=function(){this.size=e(this.element)},d.css=function(t){var e=this.element.style;for(var i in t){var n=u[i]||i;e[n]=t[i]}},d.getPosition=function(){var t=getComputedStyle(this.element),e=this.layout._getOption("originLeft"),i=this.layout._getOption("originTop"),n=t[e?"left":"right"],o=t[i?"top":"bottom"],r=this.layout.size,s=-1!=n.indexOf("%")?parseFloat(n)/100*r.width:parseInt(n,10),a=-1!=o.indexOf("%")?parseFloat(o)/100*r.height:parseInt(o,10);s=isNaN(s)?0:s,a=isNaN(a)?0:a,s-=e?r.paddingLeft:r.paddingRight,a-=i?r.paddingTop:r.paddingBottom,this.position.x=s,this.position.y=a},d.layoutPosition=function(){var t=this.layout.size,e={},i=this.layout._getOption("originLeft"),n=this.layout._getOption("originTop"),o=i?"paddingLeft":"paddingRight",r=i?"left":"right",s=i?"right":"left",a=this.position.x+t[o];e[r]=this.getXValue(a),e[s]="";var h=n?"paddingTop":"paddingBottom",u=n?"top":"bottom",d=n?"bottom":"top",l=this.position.y+t[h];e[u]=this.getYValue(l),e[d]="",this.css(e),this.emitEvent("layout",[this])},d.getXValue=function(t){var e=this.layout._getOption("horizontal");return this.layout.options.percentPosition&&!e?t/this.layout.size.width*100+"%":t+"px"},d.getYValue=function(t){var e=this.layout._getOption("horizontal");return this.layout.options.percentPosition&&e?t/this.layout.size.height*100+"%":t+"px"},d._transitionTo=function(t,e){this.getPosition();var i=this.position.x,n=this.position.y,o=parseInt(t,10),r=parseInt(e,10),s=o===this.position.x&&r===this.position.y;if(this.setPosition(t,e),s&&!this.isTransitioning)return void this.layoutPosition();var a=t-i,h=e-n,u={};u.transform=this.getTranslate(a,h),this.transition({to:u,onTransitionEnd:{transform:this.layoutPosition},isCleaning:!0})},d.getTranslate=function(t,e){var i=this.layout._getOption("originLeft"),n=this.layout._getOption("originTop");return t=i?t:-t,e=n?e:-e,"translate3d("+t+"px, "+e+"px, 0)"},d.goTo=function(t,e){this.setPosition(t,e),this.layoutPosition()},d.moveTo=d._transitionTo,d.setPosition=function(t,e){this.position.x=parseInt(t,10),this.position.y=parseInt(e,10)},d._nonTransition=function(t){this.css(t.to),t.isCleaning&&this._removeStyles(t.to);for(var e in t.onTransitionEnd)t.onTransitionEnd[e].call(this)},d.transition=function(t){if(!parseFloat(this.layout.options.transitionDuration))return void this._nonTransition(t);var e=this._transn;for(var i in t.onTransitionEnd)e.onEnd[i]=t.onTransitionEnd[i];for(i in t.to)e.ingProperties[i]=!0,t.isCleaning&&(e.clean[i]=!0);if(t.from){this.css(t.from);var n=this.element.offsetHeight;n=null}this.enableTransition(t.to),this.css(t.to),this.isTransitioning=!0};var l="opacity,"+o(a);d.enableTransition=function(){if(!this.isTransitioning){var t=this.layout.options.transitionDuration;t="number"==typeof t?t+"ms":t,this.css({transitionProperty:l,transitionDuration:t,transitionDelay:this.staggerDelay||0}),this.element.addEventListener(h,this,!1)}},d.onwebkitTransitionEnd=function(t){this.ontransitionend(t)},d.onotransitionend=function(t){this.ontransitionend(t)};var c={"-webkit-transform":"transform"};d.ontransitionend=function(t){if(t.target===this.element){var e=this._transn,n=c[t.propertyName]||t.propertyName;if(delete e.ingProperties[n],i(e.ingProperties)&&this.disableTransition(),n in e.clean&&(this.element.style[t.propertyName]="",delete e.clean[n]),n in e.onEnd){var o=e.onEnd[n];o.call(this),delete e.onEnd[n]}this.emitEvent("transitionEnd",[this])}},d.disableTransition=function(){this.removeTransitionStyles(),this.element.removeEventListener(h,this,!1),this.isTransitioning=!1},d._removeStyles=function(t){var e={};for(var i in t)e[i]="";this.css(e)};var f={transitionProperty:"",transitionDuration:"",transitionDelay:""};return d.removeTransitionStyles=function(){this.css(f)},d.stagger=function(t){t=isNaN(t)?0:t,this.staggerDelay=t+"ms"},d.removeElem=function(){this.element.parentNode.removeChild(this.element),this.css({display:""}),this.emitEvent("remove",[this])},d.remove=function(){return s&&parseFloat(this.layout.options.transitionDuration)?(this.once("transitionEnd",function(){this.removeElem()}),void this.hide()):void this.removeElem()},d.reveal=function(){delete this.isHidden,this.css({display:""});var t=this.layout.options,e={},i=this.getHideRevealTransitionEndProperty("visibleStyle");e[i]=this.onRevealTransitionEnd,this.transition({from:t.hiddenStyle,to:t.visibleStyle,isCleaning:!0,onTransitionEnd:e})},d.onRevealTransitionEnd=function(){this.isHidden||this.emitEvent("reveal")},d.getHideRevealTransitionEndProperty=function(t){var e=this.layout.options[t];if(e.opacity)return"opacity";for(var i in e)return i},d.hide=function(){this.isHidden=!0,this.css({display:""});var t=this.layout.options,e={},i=this.getHideRevealTransitionEndProperty("hiddenStyle");e[i]=this.onHideTransitionEnd,this.transition({from:t.visibleStyle,to:t.hiddenStyle,isCleaning:!0,onTransitionEnd:e})},d.onHideTransitionEnd=function(){this.isHidden&&(this.css({display:"none"}),this.emitEvent("hide"))},d.destroy=function(){this.css({position:"",left:"",right:"",top:"",bottom:"",transition:"",transform:""})},n}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("outlayer/outlayer",["ev-emitter/ev-emitter","get-size/get-size","fizzy-ui-utils/utils","./item"],function(i,n,o,r){return e(t,i,n,o,r)}):"object"==typeof module&&module.exports?module.exports=e(t,require("ev-emitter"),require("get-size"),require("fizzy-ui-utils"),require("./item")):t.Outlayer=e(t,t.EvEmitter,t.getSize,t.fizzyUIUtils,t.Outlayer.Item)}(window,function(t,e,i,n,o){"use strict";function r(t,e){var i=n.getQueryElement(t);if(!i)return void(h&&h.error("Bad element for "+this.constructor.namespace+": "+(i||t)));this.element=i,u&&(this.$element=u(this.element)),this.options=n.extend({},this.constructor.defaults),this.option(e);var o=++l;this.element.outlayerGUID=o,c[o]=this,this._create();var r=this._getOption("initLayout");r&&this.layout()}function s(t){function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}function a(t){if("number"==typeof t)return t;var e=t.match(/(^\d*\.?\d*)(\w*)/),i=e&&e[1],n=e&&e[2];if(!i.length)return 0;i=parseFloat(i);var o=m[n]||1;return i*o}var h=t.console,u=t.jQuery,d=function(){},l=0,c={};r.namespace="outlayer",r.Item=o,r.defaults={containerStyle:{position:"relative"},initLayout:!0,originLeft:!0,originTop:!0,resize:!0,resizeContainer:!0,transitionDuration:"0.4s",hiddenStyle:{opacity:0,transform:"scale(0.001)"},visibleStyle:{opacity:1,transform:"scale(1)"}};var f=r.prototype;n.extend(f,e.prototype),f.option=function(t){n.extend(this.options,t)},f._getOption=function(t){var e=this.constructor.compatOptions[t];return e&&void 0!==this.options[e]?this.options[e]:this.options[t]},r.compatOptions={initLayout:"isInitLayout",horizontal:"isHorizontal",layoutInstant:"isLayoutInstant",originLeft:"isOriginLeft",originTop:"isOriginTop",resize:"isResizeBound",resizeContainer:"isResizingContainer"},f._create=function(){this.reloadItems(),this.stamps=[],this.stamp(this.options.stamp),n.extend(this.element.style,this.options.containerStyle);var t=this._getOption("resize");t&&this.bindResize()},f.reloadItems=function(){this.items=this._itemize(this.element.children)},f._itemize=function(t){for(var e=this._filterFindItemElements(t),i=this.constructor.Item,n=[],o=0;o<e.length;o++){var r=e[o],s=new i(r,this);n.push(s)}return n},f._filterFindItemElements=function(t){return n.filterFindElements(t,this.options.itemSelector)},f.getItemElements=function(){return this.items.map(function(t){return t.element})},f.layout=function(){this._resetLayout(),this._manageStamps();var t=this._getOption("layoutInstant"),e=void 0!==t?t:!this._isLayoutInited;this.layoutItems(this.items,e),this._isLayoutInited=!0},f._init=f.layout,f._resetLayout=function(){this.getSize()},f.getSize=function(){this.size=i(this.element)},f._getMeasurement=function(t,e){var n,o=this.options[t];o?("string"==typeof o?n=this.element.querySelector(o):o instanceof HTMLElement&&(n=o),this[t]=n?i(n)[e]:o):this[t]=0},f.layoutItems=function(t,e){t=this._getItemsForLayout(t),this._layoutItems(t,e),this._postLayout()},f._getItemsForLayout=function(t){return t.filter(function(t){return!t.isIgnored})},f._layoutItems=function(t,e){if(this._emitCompleteOnItems("layout",t),t&&t.length){var i=[];t.forEach(function(t){var n=this._getItemLayoutPosition(t);n.item=t,n.isInstant=e||t.isLayoutInstant,i.push(n)},this),this._processLayoutQueue(i)}},f._getItemLayoutPosition=function(){return{x:0,y:0}},f._processLayoutQueue=function(t){this.updateStagger(),t.forEach(function(t,e){this._positionItem(t.item,t.x,t.y,t.isInstant,e)},this)},f.updateStagger=function(){var t=this.options.stagger;return null===t||void 0===t?void(this.stagger=0):(this.stagger=a(t),this.stagger)},f._positionItem=function(t,e,i,n,o){n?t.goTo(e,i):(t.stagger(o*this.stagger),t.moveTo(e,i))},f._postLayout=function(){this.resizeContainer()},f.resizeContainer=function(){var t=this._getOption("resizeContainer");if(t){var e=this._getContainerSize();e&&(this._setContainerMeasure(e.width,!0),this._setContainerMeasure(e.height,!1))}},f._getContainerSize=d,f._setContainerMeasure=function(t,e){if(void 0!==t){var i=this.size;i.isBorderBox&&(t+=e?i.paddingLeft+i.paddingRight+i.borderLeftWidth+i.borderRightWidth:i.paddingBottom+i.paddingTop+i.borderTopWidth+i.borderBottomWidth),t=Math.max(t,0),this.element.style[e?"width":"height"]=t+"px"}},f._emitCompleteOnItems=function(t,e){function i(){o.dispatchEvent(t+"Complete",null,[e])}function n(){s++,s==r&&i()}var o=this,r=e.length;if(!e||!r)return void i();var s=0;e.forEach(function(e){e.once(t,n)})},f.dispatchEvent=function(t,e,i){var n=e?[e].concat(i):i;if(this.emitEvent(t,n),u)if(this.$element=this.$element||u(this.element),e){var o=u.Event(e);o.type=t,this.$element.trigger(o,i)}else this.$element.trigger(t,i)},f.ignore=function(t){var e=this.getItem(t);e&&(e.isIgnored=!0)},f.unignore=function(t){var e=this.getItem(t);e&&delete e.isIgnored},f.stamp=function(t){t=this._find(t),t&&(this.stamps=this.stamps.concat(t),t.forEach(this.ignore,this))},f.unstamp=function(t){t=this._find(t),t&&t.forEach(function(t){n.removeFrom(this.stamps,t),this.unignore(t)},this)},f._find=function(t){return t?("string"==typeof t&&(t=this.element.querySelectorAll(t)),t=n.makeArray(t)):void 0},f._manageStamps=function(){this.stamps&&this.stamps.length&&(this._getBoundingRect(),this.stamps.forEach(this._manageStamp,this))},f._getBoundingRect=function(){var t=this.element.getBoundingClientRect(),e=this.size;this._boundingRect={left:t.left+e.paddingLeft+e.borderLeftWidth,top:t.top+e.paddingTop+e.borderTopWidth,right:t.right-(e.paddingRight+e.borderRightWidth),bottom:t.bottom-(e.paddingBottom+e.borderBottomWidth)}},f._manageStamp=d,f._getElementOffset=function(t){var e=t.getBoundingClientRect(),n=this._boundingRect,o=i(t),r={left:e.left-n.left-o.marginLeft,top:e.top-n.top-o.marginTop,right:n.right-e.right-o.marginRight,bottom:n.bottom-e.bottom-o.marginBottom};return r},f.handleEvent=n.handleEvent,f.bindResize=function(){t.addEventListener("resize",this),this.isResizeBound=!0},f.unbindResize=function(){t.removeEventListener("resize",this),this.isResizeBound=!1},f.onresize=function(){this.resize()},n.debounceMethod(r,"onresize",100),f.resize=function(){this.isResizeBound&&this.needsResizeLayout()&&this.layout()},f.needsResizeLayout=function(){var t=i(this.element),e=this.size&&t;return e&&t.innerWidth!==this.size.innerWidth},f.addItems=function(t){var e=this._itemize(t);return e.length&&(this.items=this.items.concat(e)),e},f.appended=function(t){var e=this.addItems(t);e.length&&(this.layoutItems(e,!0),this.reveal(e))},f.prepended=function(t){var e=this._itemize(t);if(e.length){var i=this.items.slice(0);this.items=e.concat(i),this._resetLayout(),this._manageStamps(),this.layoutItems(e,!0),this.reveal(e),this.layoutItems(i)}},f.reveal=function(t){if(this._emitCompleteOnItems("reveal",t),t&&t.length){var e=this.updateStagger();t.forEach(function(t,i){t.stagger(i*e),t.reveal()})}},f.hide=function(t){if(this._emitCompleteOnItems("hide",t),t&&t.length){var e=this.updateStagger();t.forEach(function(t,i){t.stagger(i*e),t.hide()})}},f.revealItemElements=function(t){var e=this.getItems(t);this.reveal(e)},f.hideItemElements=function(t){var e=this.getItems(t);this.hide(e)},f.getItem=function(t){for(var e=0;e<this.items.length;e++){var i=this.items[e];if(i.element==t)return i}},f.getItems=function(t){t=n.makeArray(t);var e=[];return t.forEach(function(t){var i=this.getItem(t);i&&e.push(i)},this),e},f.remove=function(t){var e=this.getItems(t);this._emitCompleteOnItems("remove",e),e&&e.length&&e.forEach(function(t){t.remove(),n.removeFrom(this.items,t)},this)},f.destroy=function(){var t=this.element.style;t.height="",t.position="",t.width="",this.items.forEach(function(t){t.destroy()}),this.unbindResize();var e=this.element.outlayerGUID;delete c[e],delete this.element.outlayerGUID,u&&u.removeData(this.element,this.constructor.namespace)},r.data=function(t){t=n.getQueryElement(t);var e=t&&t.outlayerGUID;return e&&c[e]},r.create=function(t,e){var i=s(r);return i.defaults=n.extend({},r.defaults),n.extend(i.defaults,e),i.compatOptions=n.extend({},r.compatOptions),i.namespace=t,i.data=r.data,i.Item=s(o),n.htmlInit(i,t),u&&u.bridget&&u.bridget(t,i),i};var m={ms:1,s:1e3};return r.Item=o,r}),function(t,e){"function"==typeof define&&define.amd?define(["outlayer/outlayer","get-size/get-size"],e):"object"==typeof module&&module.exports?module.exports=e(require("outlayer"),require("get-size")):t.Masonry=e(t.Outlayer,t.getSize)}(window,function(t,e){var i=t.create("masonry");i.compatOptions.fitWidth="isFitWidth";var n=i.prototype;return n._resetLayout=function(){this.getSize(),this._getMeasurement("columnWidth","outerWidth"),this._getMeasurement("gutter","outerWidth"),this.measureColumns(),this.colYs=[];for(var t=0;t<this.cols;t++)this.colYs.push(0);this.maxY=0,this.horizontalColIndex=0},n.measureColumns=function(){if(this.getContainerWidth(),!this.columnWidth){var t=this.items[0],i=t&&t.element;this.columnWidth=i&&e(i).outerWidth||this.containerWidth}var n=this.columnWidth+=this.gutter,o=this.containerWidth+this.gutter,r=o/n,s=n-o%n,a=s&&1>s?"round":"floor";r=Math[a](r),this.cols=Math.max(r,1)},n.getContainerWidth=function(){var t=this._getOption("fitWidth"),i=t?this.element.parentNode:this.element,n=e(i);this.containerWidth=n&&n.innerWidth},n._getItemLayoutPosition=function(t){t.getSize();var e=t.size.outerWidth%this.columnWidth,i=e&&1>e?"round":"ceil",n=Math[i](t.size.outerWidth/this.columnWidth);n=Math.min(n,this.cols);for(var o=this.options.horizontalOrder?"_getHorizontalColPosition":"_getTopColPosition",r=this[o](n,t),s={x:this.columnWidth*r.col,y:r.y},a=r.y+t.size.outerHeight,h=n+r.col,u=r.col;h>u;u++)this.colYs[u]=a;return s},n._getTopColPosition=function(t){var e=this._getTopColGroup(t),i=Math.min.apply(Math,e);return{col:e.indexOf(i),y:i}},n._getTopColGroup=function(t){if(2>t)return this.colYs;for(var e=[],i=this.cols+1-t,n=0;i>n;n++)e[n]=this._getColGroupY(n,t);return e},n._getColGroupY=function(t,e){if(2>e)return this.colYs[t];var i=this.colYs.slice(t,t+e);return Math.max.apply(Math,i)},n._getHorizontalColPosition=function(t,e){var i=this.horizontalColIndex%this.cols,n=t>1&&i+t>this.cols;i=n?0:i;var o=e.size.outerWidth&&e.size.outerHeight;return this.horizontalColIndex=o?i+t:this.horizontalColIndex,{col:i,y:this._getColGroupY(i,t)}},n._manageStamp=function(t){var i=e(t),n=this._getElementOffset(t),o=this._getOption("originLeft"),r=o?n.left:n.right,s=r+i.outerWidth,a=Math.floor(r/this.columnWidth);a=Math.max(0,a);var h=Math.floor(s/this.columnWidth);h-=s%this.columnWidth?0:1,h=Math.min(this.cols-1,h);for(var u=this._getOption("originTop"),d=(u?n.top:n.bottom)+i.outerHeight,l=a;h>=l;l++)this.colYs[l]=Math.max(d,this.colYs[l])},n._getContainerSize=function(){this.maxY=Math.max.apply(Math,this.colYs);var t={height:this.maxY};return this._getOption("fitWidth")&&(t.width=this._getContainerFitWidth()),t},n._getContainerFitWidth=function(){for(var t=0,e=this.cols;--e&&0===this.colYs[e];)t++;return(this.cols-t)*this.columnWidth-this.gutter},n.needsResizeLayout=function(){var t=this.containerWidth;return this.getContainerWidth(),t!=this.containerWidth},i});
/*
* rwdImageMaps jQuery plugin v1.6
*
* Allows image maps to be used in a responsive design by recalculating the area coordinates to match the actual image size on load and window.resize
*
* Copyright (c) 2016 Matt Stow
* https://github.com/stowball/jQuery-rwdImageMaps
* http://mattstow.com
* Licensed under the MIT license
*/
;(function(a){a.fn.rwdImageMaps=function(){var c=this;var b=function(){c.each(function(){if(typeof(a(this).attr("usemap"))=="undefined"){return}var e=this,d=a(e);a("<img />").on('load',function(){var g="width",m="height",n=d.attr(g),j=d.attr(m);if(!n||!j){var o=new Image();o.src=d.attr("src");if(!n){n=o.width}if(!j){j=o.height}}var f=d.width()/100,k=d.height()/100,i=d.attr("usemap").replace("#",""),l="coords";a('map[name="'+i+'"]').find("area").each(function(){var r=a(this);if(!r.data(l)){r.data(l,r.attr(l))}var q=r.data(l).split(","),p=new Array(q.length);for(var h=0;h<p.length;++h){if(h%2===0){p[h]=parseInt(((q[h]/n)*100)*f)}else{p[h]=parseInt(((q[h]/j)*100)*k)}}r.attr(l,p.toString())})}).attr("src",d.attr("src"))})};a(window).resize(b).trigger("resize");return this}})(jQuery);
/*!
	Zoom 1.7.20
	license: MIT
	http://www.jacklmoore.com/zoom
*/
(function ($) {
	var defaults = {
		url: false,
		callback: false,
		target: false,
		duration: 120,
		on: 'mouseover', // other options: grab, click, toggle
		touch: true, // enables a touch fallback
		onZoomIn: false,
		onZoomOut: false,
		magnify: 1
	};

	// Core Zoom Logic, independent of event listeners.
	$.zoom = function(target, source, img, magnify) {
		var targetHeight,
			targetWidth,
			sourceHeight,
			sourceWidth,
			xRatio,
			yRatio,
			offset,
			$target = $(target),
			position = $target.css('position'),
			$source = $(source);

		// The parent element needs positioning so that the zoomed element can be correctly positioned within.
		target.style.position = /(absolute|fixed)/.test(position) ? position : 'relative';
		target.style.overflow = 'hidden';
		img.style.width = img.style.height = '';

		$(img)
			.addClass('zoomImg')
			.css({
				position: 'absolute',
				top: 0,
				left: 0,
				opacity: 0,
				width: img.width * magnify,
				height: img.height * magnify,
				border: 'none',
				maxWidth: 'none',
				maxHeight: 'none'
			})
			.appendTo(target)
			.attr('alt', $(source).find('img').attr('alt')); // changed for IWC component 

		return {
			init: function() {
				targetWidth = $target.outerWidth();
				targetHeight = $target.outerHeight();

				if (source === target) {
					sourceWidth = targetWidth;
					sourceHeight = targetHeight;
				} else {
					sourceWidth = $source.outerWidth();
					sourceHeight = $source.outerHeight();
				}

				xRatio = (img.width - targetWidth) / sourceWidth;
				yRatio = (img.height - targetHeight) / sourceHeight;

				offset = $source.offset();
			},
			move: function (e) {
				var left = (e.pageX - offset.left),
					top = (e.pageY - offset.top);

				top = Math.max(Math.min(top, sourceHeight), 0);
				left = Math.max(Math.min(left, sourceWidth), 0);

				img.style.left = (left * -xRatio) + 'px';
				img.style.top = (top * -yRatio) + 'px';
			}
		};
	};

	$.fn.zoom = function (options) {
		return this.each(function () {
			var
			settings = $.extend({}, defaults, options || {}),
			//target will display the zoomed image
			target = settings.target && $(settings.target)[0] || this,
			//source will provide zoom location info (thumbnail)
			source = this,
			$source = $(source),
			img = document.createElement('img'),
			$img = $(img),
			mousemove = 'mousemove.zoom',
			clicked = false,
			touched = false;

			// If a url wasn't specified, look for an image element.
			if (!settings.url) {
				var srcElement = source.querySelector('img');
				if (srcElement) {
					settings.url = srcElement.getAttribute('data-src') || srcElement.currentSrc || srcElement.src;
				}
				if (!settings.url) {
					return;
				}
			}

			$source.one('zoom.destroy', function(position, overflow){
				$source.off(".zoom");
				target.style.position = position;
				target.style.overflow = overflow;
				img.onload = null;
				$img.remove();
			}.bind(this, target.style.position, target.style.overflow));

			img.onload = function () {
				var zoom = $.zoom(target, source, img, settings.magnify);

				function start(e) {
					zoom.init();
					zoom.move(e);

					// Skip the fade-in for IE8 and lower since it chokes on fading-in
					// and changing position based on mousemovement at the same time.
					$img.stop()
					.fadeTo($.support.opacity ? settings.duration : 0, 1, $.isFunction(settings.onZoomIn) ? settings.onZoomIn.call(img) : false);
				}

				function stop() {
					$img.stop()
					.fadeTo(settings.duration, 0, $.isFunction(settings.onZoomOut) ? settings.onZoomOut.call(img) : false);
				}

				// Mouse events
				if (settings.on === 'grab') {
					$source
						.on('mousedown.zoom',
							function (e) {
								if (e.which === 1) {
									$(document).one('mouseup.zoom',
										function () {
											stop();

											$(document).off(mousemove, zoom.move);
										}
									);

									start(e);

									$(document).on(mousemove, zoom.move);

									e.preventDefault();
								}
							}
						);
				} else if (settings.on === 'click') {
					$source.on('click.zoom',
						function (e) {
							if (clicked) {
								// bubble the event up to the document to trigger the unbind.
								return;
							} else {
								clicked = true;
								start(e);
								$(document).on(mousemove, zoom.move);
								$(document).one('click.zoom',
									function () {
										stop();
										clicked = false;
										$(document).off(mousemove, zoom.move);
									}
								);
								return false;
							}
						}
					);
				} else if (settings.on === 'toggle') {
					$source.on('click.zoom',
						function (e) {
							if (clicked) {
								stop();
							} else {
								start(e);
							}
							clicked = !clicked;
						}
					);
				} else if (settings.on === 'mouseover') {
					zoom.init(); // Preemptively call init because IE7 will fire the mousemove handler before the hover handler.

					$source
						.on('mouseenter.zoom', start)
						.on('mouseleave.zoom', stop)
						.on(mousemove, zoom.move);
				}

				// Touch fallback
				if (settings.touch) {
					$source
						.on('touchstart.zoom', function (e) {
							e.preventDefault();
							if (touched) {
								touched = false;
								stop();
							} else {
								touched = true;
								start( e.originalEvent.touches[0] || e.originalEvent.changedTouches[0] );
							}
						})
						.on('touchmove.zoom', function (e) {
							e.preventDefault();
							zoom.move( e.originalEvent.touches[0] || e.originalEvent.changedTouches[0] );
						})
						.on('touchend.zoom', function (e) {
							e.preventDefault();
							if (touched) {
								touched = false;
								stop();
							}
						});
				}
				
				if ($.isFunction(settings.callback)) {
					settings.callback.call(img);
				}
			};

			img.setAttribute('role', 'presentation');
			img.src = settings.url;
		});
	};

	$.fn.zoom.defaults = defaults;
}(window.jQuery));
/* global iwc, Modernizr */
/* jshint nonew: false  */

/**
 * @fileOverview A plugin to trigger custom touch events based on human interaction
 */
(function($, modernizr) {

    'use strict';

    var CONST = {
        SWIPE: 'swipe',
        SWIPE_LEFT: 'swipeLeft',
        SWIPE_RIGHT: 'swipeRight',
        SWIPE_UP: 'swipeUp',
        SWIPE_DOWN: 'swipeDown',
        TAP: 'tap'
    },

    /**
     * Default plugin settings to control behaviour
     * @type {Object}
     */
    settings_ = {
        // 'swipeUp', 'swipeRight', 'swipeDown' or 'swipLeft' will
        // prevent default touchmove behaviour in that direction
        preventMove: []
    },

    /**
     * Array of x touch coordinates, used for calculating average
     * @type {Array}
     */
    touchesX = [],

    /**
     * Array of y touch coordinates, used for calculating average
     * @type {Array}
     */
    touchesY = [],

    /**
     * TouchEvents - A plugin to trigger custom touch events
     *
     * @param {DOMelement} element
     * @param {Object} settings  Default settings overides
     * @class TouchEvents
     */
    TouchEvents = function(element, options) {
        this.$element = $(element);
        this.options = options;

        this.gesture = '';
        this.touchStartTriggered = false;
        this.touchStartPointX = 0;
        this.touchStartPointY = 0;
        this.touchEndPointX = 0;
        this.touchEndPointY = 0;

        this.init();
    };


    TouchEvents.prototype = {

        /**
         * Bind native touch events to target element to test against
         * @function init
         * @memberOf TouchEvents.prototype
         */
        init: function() {
            this.settings = $.extend({}, settings_, this.options);

            this.$element
                .on('touchstart', this.touchStart.bind(this))
                .on('touchmove', this.touchMove.bind(this))
                .on('touchend', this.touchEnd.bind(this));
        },

        /**
         * Record the first touch point time and position
         * @function touchStart
         * @memberOf TouchEvents.prototype
         * @param {Event} event The event that triggered touchstart
         */
        touchStart: function(event) {
            var touchPoint_ = event.originalEvent.changedTouches[0];
            this.touchStartPointX = touchPoint_.pageX;
            this.touchStartPointY = touchPoint_.pageY;
            this.touchStartTriggered = true;
        },

        /**
         * Detect whether user is swiping
         * @function touchMove
         * @memberOf TouchEvents.prototype
         * @param {Event} event The event that triggered touchmove
         */
        touchMove: function(event) {
            var touchPoint_ = event.originalEvent.changedTouches,
                horizontalSwipe_,
                verticalSwipe_;

            // make sure they're only touching with one finger so that swipe
            // gestures aren't fired when user is zooming
            if (touchPoint_.length === 1) {
                // horizontal distance swiped
                this.touchEndPointX = touchPoint_[0].pageX - this.touchStartPointX;
                // vertical distance swiped
                this.touchEndPointY = touchPoint_[0].pageY - this.touchStartPointY;

                touchesX.push(Math.abs(this.touchEndPointX));
                touchesY.push(Math.abs(this.touchEndPointY));

                // calculate averages in case user was swiping in one direction
                // but slightly flicks their finger in a different direction at the end
                horizontalSwipe_ = this.averageDistanceTravelled(touchesX);
                verticalSwipe_ = this.averageDistanceTravelled(touchesY);

                if (horizontalSwipe_ > 10 && verticalSwipe_ < 10) {
                    this.gesture = (this.touchEndPointX < 0) ? CONST.SWIPE_LEFT : CONST.SWIPE_RIGHT;
                } else {
                    this.gesture = (this.touchEndPointY < 0) ? CONST.SWIPE_UP : CONST.SWIPE_DOWN;
                }
            }

            if ($.inArray(this.gesture, this.settings.preventMove) > -1) {
                event.preventDefault();
            }
        },

        /**
         * Update gesture if user tapped and trigger detected gesture
         * @function touchEnd
         * @memberOf TouchEvents.prototype
         */
        touchEnd: function() {
            if (this.touchStartTriggered) {
                this.touchStartTriggered = false;

                if (this.touchEndPointX === this.touchStartPointX &&
                    this.touchEndPointY === this.touchStartPointY) {
                    //the user released at the same point at which they touched
                    this.gesture = CONST.TAP;
                }

                if (this.gesture) {
                    this.$element.trigger(this.gesture, [this]);
                    this.gesture = '';
                    touchesX = [];
                    touchesY = [];
                }
            }
        },

        /**
         * Calculates the average distance travelled based on multiple touch points
         * @param  {Array} touches List of touch points in a particular direction
         * @return {number} average distance
         */
        averageDistanceTravelled: function(touches) {
            return touches.reduce(function(prev, curr) {
                return (prev + curr) / touches.length;
            });
        }

    };

    /**
     * touchEvents - Touch Swipe jQuery plugin.
     *
     * @class touchEvents
     * @requires jQuery
     * @requires Modernizr
     * @memberOf jQuery.fn
     */
    $.fn.touchEvents = function(options) {

        if (modernizr.touch) {
            return this.each(function() {
                new TouchEvents(this, options);
            });
        }
    };

}(iwc.$, Modernizr));

/*global iwc, base*/
/**
 * @fileOverview To override CMS BASE Forms functionality
 */

(function($) {
    'use strict';

    window.useBaseform = $('body').hasClass('use-base-formjs') || false;

    // if not ecs and base formjs false
    if (!base.ecs && !window.useBaseform) {
        /**
         * forms component
         * @namespace forms
         * @memberof base.comp
         */
        base.comp.forms = (function() {
            return {
                init: function init() {
                }
            };
        })();


        /**
         * lightbox utility
         * @namespace lightbox
         * @memberof base.util
         */
        // TODO: Removed to load base lightbox functions
        /*base.util.lightbox = (function() {
            return {
                init: function init() {
                }
            };
        })();  */

    }
}(iwc.$));


/**
 * @fileOverview Browser detection for IE and IOS
 *
 */

(function() {
    'use strict';
    var ua = window.navigator.userAgent,
        msie,
        trident,
        edge,
        ios,
        ieV,
        browserClass;

    msie = ua.indexOf('MSIE ');
    if (msie > 0) {
        // IE 10 or older => return version number
        ieV = parseInt(ua.substring(msie + 5, ua.indexOf('.', msie)), 10);
        browserClass = ' IE IE-' + ieV;
        document.querySelector('body').className += browserClass;
    }

    trident = ua.indexOf('Trident/');
    if (trident > 0) {
        // IE 11 => return version number
        var rv = ua.indexOf('rv:');
        ieV = parseInt(ua.substring(rv + 3, ua.indexOf('.', rv)), 10);
        browserClass = ' IE IE-' + ieV;
        document.querySelector('body').className += browserClass;
    }

    edge = ua.indexOf('Edge/');
    if (edge > 0) {
        // IE 12 (aka Edge) => return version number
        ieV = parseInt(ua.substring(edge + 5, ua.indexOf('.', edge)), 10);
        browserClass = ' IE IE-' + ieV;
        document.querySelector('body').className += browserClass;
    }

    ios = /(iPad|iPhone|iPod)/g.test(ua);
    if (ios) {
        document.querySelector('body').className += ' ios';
    }
})();


/*global iwc*/

// List of events to be used throughout the IWC site.
(function(util) {
    'use strict';
    util.events = (function() {
        var isTouch = (typeof window.ontouchstart !== 'undefined'),
            events = {
                INTERACTION: 'click',
                EVENT_END: isTouch ? 'touchend' : 'mouseup',
                EVENT_START: isTouch ? 'touchstart' : 'mousedown',
                EVENT_LEAVE: isTouch ? 'touchleave' : 'mouseleave',
                EVENT_MOVE: isTouch ? 'touchmove' : 'mousemove'
            };
        window.iwcEvents = events;
        return events;
    })();
})(iwc.util);

/* globals iwc */

(function(win, util) {
    'use strict';

    /**
     * attempt to call a function but don't break entire site if
     * there happens to be an error finding function or in that function
     *
     * @namespace attempt
     * @memberof iwc.util
     *
     * @param  {string} fnLoc The location of the function to call e.g. 'componentName.init'
     * @param  {Object} [ns] The namespace that contains the function to attempt to call
     * @return {Function} will attempt to call fnLoc with passed params
     */
    util.attempt = function(fnLoc, ns) {
        var fn;

        // fnLoc is required
        if (typeof fnLoc !== 'string') {
            return;
        }

        win.console = win.console || { error: function() {} };

        // splits each part of fnLoc and assigns method as value if
        // it exists or undefined if it doesn't
        fn = fnLoc.split('.').reduce(function(prev, next) {
            if (prev && prev[next]) {
                return prev[next];
            }
        }, ns || win);

        return function() {
            try {
                if (fn) {
                    fn.apply(this, arguments);
                }
            } catch (e) {
                win.console.error(fnLoc, (e.stack || e.toString()));
            }
        };
    };

}(window, iwc.util));

/* globals iwc */

(function(window, util) {
    'use strict';

    /**
     * Throttle
     *
     * @param  {Function} callback  the callback to be executed
     * @param  {number}   delay     delay in miliseconds
     * @return {Function} function that fires callback
     */
    util.throttle = function(callback, delay) {
        var ticker,
            fn = delay ? 'setTimeout' : 'requestAnimationFrame';

        return function() {
            var context = this,
                args = arguments;

            if (!ticker) {
                // note that requestAnimationFrame is
                // polyfilled in requestanimationframe.js
                // also delay 2nd arg will just be ignored by requestAnimationFrame
                ticker = window[fn](function() {
                    callback.apply(context, args);
                    ticker = null;
                }, delay);
            }
        };
    };

}(window, iwc.util));

/*global iwc */
(function(util) {
    'use strict';

    util.elemInViewPort = function(element, buffer) {
        var rect = element.getBoundingClientRect(),
            html = document.documentElement,
            top,
            right,
            left,
            bottom;

        buffer = buffer || 0,
        top = buffer - Math.abs(rect.top) > 0;
        right = rect.right <= (window.innerWidth || html.clientWidth);
        bottom = rect.bottom <= (window.innerHeight || html.clientHeight) + buffer;
        left = rect.left >= 0;
        return (top && right && bottom && left);
    };
})(iwc.util);

/*global iwc */
//jscs:disable

(function(window, util) {
    'use strict';

    // debouncing function from John Hann
    // http://unscriptable.com/index.php/2009/03/20/debouncing-javascript-methods/
    util.debounce = function (func, threshold, execAsap) {
        var timeout;

        return function debounced () {
            var obj = this, args = arguments;
            function delayed () {
                if (!execAsap) {
                    func.apply(obj, args);
                    timeout = null;
                }
            }
            if (timeout) {
                clearTimeout(timeout);
            }
            else if (execAsap) {
                func.apply(obj, args);
            }
            timeout = setTimeout(delayed, threshold || 100);
        };
    };

}(window, iwc.util));

/* globals iwc */
(function($) {
    'use strict';

    /**
     * Ensures that all CSS transitions on the specified elements for the specified CSS properties occur on the next free clock cycle rather than immediately.
     * e.g. This is used on the navigation so that all click handlers can be resolved before begining animation.
     * @param  {Array} transitions an array of objects, each object has 2 properites: selector (a CSS selector for the elements to syncronise) and prop (an array of properties to syncronise)
     */
    function syncStart(transitions) {
        var transitionProperties,
            release = {};
        function freezePropertiesOnElement(index, el) {
            var $el = $(el);
            for (var propIndex = 0, len = transitionProperties.length; propIndex < len; propIndex ++) {
                //set the current value inline to pause transition
                var prop = transitionProperties[propIndex],
                    computed = $el.css(prop);

                $el.css(prop, computed);
                release[prop] = '';
            }
        }

        function releasePropertiesOnElements(els) {
            els.css(release);
        }

        for (var tranIndex = 0, len = transitions.length; tranIndex < len; tranIndex++) {
            var transition = transitions[tranIndex];
            transitionProperties = transition.props;
            transition.els = $(transition.selector);
            transition.els.each(freezePropertiesOnElement);
        }

        window.setTimeout(function() {
            //remove inlines CSS to restart transition
            for (var tranIndex = 0, len = transitions.length; tranIndex < len; tranIndex++) {
                var transition = transitions[tranIndex];
                transitionProperties = transition.props;
                releasePropertiesOnElements(transition.els);
            }
        }, 0);
    }
    iwc.util.transitions = {
        syncStart: syncStart
    };
}(iwc.$));

/* globals iwc, Modernizr */
(function(Modernizr) {
    'use strict';

    var transEndEventNames = {
        'WebkitTransition': 'webkitTransitionEnd',
        'MozTransition': 'transitionend',
        'OTransition': 'oTransitionEnd otransitionend',
        'msTransition': 'MSTransitionEnd',
        'transition': 'transitionend'
    };

    iwc.util.transitionEndEvent = transEndEventNames[Modernizr.prefixed('transition')];

}(Modernizr));

/*global iwc*/

/*
 * User location util
 */

(function() {
    'use strict';

    /**
     * User location Util
     * @namespace userlocation
     * @memberof iwc.util
     */
    iwc.util.userlocation = (function($) {
        var location = null,
            locationAPIUrl = $('body').data('geolocationurl'),
            userLocationDeferred = new $.Deferred(),
            isLocationRequested = false;

        /**
         * Get User's location on POST call
         * @function getUserLocation
         * @private
         * @memberOf iwc.util.userlocation
         */
        function getUserLocation() {
            //TODO: update url once implemented at backend
            if (!isLocationRequested && userLocationDeferred.state() !== 'resolved') {
                isLocationRequested = true;
                $.post(locationAPIUrl).done(function(response) {
                    if (response) {
                        location = {
                            latitude: response.location.lat,
                            longitude: response.location.lng
                        };
                    }
                    userLocationDeferred.resolve(location);
                }).fail(function(fail) {
                    userLocationDeferred.reject(fail);
                });
            }
            return userLocationDeferred.promise();
        }

        /**
         * Calculate radius
         * @function radius
         * @param {Number} x, calculated lat, lng number
         * @memberOf iwc.util.userlocation
         */
        function radius(x) {
            return x * Math.PI / 180;
        }

        /**
         * Get Nearest Boutique
         * @function getNearestBoutique
         * @param {number} lat user's current location latitude
         * @param {number} lng user's current location longitude
         * @param {object} boutiqueData object contains boutique list
         * @memberOf iwc.util.userlocation
         * Ref URL: http://stackoverflow.com/questions/4057665/google-maps-api-v3-find-nearest-markers
         */
        function getNearestBoutique(lat, lng, boutiqueData) {
            var R = 6371, // radius of earth in km
                distances = [],
                closest = -1;
            for (var i = 0; i < boutiqueData.length; i++) {
                var mlat = boutiqueData[i].location.latitude,
                    mlng = boutiqueData[i].location.longitude,
                    dLat  = radius(mlat - lat),
                    dLong = radius(mlng - lng),
                    a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(radius(lat)) * Math.cos(radius(lat)) * Math.sin(dLong / 2) * Math.sin(dLong / 2),
                    c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)),
                    d = R * c;

                distances[i] = d;

                if (closest === -1 || d < distances[closest]) {
                    closest = i;
                }
            }

            return boutiqueData[closest];
        }

        return {
            get: getUserLocation,
            nearestBoutique: getNearestBoutique
        };
    })(iwc.$);
}());


/* globals base */

/**
 * @fileOverview Provides common map options
 */

base.util.mapOptions = (function() {
    'use strict';

    /*
      Map Options

      Marker Icon Image
      markerIconImage: Add marker icon image url or base64 encoded image data

      Cluster Icon Image
      map.cluster.opts.style.url: Add clusterer icon image url or base64 encoded image data

      GeoLocation Icon Image
      map.geoLocation.map.iconImage: Add geolocation icon image url or base64 encoded image data

      Cluster options
      map.cluster: Markerclusterer options object
      map.cluster.isEnabled: true/false to enable/disable cluster
      map.cluster.opts: Cluster opts object
      map.cluster.opts.maxZoom: Zoom level
      map.cluster.opts.gridSize: Max count of markers to unite into cluster
      map.cluster.opts.minimumClusterSize: Min counts of markers to unite into cluster
      map.cluster.opts.styles: Cluster styles
      map.cluster.opts.styles.url: Url for cluster icon image
      map.cluster.opts.styles.height: Clusterer icon height
      map.cluster.opts.styles.width: Clusterer icon width
      map.cluster.opts.styles.anchorIcon: clusterer icon anchor offset for cluster icons
      map.cluster.opts.styles.textColor:  Font colour
      map.cluster.opts.styles.textSize: Font size in px

      GeoLocation options
      map.geoLocation: Geo location object
      map.geoLocation.options: Geo location options object
      map.geoLocation.options.enableHighAccuracy: true/false to enable/disable. If you do need high-precision it is possible to override the default setting with the enableHighAccuracy option.
      map.geoLocation.options.timeout: To handle timeout error case
      map.geoLocation.options.maximumAge: Maximum age
      map.geoLocation.map: Geolocation map options object
      map.geoLocation.map.isPanZoomRequired: true/false to enable/disable
      map.geoLocation.map.radius: Radius in meters
      map.geoLocation.map.title: Add title text here
      map.geoLocation.map.iconImage: user location icon image
      map.geoLocation.map.zoom: Zoom level
      map.geoLocation.map.showCircle: true/false to show/hide circle with in radius mentioned above around the user's location
      map.geoLocation.map.fillColor: Background colour
      map.geoLocation.map.strokeColor: Border colour
      map.geoLocation.map.strokeWeight: Stroke weight in px

      MAP options
      map.type: Common Map type options object
      map.type.defaultStyles: Map styles object to update the default styles of map
      map.type.defaultStyles.stylers: JSON style declaration. Stylers are color and visibility properties that you can apply to map elements. They define the displayed color through a combination of hue, color, and lightness/gamma values.
      map.type.defaultStyles.featureType,
      map.type.defaultStyles.elementType: Selectors specify the geographic components that you can style on the map. These include roads, parks, bodies of water, and more, as well as their labels. The selectors include features and elements, specified as featureType and elementType properties.

      Refer: (for google maps styling)
      https://developers.google.com/maps/documentation/javascript/styling
      http://googlemaps.github.io/js-samples/styledmaps/wizard/index.html
    */

    var config = {
        'markerIconImage': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAgCAYAAAAIXrg4AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAd9JREFUeNq0VjtuwkAQXW/SQEuTAglygliiwk2cG5CGFmigReICOUIo3TktTXwCPg20pqUJOQBSaGjJjDVIYLwztjFPWvkzs+/tZ3ZmrePxqEwYDAYteGBzodVi5l9oc2iB53mBicNKEgBiJPQTSE1AsS4IzeMGnUD+CY9ZBnJFvjPqa54BOOCoO+o2fMFMulczIPVbyRGd85lEM6A1n6li8YZ78kgfvuRdqVSihtjtdlETgJx1q9/vYxh+m7zK5bJqt9uq2Wxe/F+tVmoymajD4cCJvGuKcyNGo9EVOQL/oU1AS9MhSoTjOKparRp7ow19GLiai3fbtsWdFHxqmrOWSiVRQPJhBVJEiujDCiyXS1FA8kGBtcm42WyicDQBbejDYP3QaDSeuEgKw1BZlhUdMjwTp2WZTqfRORDg4UGrw8uPug+eNeSLLbws7kC+QG6dNhflgH9RDyCjbjMWGbbCwejr8TAdFjj6oamiYU19LWDtXdNBGxY5+isBUA7hMb6BfEwcbKr4oGtI5o2lvnwughH84R0nh0CX+srJji5Q44xLM099szuLKlzPF4F8DeR2rnRN9XrP2PdSTWcFKE+5XM0lH5V3BqfQ7SWYevGQzLwHCVd5/yxigjT9/gUYAPiiuUECu57NAAAAAElFTkSuQmCC',
        'map': {
            'isPanningRequired': true,
            'cluster': {
                'isEnabled': true,
                'opts': {
                    'maxZoom': 10,
                    'gridSize': 40,
                    'minimumClusterSize': 8,
                    'styles': [{
                        'url': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAnJJREFUeNrMV7GKIkEQrZ274DQZwVRhMdDQTo1WMBY2MzwzwWjBD1j9AOFSs0nNDjQVdiPTmdDoFhSMhDUy9Kqacpnt6TqdmWa5B2VDO131urq6qvrufD7DrRgMBo84KJQ2Tz3w+MrjC0o4m81+36rz7hoBNHqPwxNKH8W/Ue8RJUD5hWTeMhNA42M27kM2HJnEOBUB3jW5sQluENGxIZH3qwTQuOKz9MEtjkwiFAmg8RIOb/8y3mw2odFoQLVahUqlAqfTCQ6HA2y3W9hsNhBF0TUS93FPfDc+EHdOhnu9HpTL5U/zxWJRz9Xrdeh0OprMfD6XiPhsQyU8wAH3bK4oFArQ7/dBKZXK32EYQhAE2kMWTC6BqQlw0P2xGR+NRtrdWUDHMp1ObSToKBRdUY8nnmwKaOdZjRNoLekQjkLbvBBIfNVqtVK73QbSQfFj2x/9fNvv95Ref5r/DodDHWAuUKvVYLVamdM/lstl5MUjMh7xZrTnAekSvKC8WGH5AN1z1xB0tolAyRY8riHp9Gz5njKcawg6Hzz4IggJSXsgkTN3u51zApSiLXglAu+2DOYakk4iEJqTVNVcQ9D54nF1+tw9YCUTXJbZ/UJ1DD1uII/mP4vFwhkBKs+23oBsX25Bootdr9e6pOYF6RB2H8SLkbVppHqeJyBpLemQmtUPAtw6T2x3l+p5Fk/QGqEXgHi7bvaEodQJU3nudrtXixQFHMUPHaHUIaNxJfWEj3wtfVtMkJhN6SVxpWhK2/9VW56oBfyBsqXonA8TZRq/9Wn2nNP4JPXTzPJMG3N8fO3jVHiet/mISrEbE3FRS/08/yvAAF0WNmBFICZvAAAAAElFTkSuQmCC',
                        'height': 32,
                        'width': 32,
                        'anchorIcon': [32, 32],
                        'textColor': '#666',
                        'textSize': '12'
                    }]
                }
            },
            'type': {
                'defaultStyles': [{
                    'featureType': 'all',
                    'stylers': [{
                        'saturation': -80
                    }]
                }, {
                    'featureType': 'road.arterial',
                    'elementType': 'geometry',
                    'stylers': [{
                        'hue': '#666'
                    }, {
                        'saturation': -20
                    }]
                }, {
                    'featureType': 'poi.business',
                    'elementType': 'labels',
                    'stylers': [{
                        'visibility': 'off'
                    }]
                }],
                'baiduMapStyles': [{
                    'featureType': 'all',
                    'elementType': 'geometry',
                    'stylers': {
                        'hue': '#666',
                        'saturation': -80
                    }
                },
                {
                    'featureType': 'water',
                    'elementType': 'all',
                    'stylers': {
                        'color': '#999'
                    }
                }]
            }
        },
        'geoLocation': {
            'options': {
                'enableHighAccuracy': true,
                'timeout': 5000,
                'maximumAge': 0
            },
            'map': {
                'isPanZoomRequired': true,
                'radius': 500000,
                'title': '',
                'iconImage': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAMAAAAMs7fIAAAClFBMVEUGKekGKOkGKekGKOkGKekGKOkGKOkGJ+kGJ+gGJegGJugGJ+gGJ+gGJOgGJ+gGKOgGJugGI+gGJ+gFI+gGJegFJukGJ+kFJ+kFI+gFJukEI+kFJ+kEIukEJOkEJ+kEJukEJ+kEJekEJukEJ+kEJukEKOkEKOoEJ+oEKOoEJukEJ+oEJekEKOkEJ+oEKeoDJ+oDJ+oDKeoDLOwDM+0DL+wDM+0CL+4CL+4CM+4EQO8CMe4ESfADRPADSvAAevkAe/oAivoAj/sAkfsAmPsAp/wBPfMBPfQBPvMBPvQBQPUBRfUBRfYBRvYBR/UBSfcBUvoBU/cBVvoBV/MBV/UBV/cBV/gBWPUBWPYBWPcBWfMBWfQBWvQBWvUBWvYBW/MBW/UBW/YBW/gBXPcBXfoBXvkBXvoBX/cBYPgBYfoBYvgBZvgBavgBePkBfvoBhfoBl/sCQfMCV/YCWPQCWvcCYfUCZPQCZPcCZfQCZvYCZvgCavkCjPoDUPQDV/gDXvYDZPQDZvQDafcDavQDb/UDb/YDcvUDc/UDc/gDdvgDd/cDePkEafcEa/cEcvgEc/QEfvYEfvcEg/gEhPYEhfoEhvkEh/kEiPoFbPYFbvcFgPYFhPYFifgFjPcFj/oGd/cGevcGgvgGhfkGkPsGkfcGk/gGlfkGlvcGlvgGl/kGmPgGmvkHjvoHkPsHlvoHmPsHmfsHm/cHnvgHn/gHn/wHoPgHoPwHo/kHp/kHqPkIof0Ip/sIp/0IqPkIxv0JtvoJufoJufsJuvoJvvoJwPsJwf0Ky/wKzvsKzv8Kz/0K1PwK1/wLzv8L1/wL2v0L4P0L4f8Mz/0M4/4M5P8M5/8M6v4M7v4O1f0V2v0p8f5C+f5I+f7u//tkG75BAAAAPnRSTlMAAQECAhocHSQlJSUmKysuLzAwMzM5OWt0dHp6fn6NjpOUmJiZmZqenp+foKChpczNzdfY2trr7e3t8vL19UYSrZsAAAEWSURBVBgZBcFLTsJAAAbgfx6dzqNAeSSWAioEH4m6MbrxFJ7AvVfwACYeQq/j3gUJO4lRF6KUIJ1SnI7fRwAAdaPVJrdZBYAAEOlOQ9Bqu/qeFQADGgejZhpJGqjL3K3BEBz2d98W8x4hPDr9yrYM/WEq767Pp/jDPB2/Z9QkoZgo1pu0u92IjNsxa+0ZnVwQt4jDULRGg2euAuroLT85qpwnkegYLpi3uIpVKGFVEijBSwdf+oqaOqiPZbnhdusc80RQipqWNFvT9Wq/Wzpny403RhdPlv9+qmbdO+dFpKSf/mQM+fLsuJ0OWlpL//EwLRmq4q0/bEglWfFyP1uCAAjT5KYjy+Xj4jUHCACgZrSxuc08gH8Y+Wk6E4P6cwAAAABJRU5ErkJggg==',
                'zoom': 5,
                'showCircle': true,
                'fillColor': '#61a0bf',
                'strokeColor': '#1bb6ff',
                'strokeWeight': 2
            }
        }
    };

    return {
        config: config
    };
})();

/* globals iwc, base */

/**
 * @fileOverview Provides common map options
 */

iwc.util.mapOptions = (function(util) {
    'use strict';

    var config = util.mapOptions.config;

    // Default Marker Image
    config.defaultMarker = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAeCAYAAADD0FVVAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAApxJREFUeNpi/P//PwM2cOPsWvmvn17O/PLxueWvn185geoYmVnY/nLzit3lFZBq0jaPXMmAAzCiGwoy7P3r+7tfP72silMTIxMDKxvnfylF80496/hKvIZePbk8/NGtQ8t///rGyEAEABkuKKb80sanRgKroSAD71/bveLfv78MpABsBjPBGE/vnVxKqoEg8P//P4b3r+6In90/bQeKoSCBn98/MjOQCUC+ff7gjDsoPkB8FhDx6sllN5CN2ICsqi2DnJoNmP3t8xuGe1d3Mnx8+whDHciXwJSyGMi0YwGF5d8/v7BGjKFdKtBQGzhfGBhqEvLGDMe2tWE1+O2LW1Zg7//88Sni378/GApEJDVQDIQBYFJiMHPJx+orWBAy/fv7RxCbAmFJTZxhyMkjgjeMmRhoAJjY2HmOY5N4+/w6Tk3fv7zBbhgTC4RmYePcik3Bm+c3GB7fPoJV8/lDs7GK8whIfAUnKS3TsCNP7hz7++Pbe2ZsmkGGw5LU75/fGG6eX4815kE5S0BEaQU8nYpKaa15cvd4OLa0+vj2YTAmnF0ZGTi4BJrhEcXJI1wOEqQECIqpPtUwDn4INxTEEZbUuk2ZocoRGEmKX1guiQID34DiBsNQkKCwhMZTUg0ERRBQXyDOxI/sBWKBgKgiiisxDAVJSsgZXiDFUHRXYs2mfEKyAbCcQYSBT9FdidVQUEqQVDDeCQorvPkbaLGwhJo10QWKsWOWBwsrx398kSMuq38Cli6JLqVkVKyLcLkWZKGpS54lyUWfrmXMBD4hmU/YXAmykOzyVFRa15uJiRktImU+gSwk21BQzEoqmMAjDRQ54rIGegQLaUIKQJEGLH3AlRgoVeCKHIw6mxC+cmJZ+LHt3beIUQvCAAEGANZiM11/sloDAAAAAElFTkSuQmCC',

    // IWC Marker Icon Image
    config.markerIconImage = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAkCAYAAADy19hsAAAACXBIWXMAAAsTAAALEwEAmpwYAAA4KGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMwMTQgNzkuMTU2Nzk3LCAyMDE0LzA4LzIwLTA5OjUzOjAyICAgICAgICAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgICAgICAgICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgICAgICAgICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPHhtcDpDcmVhdG9yVG9vbD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNCAoTWFjaW50b3NoKTwveG1wOkNyZWF0b3JUb29sPgogICAgICAgICA8eG1wOkNyZWF0ZURhdGU+MjAxNy0wMS0yNFQxMToxMTo1MiswNTozMDwveG1wOkNyZWF0ZURhdGU+CiAgICAgICAgIDx4bXA6TW9kaWZ5RGF0ZT4yMDE3LTA0LTA2VDE2OjMyOjU0KzA1OjMwPC94bXA6TW9kaWZ5RGF0ZT4KICAgICAgICAgPHhtcDpNZXRhZGF0YURhdGU+MjAxNy0wNC0wNlQxNjozMjo1NCswNTozMDwveG1wOk1ldGFkYXRhRGF0ZT4KICAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9wbmc8L2RjOmZvcm1hdD4KICAgICAgICAgPHBob3Rvc2hvcDpDb2xvck1vZGU+MzwvcGhvdG9zaG9wOkNvbG9yTW9kZT4KICAgICAgICAgPHhtcE1NOkluc3RhbmNlSUQ+eG1wLmlpZDoxN2E2YjdhNC0xMWU2LTQxNWItOTRiMi00OWZjMmFlYmY2ZmM8L3htcE1NOkluc3RhbmNlSUQ+CiAgICAgICAgIDx4bXBNTTpEb2N1bWVudElEPnhtcC5kaWQ6MTdhNmI3YTQtMTFlNi00MTViLTk0YjItNDlmYzJhZWJmNmZjPC94bXBNTTpEb2N1bWVudElEPgogICAgICAgICA8eG1wTU06T3JpZ2luYWxEb2N1bWVudElEPnhtcC5kaWQ6MTdhNmI3YTQtMTFlNi00MTViLTk0YjItNDlmYzJhZWJmNmZjPC94bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+CiAgICAgICAgIDx4bXBNTTpIaXN0b3J5PgogICAgICAgICAgICA8cmRmOlNlcT4KICAgICAgICAgICAgICAgPHJkZjpsaSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+Y3JlYXRlZDwvc3RFdnQ6YWN0aW9uPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6aW5zdGFuY2VJRD54bXAuaWlkOjE3YTZiN2E0LTExZTYtNDE1Yi05NGIyLTQ5ZmMyYWViZjZmYzwvc3RFdnQ6aW5zdGFuY2VJRD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OndoZW4+MjAxNy0wMS0yNFQxMToxMTo1MiswNTozMDwvc3RFdnQ6d2hlbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OnNvZnR3YXJlQWdlbnQ+QWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKE1hY2ludG9zaCk8L3N0RXZ0OnNvZnR3YXJlQWdlbnQ+CiAgICAgICAgICAgICAgIDwvcmRmOmxpPgogICAgICAgICAgICA8L3JkZjpTZXE+CiAgICAgICAgIDwveG1wTU06SGlzdG9yeT4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgICAgPHRpZmY6WFJlc29sdXRpb24+NzIwMDAwLzEwMDAwPC90aWZmOlhSZXNvbHV0aW9uPgogICAgICAgICA8dGlmZjpZUmVzb2x1dGlvbj43MjAwMDAvMTAwMDA8L3RpZmY6WVJlc29sdXRpb24+CiAgICAgICAgIDx0aWZmOlJlc29sdXRpb25Vbml0PjI8L3RpZmY6UmVzb2x1dGlvblVuaXQ+CiAgICAgICAgIDxleGlmOkNvbG9yU3BhY2U+NjU1MzU8L2V4aWY6Q29sb3JTcGFjZT4KICAgICAgICAgPGV4aWY6UGl4ZWxYRGltZW5zaW9uPjQ0PC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6UGl4ZWxZRGltZW5zaW9uPjM2PC9leGlmOlBpeGVsWURpbWVuc2lvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgCjw/eHBhY2tldCBlbmQ9InciPz5YPagJAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAM8SURBVHja7JgxSHNXGIafm8SkRo0IamKqUEwcRHTIrKJT42AnUchUneKiDg5dnMQoVASngLjUNTYgGjfBuLgJBUHBwQRDr+Lgn6rFm1zzdYhe/tS/JlT/1kBeuMN9z8e5z/3Od8859yjABeCgPPSHAghlJBOQLiPetIkyUwW4AlwB/o9lBn4CvnktSFEUOjs7AXC73SiKQmtrKyaTiaamJgA0TaOnp4dsNovb7UbXdTKZDC6XC5fLRVtbG5qm8fDwAIDP56O7uxun08nFxUUexmxG5NVlQSs5wx6Ph2QyyfLyMmazmY6ODq6vr9nY2EBRFBRFwe/3o6oq09PTmEz5rnO5HLFYjPn5ee7u7mhvb2d/f5+ZmRl8Ph9DQ0NEo1FWVlaKwRr69LTaFb1ERBYWFoz729tbuby8fBGztbVV4EWjUWlubhaLxSKPj48Sj8cL2icnJ0VVVbHb7cUYPpUMXF1dLSIioVDI8KampkRExOv1Gt7x8bGIiFgsFgFkbGxM1tbWBJDNzU2RfBpfXAMDA+J2u78ucH19vYiIrK6uCiBer1eSyaSIiIyOjgog6+vrMjw8bGT/8PBQSh3RLwG/aZZIp9Ocnp4SDAYBGB8fZ3Z2FlVVDc/hcLC9vY3Dkd8Qnp2d/b/T2uLiIlarlUAggNVqJRKJEIlEGBwcJBQKcXR0BPn0AtDS0vLmqe1flwQgNptN7u/vRURkZGREAOnq6pJnOZ1OI/b8/Fyy2ew/PuO57t+lhp9rcG5u7oUfj8dFRMRmsxmeruuSSCQK4vr7+0VEZGlpqcCvqamRQCAgDQ0NRYEtpQ6D3+8HoK+vD6fTydXVldG2s7NDIpFA0zTDC4fDpFKpgj4ODg4IBoOEw2E8Hg97e3vY7XZcLhexWIybm5uiHMpThuuLBfb29pLJZKitreXk5ARVVY02q9VKLpdD13XDq6qqQkQKvGc1NjYyMTFBXV0dqVSK3d1dY7Ur9p2XDFz546hsLyvAFeAK8FdR2R1VWYBfAfsb+6kB+l9p/x347R14/3zPl//llU3Ldx91tO6+APvzRy6xH/8Ge1nsCOEj6OAz4O/L4UP+9gl2p5xmnx+ewN9dfw0Age8VXNtFjQ8AAAAASUVORK5CYII=';

    // default map zoom
    config.map.defaultZoom = 2;

    // default map zoom mobile
    config.map.defaultZoomMobile = 1;

    // default map latitude
    config.map.defaultLat = 5.012319;

    // default map longitude
    config.map.defaultLng = -9.041973;

    // map zoom on marker selection for opening infowindow
    config.map.zoomForInfoWindow = 12;

    //Cluster options
    config.map.cluster = {
            'isEnabled': true,
            'opts': {
                'maxZoom': 10,
                'gridSize': 40,
                'minimumClusterSize': 8,
                'styles': [{
                    'url': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACoAAAAqCAYAAADFw8lbAAAAAXNSR0IArs4c6QAABT9JREFUWAnVmV1MHFUUx+8MC11aWQpLKSssXVMQitRSIlJpaow2aRODqFFr6kvffDNGgz6qj9pojG++4QuxalQkJm1SjUlTLKWhtKUUCo0LW1y65UPAlo9dGOc39k7uLhQosLvlTzYz3Jk557f33rn3nLOaWKMCge/SJ4eM/XORSNnc3HTRXCTsw2SKI9WfkuLsS3E4ujLytLNe7xtTa3Glrebhvis/e/8dH6m/Mx6qmxjt96Y5XZpz81bh3JxlfrYKw/ybuTsupu+OmZ9/xOz0hOHK3hHYkpnb9Eim+3jR7pcDD+r3gUB7237YOzzibxwL9Za4Pbs0T2Gl2F5YIdKcGUv6nZ2eFLcGOkRwoF2MBK8ZWbnFPTlu39HiqtcuLvmgcnFFoD0dzfkTI/4Tw8GuGl/J81rRnheFIzVdMbPy00h4SvRd+lX4e343cjxlLS6370hJRe3gchaWBb3a+u3rg3+da8zN3+0oqXzFGt7ljK7kOtOiu/1HcXvwaiT/seqjT1S/+f1Szy0J2nG24dMhf1v9kzXHNI/vqQV2jPk5MRy8JobMIZ0c+9uek9wo52xG1qMiz5wiOZ5dQtNTFtgI+tvE5ZZvjDxf1fGK/cc+XHDDvYb7grb/8XXTyK3u2qcPvqu5sgujnp+ZGhfXLzaJmzdaRHh2ZS9zalq6KNhZIx7fWyc2pWdG2ZsYHRDnT39puLeXNlc+93Zd1MWlQOnJ2zcv1R+o/UhTjc7PR0Rvxy/iRudJEQnPLGZv2TZH6iaxs/ywKK54Sei6w76fL3+m+RNjW8GeRXt2QY8yJwN9Z048c/iDqJ7EUNvpr8RoqM82vpaT7NwiUXXwnajepWf/PPmZ4S06cCR2zkaB8nb3d//mL69+y6HOyYmxgGg99YWYujO6FrYFz6ZvyRb7Dr0vMrIK7GvM2c7WxsiO0hd86mqg23eYJyxBvN0qJD0ZD0j88sXPnfpc4EPK46sS2/LLHbDINo42qLWYm+skS5AUc5LhXu+elPY5Yhsf+JIqrXzVXE26amCSbTYoOw6LOdugFC/Oes1JaXOxIz7wJQUDLDDJNguUvXssdL2EHUeK4eDtTpTwpU4BWNiqYYPBAiXAcHvKNHVbZJ1c7RK0mi+HL3xKwUI8ARttFihREAGGFDsOi3mihU98S8EEG//rxJOEakRBUmyLK91x5DPrccQnvqVggg1GnaCXeFIN1di7kyXVN0ywwagTmRNAqCLASJZifcMGo076oC5JABKCJUuxvmGD0ezRsC+2R0kfkqVY3//3aNina0IzyHEeGmlR4YeVf8FoRlqOfhIxVbE9rF6L97kzJlaFDUadlHaxeRFvoPvZX+x9gVEn746dF6QPyVKsb9hg1CkOkHeT0kqR4yRLqm+YYINRp4JBcYC8W4pEjBwn0cInvqVggg1Ga6+ngkFxQIpskUQs0cKnmqnCBBscFihlFioYFAekyBZJxBIlfOFTChaYYKPNAqUWRJmFCoYU2SfZYqKELzXjhQUmWaeyQIGhFkSZRV2qSGnJFuMtfOBLCgar5GMyyTYblIIVtaCe9p/kNSvvJqUlW4yXsI0PNcen1AOLWkSzQQGhYBUa7IwE/RdsLoaj+tB7cYGV6bI65KTL1KNgsSHMkyhQ8mgKVpdbGgyKAVKuLK94tu7jdZ0GDDc21Zwen9ShYFBzejiiI4B7ZBuipCN7cUMUySRsYsqOF8zhblh92VHCxrOQywoTGrxiFnL3ra2QK2E3RGlcwnJ86H9sUGE5X+7nG+4hjmSH4Zjwn28AiFWifhD7D3n6KDlRx9CkAAAAAElFTkSuQmCC',
                    'height': 42,
                    'width': 42,
                    'anchorIcon': [42, 42],
                    'textColor': '#fff',
                    'textSize': '11'
                }]
            }
        };

    // Google Maps defaultStyles
    config.map.type.defaultStyles = [
            {
                elementType: 'geometry',
                stylers: [{color: '#e8e8e8'}]
            },
            {
                featureType:'administrative',
                elementType:'geometry.stroke',
                stylers:[{color:'#cccccc'},{lightness:'5'},{weight:'1.2'}]
            },
            {
                elementType: 'labels.icon',
                stylers: [{visibility: 'off'}]
            },
            {
                elementType: 'labels.text.fill',
                stylers: [{color: '#616161'}]
            },
            {
                elementType: 'labels.text.stroke',
                stylers: [{color: '#f5f5f5'}]
            },
            {
                featureType: 'administrative.land_parcel',
                elementType: 'labels.text.fill',
                stylers: [{color: '#bdbdbd'}]
            },
            {
                featureType: 'poi',
                elementType: 'geometry',
                stylers: [{color: '#eeeeee'}]
            },
            {
                featureType: 'poi',
                elementType: 'labels.text.fill',
                stylers: [{color: '#757575'}]
            },
            {
                featureType: 'poi.park',
                elementType: 'geometry',
                stylers: [{color: '#dcdcdc'}]
            },
            {
                featureType: 'poi.park',
                elementType: 'labels.text.fill',
                stylers: [{color: '#9e9e9e'}]
            },
            {
                featureType: 'road',
                elementType: 'geometry',
                stylers: [{color: '#ffffff'}]
            },
            {
                featureType: 'road.arterial',
                elementType: 'labels.text.fill',
                stylers: [{color: '#757575'}]
            },
            {
                featureType: 'road.highway',
                elementType: 'geometry',
                stylers: [{color: '#dadada'}]
            },
            {
                featureType: 'road.highway',
                elementType: 'labels.text.fill',
                stylers: [{color: '#616161'}]
            },
            {
                featureType: 'road.local',
                elementType: 'labels.text.fill',
                stylers: [{color: '#9e9e9e'}]
            },
            {
                featureType: 'transit.line',
                elementType: 'geometry',
                stylers: [{color: '#e5e5e5'}]
            },
            {
                featureType: 'transit.station',
                elementType: 'geometry',
                stylers: [{color: '#eeeeee'}]
            },
            {
                featureType: 'water',
                elementType: 'geometry',
                stylers: [{color: '#c9c9c9'}]
            },
            {
                featureType: 'water',
                elementType: 'labels.text.fill',
                stylers: [{color: '#9e9e9e'}]
            }
        ];

    // geolocation options
    config.geoLocation.map = {
            'isPanZoomRequired': true,
            'radius': 300000,
            'title': '',
            'iconImage': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAACXBIWXMAAAsTAAALEwEAmpwYAAA58mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMwMTQgNzkuMTU2Nzk3LCAyMDE0LzA4LzIwLTA5OjUzOjAyICAgICAgICAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgICAgICAgICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgICAgICAgICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPHhtcDpDcmVhdG9yVG9vbD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNCAoTWFjaW50b3NoKTwveG1wOkNyZWF0b3JUb29sPgogICAgICAgICA8eG1wOkNyZWF0ZURhdGU+MjAxNy0wNi0xNVQwOToyMjowNyswNTozMDwveG1wOkNyZWF0ZURhdGU+CiAgICAgICAgIDx4bXA6TW9kaWZ5RGF0ZT4yMDE3LTA2LTE1VDA5OjM4OjQ0KzA1OjMwPC94bXA6TW9kaWZ5RGF0ZT4KICAgICAgICAgPHhtcDpNZXRhZGF0YURhdGU+MjAxNy0wNi0xNVQwOTozODo0NCswNTozMDwveG1wOk1ldGFkYXRhRGF0ZT4KICAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9wbmc8L2RjOmZvcm1hdD4KICAgICAgICAgPHBob3Rvc2hvcDpDb2xvck1vZGU+MzwvcGhvdG9zaG9wOkNvbG9yTW9kZT4KICAgICAgICAgPHhtcE1NOkluc3RhbmNlSUQ+eG1wLmlpZDo3ZjMzY2I5OS03ZmJiLTQ4M2UtOWFmMy1mNDc0ZmUyNDBlNWU8L3htcE1NOkluc3RhbmNlSUQ+CiAgICAgICAgIDx4bXBNTTpEb2N1bWVudElEPmFkb2JlOmRvY2lkOnBob3Rvc2hvcDpiMmVlYjc4Mi05MjBlLTExN2EtODUzNi1iYzg0OTJkMDE4MzU8L3htcE1NOkRvY3VtZW50SUQ+CiAgICAgICAgIDx4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+eG1wLmRpZDozNWIwYjdiNy1kMjY0LTRhNzctYjViOC1kNDRlNmVmYzMzNGM8L3htcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD4KICAgICAgICAgPHhtcE1NOkhpc3Rvcnk+CiAgICAgICAgICAgIDxyZGY6U2VxPgogICAgICAgICAgICAgICA8cmRmOmxpIHJkZjpwYXJzZVR5cGU9IlJlc291cmNlIj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmFjdGlvbj5jcmVhdGVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6MzViMGI3YjctZDI2NC00YTc3LWI1YjgtZDQ0ZTZlZmMzMzRjPC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDE3LTA2LTE1VDA5OjIyOjA3KzA1OjMwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNCAoTWFjaW50b3NoKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6YWN0aW9uPnNhdmVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6N2YzM2NiOTktN2ZiYi00ODNlLTlhZjMtZjQ3NGZlMjQwZTVlPC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDE3LTA2LTE1VDA5OjM4OjQ0KzA1OjMwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNCAoTWFjaW50b3NoKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmNoYW5nZWQ+Lzwvc3RFdnQ6Y2hhbmdlZD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgIDwvcmRmOlNlcT4KICAgICAgICAgPC94bXBNTTpIaXN0b3J5PgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICAgICA8dGlmZjpYUmVzb2x1dGlvbj43MjAwMDAvMTAwMDA8L3RpZmY6WFJlc29sdXRpb24+CiAgICAgICAgIDx0aWZmOllSZXNvbHV0aW9uPjcyMDAwMC8xMDAwMDwvdGlmZjpZUmVzb2x1dGlvbj4KICAgICAgICAgPHRpZmY6UmVzb2x1dGlvblVuaXQ+MjwvdGlmZjpSZXNvbHV0aW9uVW5pdD4KICAgICAgICAgPGV4aWY6Q29sb3JTcGFjZT42NTUzNTwvZXhpZjpDb2xvclNwYWNlPgogICAgICAgICA8ZXhpZjpQaXhlbFhEaW1lbnNpb24+MzA8L2V4aWY6UGl4ZWxYRGltZW5zaW9uPgogICAgICAgICA8ZXhpZjpQaXhlbFlEaW1lbnNpb24+MzA8L2V4aWY6UGl4ZWxZRGltZW5zaW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/PswN0Y4AAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA79JREFUeNrMV99rW2UYfr7v5DQ5rckxLWedSZu1SVHSVislZWHIpOCoqy0TMb1xiNBdjsG6P8B4p4IbiJftjeBNKqi0yygTgsq2QONwsjUXW9KaNqEzrDH9kR89yfftYh5JJSeJI6U+t+d5z/Od877v874fQQMIBHyCccfcx5nqEgixgcDKABMAUKAAjkyZ8xShYqxo3nk0NTVfrvdOUlPwqk8yypKXcjLCOG9t5JCUkBwjfLmYzYenZubz/1l4cXZ6kBP1LGNow3OAUuwRLt6YuDB3vyFh7vfTBVt8nBN40AQQjshkyhkkfj/TFeZ+P120x30McKOJoEB0IumcrxSnlYQFW3y82aIAwAD3gi0+/q/DVOa0Ob+3GjiBZ3F2evDArw5c9UmSLF2sV0id3UNK78CZYbnD4RKNbTIAqMW9bPZJIrb64Obdx+v30vUKLp/NfzU1M583AIBRlry1RA2iSRh569KYYu/3AORAXRglWTnW9apyrGvwZDq5Eln+8culklqo2seMoc0oS14AIRII+ARpu/WKXp8aRJNw+t1PPnhBPt7LWAlr0RA2Yrexk0kCAMxWO7pcp9DjHgWlBuxmN1d//v7jb/TEKSG5vCX3hXD+be/LnLNhva89OTZz1qo4Bwq5Ldy6/inWH/6CQi4DzsrgrIxCLoM/N37HZuI3HD/xOlrNivVFxSltPLr1sGquAdGgSinKmeqqlVPF3u9hrITw0jVsbyV087e9lUB46RoYK0Gx93s6u4cU3UJjqosKhNj0CL0DZ4YBQtaioZqileJr0RAAQp7FVodAiI2CwKpHkDscLgDYiN1uuG00rharY9RWqk2ZatBaRiukRqBxtVgdQzFRHBEoBQp6D9XiXlZrmUahcbVYHe8uUHBk9AjZJ4kYAHS5TjUsrHG12OpljQwtc57Se7764OZdgPMe9ygs7Y66opZ2B3rcowA4fxZbHWXOU5RQUfdkj9fvpdPJlQilBnjHLtcUt7Q74B27DEoNSCdXIrV8m1AxJrx3vu+vlv2WEQ6I1Uibf/waf6l3pLvVrFgdr5xGi8mC/eIu1P0cKDVA7jiBvtfewdAbH0FsacNudnP1TvCz7xgrcT3LLFj2rhMA+GHuw1EwvPk8Q6IicbzekPi7sn46N/11yAAAxWw+LMmSR29CldRC+c6Nz4Od3UPLTRiL4QOrz+Ls9GCZq+8fZu8KRPxWW/7+MZCJC3P3CUfksEQJR6Ry4zzgXJMpZ5AC0aa7FBCdTDmD/7/19kgX+iO/whz2pe3pAAaX15E5/Jc6AAAAAElFTkSuQmCC',
            'zoom': 6,
            'showCircle': true,
            'fillColor': '#b19c5e',
            'strokeColor': '#b19c5e',
            'strokeWeight': 1
        };

    return {
        config: config
    };
})(base.util);

/*global iwc*/
/**
 * @fileOverview Provides a utility function to initialise any component by calling the
 * components' returned init function.
 */
(function(iwc, $, util) {
    'use strict';

    /**
     * Initialise DOM Element
     * @memberof iwc.util
     */
    util.initialise = function(element) {
        // get all components
        var $element = $(element),
            $components = $element.find('.iwc-component[data-component-name], .base-component[data-component-name]');

        $.each($components, function(index, item) {
            var $item = $(item);
            // initialise element only when its not marked as defer
            if (!$item.closest('.iwc-comp-defer').length) {

                util.attempt($item.data('component-name') + '.init', iwc.comp)(item, document, $);
            }
        });

    };

})(iwc, iwc.$, iwc.util);

/*global iwc*/

iwc.util.matchmedia = (function(settings) {
    'use strict';

    var MEDIA_NARROW = '(max-width: 767px)',
        MEDIA_TABLET = '(max-width: 959px)',
        MEDIA_WIDE = '(min-width: 960px)';

    // forceWide is true in browsers that we are
    // not providing narrow styling to
    if (settings.forceWide) {
        return {
            narrow: {
                matches: true,
                media: MEDIA_NARROW,
                addListener: function() {},
                removeListener: function() {}
            },
            tablet: {
                matches: true,
                media: MEDIA_TABLET,
                addListener: function() {},
                removeListener: function() {}
            },
            wide: {
                matches: true,
                media: MEDIA_WIDE,
                addListener: function() {},
                removeListener: function() {}
            }
        };
    } else {
        return {
            narrow: window.matchMedia(MEDIA_NARROW),
            tablet: window.matchMedia(MEDIA_TABLET),
            wide: window.matchMedia(MEDIA_WIDE)
        };
    }
})(iwc.settings || {});

/*global iwc */

/**
 * @fileOverview Load images that are meant for mobile only.
 */
(function($, util) {
    'use strict';

    /**
     * Load images for mobile
     * @memberof iwc.util
     */
    util.loadImages = (function() {
        var $images,
            isMobile = util.matchmedia.narrow.matches;

        /**
         * Append images source to mobile images for mobile only
         * @memberof iwc.util.loadImages
         * @private
         */
        function appendSrc() {
            if (isMobile) {
                $images.each(function(i, elem) {
                    if ($(elem).data('narrow-image')) {
                        $(elem).data('narrow-image', false);
                        $(elem).attr('src', $(elem).data('narrow-src'));
                    }
                });
            }
        }
        /**
         * Loads images that are meant for mobile only
         * @memberof iwc.util.loadImages
         * @public
         * @param {Object} object element
         */
        function init(element) {
            $images = $(element).find('[data-narrow-image]');
            appendSrc();
        }

        return {
            init: init
        };
    }());
})(iwc.$, iwc.util);

/*global iwc */

iwc.util.resize = (function($, window, undefined) {
    'use strict';
    var resizeEvent = 'resize.iwc-resize orientationchange.iwc-resize',
        delayTimer = 250,
        timer,
        wWidth = $(window).width(),
        wHeight = $(window).height(),

    onResizeEvent = function() {
        if (timer !== undefined) {
            window.clearTimeout(timer);
        }

        timer = window.setTimeout(function() {
            //adding this checkas on some mobiles when scrolling it things that we resized screen
            if ($(window).width() !== wWidth || $(window).height() !== wHeight) {
                wWidth = $(window).width();
                wHeight = $(window).height();
                $.publish('iwc:resize',[wWidth, wHeight]);
            }
        }, delayTimer);
    };
    function init() {
        $(window).on(resizeEvent, onResizeEvent);
    }

    return {
        init : init
    };

})(iwc.$, window);

/*global iwc */

/**
 * @fileOverview Provides functionality for scrolling elements to points
 */
(function($, util) {
    'use strict';

    /**
     * Scroll to methods
     * @memberof iwc.util
     */
    util.scrollTo = (function() {
        var startedOffset,
            currOffset = 0,
            $page;

        /**
         * Initialises listeners that modify offset
         * @memberof iwc.util.scrollTo
         * @public
         */
        function init() {
            var snHeight = 0;

            $.subscribe('iwc:sn:positioned', function(position, height) {
                var isFixed = (position === 'fixed');

                if (isFixed) { snHeight = height; }
                currOffset += (isFixed) ? snHeight : -snHeight;
                if (currOffset < 0) { currOffset = 0; }
            });
        }

        /**
         * Animates element scroll top position
         * @memberof iwc.util.scrollTo
         * @private
         * @param {jQuery} $el The element you want to scroll
         * @param {number} top The position you want to scroll to
         * @param {Object} options The animation options
         */
        function animate($el, top, options) {
            return $el.stop().animate({
                scrollTop: top
            }, options);
        }

        /**
         * Scroll to an element
         * @memberof iwc.util.scrollTo
         * @public
         * @param {jQuery} $el The element you want to scroll to
         * @param {Object} options The animation options
         * @param {number} [offset] A pixel offset which will be
         *                          added to top of element you are
         *                          scrolling to
         */
        function element($el, options, offset) {
            var step = options.step || $.noop,
                go = function() {
                    startedOffset = currOffset;
                    animate($page, $el.offset().top - ((offset || 0) + currOffset), options);
                };

            $page = $page || $('html, body');
            options.step = function() {
                // in case a step function is passed to options
                // we still want to call it
                step();

                // change scrollTo position if offset changes mid scroll
                if (currOffset !== startedOffset) {
                    go();
                }
            };

            go();
        }

        /**
         * Scroll to position
         * @memberof iwc.util.scrollTo
         * @public
         * @param {number} top The position you want to scroll to
         * @param {number} [time] The speed you want to scroll
         * @param {Function} [donecallback] Function to call when scrolling
         *                                  has finished
         */
        function position(top, time, doneCallback) {
            $page = $page || $('html, body');

            return animate($page, top, {
                duration: time,
                done: doneCallback
            });
        }

        return {
            init: init,
            element: element,
            position: position
        };
    }());

})(iwc.$, iwc.util);

/*global iwc*/
/**
 * navigation component js
 */

(function() {
    'use strict';

    /**
     * Navigation component
     * @namespace navigation
     * @memberof iwc.comp
     */
    iwc.util.scroll = (function($) {
        var lastScroll,
            events,
            DEBOUNCE_EMITTER = 10; // Time in milis between each event published when scrolling

        function debounce () {
            var scrollY = window.scrollTop || window.pageYOffset;
            if (lastScroll !== scrollY) {
                $.publish('scroll', [scrollY]);
                lastScroll = scrollY;
            }
        }

        function init(eventsObj) {
            events = eventsObj;
            $(window).on('scroll', iwc.util.debounce(debounce, DEBOUNCE_EMITTER));
            iwc.util.debounce(debounce, DEBOUNCE_EMITTER);
        }
        return {
            init: init
        };
    })(iwc.$);
}());

/*global iwc */

/**
 * @fileOverview Provides functionality for scrolling elements to points
 * example usege - smoothScroll.init($(hash).offset().top, 700, function () {});
 */
(function($, util) {
    'use strict';

    /**
     * Scroll to methods based on https://gist.github.com/james2doyle/5694700
     * @memberof iwc.util
     */
    util.smoothScroll = (function() {

        // easing functions http://goo.gl/5HLl8
        Math.easeInOutQuad = function(t, b, c, d) {
            t /= d / 2;
            if (t < 1) {
                return c / 2 * t * t + b;
            }
            t--;
            return -c / 2 * (t * (t - 2) - 1) + b;
        };

        Math.easeInCubic = function(t, b, c, d) {
            var tc = (t /= d) * t * t;
            return b + c * (tc);
        };

        Math.inOutQuintic = function(t, b, c, d) {
            var ts = (t /= d) * t,
            tc = ts * t;
            return b + c * (6 * tc * ts + -15 * ts * ts + 10 * tc);
        };

        // requestAnimationFrame for Smart Animating http://goo.gl/sx5sts
        var requestAnimFrame = (function() {
            return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || function(callback) { window.setTimeout(callback, 1000 / 60); };
        })();

        function init(to, duration, callback) {
            // because it's so fucking difficult to detect the scrolling element, just move them all
            function move(amount) {
                document.documentElement.scrollTop = amount;
                document.body.parentNode.scrollTop = amount;
                document.body.scrollTop = amount;
            }
            function position() {
                return document.documentElement.scrollTop || document.body.parentNode.scrollTop || document.body.scrollTop;
            }
            var start = position(),
            change = to - start,
            currentTime = 0,
            increment = 20;
            duration = (typeof(duration) === 'undefined') ? 500 : duration;
            var animateScroll = function() {
                // increment the time
                currentTime += increment;
                // find the value with the quadratic in-out easing function
                var val = Math.easeInOutQuad(currentTime, start, change, duration);
                // move the document.body
                move(val);
                // do the animation unless its over
                if (currentTime < duration) {
                    requestAnimFrame(animateScroll);
                } else {
                    if (callback && typeof(callback) === 'function') {
                        // the animation is done so lets callback
                        callback();
                    }
                }
            };
            animateScroll();
        }
        return {
            init: init
        };
    }());

})(iwc.$, iwc.util);

/*global iwc*/
/**
 * Animation component js
 */

(function() {
    'use strict';

    /**
     * Animation component
     * @namespace animatable
     * @memberof iwc.comp
     */
    iwc.util.animatable = (function($, util) {

        var $animatable = $('*[data-animatable="true"]'),
            $trackable = $('.iwc-tracking-on-scroll'),
            $sections = $('.iwc-section'),
            $window = $(window),
            $body = $('body'),
            navHeight = $('.iwc-header').height(),
            urlPathName = window.location.pathname,
            cssClasses = {
                show: 'iwc-show',
                tracked: 'iwc-tracked'
            };

        /**
        * slideUpItems
        * @memberOf iwc.util.animatable
        * @private
        * @param  {Object} $nav The jQuery object of the component, {Number} Sroll Y position
        */
        function slideUpItems(elem, scrollY) {
            var innerH = window.innerHeight,
                $elem = $(elem);
            if ($elem.is('.inpage-selector')) {
                innerH = innerH / 1.5;
            }
            var toScroll = scrollY + innerH + (navHeight * 2),
                elemTopPostion = $elem.offset().top;
            if (elemTopPostion > 0 && elemTopPostion < toScroll && !$elem.hasClass(cssClasses.show)) {
                $elem.addClass(cssClasses.show);
            }
        }
        /**
        * trackComponentsOnScroll
        * @memberOf iwc.util.animatable
        * @private
        * @param  {Object} jQuery object of the component, {Number} Sroll Y position
        */
        function trackComponentsOnScroll(elem, scrollY) {
            var navHeight = $('.iwc-header').height(),
                innerH = window.innerHeight,
                $elem = $(elem);
            if ($elem.is('.inpage-selector')) {
                innerH = innerH / 1.5;
            }
            var toScroll = scrollY + innerH + (navHeight * 2),
                elemTopPostion = $elem.offset().top;
            if (elemTopPostion > 0 && elemTopPostion < toScroll && !$elem.hasClass(cssClasses.tracked)) {
                $elem.addClass(cssClasses.tracked);
                var compName = $elem.data('compName');
                util.tracking.iwcCustomTracking({
                    'event': 'virtualPageview',
                    'page': urlPathName + '/' + compName,
                    'rcms_cgGroup': 'Product'
                });
            }
        }
        /**
         * fixSectionBackgroundOnScroll
         * @memberOf iwc.util.animatable
         * @private
         * @param  {Object} $nav The jQuery object of the component, {Number} Sroll Y position
         */
        function fixSectionBackgroundOnScroll(elem, scrollY) {
            var $elem = $(elem);
            $elem.toggleClass('fix', $elem.offset().top < scrollY && !$elem.hasClass('hero'));
        }
        /**
        * scrollingAnimations
        * @memberOf iwc.util.animatable
        * @private
        * @param  {Object} $nav The jQuery object of the component
        */
        function scrollingAnimations() {
            for (var i = 0; i < $animatable.length; i++) {
                slideUpItems($animatable[i], $window.scrollTop());
            }
            for (var ii = 0; ii < $sections.length; ii++) {
                fixSectionBackgroundOnScroll($sections[ii], $window.scrollTop());
            }
            if ($window.scrollTop() > 50) {
                $body.addClass('scroll');
                $.publish('animated:scroll');
            } else {
                $body.removeClass('scroll');
            }
            for (var j = 0; j < $trackable.length; j++) {
                trackComponentsOnScroll($trackable[j], $window.scrollTop());
            }
        }
        /**
         * Contextual ReInit an animatable util.
         * @memberOf iwc.comp.animatable
         * @public
         * @param  {HTMLElement} element
         */
        function reInit(obj) {
            $animatable = $(obj).find('*[data-animatable="true"]');
            $trackable = $(obj).find('.iwc-tracking-on-scroll');
            urlPathName = window.location.pathname;
            for (var i = 0; i < $animatable.length; i++) {
                slideUpItems($animatable[i], $window.scrollTop());
            }
        }
        /**
         * Initialise a animatable util.
         * @memberOf iwc.comp.animatable
         * @public
         */
        function init() {
            $window.on('load', scrollingAnimations);
            $.subscribe('scroll', scrollingAnimations);
        }

        return {
            init: init,
            scrollingAnimations: scrollingAnimations,
            reInit: reInit
        };
    })(iwc.$, iwc.util);
}());

/*global iwc*/
/**
 * CTA component js
 */

(function() {
    'use strict';

    /**
     * CTA Util
     * @namespace cta
     * @memberof iwc.comp
     */
    iwc.util.cta = (function($, util) {
        function cta(e) {
            var $el = $(e.target) || $('.iwc-btn');
            if ($el.is('.iwc-btn')) {
                var parent = $el;
                if (parent.length) {
                    parent.addClass('active');
                    setTimeout(function() {
                        parent.removeClass('active');
                    }, 800);
                }
            }
        }
        function init() {
            var $ctas = $('body').find('.iwc-btn'),
                EVENTS = util.events.INTERACTION;
            $ctas.on(EVENTS, cta);
        }
        return {
            init: init
        };
    })(iwc.$, iwc.util);
}());


/*global iwc*/
/**
* Carousel component js
* Usage:
* Add data-iwc-carousel="optionalComponentName" attribute on the element to add a carousel on it
* To override the default slick setting add data-carousel-options with the modified object
* eg: data-carousel-options='{"dots":true}' for adding dots in default mode
*/

(function() {
    'use strict';

    /**
     * Carousel Util
     * @namespace cta
     * @memberof iwc.comp
     */
    iwc.util.carousel = (function($, util) {
        var $body = $('body.iwc-body'),
            $carousel,
            defaults = {
                speed: 300,
                infinite: true,
                slidesToShow: 1,
                slidesToScroll: 1,
                centerMode: false,
                arrows: true,
                dots: false,
                responsive: [
                    {
                        breakpoint: 768,
                        settings: {
                            arrows: false,
                            dots: true
                        }
                    }
                ]
            };

        /**
         * Initialise slick carousel
         * @function getItems
         * @public
         * @param {HTMLElement} $carousel element
         * @memberof iwc.util.carousel
         */
        function initCarousel($carousel) {
            if ($carousel.length) {
                $carousel.each(function(index) {
                    var options = $carousel.eq(index).data('carousel-options') || '{"dots":true}',
                    newObjects = {},
                    slickSettings;
                    newObjects = (options) ? options : {};
                    slickSettings = $.extend({}, defaults, newObjects);
                    $carousel.eq(index).slick(slickSettings);
                });

                $carousel.on('afterChange', function(event, slick, currentSlide) {
                    var $slide = $(slick.$slides[currentSlide]);
                    util.tracking.publish($slide);
                    util.videoPlayer.playVisible();
                });
            }
        }

        /**
         * Contextual init carousel
         * @function contextualInit
         * @public
         * @param {Object} $obj
         * @memberof iwc.util.carousel
         */
        function contextualInit($obj) {
            $carousel = $obj;
            initCarousel($carousel);
        }

        /**
         * Init carousel
         * @function init
         * @public
         * @param {Object} $obj
         * @memberof iwc.util.carousel
         */
        function init($obj) {
            $carousel = $obj.find('[data-iwc-carousel]');
            util.loadImages.init($carousel);
            initCarousel($carousel);
        }

        init($body);

        return {
            init: init,
            contextualInit: contextualInit
        };

    })(iwc.$, iwc.util);

}());


/*global iwc*/
/**
 * Toggle utility js
 * TODO:
 * - Add toggle text on current selector
 *
 * Markup:
 * Accordion                <div data-toggle-group="myAccordion"></div>
 * button:                  <button data-toggle="myDiv">Tab</button>
 * buttonHighlightClass     <button data-toggle="myDiv" class="selected">Tab</button>
 * Element:                 <div data-toggle-id="myDiv">Tab Content</div>
 * ElementToggleClass       <div data-toggle-id="myDiv" class="expanded">Tab Content</div>
 */

/**
 * defer init               <div class="iwc-toggle-defer" data-toggle-group="myAccordion"></div>
 */

/**
 * Allow multiple content expandable
 *                          <div data-toggle-group="myAccordion" data-toggle-multi-expandable="true"></div>
 *
 */

/**
 * Allow smooth collapse/expand
 *                          <div data-toggle-group="myAccordion" data-toggle-smooth-expandable="true"></div>
 *
 */


/**
 * Mandatory attributes are : data-toggle-group, data-toggle, and data-toggle-id
 */

/**
 * Selectors can be overriden to define how utility identify buttons, target
 */

(function($, util) {
    'use strict';

    /**
     * ToggleComponent
     * @constructor
     * @param {jQuery} $toggleGroup Container having all accordion markup
     * @param {object} options defining selector to be overriden
     */
    function ToggleComponent($toggleGroup, options) {
        this.$toggleButtons = {};
        this.$toggleTargets = {};
        this.$toggleGroup = $toggleGroup;
        this.$currentToggleButton = {};
        this.$targetElement = {};
        this.isMultipleExpandable = false;

        this.cssClass = {
                selected: 'selected',
                expand: 'expanded',
                disabled: 'disabled'
            };


        this.selectors = {
            toggleButton: '[data-toggle]',
            toggleTarget: '[data-toggle-id]',
            toggleParent: '[data-toggle-group]',
            checkoutHeader: '.iwc-checkout-header',
            iwcPanelHeading: '.iwc-panel-heading'
        };

        this.init($toggleGroup, options);

    }

    /*
     * Toggle the section based on the clicked button
     * @function toggleElements
     * @param {Object} event event object
     * @memberof iwc.util.toggle.ToggleComponent
     */
    ToggleComponent.prototype.toggleElements = function(event, $requestedButton) {
        var $currentToggleButton,
            $targetElement,
            currentTargetId,
            isCollapsed;

        if (event) {
            event.preventDefault();
            $currentToggleButton = $(event.currentTarget);
        } else {
            $currentToggleButton = $requestedButton;
        }

        currentTargetId = $currentToggleButton.data('toggle');

        if ($currentToggleButton.hasClass(this.cssClass.disabled)) {
            return;
        }

        //TODO refactor: An utility must be generic and do not have special case coded for a component
        if ($(this.selectors.checkoutHeader).length) {
            $currentToggleButton
                .parent(this.selectors.iwcPanelHeading)
                .nextAll(this.selectors.iwcPanelHeading)
                .find(this.selectors.toggleButton)
                .addClass(this.cssClass.disabled);
        }

        //remember current state
        $targetElement = this.$toggleTargets.filter('[data-toggle-id="' + currentTargetId + '"]');
        isCollapsed = !($targetElement.hasClass(this.cssClass.expand));
        this.$currentToggleButton = $currentToggleButton;
        this.$targetElement = $targetElement;
        if (!this.isMultipleExpandable) {
            //Close all
            this.closeAll();
        }

        //toggle the visibility based on the status
        $currentToggleButton
            .toggleClass(this.cssClass.selected, isCollapsed)
            .attr('aria-expanded', (isCollapsed ? 'true' : 'false'));
        $targetElement.toggleClass(this.cssClass.expand, isCollapsed);

        this.$toggleGroup.trigger('toggle-change', [this]);
    };

    /**
     * Close All
     * @function closeAll
     * @memberOf iwc.util.toggle.ToggleComponent
     */
    ToggleComponent.prototype.closeAll = function() {
        this.$toggleButtons
            .removeClass(this.cssClass.selected)
            .attr('aria-expanded', 'false');
        this.$toggleTargets.removeClass(this.cssClass.expand);
        this.$toggleGroup.trigger('toggle-change', [this]);
    };

    /**
     * Open a specific tab
     * @function open
     * @memberOf iwc.util.toggle.ToggleComponent
     */
    ToggleComponent.prototype.open = function(tabName) {
        var $toggleButton = this.$toggleButtons.filter('[data-toggle="' + tabName + '"]');
        if ($toggleButton.length) {
            this.toggleElements(undefined, $toggleButton.eq(0));
        }
    };


    /**
     * Tells if any target is expanded
     * @function anyExpanded
     * @memberOf iwc.util.toggle.ToggleComponent
     * @returns {boolean}
     */
    ToggleComponent.prototype.anyExpanded = function() {
        return this.$toggleTargets.filter('.' + this.cssClass.expand).length > 0;
    };


    /**
     * Filter the elements that is children of current group, and do not have any other group.
     * This allows to have nested default toggle feature.
     * @function filterImmediateChildren
     * @memberOf iwc.util.toggle.ToggleComponent
     * @param {jQuery} $elements list of elements to filter from
     * @returns {jQuery} elements that satisfy
     */
    ToggleComponent.prototype.filterImmediateChildren = function($elements) {
        return $elements.filter((function(index) {
                    return $elements.eq(index)
                            .closest('[data-toggle-group]', this.$toggleGroup)
                            .is(this.$toggleGroup);
                }).bind(this));
    };

    /**
     * Perform the smooth animation on toggle
     * @function smoothToggle
     * @param {Object} event event object
     */
    ToggleComponent.prototype.smoothToggle = function(event) {
        event.preventDefault();
        var $currentToggleButton = $(event.currentTarget),
            currentTargetId = $currentToggleButton.data('toggle'),
            $targetElement = this.$toggleTargets.filter('[data-toggle-id="' + currentTargetId + '"]'),
            targetElementHeight = $targetElement.data('height'),
            isCollapsed = !$targetElement.hasClass(this.cssClass.expand);

        if (!this.isMultipleExpandable) {
            this.$toggleTargets.removeClass(this.cssClass.expand).css('max-height', 0);
            this.$toggleButtons.removeClass(this.cssClass.selected).attr('aria-expanded', false);
        }

        if (isCollapsed) {
            $targetElement.addClass(this.cssClass.expand).css('max-height', targetElementHeight);
            $currentToggleButton.addClass(this.cssClass.selected).attr('aria-expanded', true);
        } else {
            $targetElement.removeClass(this.cssClass.expand).css('max-height', 0);
            $currentToggleButton.removeClass(this.cssClass.selected).attr('aria-expanded', false);
        }
    };
    /**
     * Set max height data attribute to target elements to use later
     * @function setTargetHeight
     * @param {jQuery} $element list of elements to filter from
     */
    ToggleComponent.prototype.setTargetHeight = function($elements) {
        var _this = this;
        $elements.each(function(i, elem) {
            var $element = $(elem),
                targetHeight = $element.outerHeight() + 300;
            $element.css('max-height', targetHeight).data('height', targetHeight);
            if (!$element.hasClass(_this.cssClass.expand)) {
                $element.css('max-height', 0);
            }
        });
    };

    /**
     * Initialise toggle
     * @function init
     * @memberOf iwc.util.toggle.ToggleComponent
     * @param {jQuery} $toggleGroup Container having all accordion markup
     * @param {object} options defining selector to be overriden
     */
    ToggleComponent.prototype.init = function($toggleGroup, options) {
        this.selectors = $.extend(this.selectors, options);
        this.$toggleButtons = this.filterImmediateChildren($toggleGroup.find(this.selectors.toggleButton));
        this.$toggleTargets = this.filterImmediateChildren($toggleGroup.find(this.selectors.toggleTarget));
        this.isMultipleExpandable = $toggleGroup.data('toggle-multi-expandable') || false;
        this.isSmoothToogle = $toggleGroup.data('toggle-smooth-expandable') || false;

        if (this.$toggleButtons.length && this.isSmoothToogle) {
            this.setTargetHeight(this.$toggleTargets);
            this.$toggleButtons.on(util.events.INTERACTION, this.smoothToggle.bind(this));
        } else if (this.$toggleButtons.length) {
            this.$toggleButtons.on(util.events.INTERACTION, this.toggleElements.bind(this));
        }
    };

    /**
     * Toggle Util
     * @namespace toggle
     * @memberof iwc.comp
     */
    iwc.util.toggle = (function() {

        /**
         * Initialise toggle
         * @function init
         * @memberOf iwc.util.toggle
         * @param {jQuery} $toggleGroup Container having all accordion markup
         * @param {object} options defining selector to be overriden
         */
        function init($toggleGroup, options) {
            var instance = new ToggleComponent($toggleGroup, options);
            $toggleGroup.data('instance', instance);
        }

        /**
         * close all opened content
         * @function close
         * @memberOf iwc.util.toggle
         * @param {jQuery} $toggleGroup Container whose content should be closed
         */
        function close($toggleGroup) {
            var instance = $toggleGroup.data('instance');
            if (instance) {
                instance.closeAll();
            }
        }

        /**
         * open a specific tab to provided toggleGroup
         * @function openTab
         * @memberOf iwc.util.toggle
         * @param {jQuery} $toggleGroup Container whose content should be closed
         * @param {string} tabName
         */
        function openTab($toggleGroup, tabName) {
            var instance = $toggleGroup.data('instance');
            if (instance) {
                instance.open(tabName);
            }
        }

        return {
            init: init,
            close: close,
            openTab: openTab
        };

    })();

}(iwc.$, iwc.util));


/*global iwc, videojs*/
/**
 * Lighbox component js
 */

(function() {
    'use strict';

    /**
     * CTA Util
     * @namespace cta
     * @memberof iwc.comp
     */
    iwc.util.lightbox = (function($, util) {
        // get all components
        var $html = $('html'),
            $body = $('body'),
            $lightboxWrapper,
            $lightboxContent,
            $lightboxOverlay,
            $lighboxSelector,
            $lighboxVideo,
            $target,
            videoInstance,
            /* selectors */
            selectors = {
                overlay: '.iwc-lightbox-overlay',
                wrapper: '.iwc-lightbox-wrapper',
                content: '.iwc-lightbox-content',
                video: '.iwc-lightbox-video',
                close: '.iwc-lightbox-close',
                viewport: '#viewport',
                registerOverlay: '.iwc-register',
                loginOverlay: '.iwc-login',
                accountForm: '.iwc-account-form-content'
            },
            cssClass = {
                lightboxOpen: 'iwc-lightbox-open',
                scaled: 'iwc-scaled',
                hidden: 'iwc-hidden'
            },
            EVENTS = util.events.INTERACTION,
            pageName,
            isOpen;

        /**
         * Set content inside lightbox content
         */
        function setContent(data) {
            var $page = $(data).find('[data-component-name]');
            $lightboxContent = $lightboxContent ? $lightboxContent : $(selectors.content);
            $lightboxContent.empty().html(data);

            if ($page.length) {
                pageName = $page.data('component-name');
                util.attempt(pageName + '.init', iwc.comp)($page, document, $);
            }

            $.publish('iwc:lightbox:content:set', [{target: $target, pageName: pageName}]);
        }
        /**
         * closeLightbox and destroy its content
         * @return {[type]} [description]
         */
        function closeLightbox() {
            $html.removeClass(cssClass.lightboxOpen);
            $body.removeClass(cssClass.lightboxOpen);

            $lightboxOverlay.attr('tabindex', -1);
            $lightboxWrapper.attr('tabindex', -1);

            if (util.matchmedia.narrow.matches) {
                $(selectors.viewport).attr('content', 'width=device-width, initial-scale=1');
            }
            $.publish('iwc:lightbox:close', [pageName]);

            //Destroy Video player if found in lightboxcontent
            var $player = $lightboxContent.find('.vjs-tech');

            if ($player.length && window.videojs) {
                videojs.players['iwc-overlay-video'].dispose();
                delete videojs.players['iwc-overlay-video'];
            }
            // Clear other content if any
            $lightboxContent.empty();
            $lightboxWrapper.removeClass(cssClass.scaled);
            if ($target) {
                $target.focus();
            }

            ///Update lightbox status
            updateOpenStatus(false);
        }
        /**
         * [errorHandler description]
         * @param  {[type]} error [description]
         * @return {[type]}       [description]
         */
        function errorHandler(error) {
            console.log('error', error, error.statusText);
        }
        /**
         * [getData description]
         * @return {[type]} [description]
         */
        function getData(settings) {
            $.ajax(settings).done(setContent).fail(errorHandler);
        }

        /**
         * Update lightbox's open status
         * @function updateLightboxOpenStatus
         * @private
         * @memberOf iwc.comp.lightbox
         */
        function updateOpenStatus(status) {
            isOpen = status;
        }

        /**
         * Get lightbox open status
         * @function getOpenStatus
         * @public
         * @memberOf iwc.comp.lightbox
         */
        function getOpenStatus() {
            return isOpen;
        }

        /**
         * Parse incoming data
         * @function parseData
         * @private
         * @param {object} data can be HTML markup, a plain string or DOM
         * @memberOf iwc.comp.lightbox
         */
        function parseData(data) {
            var datatype = typeof data || undefined;

            if (datatype === 'string') {
                return data.replace(/className/g, 'class');
            }
            return data;
        }

        /**
         * Function to check if lightbox is already opened and close it if it is
         * @function avoidOverlayCollision
         * @private
         * @memberOf iwc.comp.lightbox
         */
        function avoidOverlayCollision() {
            if (getOpenStatus()) {
                closeLightbox();
            }
        }

        /**
         * Set Lightbox Data
         * @function setLightboxData
         * @public
         * @param {String} url page url
         * @memberOf iwc.comp.lightbox
         */
        function setLightboxData(url) {

            getData({
                url: url,
                type: 'GET'
            });

            $html.addClass(cssClass.lightboxOpen);
            $body.addClass(cssClass.lightboxOpen);

            if (util.matchmedia.narrow.matches) {
                $(selectors.viewport).attr('content','width=device-width, initial-scale=1, maximum-scale=1');
            }
        }

        /**
         * Open Lightbox
         * @function openLightbox
         * @public
         * @param @param {object} e event object
         * @param {object} data to be loaded
         * @memberOf iwc.comp.lightbox
         */
        function openLightbox(e, data) {
            var lightboxHref,
                type,
                videoId,
                cacheburst,
                $videoTag,
                parsedData;

            //safety check to close lightbox if its already open
            avoidOverlayCollision();
            $lightboxOverlay.attr('tabindex', 0);
            $lightboxWrapper.attr('tabindex', 0);
            if (e && e.currentTarget) {
                $target = $(e.currentTarget);
                lightboxHref = $target.prop('href') || undefined;
                type = $target.data('page-type') || undefined;
                videoId = $target.data('video-id') || undefined;
                cacheburst = $target.data('cacheburst') || undefined;
                $videoTag = $('<video id="iwc-overlay-video"></video>');
            }

            if (lightboxHref) {
                e.preventDefault();
                e.stopPropagation();

                if (cacheburst) {
                    setLightboxData(lightboxHref + '?cacheburst=' + new Date().getTime());
                } else {
                    setLightboxData(lightboxHref);
                }

                $.publish('iwc:lightbox:opened', [{
                    target: $target,
                    type: type,
                    pageName: pageName
                }]);

                //Update lightbox status
                updateOpenStatus(true);
            }

            if (type === 'video' && videoId) {
                // setup video
                var isYt = ($target.data('video-type') === 'Youtube'),
                    className = 'video-js vjs-default-skin iwc-responsive-video-js iwc-' + (isYt ? 'yt' : 'brt') + '-video';

                $videoTag.attr({
                    'class': className
                });

                // set path
                if (isYt) {
                    $videoTag.attr('data-video-src', 'https://www.youtube.com/watch?v=' + videoId);
                } else {
                    $videoTag.attr({
                        'data-account': $body.data('brightcove-id'),
                        'data-player': $body.data('brightcove-player'),
                        'data-embed': 'default',
                        'data-brightcove-video-id': videoId
                    });
                }
                // play videos in lightbox
                $html.addClass(cssClass.lightboxOpen);
                $body.addClass(cssClass.lightboxOpen);

                //Update lightbox status
                updateOpenStatus(true);

                // show video
                $lightboxWrapper.addClass(cssClass.scaled);

                $lightboxContent
                .empty()
                .html($videoTag);

                videoInstance = util.videoPlayer.getPlayer($videoTag, $target);
            }

            if (lightboxHref) {
                util.tracking.iwcCustomTracking({
                    'event': 'virtualPageview',
                    'uri': lightboxHref
                });
            }

            if ($target && $target.hasClass('iwc-track-element')) {
                util.tracking.publish($target);
            }

            if (data) {

                parsedData = parseData(data);
                $lightboxContent.empty().html(parsedData);

                $html.addClass(cssClass.lightboxOpen);
                $body.addClass(cssClass.lightboxOpen);

                if (util.matchmedia.narrow.matches) {
                    $(selectors.viewport).attr('content','width=device-width, initial-scale=1, maximum-scale=1');
                }

                //Update lightbox status
                updateOpenStatus(true);
            }
        }
        /**
         * Open URL in Lightbox
         * @function openUrlInLightbox
         * @public
         * @param {String} url page path
         * @memberOf iwc.comp.lightbox
         */
        function openUrlInLightbox(url, target) {
            var targetUrl = url;
            //re-setting the target.
            $target = target;

            // setting the tabindex to 0 when lightbox open.
            $lightboxOverlay = $lightboxOverlay ? $lightboxOverlay : $(selectors.overlay);
            $lightboxWrapper = $lightboxWrapper ? $lightboxWrapper : $(selectors.wrapper);
            $lightboxOverlay.attr('tabindex', 0);
            $lightboxWrapper.attr('tabindex', 0);

            if (targetUrl) {

                avoidOverlayCollision();
                setLightboxData(targetUrl);

                $.publish('iwc:lightbox:opened', [{
                    target: targetUrl,
                    pageName: pageName
                }]);

                $.subscribe('iwc:lightbox:content:set', function() {
                    applyTabbingModalElems();
                });
                //Update lightbox status
                updateOpenStatus(true);
            }
        }

        /**
         * Contextual ReInit
         * @function contextualReInit
         * @public
         * @param {HTMLElement} elem html element
         * @memberOf iwc.comp.lightbox
         */
        function contextualReInit(elem) {
            var $elem = $(elem);
            $lighboxSelector = $elem.find('[data-lightbox]');
            // bind events
            $lighboxSelector.on(EVENTS, openLightbox);
        }

        /**
         * Adding recursive tabbing on modal elements.
         * @function applyTabbingModal
         * @public
         * @param {HTMLElement} firstInput html element
         * @param {HTMLElement} lastInput html element
         * @memberOf iwc.comp.lightbox
         */
        function circularTabbing(firstInput, lastInput, checkOverlay) {
            /*redirect last tab to first input*/
            lastInput.on('keydown', function(e) {
                if ((e.which === 9 && !e.shiftKey)) {
                    if (lastInput[0].nodeName !== 'INPUT' || lastInput[0].nodeName !== 'BUTTON') {
                        e.preventDefault();
                    }
                    //firstInput.focus();
                    if (checkOverlay) {
                        $(selectors.close).focus();
                    } else {
                        firstInput.focus();
                    }
                }
            });

            if (checkOverlay) {
                /*on tab redirect to firstInput*/
                $(selectors.close).on('keydown', function(e) {
                    if ((e.which === 9 && !e.shiftKey)) {
                        e.preventDefault();
                        firstInput.focus();
                    }
                });

                /*on shift+tab redirect to lastInput*/
                $(selectors.close).on('keydown', function(e) {
                    if ((e.which === 9 && e.shiftKey)) {
                        e.preventDefault();
                        lastInput.focus();
                    }
                });
            }
            /*redirect first shift+tab to last input*/
            firstInput.on('keydown', function(e) {
                if ((e.which === 9 && e.shiftKey)) {
                    e.preventDefault();
                    if (checkOverlay) {
                        $(selectors.close).focus();
                    } else {
                        lastInput.focus();
                    }
                }
            });
        }

        /**
         * Adding recursive tabbing on modal elements.
         * @function applyTabbingModal
         * @public
         * @memberOf iwc.comp.lightbox
         */
        function applyTabbingModalElems() {
            $lightboxWrapper = $lightboxWrapper || $(selectors.wrapper);
            var inputs =  $lightboxWrapper.find('select, input, textarea, button, a').filter(':visible'),
                firstInput = inputs.length ? inputs.first() : '',
                lastInput = inputs.length ? inputs.last() : '',
                isLoginRegister = $lightboxWrapper.find(selectors.loginOverlay).length || $lightboxWrapper.find(selectors.registerOverlay).length;

            if (isLoginRegister && $(selectors.accountForm).find('input')) {
                $(selectors.accountForm).find('input').filter(':visible').first().focus();
            } else {
                if (firstInput) {
                    firstInput.focus();
                }
            }
            if (firstInput && lastInput) {
                circularTabbing(firstInput, lastInput, 'true');
            }
        }



        /**
         * Init Lightbox
         * @return {[type]} [description]
         */
        function init() {
            // selector
            $lighboxSelector =  $('[data-lightbox]');
            //overlay
            $lightboxOverlay = $(selectors.overlay);
            //content
            $lightboxWrapper = $(selectors.wrapper);
            $lightboxContent = $lightboxWrapper.find(selectors.content);
            $lighboxVideo = $(selectors.video);

            // bind events
            $lighboxSelector.on(EVENTS, openLightbox);
            $lightboxOverlay.on(EVENTS, closeLightbox);

            // $lightboxOverlay.on('touchstart', closeLightbox);
            // close lightbox on keyboard escape key press
            $(window).on('keyup', function(event) {
                var key = event.charCode || event.keyCode;
                if (key === 27) {
                    closeLightbox();
                }
            });

            $.subscribe('iwc:lightbox:content:set', function() {
                applyTabbingModalElems();
            });
            // Move focus to wishlist overlay
            $.subscribe('iwc:wishlistform:opened', function() {
                applyTabbingModalElems();
            });

            // Move focus to video-overlay
            $.subscribe('iwc:lightbox:videoData:set', function() {
                applyTabbingModalElems();
            });

            // setting focus to first input element in the lightbox form after submission.
            $lightboxWrapper.on('submit', null, function() {
                if ($lightboxWrapper.find('input').filter(':visible').first()) {
                    $lightboxWrapper.find('input').filter(':visible').first().focus();
                }
            });
            //Update lightbox status
            updateOpenStatus(false);
        }

        return {
            init: init,
            openLightbox: openLightbox,
            closeLightbox: closeLightbox,
            content: setContent,
            reInit: contextualReInit,
            openUrlInLightbox: openUrlInLightbox,
            getOpenStatus: getOpenStatus,
            circularTabbing: circularTabbing
        };
    })(iwc.$, iwc.util);
}());


/*global iwc*/
/**
 * Notification component
 */

(function() {
    'use strict';

    /**
     * Notification
     * @namespace notification
     * @memberof iwc.util
     */
    iwc.util.notification = (function($, util) {
        // get all components
        var $body = $('body'),
            $notificationWrapper,
            $notificationContent,
            $closeBtn,
            $selectors,
            /* selectors */
            selectors = {
                wrapper: '.iwc-notification',
                content: '.iwc-notification-content',
                close: '.iwc-close',
                notifyBar: '.iwc-notification-template',
                main: '.iwc-main',
                addedNotification: '.iwc-added-notification',
                closeNotification: '.iwc-close-notification'
            },
            cssClass = {
                open: 'iwc-notification-open',
                notifyBarOpen: 'iwc-notification-bar-open',
                animateBar: 'iwc-notify-bar-animate'
            },
            autoCloseId,
            CLOSE_AFTER = 2000,
            notifyTemplate,
            EVENTS = util.events.INTERACTION;

        /**
         * Set content inside notification content
         * @function setContent
         * @public
         * @memberof iwc.util.notification
         * @param {html} data HTML markup to be shown
         */
        function setContent(data) {
            $notificationContent.empty().html(data);
            util.initialise($notificationContent);
            util.lightbox.reInit($notificationContent);
        }

        /**
         * Cancel the automatic closing of notification box
         * @function cancelAutoClose
         * @public
         * @memberof iwc.util.notification
         */
        function cancelAutoClose() {
            if (autoCloseId) {
                window.clearTimeout(autoCloseId);
            }
        }

        /**
         * Hide notificaiton
         * @function hide
         * @public
         * @memberof iwc.util.notification
         */
        function hide() {
            /*
             * TODO: removed commented code after stablization of defect
             * may be required to revert incase of any regression
             * IWCE-4429
             */

            // cancelAutoClose();
            $body.removeClass(cssClass.open);
        }

        /**
         * Set the automatic closing of notification box
         * @function setAutoClose
         * @public
         * @memberof iwc.util.notification
         */
        function setAutoClose() {
            cancelAutoClose();
            autoCloseId = window.setTimeout(hide, CLOSE_AFTER);
        }

        /**
         * Show the notification box
         * @function show
         * @public
         * @memberof iwc.util.notification
         * @param  {object} option
         * @param  {string} option.variant Adds a variant class
         */
        function show(option) {
            $notificationWrapper.attr({'variant': option.variant || ''});
            $body.addClass(cssClass.open);

            if (option.autoCloseAfter) {
                cancelAutoClose();
                autoCloseId = window.setTimeout(hide, option.autoCloseAfter);
            } else {
                setAutoClose();
            }
            $.publish('iwc:notification:open');
        }

        /**
         * Event handler for element whose click requires notification
         * @function showBar
         * @public
         * @memberof iwc.util.notification
         * @param  {Object} options
         */
        function showBar(url, options, anotherProduct) {
            var $notifyBar = $(selectors.addedNotification),
                isAnotherProduct = anotherProduct ? options.anotherProduct : '',
                productAddedText = options.productAddedText,
                destinationLink = util.helper.removeHtmlExtension(url) + '.html',
                destinationLinkText = options.destinationLinkText,
                updatedTemplate = notifyTemplate
                    .replace('{{anotherProduct}}', isAnotherProduct)
                    .replace('{{productAddedText}}', productAddedText)
                    .replace('{{destinationLink}}', destinationLink)
                    .replace('{{destinationLinkText}}', destinationLinkText);

            if (!$notifyBar.length) {
                $(selectors.main).prepend($(updatedTemplate));
            } else {
                $notifyBar.remove();
                $(selectors.main).prepend($(updatedTemplate).addClass(cssClass.animateBar));
            }

            window.setTimeout(function() {
                $body.addClass(cssClass.notifyBarOpen);
            }, 100);
        }

        /**
         * Event handler for element whose click requires notification
         * @function prepareNotification
         * @private
         * @memberof iwc.util.notification
         * @param  {event} event
         */
        function prepareNotification(event) {
            var $element = $(event.target),
                contentUrl = $element.data('url');
            if (contentUrl) {
                $.get(contentUrl)
                    .then(function(data) {
                        setContent(data);
                        show();
                    });
            }
        }

        /**
         * Event handler for closing the gotobag bar
         * @function closeGotoBagBar
         * @private
         * @memberof iwc.util.notification
         */
        function closeGotoBagBar() {
            $body.removeClass(cssClass.notifyBarOpen);
        }

        /**
         * Init notification box
         * @function init
         * @public
         * @memberof iwc.util.notification
         */
        function init() {
            // selector
            $selectors =  $('[data-notification]');
            //content
            $notificationWrapper = $(selectors.wrapper);
            $notificationContent = $notificationWrapper.find(selectors.content);
            $closeBtn = $notificationWrapper.find(selectors.close);
            notifyTemplate = $(selectors.notifyBar).text();

            // bind events
            $(document).on('click', selectors.closeNotification, closeGotoBagBar);
            $selectors.on(EVENTS, prepareNotification);
            $closeBtn.on(EVENTS, hide);
            $notificationWrapper.on('mouseover', cancelAutoClose);
            $notificationWrapper.on('mouseleave', setAutoClose);

            // close notification on keyboard escape key press
            $(window).on('keyup', function(event) {
                var key = event.charCode || event.keyCode;
                if (key === 27 && $body.hasClass(cssClass.open)) {
                    hide();
                }
            });
        }

        return {
            init: init,
            open: show,
            close: hide,
            content: setContent,
            showBar: showBar
        };
    })(iwc.$, iwc.util);
}());


/*globals iwc*/
(function($) {
    'use strict';

    /**
     * Lazy Load A Single Script File
     * @memberof iwc.util
     * @param {Object} script The script object
     * @param {string} script.url The url of the script to load
     * @param {Function} [script.isLoaded] Optional callback to check whether the script is already available
     * @returns {Promise}
     */
    iwc.util.lazyLoadScript = function(script) {
        var deferred = $.Deferred(),
            scriptTag = document.createElement('script'),
            timeout = 10000;

        // If there is a callback run it to check script availability first
        if ($.isFunction(script.isLoaded) && script.isLoaded()) {
            deferred.resolve();
            return deferred.promise();
        }

        // IE8 load event for script elements
        if (scriptTag.readyState) {
            scriptTag.onreadystatechange = function() {
                if (scriptTag.readyState === 'loaded' || scriptTag.readyState === 'complete') {
                    scriptTag.onreadystatechange = null;
                    deferred.resolve();
                }
            };
        } else {
            scriptTag.onload = function() {
                deferred.resolve();
            };
        }

        scriptTag.src = script.url;
        document.body.appendChild(scriptTag);

        // time out after max. 10 seconds
        window.setTimeout(function() {
            deferred.reject();
        }, timeout);

        return deferred.promise();
    };

    /**
     * Lazy Load Multiple Script Files In Parallel, Maintaining Execution Order As If They Loaded In Series (For Better Performance)
     * @memberof iwc.util
     * @param {Array} scripts Array of 'script' objects (as found on iwc.util.lazyLoadScript)
     * @returns {Promise}
     */
    iwc.util.lazyLoadScriptMulti = function(scripts) {
        var deferred = $.Deferred(),
            timeout = 10000,
            script,
            scriptTag,
            scriptsToLoad = [],
            scriptsToLoadIndex = 0,
            scriptsToLoadLength = 0,
            pendingScripts = [],
            lastScript = document.scripts[document.scripts.length - 1],
            supportsScriptAsync = 'async' in lastScript,
            loadCount = 0;

        /**
         * Get a list of scripts to be loaded that haven't already been loaded.
         * @private
         * @memberOf iwc.util.lazyLoadScriptMulti
         * @param {Array} scripts Array of all the scripts that have been requested to be loaded
         * @returns {Array} Array of all the scripts that have been requested to be loaded that haven't already been loaded
         */
        function getScriptsToLoad(scripts) {
            var scriptsToLoad = [],
                script,
                scriptsIndex = 0,
                scriptsLength = scripts.length;

            for (; scriptsIndex < scriptsLength; scriptsIndex++) {
                script = scripts[scriptsIndex];

                if (!$.isFunction(script.isLoaded) || !script.isLoaded()) {
                    scriptsToLoad.push(script);
                }
            }

            return scriptsToLoad;
        }

        /**
         * Increment the load counter - when all the scripts have loaded, resolve the master promise.
         * @private
         * @memberOf iwc.util.lazyLoadScriptMulti
         */
        function incrementLoadCount() {
            loadCount++;
            if (loadCount === scriptsToLoadLength) {
                deferred.resolve();
            }
        }

        /**
         * Handle script load state in old IE only.
         * @private
         * @memberOf iwc.util.lazyLoadScriptMulti
         */
        function readyStateChange() {
            var pendingScript;
            while (pendingScripts[0] && pendingScripts[0].readyState === 'loaded') {
                pendingScript = pendingScripts.shift();
                pendingScript.onreadystatechange = null;
                // using appendChild() fails in some cases in old IE, so use insertBefore() instead
                lastScript.parentNode.insertBefore(pendingScript, lastScript);
                incrementLoadCount();
            }
        }

        scriptsToLoad = getScriptsToLoad(scripts);
        scriptsToLoadLength = scriptsToLoad.length;

        if (scriptsToLoad.length) {
            for (; scriptsToLoadIndex < scriptsToLoadLength; scriptsToLoadIndex++) {
                script = scriptsToLoad[scriptsToLoadIndex];
                scriptTag = document.createElement('script');
                if (supportsScriptAsync) {
                    scriptTag.async = false;
                    scriptTag.onload = incrementLoadCount;
                    scriptTag.src = script.url;
                    document.head.appendChild(scriptTag);
                } else if (lastScript.readyState) {
                    pendingScripts.push(scriptTag);
                    scriptTag.onreadystatechange = readyStateChange;
                    scriptTag.src = script.url;
                } else {
                    scriptTag.defer = 'defer';
                    scriptTag.onload = incrementLoadCount;
                    scriptTag.src = script.url;
                    document.body.appendChild(scriptTag);
                }
            }

            window.setTimeout(function() {
                deferred.reject();
            }, timeout);

        } else {
            deferred.resolve();
        }

        return deferred.promise();
    };

})(iwc.$);

/*global iwc, videojs, bc, objectFitVideos */

/**
 * @fileOverview Load brighcove and initialise players
 */
(function() {
    'use strict';

    /**
     * videoPlayer utility functions
     * @namespace videoPlayer
     * @memberof iwc.util
     */
    iwc.util.videoPlayer = (function($, util) {

        var $body = $('body'),
            $ytplayers,
            $brtplayers,
            $videoTags,
            $videoImageHolder,
            accountId = $body.data('brightcoveId') || '',
            playerId = $body.data('brightcovePlayer') || '',
            selectors = {
                videoElem: '.iwc-responsive-video-js',
                videoElemOverlay: '.iwc-lightbox-content .iwc-responsive-video-js',
                yt: '.iwc-yt-video',
                brightcove: '.iwc-brt-video',
                figureContainer: '.iwc-figure-container',
                videoWrapper: '.iwc-adaptive-video-util',
                videoImageHolder: '.iwc-video-wrapper',
                imageWrapper: '.iwc-adaptive-image-util',
                player: 'iwc-overlay-video'
            },
            CONST = {
                BRIGHTCOVEJS: '//players.brightcove.net/' + accountId + '/' + playerId + '_default/index.min.js',
                YOUTUBEJS: '/etc/designs/cms-iwc/clientlibs/libs/scripts/external/Youtube.min.js',
                YOUTUBEURL: 'https://www.youtube.com/watch?v=',
                BUFFER: window.innerHeight || 200,
                LIMIT: 20
            },
            cssClass = {
                hide: 'iwc-hidden',
                show: 'iwc-visible',
                available: 'iwc-video-available'
            },
            errorMessage = {
                code: 4 // https://html.spec.whatwg.org/multipage/embedded-content.html#error-codes
            },
            isWide,
            isIOS;

        /**
         * get params for youtube player
         * @function ytParams
         * @param {string} videoSource
         * @private
         * @return {Object}
         * @memberOf iwc.util.videoPlayer
         */
        function ytParams(videoSource) {
            return {
                'techOrder': ['youtube', 'html5'],
                'sources': [{
                    'type': 'video/youtube',
                    'src': CONST.YOUTUBEURL + videoSource
                }],
                //https://developers.google.com/youtube/player_parameters?playerVersion=HTML5#Parameters
                'youtube': {
                    'origin': location.host,
                    'iv_load_policy': 3,
                    'showinfo': 0,
                    'modestbranding': 1,
                    'enablejsapi': 1,
                    'controls': 0,
                    'autoplay': 0,
                    'loop': 1
                }
            };
        }
        /**
         * Display image and hide video
         * @function initVideoFallback
         * @param  {string} elem element id
         * @private
         * @memberOf iwc.util.videoPlayer
         */
        function initVideoFallback(elem) {

            if (!elem || elem === '') {
                return;
            }

            var $elem = $('#' + elem),
                $container = $elem.closest(selectors.figureContainer);

            $container.removeClass(cssClass.available).find(selectors.videoWrapper).addClass(cssClass.hide);
            $container.find(selectors.imageWrapper).removeClass(cssClass.hide).addClass(cssClass.show);
        }
        /**
         * Trigger and display errors in players
         * @funtion errorHandler
         * @param  {Object} player player instance
         * @param  {Object} error  error object
         * @memberOf iwc.util.videoPlayer
         */
        function errorHandler(player, error) {
            if (error && error.data === '') {
                error = errorMessage;
            }
            // trigger error
            player.error(error);
        }
        /**
         * Destroy player and trigger video fallback
         * @function disposeVideosWithError
         * @param  {string} playerId player id
         * @private
         * @memberOf iwc.util.videoPlayer
         */
        function disposeVideosWithError(playerId) {

            var vjsPlayer = videojs.players[playerId];

            // if current src is empty then remove video and show image
            if (vjsPlayer && vjsPlayer.paused()) {
                // initiate video fallback
                initVideoFallback(playerId);

                //dispose and delete reference
                videojs.players[playerId].dispose();
                delete videojs.players[playerId];
            }
        }
        /**
         * Play videos if they are visible to user else pause them
         * @function toggleVideoPlay
         * @param  {HTMLElement} el Video element
         * @param  {Object} currentPlayer videoplayer object associated with the element
         * @memberOf iwc.util.videoPlayer
         */
        function toggleVideoPlay(el, currentPlayer) {

            if (util.elemInViewPort(el, CONST.BUFFER)) {

                if (currentPlayer &&
                    currentPlayer.paused() &&
                    currentPlayer.currentSrc() !== '') {

                    currentPlayer.play();
                }
            } else {
                if (currentPlayer && !currentPlayer.paused()) {
                    currentPlayer.pause();
                }
            }
        }
        /**
         * Play videos which are visible in viewport
         * @function playVideosIfInViewPort
         * @private
         * @memberOf iwc.util.videoPlayer
         */
        function playVideosIfInViewPort() {

            if (!window.videojs || !isWide || isIOS) {
                return;
            }

            Object.keys(videojs.players).forEach(function(key) {
                var el = videojs.players[key].el(),
                    currentPlayer = videojs.players[key];
                toggleVideoPlay(el, currentPlayer);
            });
        }
        /**
         * Setup brightcove players
         * @function setupBrightcovePlayers
         * @private
         * @memberOf iwc.util.videoPlayer
         */
        function setupBrightcovePlayers() {

            $brtplayers = $brtplayers || $(selectors.brightcove);

            $brtplayers.each(function(index, el) {

                videojs(el).ready(function() {
                    var brightcovePlayer = this,
                        playerId = el.getAttribute('data-brightcove-video-id');

                    // load video
                    if (!isIOS && isWide) {

                        if (typeof brightcovePlayer.catalog.getVideo !== 'function') {
                            return;
                        }

                        brightcovePlayer.catalog.getVideo(playerId, function(error, video) {

                            if (error) {
                                disposeVideosWithError(brightcovePlayer.id());
                            } else {
                                brightcovePlayer.catalog.load(video);
                                brightcovePlayer.poster_ = null; //to set poster to null
                                brightcovePlayer.preload();
                                brightcovePlayer.loop(true);
                                brightcovePlayer.muted(true);
                            }
                        });
                    }
                }).on('loadeddata', function(e) {
                    var el = e.target,
                        currentPlayer = videojs.players[el.id];
                    toggleVideoPlay(el, currentPlayer);
                });
            });

            // play videos available in viewport
            if ($ytplayers.length || $brtplayers.length && isWide) {
                playVideosIfInViewPort();
                $(window).on('scroll.videojs', util.debounce(playVideosIfInViewPort, 50));
            }

            // IE polyfill
            objectFitVideos();
        }
        /**
         * Setup Youtube players
         * @function setupYTPlayer
         * @private
         * @memberOf iwc.util.videoPlayer
         */
        function setupYTPlayer() {
            $ytplayers = $ytplayers || $(selectors.yt);
            // load YT/brightcover players
            if (!isIOS && isWide) {
                $ytplayers.each(function(index, el) {

                    var $el = $ytplayers.eq(index),
                        vidSrc = $el.data('videoSrc'),
                        options = ytParams(vidSrc);

                    // INIT
                    videojs(el, options, function() {
                        var ytPlayer = this;
                        ytPlayer.preload();
                        ytPlayer.loop(true);
                        ytPlayer.muted(true);
                        // handle errors
                        ytPlayer.on('error', function() {
                            disposeVideosWithError(ytPlayer.id());
                        });
                    }).on('loadedmetadata', function(e) {
                        var el = e.target,
                            currentPlayer = videojs.players[el.id];
                        toggleVideoPlay(el, currentPlayer);
                    });

                    // If Youtube is unavailable (china wall) even after 10 seconds, initiate fallback
                    window.setTimeout(function() {
                        if (videojs.players[$el[0].playerId].tech_.ytPlayer === undefined) {
                            disposeVideosWithError($el[0].playerId);
                        }
                    }, 10000);
                });
            }
        }
        /**
         * AJAX script loader
         * @function loadScriptAsync
         * @param {string} url url to load
         * @memberOf iwc.util.videoPlayer
         */
        function loadScriptAsync(url) {

            var scriptLoaded = $.ajax({
                url: url,
                dataType: 'script',
                cache: true
            });

            return scriptLoaded;
        }
        /**
         * Load videojs-youtube player API
         * @function loadYtPlayer
         * @memberOf iwc.util.videoPlayer
         */
        function loadYtPlayer() {

            var attemptMade = 0;

            if (videojs && typeof videojs.getTech('Youtube') === 'function') {
                setupYTPlayer();
            } else {

                var ytInterval = window.setInterval(function() {

                    if (typeof videojs.getTech('Youtube') === 'function') {
                        clearInterval(ytInterval);
                        setupYTPlayer();
                    }

                    if (CONST.LIMIT === attemptMade) {
                        clearInterval(ytInterval);
                    } else {
                        ++attemptMade;
                    }
                }, 500);
            }
        }
        /**
         * Setup a new player
         * @function loadNewPlayer
         * @param {jQuery} $videoTag Video HTMLElement
         * @param {jQuery} $requestor Element that requested video
         * @memberOf iwc.util.videoPlayer
         */
        function loadNewPlayer($videoTag, $requestor) {
            var playerType = $requestor.data('video-type'),
                videoId = $requestor.data('video-id');

            if (playerType === 'Youtube') {

                if (!window.YT) {
                    videojs(selectors.player).ready(function() {
                        this.error({
                            code: 2 // Network error
                        });
                    });
                    return;
                }

                var params = ytParams(videoId),
                    overlayParams = {
                        youtube: {
                            'fs': 1,
                            'ytControls': 2 // use youtube/native controls in IOS
                        }
                    };
                // if IOS, show youtube controls
                if (isIOS) {
                    params = $.extend(true, {}, overlayParams, params);
                }

                //instantiate player
                videojs(selectors.player, params, function() {

                    var ytPlayer = this;
                    ytPlayer.preload();
                    ytPlayer.muted(false);

                    // Use Video JS controls in non IOS device
                    if (!isIOS) {
                        ytPlayer.controls(true);
                    }

                    if (isWide && !isIOS) {
                        ytPlayer.play();
                    }
                    // publishing custom event for accessibility tracking.
                    $.publish('iwc:lightbox:videoData:set');
                });

            } else if (playerType === 'Brightcove') {

                // Instantiate brightcove player
                if (window.bc) {
                    bc($videoTag[0]);
                }
                // get instance of player
                videojs(selectors.player).ready(function() {
                    var brightcovePlayer = this,
                        videoId = brightcovePlayer.el().getAttribute('data-brightcove-video-id');

                    // load videos
                    brightcovePlayer.catalog.getVideo(videoId, function(error, video) {

                        if (error) {
                            errorHandler(brightcovePlayer, error);
                        } else {
                            brightcovePlayer.catalog.load(video);
                            brightcovePlayer.controls(true);
                            brightcovePlayer.preload();
                            brightcovePlayer.muted(false);
                            if (isWide && !isIOS) {
                                brightcovePlayer.play();
                            }
                            // publishing custom event for accessibility tracking after videojs DOM gets loaded
                            setTimeout(function() {
                                $.publish('iwc:lightbox:videoData:set');
                            }, 1000);
                        }
                    });
                });
            }
        }
        /**
         * addNewPlayer
         * @param {jQuery} $videoTag Video
         * @param {jQuery} $requestor Element that requested video
         * @memberOf iwc.util.videoPlayer
         */
        function addNewPlayer($videoTag, $requestor) {
            loadNewPlayer($videoTag, $requestor);
        }
        /**
         * reinit videos
         * @function reInit
         * @public
         * @memberOf iwc.util.videoPlayer
         */
        function reInit(obj) {
            $brtplayers = $(obj).find(selectors.brightcove);
            var deferred = $.Deferred();
            loadScriptAsync(CONST.BRIGHTCOVEJS)
                .done(function() {
                    deferred.resolve();
                    if (window.bc) {
                        setupBrightcovePlayers();
                    }
                }).fail(function() {
                deferred.reject();
            });
        }
        /**
         * load images only on wide
         * @function showSpecificImage
         * @private
         * @memberOf iwc.util.videoPlayer
         */
        function showSpecificImage() {
            if (isWide) {
                $videoImageHolder.each(function() {
                    var imgSrc = $(this).attr('data-image');
                    if (typeof imgSrc !== typeof undefined && imgSrc !== false) {
                        $(this).css('background', 'url(' + imgSrc + ')');
                    }
                });
            }
        }
        /**
         * init videos
         * @function init
         * @public
         * @memberOf iwc.util.videoPlayer
         */
        function init() {
            $ytplayers = $ytplayers || $(selectors.yt);
            $brtplayers = $brtplayers || $(selectors.brightcove);
            $videoTags = $(selectors.videoElem).not(selectors.videoElemOverlay);
            $videoImageHolder = $(selectors.videoImageHolder);
            // get breakpoint
            isWide = util.matchmedia.wide.matches || false;
            // get IOS
            isIOS = $body.hasClass('ios') || false;
            showSpecificImage();

            // Load Brightcove players
            setupBrightcovePlayers();

            // load videojs-youtube js
            loadScriptAsync(CONST.YOUTUBEJS)
                .done(loadYtPlayer)
                .fail(function() {
                    $ytplayers.each(function(i, elem) {
                        initVideoFallback(elem.getAttribute('id'));
                    });
                });
        }

        return {
            init: init,
            getPlayer: addNewPlayer,
            reInit: reInit,
            playVisible: playVideosIfInViewPort
        };

    })(iwc.$, iwc.util, window.videojs);
}());

/*global iwc, base*/
/**
 * Forms Animation component js
 */

(function() {
    'use strict';

    /**
     * Forms Animation Util
     * @namespace formsAnimation
     * @memberof iwc.comp
     */
    iwc.util.formsAnimation = (function($, base) {
        var selectors = {
                baseFormElement:    '.base-forms-element',
                baseFormInput:      '.base-forms-input',
                deliveryCountry:    '.base-cods-country-select'
            },
            cssClass = {
                focusedClass: 'input-focused'
            },
            $body = $('body.iwc-body'),
            $form,
            $input,
            $label,
            value;

        /**
         * Apply class on Element based on user action
         * @memberOf iwc.comp.formsAnimation
         * @private
         * @param  {e} event The jQuery object of the element
         */
        function applyAnim(e) {
            var $this = $(e.target);
            value = $this.val();
            if (!$.trim(value) && e.type === 'focus') {
                $this.parents(selectors.baseFormElement).addClass(cssClass.focusedClass);
            } else if (!$.trim(value) && e.type === 'blur') {
                $this.parents(selectors.baseFormElement).removeClass(cssClass.focusedClass);
            } else if ($.trim(value) && e.type === 'change') {
                $this.parents(selectors.baseFormElement).addClass(cssClass.focusedClass);
            }
        }

        /**
         * Apply class on filled element
         * @memberOf iwc.comp.formsAnimation
         * @private
         */
        function resetAnim() {
            $input.each(function() {
                if ($.trim($(this).val())) {
                    $(this).parents(selectors.baseFormElement).addClass(cssClass.focusedClass);
                }
            });
        }
        /**
         * Trigger focus on input on label click
         * @memberOf iwc.comp.formsAnimation
         * @private
         * @param  {e} event jQuery object of the element
         */
        function focusInput(e) {
            var labelID = $(e.target).attr('for');
            $('#' + labelID).trigger('focus');
        }
        /**
         * Bind events
         * @memberOf iwc.comp.formsAnimation
         * @private
         */
        function bindEvents() {
            $input.each(applyAnim);
            $input.on('focus blur change', applyAnim);
            $label.on('click', focusInput);
        }

        /**
         * Map form element if there are multiple Forms on a page
         * @memberOf iwc.comp.formsAnimation
         * @private
         * @param  {$form} event The jQuery object of the element
         */
        function mapDOMElements($form) {
            $input = $form.find(selectors.baseFormInput);
            $label = $form.find(selectors.baseFormInput).prev('label');
            bindEvents();
            resetAnim();
        }

        /**
         * contextual initialise Forms Animation.
         * @memberOf iwc.comp.formsAnimation
         * @private
         * @param  {$obj} Object The jQuery object of the element
         */
        function htmlInit($obj) {
            var $form = $obj.parents('form') || $obj.find('form');
            if ($form.length) {
                mapDOMElements($form);
            }
        }

        /**
         * Initialise a Forms Animation.
         * @memberOf iwc.comp.formsAnimation
         */
        function init($obj) {
            $form = $obj ? $obj.find('form') : $body.find('form');
            if ($form.length) {
                mapDOMElements($form);
            }
            $body.find(selectors.deliveryCountry).on('change', function() {
               // bindEvents();
               console.log("drop change now !")
            })

        }

       $.subscribe(base.util.customEvents.FORMS_SUCCESS, function($response) {
                console.log("base form event");
                htmlInit($response);
            });
        init();

        return {
            init: init,
            reInit: init,
            htmlInit: htmlInit
        };

    })(iwc.$, base);

}());


/*global iwc*/
/**
 * @fileOverview Forms error handler
 */

(function($) {
    'use strict';

    /**
     * form error component
     * @namespace forms
     * @memberof iwc.util
     */
    iwc.util.formError = (function() {

        var $body = $('body'),
            errorCode,
            errMessage;

        /**
         * Parse errors from the error string
         * @memberOf iwc.util.formError
         * @public
         * @function parseErrors
         * @param  {Object} obj error object
         * @return {string} Error message
         */
        function parseErrors(obj) {

            var err = (obj && obj.errorCode) ? (obj.errorCode) : obj;

            if (err.indexOf('CustomerException.code.') !== -1) {
                errorCode = obj.errorCode.replace('CustomerException.code.', '');
            } else if (err === 'validation.email.format') {
                errorCode = 'email';
            } else if (err === 'validation.password.format') {
                errorCode = 'password';
            } else {
                errorCode = 'general';
            }

            errMessage = $body.data('error-code-' + errorCode);

            return errMessage;
        }

        /**
         * Default error message
         * @memberOf iwc.util.formError
         * @public
         * @function getDefaultError
         * @return {string} Error message
         */
        function getDefaultError() {
            return $body.data('error-code-general');
        }

        return {
            get: parseErrors,
            getdefault: getDefaultError
        };
    })();
}(iwc.$));

/* globals iwc, base */

/**
 * Adds Location Map on each element containing on a data attribute 'data-map-type'
 * with value for map type google. This element also requires mandatory
 * data attributes for latitude (data-map-latitude) and longitude(data-map-longitude).
 * E.g.: data-map-type="google" // google
 *       data-map-latitude="11.11"
 *       data-map-longitude="22.22"
 */
iwc.util.mapRenderer = (function($, util) {
    'use strict';

    var selectors = {
            mapInitElement: '[data-map-type]' // Identifier to initialize store map
        },
        latitude,
        longitude,
        mapType,
        markerType,
        useMapMarker,
        map,
        marker;

    /**
     * Render map
     * @memberOf iwc.util.mapRenderer
     * @private
     * @param {Object} $el - current map element
     */
    function renderMap($el) {
        useMapMarker = (markerType === 'iwcMarker') ? util.mapOptions.config.markerIconImage : util.mapOptions.config.defaultMarker;
        if (latitude && longitude && mapType) {

            if (mapType === 'google') {

                base.util.googlemaps.loadGoogleMaps(function() {

                    var latLng = new window.google.maps.LatLng(latitude, longitude),
                        mapOptions = {
                            zoom: 14,
                            center: latLng,
                            scrollwheel: false,
                            mapTypeControl: false,
                            streetViewControl: false,
                            mapTypeId: window.google.maps.MapTypeId.ROADMAP
                        };

                    map = new window.google.maps.Map($el[0], mapOptions);

                    marker = new window.google.maps.Marker({
                        position: latLng,
                        map: map,
                        icon: useMapMarker
                    });

                    map.setOptions({styles: util.mapOptions.config.map.type.defaultStyles});
                });
            } else {
                /* jshint ignore:start */
                /* jscs:disable*/
                var map = new BMap.Map($el[0]);
                var point = new BMap.Point(longitude, latitude);
                var icon = new window.BMap.Icon(useMapMarker, new window.BMap.Size(44, 36));
                var myLatLng = new window.BMap.Point(longitude, latitude);
                var marker = new BMap.Marker(myLatLng, {
                    icon: icon
                });
                map.centerAndZoom(point, 14);
                map.addOverlay(marker);  
                map.enableScrollWheelZoom(false);
                map.setMapStyle({
                    styleJson: util.mapOptions.config.map.type.baiduMapStyles
                });
                /* jscs:enable*/
                /* jshint ignore:end */
            }
        }
    }

    /**
     * Adds Map to each element
     * @memberOf iwc.util.mapRenderer
     * @private
     * @param {number} i - index of the current element
     * @param {HTMLElement} el - current map element
     */
    function addMap (i, el) {
        var $el = $(el);
        latitude = $el.data('mapLatitude'),
        longitude = $el.data('mapLongitude'),
        mapType = $el.data('mapType'),
        markerType = $el.data('mapMarker'),
        renderMap($el);
    }

    /**
     * Adds Map on request
     * @memberOf iwc.util.mapRenderer
     * @public
     * @param {HTMLElement} el - current map element
     * @param {number} lat - latitude
     * @param {number} lng - longitude
     * @param {string} type - map type
     * @param {string} marker - marker type
     */
    function addMapOnRequest(el, lat, lng, type, marker) {
        var $el = $(el);
        latitude = lat || $el.data('mapLatitude'),
        longitude = lng || $el.data('mapLongitude'),
        mapType = type || $el.data('mapType'),
        markerType = marker || $el.data('mapMarker'),
        renderMap($el);
    }

    // map initializer, there could be several in a page
    $(selectors.mapInitElement).each(addMap);

    return {
        addMapOnRequest: addMapOnRequest
    };

})(iwc.$, iwc.util, base);

/*global iwc*/
/**
 * Common utility keep & share data required by multiple components
 * If required fetch data from server
 */

(function() {
    'use strict';

    /**
     * dataStore Util
     * @memberof iwc.comp
     */
    iwc.util.dataStore = (function($, util) {
        var deferredMultisiteJson = $.Deferred(),
            deferredBoutiqueData = $.Deferred(),
            isBoutiqueDataRequested = false,
            currentPagePath = '',
            currentPagePathWithoutSelector = '',
            $body = $('body'),
            commerceEnabled = $body.data('ecommerce-enabled'),
            homeUrl = $body.data('home-page-url'),
            ppcEnabled = $body.data('ppc-enabled');

        /**
         * Make request for multisite JSON
         * @public
         * @memberOf iwc.util.dataStore
         * @return {Deferred} deferred promise
         */
        function getMultisiteJson() {
            if (deferredMultisiteJson.state() !== 'resolved') {
                var pageURL = window.location.href,
                storeURLJson = pageURL.replace('.html', '.multisites.json');

                $.get(storeURLJson, function(data) {
                    deferredMultisiteJson.resolve(data);
                });
            }
            //If promise has already been resolved, it retains the data
            return deferredMultisiteJson.promise();
        }

        /**
         * getCurrentPagePath
         * @public
         * @memberOf iwc.util.dataStore
         * @return {string}
         */
        function getCurrentPagePath() {
            if (currentPagePath === '') {
                currentPagePath = window.location.pathname.split('#')[0].replace('.html', '');
            }
            return currentPagePath;
        }

        /**
         * getCurrentPagePathWithoutSelector
         * @public
         * @memberOf iwc.util.dataStore
         * @return {string}
         */
        function getCurrentPagePathWithoutSelector() {
            if (currentPagePathWithoutSelector === '') {
                currentPagePathWithoutSelector = window.location.pathname.split('#')[0].replace(/\.(.*)html(.*)/, '');
            }
            return currentPagePathWithoutSelector;
        }

        /**
         * Get boutique data
         * @private
         * @memberOf iwc.comp.dataStore
         * @return {Deferred} deferred promise
         */

        function getBoutiqueData() {
            var dataUrl = util.helper.removeHtmlExtension(homeUrl) + '.stores-with-hours.internal-external.json';
            if (!isBoutiqueDataRequested && deferredBoutiqueData.state() !== 'resolved') {
                isBoutiqueDataRequested = true;
                // make call
                $.getJSON(dataUrl).done(function(response) {
                    deferredBoutiqueData.resolve(response);
                }).fail(function() {
                    deferredBoutiqueData.reject();
                });
            }
            return deferredBoutiqueData.promise();
        }

        /**
         * isCommerceEnabled
         * @public
         * @memberOf iwc.util.dataStore
         * @return {Boolean}
         */
        function isCommerceEnabled() {
            return commerceEnabled;
        }

        /**
         * isPpcEnabled
         * @public
         * @memberOf iwc.util.dataStore
         * @return {Boolean}
         */
        function isPpcEnabled() {
            return ppcEnabled;
        }

        return {
            getMultisiteJson: getMultisiteJson,
            getCurrentPagePath: getCurrentPagePath,
            isCommerceEnabled: isCommerceEnabled,
            getBoutiqueData: getBoutiqueData,
            getCurrentPagePathWithoutSelector: getCurrentPagePathWithoutSelector,
            isPpcEnabled: isPpcEnabled
        };
    })(iwc.$, iwc.util);
}());


/*global iwc*/

/*
 * Ajax Loader js
 */

(function() {
    'use strict';

    /**
     * Ajax Loader Util
     * @namespace ajaxloader
     * @memberof iwc.comp
     */
    iwc.util.ajaxloader = (function($) {
        var $body = $('body'),
            $ajaxLoader,
            selectors = {
                ajaxLoader: '.base-ajax-loader'
            },
            cssClass = {
                hide: 'base-hidden'
            };

        /*
         * Hide the ajax loader
         * @function hideLoader
         * @public
         * @memberof iwc.util.ajaxloader
         */
        function hideLoader() {
            $ajaxLoader.addClass(cssClass.hide);
        }

        /*
         * show the ajax loader
         * @function showLoader
         * @public
         * @memberof iwc.util.ajaxloader
         */
        function showLoader() {
            $ajaxLoader.removeClass(cssClass.hide);
        }

        /**
         * Initialise ajax loader
         * @function init
         * @private
         * @memberOf iwc.util.ajaxloader
         */
        function init() {
            $ajaxLoader = $body.find(selectors.ajaxLoader);
        }

        return {
            init: init,
            hide: hideLoader,
            show: showLoader
        };
    })(iwc.$);
}());


/*global iwc*/

(function() {
    'use strict';

    /**
     * Character count utility
     * @namespace charcount
     * @memberof iwc.comp
     */
    iwc.util.charcount = (function($) {
        var $obj,
            $textarea,
            $iwcCharactersCount,
            $target,
            $charatersCountText,
            selectors = {
                textarea: '[data-max-chars]',
                charatersCountText: '.iwc-characters-count',
                charactersCount: '.iwc-characters-count'
            },
            maxChars,
            currentLength;
        /*
         * Counnt charaters on type/copy/paste
         * @function countChar
         * @private
         * @param {Object} e - Event object
         * @memberof iwc.util.charcount
         */
        function countChar(e) {
            $target = $(e.target);
            currentLength = $target.val().length;
            if (currentLength >= maxChars) {
                $target.val($target.val().substr(0, maxChars));
            }
            $target.next($iwcCharactersCount).find($charatersCountText).text(maxChars - $target.val().length);
        }
        /*
         * Update character count on load of lightbox
         * @function updateCharCountOnLoad
         * @private
         * @memberof iwc.util.charcount
         */
        function updateCharCountOnLoad() {
            var printedData = iwc.comp.giftoptions.printedMessage().trim();
            printedData = printedData.length;
            $obj.find($charatersCountText).text(maxChars - printedData);
        }
        /*
         * Map DOM elements within component
         * @function mapDomElements
         * @private
         * @memberof iwc.util.charcount
         */
        function mapDomElements() {
            $textarea = $obj.find(selectors.textarea);
            $iwcCharactersCount = $obj.find(selectors.charactersCount);
            $charatersCountText = $obj.find(selectors.charatersCountText);
        }
        /**
         * Initialise Character count
         * @function init
         * @memberOf iwc.util.charcount
         */
        function init(obj) {
            $obj = $(obj);
            if ($obj.length) {
                mapDomElements();
                $textarea.each(function() {
                    maxChars = $(this).data('maxChars');
                    $(this).on('keyup change blur', countChar);
                });
                updateCharCountOnLoad();
            }
        }

        return {
            init: init
        };

    })(iwc.$);
}());

/*global iwc, JSON*/
/**
 * Wishlist component js
 */

(function() {
    'use strict';

    /**
     * Wishlist Buttons Utility
     * @namespace wishlist
     * @memberof iwc.util
     */
    iwc.util.wishlist = (function($) {

        var $html = $('html'),
            $body = $('body'),
            $wishlistBtns,
            customerDetails,
            appliedWishlistOnPage = false,
            selectors = {
                wishlistBtn: '[data-addtowishlist]',
                altTextSpan: '.iwc-icn-alt',
                legacyCheckout: '.iwc-legacy-checkout'
            },
            cssClass = {
                added: 'iwc-added-to-wishlist',
                selectWishlist: 'iwc-select-wishlist'
            },
            CONST = {
                productId: 'productId',
                wishListName: 'wishListName',
                addtowishlistData: 'addtowishlist'
            },
            legacyCheckout,
            wishListData;
        /**
         * Pass target button properties for actions
         * @function passTarget
         * @private
         * @param {Object} targetButton object with product details
         * @memberof iwc.util.wishlist
         */
        function passTarget(requester) {
            if (requester.pageName === 'addtowishlistform') {
                iwc.comp.addtowishlistform.openWishlitForm(requester);
            }
        }

        /**
         * Update the button text to add or remove
         * @function updateButtonText
         * @private
         * @param {jQuery} $targetBtn button to change text for
         * @param {string} action to check action to perform
         * @memberof iwc.util.wishlist
         */
        function updateButtonText($targetBtn, action) {
            var $altTextSpan;
            if (action === 'addtext') {
                $targetBtn.removeClass(cssClass.added);
            } else {
                $targetBtn.addClass(cssClass.added);
            }
            $altTextSpan = $targetBtn.find(selectors.altTextSpan);
            $altTextSpan = $altTextSpan.length ? $altTextSpan : $targetBtn;
            $altTextSpan.text($targetBtn.data(action));
        }

        /**
         * Unbind and bind with remove from wishlist
         * @function updateButtonState
         * @private
         * @param {jQuery} $targetBtn button to change text for
         * @param {string} action to check action to perform
         * @memberof iwc.util.wishlist
         */
        function updateButtonState($targetBtn, addedWishlistName) {
            var productData = $targetBtn.data('addtowishlist');
            $targetBtn[0].setAttribute
                ('data-addtowishlist', (JSON.stringify({
                    wishListName: addedWishlistName,
                    productId: productData.productId,
                    engravingId: productData.engravingId || '',
                    engravingText: productData.engravingText || ''
                })));
            $targetBtn[0].setAttribute('data-action' ,'iwc-remove-from-wishlist');
            $targetBtn[0].setAttribute('data-selector' ,'.delete-item-wishlist.json');
        }

        /**
         * Make a button added in a wishlist
         * @function markButtonWishlistAdded
         * @public
         * @param {jQuery} $targetBtn button to make changes for
         * @param {string} addedWishlistName wishlist name product added in
         * @memberof iwc.util.wishlist
         */
        function markButtonWishlistAdded($targetBtn, addedWishlistName) {
            updateButtonText($targetBtn, 'removetext');
            $html.addClass(cssClass.selectWishlist);
            updateButtonState($targetBtn, addedWishlistName);

        }

        /**
         * Make a button removed from a wishlist
         * @function markButtonWishlistRemoved
         * @public
         * @param {jQuery} $targetBtn button to make changes for
         * @memberof iwc.util.wishlist
         */
        function markButtonWishlistRemoved($targetBtn) {
            updateButtonText($targetBtn, 'addtext');
            var productData = $targetBtn.data('addtowishlist');
            $targetBtn
                .data('addtowishlist', {
                    wishListName: '',
                    productId: productData.productId,
                    engravingId: productData.engravingId || '',
                    engravingText: productData.engravingText || ''
                })
                .attr('data-action' ,'iwc-add-to-wishlist')
                .attr('data-selector' ,'.add-wishlist.json');
        }

        /**
         * Update status of products with same ID
         * @function updateSimilarProducts
         * @public
         * @param {jQuery} $targetBtn button to find IDs for other buttons
         * @param {string} addedWishlistName if adding a product
         * @memberof iwc.util.wishlist
         */
        function updateSimilarProducts($targetBtn, addedWishlistName) {
            var targetBtnId = $targetBtn.data('addtowishlist').productId;
            for (var i = 0; i < $wishlistBtns.length; i++) {
                var getProductId = $wishlistBtns.eq(i).data('addtowishlist').productId;
                if (getProductId === targetBtnId) {
                    if (addedWishlistName !== 'remove') {
                        markButtonWishlistAdded($wishlistBtns.eq(i), addedWishlistName);
                    } else {
                        markButtonWishlistRemoved($wishlistBtns.eq(i));
                    }
                }
            }
        }

        /**
         * Update data properties which are already added
         * @function filterWishlistBtn
         * @private
         * @param {jQuery} $buttons list of buttons to search in
         * @param {string} wishListName for product name
         * @param {string} pid for product id
         * @memberof iwc.util.wishlist
         */
        function filterWishlistBtn($buttons, wishListName, pid) {
            var $productBtns = $buttons.filter(function(index) {
                return $buttons.eq(index).data(CONST.addtowishlistData).productId === pid;
            });
            $productBtns.each(function(index) {
                //showAddedInWishlist($productBtns.eq(index), wishListName, pid);
                markButtonWishlistAdded($productBtns.eq(index), wishListName);
            });
        }
        /**
         * List object to map already added buttons
         * @function applyWishlistDataOn
         * @private
         * @param {jquery} $buttons list of buttons
         * @memberof iwc.util.wishlist
         */
        function applyWishlistDataOn($buttons) {
            if (legacyCheckout === false) {
                $.each(wishListData , function(i, wishlist) {
                    $html.addClass(cssClass.selectWishlist);
                    $.each(wishlist.entries, function(j, wishlistItem) {
                        filterWishlistBtn($buttons, wishlist.listId, wishlistItem.globalReference);
                    });
                });
            } else {
                $.each(customerDetails.wishlists, function(i, wishlist) {
                    $html.addClass(cssClass.selectWishlist);
                    $.each(wishlist.wishlistItems, function(j, wishlistItem) {
                        filterWishlistBtn($buttons, wishlist.wishListName, wishlistItem.productReference);
                    });
                });
            }
        }

        /**
         * Listen to changes in customer data and updates its copy
         * @function storeWishlistData
         * @private
         * @param {Object} data
         * @memberof iwc.util.wishlist
         */
        function storeWishlistData(data) {
            if (legacyCheckout === true) {
                customerDetails = data.values.customerDetails;
            } else {
                wishListData = data;
            }
            if (appliedWishlistOnPage === false) {
                appliedWishlistOnPage = true;
                applyWishlistDataOn($body.find(selectors.wishlistBtn));
            }
        }

        /**
         * Re-run wishlist logic within a context
         * Currently it must be called after applyWishlistData.
         * Note: Possibly we can handle this dependency automatically.
         * @function reInit
         * @public
         * @param  {jQuery} $context To search buttons within
         * @memberof iwc.util.wishlist
         */
        function reInit($context) {
            var $buttons = $context.find(selectors.wishlistBtn);
            $buttons.each(function(index) {
                markButtonWishlistRemoved($buttons.eq(index));
            });
            applyWishlistDataOn($buttons);
        }

        /**
         * Initialise wishlist buttons
         * @function init
         * @private
         * @memberof iwc.util.wishlist
         */
        function init() {
            legacyCheckout = $body.find(selectors.legacyCheckout).length ? false : true;
            $wishlistBtns =  $body.find(selectors.wishlistBtn);
            $.subscribe('iwc:lightbox:content:set', passTarget);
            $.subscribe('iwc:customer:data:update', storeWishlistData);
            $.subscribe('iwc:eu:wishlist:update', storeWishlistData)
        }

        return {
            init: init,
            reInit: reInit,
            markButtonWishlistAdded: markButtonWishlistAdded,
            markButtonWishlistRemoved: markButtonWishlistRemoved,
            updateSimilarProducts: updateSimilarProducts
        };

    })(iwc.$);
}());

/*global iwc*/
/**
 * Google Analytics Tracking
 */

(function() {
    'use strict';
    /**
     * Tracking Util
     * @namespace tracking
     * @memberof iwc.comp
     */
    iwc.util.tracking = (function($) {

        var dataLayer = window.dataLayer || [],
            CONST = {
                genericTrackingEvent: 'rcms:tracking:genericEvent'
            };

        /**
         * When not using BASE util, pass data direcly to Analytics
         * @function iwcCustomTracking
         * @public
         * @param {Object} data object to push to Analytics
         * @memberof iwc.util.tracking
         */
        function iwcCustomTracking(data) {
            dataLayer.push(data);
            console.log(data);
        }
        /**
         * Publishes the element
         * @function publish
         * @public
         * @param {jQuery} $elem target element
         * @memberof iwc.util.tracking
         */
        function publish($elem) {
            $.publish(CONST.genericTrackingEvent, $elem);
        }
        /*
         * Track element for tracking
         * @function trackElement
         * @private
         * @param  {Object} event object
         * @memberof iwc.util.tracking
         */
        function trackElement(e) {
            e.preventDefault();
            var $target = $(e.currentTarget),
                href = $target.attr('href'),
                target = $target.attr('target');
            publish($target);
            setTimeout(function() {
                window.open(href, (!target ? '_self' : target));
            }, 300);
        }

        return {
            publish: publish,
            iwcCustomTracking: iwcCustomTracking,
            trackElement: trackElement
        };
    })(iwc.$);
}());

/*globals iwc*/
(function($) {
    'use strict';

    iwc.util.lazyLoadImage = (function() {
        var selector = {
                lazyImage: '.iwc-image-lazyload',
                lazyImageSrcData: 'lazy-src',
                lazyImageSrcSetData: 'lazy-srcset'

            },
            buffer = {
                //load images this number of px below scroll bottom
                bottom: 500
            },
            imagesToLazyLoad = [];

        /**
         * imageIsInOrAboveViewPort checks if the given image element is within or above the current viewport
         * @memberof iwc.util.lazyLoadImage
         * @private
         * @param {jQuery} $imageElement image element
         * @return {boolean} true if image is within or above the current viewport, else false
         */
        function imageIsInOrAboveViewPort($imageElement) {
            var imageBoundingRect = $imageElement[0].getBoundingClientRect(),
                // If this method is called before the image is fully loaded, the bounding rectangle reports iself as 0-0-0-0,
                // which we should ignore.
                isBoundsError = imageBoundingRect.left === 0 && imageBoundingRect.top === 0 && imageBoundingRect.right === 0 && imageBoundingRect.bottom === 0,
                isInHorizontalViewPort = !isBoundsError && imageBoundingRect.left <= (window.innerWidth || document.documentElement.clientWidth),
                isInVerticalViewPort = !isBoundsError && imageBoundingRect.top - buffer.bottom <= (window.innerHeight || document.documentElement.clientHeight);

            return (
                isInHorizontalViewPort && isInVerticalViewPort
            );
        }



        /**
         * remove an image from the list of elements that we need to lazy load
         * @memberof iwc.util.lazyLoadImage
         * @private
         * @param {jQuery} $imageElement image element
         */
        function removeImageFromList($imageElement) {
            var index = $.inArray($imageElement, imagesToLazyLoad);
            if (index !== -1) {
                imagesToLazyLoad.splice(index, 1);
            }
        }
        /**
         * set the source of the given image element to the given source
         * @memberof iwc.util.lazyLoadImage
         * @private
         * @param {jQuery} $imageElement image element
         * @param {string} imageSrc image source
         */
        function loadImage($imageElement) {
            $imageElement.attr({
                'srcset': $imageElement.data(selector.lazyImageSrcSetData),
                'src': $imageElement.data(selector.lazyImageSrcData)
            });
            removeImageFromList($imageElement);
        }

        /**
         * check all images that we need to lazy load, if they are in or above the viewport then load them
         * @memberof iwc.util.lazyLoadImage
         * @public
         */
        function checkImages() {
            var $imageElement,
                i = imagesToLazyLoad.length;
            // loop over array backwards so that splice doesn't affect loop
            while (i--) {
                $imageElement = imagesToLazyLoad[i];
                if (imageIsInOrAboveViewPort($imageElement)) {
                    loadImage($imageElement);
                }
            }
        }

        /**
         * init intialize image's lazy load on the page
         * @memberof iwc.util.lazyLoadImage
         * @public
         */
        function init() {
            var $lazyImages = $(selector.lazyImage);
            $lazyImages.each(function(index) {
                imagesToLazyLoad.push($lazyImages.eq(index));
            });

            $.subscribe('scroll', checkImages);
        }

        return {
            init: init,
            checkImages: checkImages
        };

    })();

})(iwc.$);

/*global iwc*/
/**
 * HTML 5 Web storage js
 */

(function() {
    'use strict';

    /**
     * HTML web storage (session)
     * @namespace webstorage
     * @memberof iwc.util
     */
    iwc.util.webstorage = (function() {

        function set(key, value) {
            if (key && value) {
                sessionStorage.setItem(key, value);
            }
        }

        //get value of session storage item
        function get(key) {
            if (key) {
                return sessionStorage.getItem(key);
            }
        }

        //remove value o storage item
        function remove(key) {
            if (key) {
                sessionStorage.removeItem(key);
            }
        }

        // clear all items in storage
        function clear() {
            sessionStorage.clear();
        }

        // show full storage object
        function storage() {
            return sessionStorage;
        }

        return {
            set: set,
            get: get,
            remove: remove,
            clear: clear,
            storage: storage
        };
    })();
}());


/*global iwc*/

/*
 * Configurator Util js
 */

(function() {
    'use strict';

    /**
     * Configurator Util
     * @namespace configurator
     * @memberof iwc.util
     */
    iwc.util.configurator = (function($, dataStore) {

        var $body = $('body'),
            $strapSelector,
            $strapBlockSelector,
            selectors = {
                strapBlockSelector: '.iwc-strap-size',
                strapSelector: 'input[name="iwc-configurator-strap-size"]'
            },
            $target,
            currentPagePath = dataStore.getCurrentPagePathWithoutSelector(),
            defaultSelectedStrap = '';

        /*
         * Update Strap Size
         * @function updateStrapSize
         * @public
         * @memberof iwc.util.configurator
         */
        function updateStrapSize(strapSize, strapRef) {
            var url = currentPagePath + '.update-strap-size.json',
                params = {
                    strapSize: strapSize,
                    newStrapReference: strapRef || ''
                };
            // post form data
            $.post(url, params);
        }

        /**
         * Initialise configurator util
         * @function init
         * @private
         * @memberOf iwc.util.configurator
         */
        function init() {
            $strapBlockSelector = $body.find(selectors.strapBlockSelector);
            $strapSelector = $body.find(selectors.strapSelector);

            if ($strapBlockSelector) {
                defaultSelectedStrap = $($strapBlockSelector).data('selected-starp');
            }

            if ($strapSelector) {
                $strapSelector.on('change', function(event) {
                    $target = $(event.target);
                    updateStrapSize($target.data('strap-size'), $target.data('strap-ref'));
                });
                if (defaultSelectedStrap) {
                    $(selectors.strapSelector + '[data-strap-size="' + defaultSelectedStrap + '"]').attr('checked',true);
                }
            }
        }

        return {
            init: init
        };
    })(iwc.$, iwc.util.dataStore);
}());

/*global iwc*/
/**
 * Helper functions
 */

(function() {
    'use strict';

    /**
     * collection of helper functions
     * @namespace helper
     * @memberof iwc.util
     */
    iwc.util.helper = (function() {

        /**
         * removeHtmlExtension from url
         * @public
         * @param {string} url path
         * @memberOf iwc.util.helper
         * @return {string}
         */
        function removeHtmlExtension(url) {
            var splitPath = url.split('.html');
            return (splitPath.length === 2) ? splitPath[0] : url;
        }

        return {
            removeHtmlExtension: removeHtmlExtension
        };

    })();
}());


/*global iwc*/
/**
 * Get OS information
 */

(function() {
    'use strict';

    /**
     * Operating System Detection Util
     * @namespace osDetect
     * @memberof iwc.util
     */
    iwc.util.osDetect = (function() {
        var ua = window.navigator.userAgent;

        /**
         * Tests if the device is Android
         * @namespace isAndroid
         * @memberof iwc.util.osDetect
         */
        function isAndroid() {
            return /(Android)/g.test(ua);
        }

        /**
         * Tests if the device is iOS
         * @namespace isAndroid
         * @memberof iwc.util.osDetect
         */
        function isiOS() {
            return /(iPad|iPhone|iPod)/g.test(ua);
        }

        return {
            isiOS: isiOS,
            isAndroid: isAndroid
        };

    })();

}());


/*global iwc*/
/*global base*/
/**
 * functionality for the account, validate if user is logged in
 */
(function() {
    'use strict';

    /*
     * account component
     * @memberof iwc.comp
     */
    iwc.comp.account = (function($, util, baseUtil, comp) {

        var $html = $('html'),
            $body = $('body'),
            $window = $(window),
            $accountWrapper,
            $loggedIn,
            $loggedOut,
            $wishlistCount,
            $shoppingBagCount,
            $shoppingBagPrice,
            $navBag,
            $navWishlist,
            $countrySelectorBtn,
            selectors = {
                base: '.iwc-account-menu',
                loggedIn: '.iwc-logged-in',
                loggedOut: '.iwc-logged-out',
                loginLink: '.iwc-link-login',
                loggedInLink: '.iwc-account-menu-logged-in',
                wishlistCount: '.iwc-wishlist-size',
                navBag: '.iwc-link.iwc-icn-bag',
                shoppingBagCount: '.iwc-bag-size',
                shoppingBagPrice: '.iwc-bag-price',
                navWishlist: '.iwc-icn-star',
                miniCartTemplate: '.iwc-minicart-template',
                legacyCheckout: '.iwc-legacy-checkout',
                minicart: '.iwc-minicart-popup',
                countrySelectorBtn: '.iwc-cs-link'
            },
            cssClass = {
                hide: 'iwc-hidden',
                selectWishlist: 'iwc-select-wishlist'
            },
            formUrl,
            wishlistProductCount,
            shoppingBagSize = 0,
            wishListSize = 0,
            loginStatus,
            customerDetails,
            $miniCartTemplate,
            $minicart,
            $deferredCustomerDataJob = new $.Deferred(),
            legacyCheckout;

        /**
         * updateHeader
         * @function updateHeader
         * @private
         * @param {object} data object with user name
         * @memberof iwc.comp.account
         */
        function updateHeader(data) {

            if (data && data.values.customerDetails) {
                var name = data.values.customerDetails.displayName ? data.values.customerDetails.displayName : $body.data('logged-msg');
                $loggedIn.find(selectors.loggedInLink).text(name);
                $loggedIn.removeClass(cssClass.hide);
                $loggedOut.addClass(cssClass.hide);
            }
        }
        /**
         * updateEUHeader for non legacy
         * @function updateEUHeader
         * @private
         * @param {object} data object with user name
         * @memberof iwc.comp.account
         */
        function updateEUHeader(data) {
            if (data) {
                var name = data.displayName ? data.displayName : $body.data('logged-msg');
                $loggedIn.find(selectors.loggedInLink).text(name);
                $loggedIn.removeClass(cssClass.hide);
                $loggedOut.addClass(cssClass.hide);
            }
        }
        /**
         * showError
         * @function showError
         * @private
         * @memberof iwc.comp.account
         */
        function showError() {
            $loggedIn.addClass(cssClass.hide);
            $loggedOut.removeClass(cssClass.hide);

            if (window.location.search.indexOf('emailActivation=true') !== -1) {
                // using generic dom selector instead of the cached jquery variable.
                $('.iwc-link-login').trigger('click');
            }
        }

        function customerDetailsData() {
            if (legacyCheckout === 'false') {
                //for eu fetching cust details
                return comp.minicart.customerDetailsData();

            } else {
                //Method to pull the data out of this component
                return $deferredCustomerDataJob.promise();
            }
        }

        /**
         * Write shopping bag size and price
         * @function showBagData
         * @private
         * @param {Object} data ajax response
         * iwc.comp.account
         */
        function showBagData(data) {
            shoppingBagSize = data.values.customerDetails.shoppingBagSize;
            $shoppingBagCount.text(shoppingBagSize).attr({'data-value': shoppingBagSize});
            $navBag = $navBag ? $navBag : $(selectors.navBag);
            $navBag.attr('title', $navBag.attr('data-title') + ' ' + shoppingBagSize + ' ' + $navBag.attr('data-subtitle'));
            $shoppingBagPrice.text(data.values.customerDetails.shoppingBagPrice);
        }
        /**
         * Write shooping bag size and price for non legacy checkout
         * @function showEUBagData
         * @private
         * @param count and price are fetched form contextHub object
         * iwc.comp.account
         */
        function showEUBagData(data) {
            // update profile info also as base.util.customEvents.PROFILE_UPDATED was not triggering on each page refresh
            var profileData = baseUtil.profileManager.getProfileStoreData();
            profileData.logInStatus !== false ? updateEUHeader(profileData) : showError();
            var cartData = data || baseUtil.cartManager.getCartStoreData(),
                count = 0,
                price = '';
            if (cartData &&
                cartData.entries &&
                cartData.entries.length > 0) {
                count = cartData.entries.length;
                price = cartData.totalFormattedPrice;
            }
            shoppingBagSize = count;
            $shoppingBagCount.text(shoppingBagSize).attr({'data-value': shoppingBagSize});
            $navBag = $navBag ? $navBag : $(selectors.navBag);
            $navBag.attr('title', $navBag.attr('data-title') + ' ' + shoppingBagSize + ' ' + $navBag.attr('data-subtitle'));
            $shoppingBagPrice.text(price);
        }

        /**
         * Write wish list size
         * @function showWishCount
         * @private
         * @param {Object} data ajax response
         * iwc.comp.account
         */
        function showWishCount(data) {
            if (legacyCheckout === 'false') {
                wishListSize = wistListItemsCount(data);
            } else {
                wishListSize = data.values.customerDetails.wishlistSize;
            }
            $wishlistCount.text(wishListSize).attr({'data-value': wishListSize});
            $navWishlist = $navWishlist ? $navWishlist : $(selectors.navWishlist);
            $navWishlist.attr('title', $navWishlist.attr('data-title') + ' ' + wishListSize + ' ' + $navWishlist.attr('data-subtitle'));
            if (wishListSize === 0) {
                $html.removeClass(cssClass.selectWishlist);
            } else {
                $html.addClass(cssClass.selectWishlist);
            }
        }

        /**
         * check Country Selector Cookie for popup
         * @function checkCountrySelectorCookie
         * @private
         * iwc.comp.account
         */
        function checkCountrySelectorCookie(data) {
            $window.one('scroll.cs mousemove.cs', function() {
                if (data.values.showCountrySelectorPopup) {
                    $countrySelectorBtn.eq(0).trigger('click');
                }
                $window.off('scroll.cs mousemove.cs');
            });
        }

        /**
         * Return customer details url
         * @function customerDetailsUrl
         * @private
         * iwc.comp.account
         */
        function customerDetailsUrl() {
            formUrl = iwc.util.dataStore.getCurrentPagePathWithoutSelector() + '.login-details.json?cacheburst=' + new Date().getTime();
            return formUrl;
        }

        /**
         * Makes ajax call to fetch customer details
         * @function fetchCustomerDetails
         * @private
         * @param {Object} callbacks
         * @param {Function} callbacks.onSuccess
         * @param {Function} callbacks.onFail
         * iwc.comp.account
         */
        function fetchCustomerDetails(callbacks) {
            $deferredCustomerDataJob = new $.Deferred();
            // get logged status
            $.get(customerDetailsUrl())
                .done(function(data) {
                    iwc.data.cart = iwc.data.cart || {};
                    iwc.data.cart.configurable = data.values.cartStatus.configurable || false;
                    //Mechanism to pull the data out of the component
                    $deferredCustomerDataJob.resolve(data);

                    callbacks.onSuccess(data);

                    //check for showCountrySelectorPopup
                    checkCountrySelectorCookie(data);

                    //Mechanism to push out the data
                    $.publish('iwc:customer:data:update', [data]);
                })
                .fail(callbacks.onFail);
        }
        /**
         * Bag amount tracking
         * @function trackBagPrice
         * @private
         * @param {int} total bag amount
         * iwc.comp.account
         */
        function trackBagPrice(bagPrice) {
            util.tracking.iwcCustomTracking({
                'cartAmount': bagPrice
            });
        }
        /**
         * Success Handler
         * @function accountSuccess
         * @private
         * @param {string} data ajax response
         * iwc.comp.account
         */
        function accountSuccess(data) {
            if (data) {
                customerDetails = data;
                /* Davinder Kumar ::
                 * data "data.values.customerDetails" will always be available irrespectively
                 */
                wishlistProductCount = data.values.customerDetails.wishlistSize || '';
                loginStatus = data.values.customerDetails.customerId;

                loginStatus !== 0 ? updateHeader(data) : showError();

                showWishCount(data);
                showBagData(data);
                if (util.dataStore.isCommerceEnabled()) {
                    trackBagPrice(data.values.customerDetails.rawShoppingBagPrice);
                }
                // send user details to configurator
                if (window.configurator) {
                    window.configurator.userDetails(data);
                }
            } else {
                showError();
            }
        }

        /**
         * Listen to changes in shopping bag & wishlist
         * @function shoppingBagChanged
         * @private
         * iwc.comp.account
         */
        function customerDetailChanged() {
            fetchCustomerDetails({
                onSuccess: accountSuccess,
                onFail: function() {}
            });
        }

        /**
         * show reset password lightbox
         * @function showResetPassword
         * @private
         * iwc.comp.account
         */
        function showResetPassword() {
            var resetUrl = $body.data('resetUrl');
            iwc.util.lightbox.openUrlInLightbox(resetUrl);
        }

        /**
         * Toggle Shopping popup
         * @memberOf iwc.comp.navigation
         * @param {event} e
         * @private
         */
        function openShoppingBagPopup(e) {
            var $elem =  $(e.currentTarget);
            if ($elem.is(':hover')) {
                var url = $elem.attr('href').replace('.html', '.popup.html');
                util.notification.close();
                $.get(url)
                    .done(function(data) {
                        util.notification.content(data);
                        util.notification.open({
                            variant:'shoppingbag-all'
                        });
                    });
            }
        }

        /**
         * Open Shopping Bag on Non Legacy Checkout
         * @memberOf iwc.comp.account
         * @param {event} e
         * @private
         */
        function openShoppingBagPopupNonLegacy(e) {
            var $elem =  $(e.currentTarget);
            if ($elem.is(':hover')) {
                //$elem.attr('href').replace('.html', '.popup.html');
                util.notification.close();
                var cartData =  baseUtil.cartManager.getCartStoreData(),
                    //miniCartTemplate = $miniCartTemplate.text(),
                    cartString,
                    cartContainer,
                    regEx = new RegExp('(?<=\\(\\s)(.*?)(?=\\s\\))','g');
                if (cartData &&
                cartData.entries &&
                cartData.entries.length > 0) {
                    // if contextHub  has cart entries then update popup
                    var productListItem = $minicart.find('.iwc-notify-list');
                    productListItem.html('');
                    //$miniCartTemplate =
                    $.each(cartData.entries,function(i, obj) {
                        var item = $miniCartTemplate
                                  .replace('{{title}}', obj.title.split('-')[1])
                                  .replace('{{price}}', obj.priceFormatted)
                                  .replace(/{{imgSrc}}/g, obj.thumbnail)
                                  .replace('{{sku}}', obj.sku);
                        productListItem.append(item);
                    });
                    cartContainer = $minicart.find('.iwc-bag-show-all');
                    cartString =  cartContainer.text().replace(regEx , cartData.entries.length);
                    cartContainer.text(cartString);
                    util.notification.content($minicart.html());
                    util.notification.open({
                        variant:'shoppingbag-all'
                    });
                }


            }
        }

        /**
         * Bind event handlers
         * @function eventBinding
         * @private
         * iwc.comp.account
         */
        function eventBinding() {
            // depending upon legacy checkout opening  popup
            if (legacyCheckout === 'false') {
                // eu notification popup
                $accountWrapper.find(selectors.navBag).on('mouseover', openShoppingBagPopupNonLegacy);
                //added listener for eu shopping bag
                $.subscribe('iwc:eu:shoppingbag:changed', showEUBagData);
            } else {
                $accountWrapper.find(selectors.navBag).on('mouseover', openShoppingBagPopup);
                $.subscribe('iwc:shoppingbag:changed', customerDetailChanged);
                $.subscribe('iwc:wishlist:changed', customerDetailChanged);

            }
        }

        /**
         * To fetch wishlist details
         * @function fetchWishlistDetails
         * @private
         * iwc.comp.account
         */
        function fetchWishlistDetails(data) {
            //TODO:Bhupendra updated Header count for wishlist
            wishListSize =  wistListItemsCount(data);
            $wishlistCount.text(wishListSize).attr({'data-value': wishListSize});
            // event for updating wishlist products on page
            $.publish('iwc:eu:wishlist:update' , [data]);
        }

        /**
         * To update wishlist details
         * @function updateWishListCount
         * @private
         * iwc.comp.account
         */
        function updateWishListCount(data) {
            comp.addtowishlistform.getWishListData(function(data) {
                showWishCount(data.wishlists);
            })
        }

        /**
         * To count no of items in all wishlists
         * @function wistListItemsCount
         * @private
         * iwc.comp.account
         */
        function wistListItemsCount(data) {
            var count = 0;
            data.forEach(
                function(val) {
                    if (val.entries) {
                        count += val.entries.length;
                    }
                });
            return count;
        }

        /**
         * Initialize account
         * @function init
         * @public
         * @memberOf iwc.comp.account
        */
        function init() {
            $accountWrapper = $(selectors.base);
            $loggedIn = $body.find(selectors.loggedIn);
            $loggedOut = $body.find(selectors.loggedOut);
            $wishlistCount = $accountWrapper.find(selectors.wishlistCount);
            $shoppingBagCount = $accountWrapper.find(selectors.shoppingBagCount);
            $shoppingBagPrice = $accountWrapper.find(selectors.shoppingBagPrice);
            $navBag = $(selectors.navBag);
            $navWishlist = $(selectors.navWishlist);
            legacyCheckout = $body.find(selectors.legacyCheckout).length ? 'false' : '';
            $countrySelectorBtn = $body.find(selectors.countrySelectorBtn);
            // below  function  loads shopping bag data on each page , checking legacy checkout
            // no need to make ajax call to get user deatils as contextHub already has info
            if (legacyCheckout === 'false') {
                // will be handled by baseUtil.customEvents.CART_UPDATED in minicart.js
                // TODO: to check if page refresh fires base checkout event
                //showEUBagData();
                $minicart = $accountWrapper.find(selectors.minicart);
                $miniCartTemplate = $accountWrapper.find(selectors.miniCartTemplate).text();
            } else {
                fetchCustomerDetails({
                    onSuccess: accountSuccess,
                    onFail: showError
                });
            }
            //wishlist event
            $.subscribe(baseUtil.customEvents.WISHLIST_UPDATED, fetchWishlistDetails);
            $.subscribe('iwc:eu:wishlist:changed', updateWishListCount);

            // is Reset password url
            if (window.location.search.indexOf('resetpassword=true') !== -1) {
                showResetPassword();
            }

            eventBinding();
        }

        init();

        return {
            init: init,
            customerDetailsData: customerDetailsData
        };

    })(iwc.$, iwc.util, base.util, iwc.comp);
}());

/*global iwc*/
/**
 * cart state object for Buying Options on PDP page
 */
(function($) {
    'use strict';

    /**
     * Initialise a cartState object.
     * @memberOf iwc.comp.cartState
     */
    iwc.comp.cartState = (function() {

        var state = {
            count: 0,
            limit: 0,
            accessoryCount: 0,
            accessoryLimit: 0
        };

        /**
         * get
         * get state object
         * @private
         * @memberOf iwc.comp.cartState
         */
        function get() {
            return state;
        }

        /**
         * set
         * set state object
         * @private
         * @memberOf iwc.comp.cartState
         * @param  {object} option
         */
        function set(option) {
            state = $.extend(state, option);
            $.publish('iwc:state:changed', [state]);
        }

        return {
            get: get,
            set: set
        };

    })();
})(iwc.$);

/*global iwc, base*/
/**
 * @fileOverview Provides placeholder functionality for the forms component
 */

(function($, util) {
    'use strict';

    /**
     * forms component
     * @namespace forms
     * @memberof iwc.comp
     */
    iwc.comp.forms = (function() {

        var selectors = {
                formsElementGroup: '.base-forms-element-group',
                formsElementWrapper: '.base-forms-element',
                submitTypeWrapper: '.base-forms-submit-type',
                responseWrapper: '.base-forms-wrapper',
                submitResponse: '.base-forms-response',
                serverErrorElement: '.base-forms-server-side-error',
                fieldErrorElement:'.base-forms-field-error',
                confirmationElement: '.base-forms-confirmation',
                formsElementDatePicker: '.base-forms-datepicker',
                trackingElement: '.rcms_trackingFormSubmission',
                formTooltip: '.base-forms-btn-tooltip',
                aemCaptchaWrapper: '.base-aemcaptcha',
                checkoutLoginBtn: '.checkout-login .auto-test-forms-button-submit[type=submit]'
            },
            cssClass = {
                formsCheckbox: 'base-forms-checkbox',
                error: 'iwc-error',
                baseError: 'base-forms-error',
                hide: 'iwc-hidden',
                show:'iwc-visible'
            },
        $form,
        $responseWrapper,
        formId;

        /**
         * Handler for form error placement
         * @memberOf iwc.comp.forms
         * @private
         * @param  {Object} error Error object
         * @param  {Object} element Current element
         */
        function errorPlacementHandler(error, element) {
            var $elem = $(element);
            if ($elem.hasClass(cssClass.formsCheckbox)) {
                error.insertAfter($elem.parents(selectors.formsElementGroup));
            } else {
                error.insertAfter(element);
            }
            $elem.attr('aria-invalid', 'true');
        }

        /**
         * Handler error highlight on form fields
         * @memberOf iwc.comp.forms
         * @private
         * @param  {Object} error Error object
         * @param  {Object} element Current element
         */
        function highlightHandler(element) {
            var $elem = $(element);
            $elem.addClass(cssClass.baseError);
            $elem.closest(selectors.formsElementWrapper).addClass(cssClass.error);
        }

        /**
         * Handler error unhighlight on form fields
         * @memberOf iwc.comp.forms
         * @private
         * @param  {Object} error Error object
         * @param  {Object} element Current element
         */
        function unhighlightHandler(element) {
            var $elem = $(element);
            $elem.removeClass(cssClass.baseError);
            $elem.closest(selectors.formsElementWrapper).removeClass(cssClass.error);
        }

        /**
         * Form submit success handler
         * @memberOf iwc.comp.forms
         * @private
         * @param  {Object} response ajax response
         */
        function successHandler(response) {
            var resultId = 'result_' + formId,
                data = $(response).find(selectors.submitResponse).html(),
                $aemCaptchaWrapper;
            if (data) {
                data = $.parseJSON(data) || {};
                if (data[resultId].success && data[resultId].redirectPath) {
                    // redirect to url
                    window.location.href = data[resultId].redirectPath;
                } else if (data[resultId].success && data[resultId].successMessage) {
                    // show confirmation message
                    $responseWrapper.find(selectors.confirmationElement).text(data[resultId].successMessage).addClass(cssClass.show);
                    $responseWrapper.find(selectors.serverErrorElement).addClass(cssClass.hide);
                    $form.addClass(cssClass.hide);
                } else {
                    // push the invalid form html if base form wrapper available
                    var $responseData = $(response).find('#' + formId).closest(selectors.responseWrapper);
                    if ($responseData.length > 0) {
                        $responseWrapper.html($responseData.html());
                        init($responseData.html());
                        util.formsAnimation.init();
                        $aemCaptchaWrapper = $responseData.find(selectors.aemCaptchaWrapper);
                        if ($aemCaptchaWrapper.length) {
                            base.comp.captcha.aemCaptcha.init(selectors.aemCaptchaWrapper);
                        }
                    } else {
                        $responseWrapper.html(response);
                    }
                    // show error message if available in response
                    if (data[resultId].errorMsg) {
                        var err = data[resultId].errorMsg;
                        $responseWrapper.find(selectors.serverErrorElement).text(err).removeClass(cssClass.hide);
                        $responseWrapper.find(selectors.confirmationElement).addClass(cssClass.hide);
                    }
                }

                $.publish('base:forms:success', [$responseWrapper.find('form'),data[resultId].success]);
                $.publish('iwc:forms:reinit', [$responseWrapper.find('form'),data[resultId].success]);
                $.publish('rcms:tracking:formSubmitEvent', [$responseWrapper.find(selectors.trackingElement)]);
            }
        }

        /**
         * Form submit error handler
         * @memberOf iwc.comp.forms
         * @private
         */
        function errorHandler() {
            $responseWrapper.find(selectors.serverErrorElement).text(iwc.util.formError.getdefault());
        }

        /**
         * Ajax Started function
         * @memberOf iwc.comp.forms
         * @private
         */
        function ajaxStarted() {
            util.ajaxloader.show();
        }

        /**
         * Ajax Started function
         * @memberOf iwc.comp.forms
         * @private
         */
        function ajaxCompleted() {
            util.ajaxloader.hide();
        }

        /**
         * Submit Form Handler
         * @memberOf iwc.comp.forms
         * @private
         * @param  {Object} form Form element
         */
        function submitHandler(form) {
            $form = $(form);
            $responseWrapper = $form.closest(selectors.responseWrapper);
            formId = form.id;
            if (($form.find(selectors.submitTypeWrapper).data('submitType') === 'ajaxCall') && ($form.find(selectors.submitTypeWrapper).data('baseSubmit') !== 'disabled')) {
                $.ajax({
                    url: form.action,
                    type: form.method,
                    global: false,
                    beforeSend: ajaxStarted,
                    complete : ajaxCompleted,
                    data: $form.serialize(),
                    success: successHandler,
                    error: errorHandler
                });
                return false;
            } else {
                return true;
            }
        }


        /**
         * Validate Form
         * @memberOf iwc.comp.forms
         * @private
         * @param  {Object} $form The jQuery object of the component
         */
        function validateForm($forms) {
            // Pattern validation and message
            $.validator.addMethod('cPattern', function(value, element) {
                var regexp = new RegExp($(element).data('paramCstPattern'));
                return regexp.test(value);
            }, function(value, element) {
                return $(element).data('msgCstPattern');
            });

            // Required field validation and message
            $.validator.addMethod('cRequired', $.validator.methods.required, function(value, element) {
                return $(element).data('msgCstRequired');
            });

            // Minlength validation and message
            $.validator.addMethod('cMinlength', function(value, element) {
                return value.length >= $(element).attr('minlength');
            }, function(value, element) {
                return $(element).data('msgCstMinlength');
            });

            // Max validation and message
            $.validator.addMethod('cMaxlength', function(value, element) {
                return value.length <= $(element).attr('maxlength');
            }, function(value, element) {
                return $(element).data('msgCstMaxlength');
            });

            // Confirm field validation and message
            $.validator.addMethod('confirm', function(value, element) {
                var elementId = $(element).data('confirm');
                return $('#' + elementId).val() === value;
            }, function(value, element) {
                return $(element).data('msgConfirm');
            });

            // Radio true Validator
            $.validator.addMethod('cRadioTrue', function(value) {
                return value === 'true';
            }, function(value, element) {
                return $(element).data('msgIwcRadiobuttonValueAsTrueConstraint');
            });

            $.validator.addClassRules({
                'base-forms-textarea': {
                    normalizer: function(value) {
                        return $.trim(value);
                    }
                },
                'base-forms-input': {
                    normalizer: function(value) {
                        return $.trim(value);
                    }
                },
                'cst-required': {
                    cRequired: true
                },
                'cst-pattern': {
                    cPattern: true
                },
                'cst-number': {
                    number: true
                },
                'cst-maxlength' : {
                    cMaxlength: true
                },
                'cst-minlength' : {
                    cMinlength: true
                },
                'cst-confirm' : {
                    confirm: true
                },
                'iwc-radiobutton-value-as-true-constraint' : {
                    cRadioTrue: true
                }
            });

            // Validate the selected form using jquery validate
            $forms.validate({
                debug: false,
                focusInvalid: true,
                errorClass: 'base-forms-error',
                errorElement: 'span',
                errorPlacement: errorPlacementHandler,
                highlight: highlightHandler,
                unhighlight: unhighlightHandler,
                submitHandler: submitHandler
            });
        }

        /**
         * Initialise a forms element.
         * @memberOf iwc.comp.forms
         * @public
         */
        function init(obj) {
            var $forms = $(obj).is('form') ? $(obj) : $(obj).find('form');
            $forms.attr('autocomplete', 'off');
            // Datepicker form field
            $forms.find(selectors.formsElementDatePicker).datepicker({
                minDate: 2,
                onClose: function() {
                    $(this).valid();
                }
            });

            // Form fields ToolTip
            $forms.find(selectors.formTooltip).tooltip({
                position: {
                    my: 'left center',
                    at: 'right center',
                    collision: 'none'
                },
                classes: {
                    'ui-tooltip': 'base-forms-tooltip-text'
                }
            });

            // validate form
            validateForm($forms);
            // showing loader on checkout login buttons
            $(selectors.checkoutLoginBtn).on('click', function(e) {
                if ($(this.form).valid()) {
                    util.ajaxloader.show();
                }
            })

        }

        return {
            init: init
        };
    })();
}(iwc.$, iwc.util, base));

/*global iwc*/
/**
 * functionality for generic tabs component
 */

(function() {
    'use strict';

    /*
     * Tabs component
     * @namespace tabs
     * @memberof iwc.comp
     */
    iwc.comp.tabs = (function($, util) {

        var $component,
            selectors = {
                tabsLink: '.iwc-tabs-link',
                tabContent: '.iwc-tabs-content',
                tabItem: '.iwc-tabs-item',
                subCopyItem: '.iwc-tabs-subcopy-item',
                errorWrapper: '.iwc-error'
            },
            cssClass = {
                hidden: 'iwc-hidden',
                selected: 'iwc-selected',
                expanded: 'iwc-expanded'
            },
            $tabItem,
            $subCopyItem,
            $tabContent,
            currentTab,
            loadedTabs = [];

        /**
         * Set Content
         * @function setContent
         * @private
         * @param {Object} data object
         * @memberOf iwc.comp.tabs
         */
        function setContent(data) {
            $component.find('[data-tab-id="' + currentTab + '"]').html(data);
            util.ajaxloader.hide();
        }

        /**
         * Error handler
         * @function errorHandler
         * @private
         * @param {Object} error object
         * @memberOf iwc.comp.tabs
         */
        function errorHandler(error) {
            $component.find(selectors.errorWrapper).removeClass(cssClass.hidden).text(error.statusText);
            util.ajaxloader.hide();
        }

        /**
         * Get Data
         * @function getData
         * @private
         * @param {Object} settings object
         * @memberOf iwc.comp.tabs
         */
        function getData(settings) {
            $.ajax(settings).done(setContent).fail(errorHandler);
        }

        /**
         * Set Data
         * @function setData
         * @public
         * @param {Object} e - Event object
         * @memberOf iwc.comp.tabs
         */
        function setData(e) {
            e.preventDefault();
            var $currentTarget = $(e.currentTarget),
                url = $currentTarget.data('url');
            currentTab = $currentTarget.data('tab');
            $tabItem.removeClass(cssClass.selected).attr({'aria-selected': 'false'});
            $currentTarget.parent(selectors.tabItem).addClass(cssClass.selected).attr({'aria-selected': 'true'});
            $tabContent.removeClass(cssClass.expanded).attr({'aria-hidden': 'true'});
            $component.find('[data-tab-id="' + currentTab + '"]').addClass(cssClass.expanded).attr({'aria-hidden': 'false'});

            if (util.matchmedia.narrow.matches) {
                $subCopyItem.removeClass(cssClass.selected);
                $component.find('[data-subcopy-id="' + currentTab + '"]').addClass(cssClass.selected);
            }

            if (($.inArray(currentTab, loadedTabs)) === -1) {
                util.ajaxloader.show();
                loadedTabs.push(currentTab);
                getData({
                    url: url,
                    type: 'GET'
                });
            }
        }

        /**
         * Bind Events
         * @function bindEvents
         * @private
         * @memberOf iwc.comp.tabs
         */
        function bindEvents() {
            $component.find(selectors.tabsLink).on('click', setData);
        }

        /**
         * initialise component
         * @function init
         * @public
         * @param {HTMLElement} elem HTML element
         * @memberOf iwc.comp.tabs
         */
        function init(elem) {
            $component = $(elem);
            $tabItem = $component.find(selectors.tabItem);
            $subCopyItem = $component.find(selectors.subCopyItem);
            $tabContent = $component.find(selectors.tabContent);
            bindEvents();
            loadedTabs.push($component.find(selectors.tabsLink).data('tab'));
        }

        return {
            init: init
        };

    })(iwc.$, iwc.util);
}());

/*global iwc, JSON*/
/**
 * navigation component js
 */

(function() {
    'use strict';

    /**
     * Navigation component
     * @memberof iwc.comp
     */
    iwc.comp.navigation = (function($, util) {

        var $body = $('body'),
            $window = $(window),
            $nav,
            $header,
            $wrapper,
            $currencyFlag,
            $currencySymbol,
            $miniPpc,
            accountMenuOpen = false,
            generalMenuOpen = false,
            currentTarget = '',
            currencyLsData,
            selectors = {
                menuBtn: '.iwc-main-navigation-btn',
                navList: '.iwc-main-navigation-list',
                header: '.iwc-header',
                accountLink: '.iwc-logged-in',
                menu: '[data-menu=menu]',
                watchMenu: '[data-menu=watches]',
                megaMenu: '[data-menu=iwc-mega-menu]',
                watchMegaMenu: '[data-menu=iwc-mega-menu-watches]',
                accountMenu: '.iwc-account-drop-menu',
                accountMenuBtn: '.iwc-account-menu-btn',
                navlistItem: '.iwc-main-navigation-list-item-link',
                countrySelectorLink: '.iwc-cs-link',
                watchMenuList: '.iwc-watch-menu-list',
                watchMenuLink: '.iwc-watch-menu-link',
                menuWrapper: '.iwc-menu-nav-wrapper',
                veil: '.iwc-menu-nav-veil',
                watchFinder: '.iwc-watchfinder',
                conciergeSelect: '.iwc-contact-concierge-country',
                leftSection: '.iwc-navigation-left-section',
                navigationLink: '.iwc-navigation-link',
                socialIconsLink: '.iwc-social-icons-link',
                currencyFlag: '.iwc-language-country-flag',
                currencySymbol: '.iwc-language-currency-code',
                miniPpc: '.iwc-mini-ppc'
            },
            cssClass = {
                hide: 'iwc-menu-nav-hide',
                active: 'active ',
                mobileMenuOpen: 'iwc-mobile-menu-open',
                csOverlayActive: 'iwc-cs-overlay-active',
                headerActive: 'iwc-header-active',
                watchFilterMenu: 'iwc-finder-showfilters',
                hidden: 'iwc-hidden'
            },
            CONST = {
                watches: 'watches',
                flagImgPath: '/content/dam/iwc-assets/icons/flags/'
            },
            conciergeSelectOpened = false,
            menuHeight = 0,
            firstTabItem = '',
            lastTabItem = '';

        /**
         * Close Menu
         * @memberOf iwc.comp.navigation
         * @private
         */
        function closeMenu() {
            if (generalMenuOpen) {
                $(selectors.megaMenu + ',' + selectors.watchMegaMenu).addClass(cssClass.hide);
                $(selectors.menu + ',' + selectors.watchMenu).removeClass(cssClass.active);
                $header.removeClass(cssClass.headerActive);
                $.publish('iwc:navigationClosed');
                currentTarget = '';
                generalMenuOpen = false;
            }
        }

        /**
         * Close Menu on scroll of page.
         * @memberOf iwc.comp.navigation
         * @private
         */
        function closeMenuOnScroll() {
            if ($window.scrollTop() > menuHeight && generalMenuOpen) {
                closeMenu();
            }
        }
        /**
         * Toggle Account Menu
         * @memberOf iwc.comp.navigation
         * @private
         */
        function openAccountMenu() {
            util.notification.close();
            $(selectors.accountMenu).removeClass(cssClass.hide);
            accountMenuOpen = true;
            $body.trigger('account-menu-closed');
            closeMenu();
        }
        /**
         * Close Account Menu
         * @memberOf iwc.comp.navigation
         * @private
         */
        function closeAccountMenu() {
            if (accountMenuOpen) {
                $(selectors.accountMenu).addClass(cssClass.hide);
                accountMenuOpen = false;
            }
        }
        /**
         * Toggle Moble Account Menu
         * @memberOf iwc.comp.navigation
         * @private
         */
        function toggleMobileAccountMenu() {
            $(selectors.accountMenuBtn).toggleClass(cssClass.active);

            $body.toggleClass(cssClass.mobileMenuOpen);

            var $menuButton = $(selectors.menuBtn);

            if ($menuButton.hasClass(cssClass.active)) {
                $menuButton.removeClass(cssClass.active);
                $body.removeClass(cssClass.mobileMenuOpen);
            }

            $nav.find(selectors.watchMegaMenu).addClass(cssClass.hide);
            $nav.find($menuButton).removeClass(cssClass.active);

            $(selectors.megaMenu).addClass(cssClass.hide);
            $(selectors.accountMenu).toggleClass(cssClass.hide);
        }

        /**
         * open country selector ovelay
         * on click of country selector link
         * available in navigation footer
         * @memberOf iwc.comp.navigation
         * @private
         */
        function showCountrySelectorOverlay() {
            $(selectors.megaMenu).addClass(cssClass.hide);
            $nav.find(selectors.menu).removeClass(cssClass.active);
            $body.addClass(cssClass.csOverlayActive);
            $header.removeClass(cssClass.headerActive);
        }

        /**
         * Close country selector ovelay
         * @memberOf iwc.comp.navigation
         * @private
         */
        function closeCountrySelectorOverlay() {
            $body.removeClass(cssClass.csOverlayActive);
        }

        /**
         * function to init watch menu slider
         * for mobile view only
         * @memberOf iwc.comp.navigation
         * @private
         */
        function initWatchSlider() {
            $(selectors.watchMenuList).slick({
                speed: 300,
                slidesToShow: 1,
                slidesToScroll: 1,
                centerMode: true,
                variableWidth: true,
                arrows: false
            });
        }

        /**
         * Toggle Menu
         * @memberOf iwc.comp.navigation
         * @private
         * @param  {string} target the menu data value of clicked link
         */
        function toggleMenus(target, userEvent) {
            if (target === CONST.watches) {
                if (userEvent === 'hover') {
                    $(selectors.watchMegaMenu).removeClass(cssClass.hide);
                    $nav.find(selectors.watchMenu).addClass(cssClass.active).attr('aria-expanded', 'true');
                    $header.addClass(cssClass.headerActive);
                } else {
                    $(selectors.watchMegaMenu).toggleClass(cssClass.hide);
                    $nav.find(selectors.watchMenu).toggleClass(cssClass.active);
                    $header.removeClass(cssClass.headerActive);

                    // toggling aria-expanded for watch menu.
                    if ($nav.find(selectors.watchMenu).attr('aria-expanded') === 'false') {
                        $nav.find(selectors.watchMenu).attr('aria-expanded', 'true');
                    } else {
                        $nav.find(selectors.watchMenu).attr('aria-expanded', 'false');
                    }

                    // setting focus to the first item in the expanded mega-watch menu.
                    if (!$(selectors.watchMegaMenu).hasClass(cssClass.hide)) {
                        $(selectors.navList).find(selectors.menu).attr('tabindex', -1);
                        $(selectors.watchMegaMenu).find(selectors.watchMenuLink).first().focus();

                        // setting cyclic tabbing when watch menu opens
                        firstTabItem = $(selectors.watchMenu);
                        lastTabItem = $(selectors.watchMegaMenu).find('.iwc-link').last();

                        if (firstTabItem && lastTabItem) {
                            util.lightbox.circularTabbing(firstTabItem, lastTabItem);
                        }
                    } else {
                        $(selectors.watchMenu).unbind('keydown');
                        $(selectors.navList).find(selectors.menu).attr('tabIndex', 0);
                        $nav.find(selectors.watchMenu).focus();
                    }
                }
                $(selectors.megaMenu).addClass(cssClass.hide);
                $nav.find(selectors.menu).removeClass(cssClass.active).attr('aria-expanded', 'false');

            } else {
                if (userEvent === 'hover') {
                    $(selectors.megaMenu).removeClass(cssClass.hide);
                    $nav.find(selectors.menu).addClass(cssClass.active).attr('aria-expanded', 'true');
                    $header.addClass(cssClass.headerActive);
                } else {
                    $(selectors.megaMenu).toggleClass(cssClass.hide);
                    $nav.find(selectors.menu).toggleClass(cssClass.active);
                    $header.removeClass(cssClass.headerActive);

                    //toggling aria-expanded for main menu.
                    if ($nav.find(selectors.menu).attr('aria-expanded') === 'false') {
                        $nav.find(selectors.menu).attr('aria-expanded', 'true');
                    } else {
                        $nav.find(selectors.menu).attr('aria-expanded', 'false');
                    }

                    // setting focus to the first item in the expanded mega menu.
                    if (!$(selectors.megaMenu).hasClass(cssClass.hide)) {
                        $(selectors.navList).find(selectors.watchMenu).attr('tabindex', -1);
                        $(selectors.megaMenu).find(selectors.navigationLink).first().focus();

                        // setting cyclic tabbing when mega menu opens
                        firstTabItem = $(selectors.menu);
                        lastTabItem = $(selectors.megaMenu).find(selectors.socialIconsLink).last();

                        if (firstTabItem && lastTabItem) {
                            util.lightbox.circularTabbing(firstTabItem, lastTabItem);
                        }
                    } else {
                        $(selectors.menu).unbind('keydown');
                        $(selectors.navList).find(selectors.watchMenu).attr('tabIndex', 0);
                        $nav.find(selectors.menu).focus();
                    }
                }
                $(selectors.watchMegaMenu).addClass(cssClass.hide);
                $nav.find(selectors.watchMenu).removeClass(cssClass.active).attr('aria-expanded', 'false');
            }

            if (currentTarget === target) {
                $.publish('iwc:navigationClosed');
                currentTarget = '';
                generalMenuOpen = false;
            } else {
                $.publish('iwc:navigationOpen');
                currentTarget = target;
                generalMenuOpen = true;
            }
        }

        /**
         * bindEvents
         * @memberOf iwc.comp.navigation
         * @private
         * @param  {Object} $nav The jQuery object of the component
         */
        function bindEvents($nav) {
            $nav.find(selectors.navList).find(selectors.navlistItem).on('click', function(event) {
                event.preventDefault();
                toggleMenus($(event.currentTarget).data('menu'));
            });

            $nav.find(selectors.navList).find(selectors.navlistItem).on('mouseover', function(event) {
                event.preventDefault();
                toggleMenus($(event.currentTarget).data('menu'), 'hover');
            });

            $(selectors.watchMenuList).on('click', selectors.watchMenuLink, function() {
                toggleMenus(CONST.watches);
            });

            $wrapper.on('mouseenter', function(event) {
                event.preventDefault();
                $(event.currentTarget).removeClass(cssClass.hide);
                $header.addClass(cssClass.headerActive);
                if ($(event.currentTarget).data('menu') === 'iwc-mega-menu') {
                    $nav.find(selectors.menu).addClass(cssClass.active);
                    $nav.find(selectors.menu).attr('aria-expanded', 'true');
                } else {
                    $nav.find(selectors.watchMenu).addClass(cssClass.active);
                    $nav.find(selectors.watchMenu).attr('aria-expanded', 'true');
                }
            });

            $nav.find(selectors.conciergeSelect).click(function(event) {
                conciergeSelectOpened = !conciergeSelectOpened;
                event.stopPropagation();
            });

            $wrapper.on('mouseleave', function(event) {
                event.preventDefault();
                if (!conciergeSelectOpened) {
                    $(event.currentTarget).addClass(cssClass.hide);
                    $header.removeClass(cssClass.headerActive);
                    $nav.find(selectors.menu).removeClass(cssClass.active);
                    $nav.find(selectors.watchMenu).removeClass(cssClass.active);
                    $nav.find(selectors.menu).attr('aria-expanded', 'false');
                    $nav.find(selectors.watchMenu).attr('aria-expanded', 'false');
                }
            });

            $(selectors.accountLink).on('mouseover', openAccountMenu);
            $.subscribe('iwc:lightbox:close', closeCountrySelectorOverlay);
            $.subscribe('iwc:notification:open', closeAccountMenu);
            $.subscribe('iwc:navigationOpen', closeAccountMenu);
            $(selectors.accountLink).on('click',function() {
                if ($(selectors.accountMenu).hasClass(cssClass.hide)) {
                    closeMenu();
                    openAccountMenu();
                } else {
                    closeAccountMenu();
                }
            });
        }
        /**
         * Bind events
         * @memberOf iwc.comp.navigation
         * @private
         * @param  {Object} $nav The jQuery object of the component
         */
        function mobileBindEvents($nav) {
            $nav.on('click', selectors.menuBtn, function(e) {
                $(e.currentTarget).toggleClass(cssClass.active);
                if ($(e.currentTarget).hasClass(cssClass.active)) {
                    $body.addClass(cssClass.mobileMenuOpen);
                } else {
                    $body.removeClass(cssClass.mobileMenuOpen);
                }
                if ($(selectors.watchFinder)) {
                    $(selectors.watchFinder).removeClass(cssClass.watchFilterMenu);
                }

                if ($body.hasClass(cssClass.mobileMenuOpen)) {
                    $.publish('iwc:navigationOpen');
                } else {
                    $.publish('iwc:navigationClosed');
                }

                if (!$(selectors.accountMenu).hasClass(cssClass.hide)) {
                    $(selectors.accountMenu).addClass(cssClass.hide);
                    $(selectors.megaMenu).removeClass(cssClass.hide);
                    $(selectors.accountMenuBtn).removeClass(cssClass.active);

                } else if (!$(selectors.watchMegaMenu).hasClass(cssClass.hide)) {
                    $nav.find(selectors.watchMegaMenu).toggleClass(cssClass.hide);

                } else {
                    $(selectors.megaMenu).toggleClass(cssClass.hide);
                }
            });

            //handling of watch menu in mobile view
            $nav.on('click', selectors.watchMenu, function() {
                $nav.find(selectors.watchMegaMenu).toggleClass(cssClass.hide);
                $nav.find(selectors.megaMenu).addClass(cssClass.hide);
            });

            $(selectors.watchMenuList).on('click', selectors.watchMenuLink, function() {
                $nav.find(selectors.watchMegaMenu).addClass(cssClass.hide);
                $nav.find(selectors.menuBtn).removeClass(cssClass.active);
                $.publish('iwc:navigationClosed');
            });

            $.subscribe('iwc:lightbox:close', closeCountrySelectorOverlay);

        }
        /**
         * getHeight
         * @return {number} height of the component
         */
        function getHeight() {
            return $nav.height();
        }

        function checkAccountMenu() {
            if (accountMenuOpen) {
                $header.on('mouseleave', closeAccountMenu);
            }
        }
        /**
         * Initialise a navigation element.
         * @memberOf iwc.comp.navigation
         * @public
         * @param  {HTMLElement} element
         */
        function init(elem) {
            $nav = $(elem);
            $header = $(selectors.header);
            $wrapper = $nav.find(selectors.menuWrapper);
            $currencyFlag = $body.find(selectors.currencyFlag);
            $currencySymbol = $body.find(selectors.currencySymbol);
            $miniPpc = $body.find(selectors.miniPpc);
            var leftSection = $nav.find(selectors.leftSection).height(),
                watchSection = $nav.find(selectors.watchMenuList).height(),
                countryCode,
                currencySymbol;

            if (util.matchmedia.narrow.matches) {
                initWatchSlider();
                $(selectors.accountMenuBtn).on('click', toggleMobileAccountMenu);
                // bind events
                mobileBindEvents($nav);
            } else {
                menuHeight = (leftSection > watchSection ? leftSection : watchSection);
                bindEvents($nav);
                $wrapper.css('max-height', menuHeight + 300);
                $.subscribe('animated:scroll', closeMenuOnScroll);
            }
            $(selectors.veil).on('click', closeMenu);
            $(selectors.countrySelectorLink).on('click', showCountrySelectorOverlay);
            $body.on('account-menu-closed', checkAccountMenu);


            // Dynamically changing the path of flag image and currency symbol from localstorage if ppc is enabled and ecom is disabled.
            if (util.dataStore.isPpcEnabled() && !util.dataStore.isCommerceEnabled()) {
                currencyLsData = JSON.parse(localStorage.getItem('ccData'));
                if (currencyLsData && currencyLsData !== null && currencyLsData !== undefined) {
                    countryCode = currencyLsData.countryCode;
                    currencySymbol = currencyLsData.currencySymbol;
                }
                if (countryCode !== '' && countryCode !== undefined) {
                    $currencyFlag.attr('src', CONST.flagImgPath + countryCode.toLowerCase() + '.svg');
                }
                if (currencySymbol !== '' && currencySymbol !== undefined) {
                    $currencySymbol.html(currencySymbol);
                }
            }
            // remove hidden class from miniPpc container
            if ($miniPpc.length) {
                setTimeout(function() { $miniPpc.removeClass(cssClass.hidden); }, 1000);
            }
        }

        return {
            init: init,
            getHeight: getHeight
        };
    })(iwc.$, iwc.util);
}());

/*global iwc*/
/**
 * Newsletters component
 */

(function() {
    'use strict';

    /**
     * Newsletters component
     * @namespace newsletters
     * @memberof iwc.comp
     */
    iwc.comp.newsletters = (function($, util) {

        var selectors = {
            newslettersCheckbox: '.iwc-newsletters-checkbox',
            errorWrapper: '.iwc-error'
        },
        $newsletters,
        $newslettersCheckbox,
        formUrl = iwc.util.dataStore.getCurrentPagePath() + '.newsletter.json?cacheburst=' + new Date().getTime();

        /**
         * show error
         * @function onPageLoad
         * @private
         * @param {string} errorText ajax response
         * @memberOf iwc.comp.newsletters
        */
        function showError(errorText) {
            $newsletters.find(selectors.errorWrapper).text(errorText);
        }

        /**
         * On newsletters checkbox click
         * @function onNewslettersCheckboxClick
         * @private
         * @param {Object} e event
         * @memberOf iwc.comp.newsletters
        */
        function onNewslettersCheckboxClick(e) {
            var isChecked = false;

            if ($(e.currentTarget).is(':checked')) {
                isChecked = true;
            }

            // make call
            $.ajax({
                url: formUrl,
                type: 'POST',
                data: {
                    newsletter: isChecked
                }
            })
            .done(function(response) {
                if (response.status.toLowerCase() === 'success') {
                    $newsletters.find(selectors.errorWrapper).empty();
                    if (isChecked === true) {
                        util.tracking.iwcCustomTracking({'event': 'newsletterSubscription', 'newsletter': 'subscription'});
                    } else {
                        util.tracking.iwcCustomTracking({'event': 'newsletterSubscription', 'newsletter': 'unsubscription'});
                    }
                } else {
                    showError(response.values.errorMessage);
                }
            })
            .fail(function(jqXHR, textStatus, errorText) {
                showError(errorText);
            });
        }

        /**
         * Bind events
         * @function bindEvents
         * @private
         * @memberOf iwc.comp.newsletters
        */
        function bindEvents() {
            $newslettersCheckbox.on('click', onNewslettersCheckboxClick);
        }

        /**
         * initialise newsletters component
         * @function init
         * @public
         * @param {HTMLElement} element
         * @memberOf iwc.comp.newsletters
         */
        function init(elem) {
            $newsletters = $(elem);
            $newslettersCheckbox = $newsletters.find(selectors.newslettersCheckbox);
            bindEvents();
        }

        return {
            init: init
        };
    })(iwc.$, iwc.util);
}());

/*global iwc*/
/**
 * Product component js
 */

(function() {
    'use strict';

    /**
     * Product component
     * @namespace product
     * @memberof iwc.comp
     */
    iwc.comp.product = (function($, comp, util) {
        /**
         * Initialise a product element.
         * @memberOf iwc.comp.product
         */
        var $newsWrapper,
            $component,
            productId = '',
            thresholdPrice,
            maxWatches,
            deferredBuyingOption = $.Deferred(),
            selectors = {
                video: '.iwc-adaptive-video-item',
                newsWrapper: '.iwc-product-articles-wrapper',
                buyingOptionComponent: '.iwc-component.iwc-buying-options'
            },
            cssClass = {
                newsCarousel: 'iwc-product-articles-carousel',
                show: 'iwc-show'
            },
            CONST = {
                eCommerseDetail: 'productinfo'
            };

        /**
         * Play a videos in a component
         * @memberOf iwc.comp.product
        */
        function playVideo($dl) {
            $dl = $dl || $(selectors.video);
            for (var i = 0; i < $dl.length; i++) {
                $dl[i].play();
            }
        }

        /**
         * Where we setup components that need to do something when in view on scroll
         * eg. Play video.
         * @memberOf iwc.comp.product
         */
        //TODO add other components for auto play eg. 360.
        function setUpComponent($el) {
            $el = $el || $(document);
            if ($el.find('video').length) {
                playVideo($el.find('video'));
            }
        }
        /**
         * Validate if the breakpoint isNarrow
         * @memberOf iwc.comp.product
         * @return {Boolean}  return if mobile viewport
         */
        function isNarrow() {
            return util.matchmedia.narrow.matches || false;
        }

        /**
         * shareProductData share product data with caller.
         * @return {object} product data
         */
        function shareProductData() {
            var productData = {
                'globalRef': productId,
                'thresholdPrice': thresholdPrice,
                'maxWatches': maxWatches
            };
            return productData;
        }

        /**
         * shareBuyingOptions share buying option data with caller.
         * @return {Deferred} A promise
         */
        function shareBuyingOptions() {
            return deferredBuyingOption.promise();
        }

        /**
         * processBuyingOptions Success Handler
         * @function processBuyingOptions
         * @private
         * @param {Array} data json data
         * @memberOf iwc.comp.product
        */
        function processBuyingOptions(data) {
            var productData;
            if (data) {
                productData = data;
                deferredBuyingOption.resolve(productData);
            }
        }

        /**
         * Check if the product is sellable
         * @memberOf iwc.comp.product
         */
        function checkForBuyingOptions() {
            var leafPageName  = util.dataStore.getCurrentPagePath(),
                finalUrl = leafPageName + '.' + CONST.eCommerseDetail + '.' + iwc.comp.currencyselectorppc.checkCountryCodeLS() + '.json';

            $.get(finalUrl).done(processBuyingOptions).fail(function() {
                deferredBuyingOption.reject();
            });
        }


        /**
         * scrollToBuyingOptions
         * @private
         * @memberOf iwc.comp.product
         */
        function scrollToBuyingOptions() {
            var $buyingOptions = $component.find(selectors.buyingOptionComponent);
            if ($buyingOptions.length) {
                var componentOffset = $buyingOptions.offset().top;
                util.smoothScroll.init(componentOffset, 700, function() {});
            }
        }

        /**
         * initialise product page
         * @memberOf iwc.comp.product
         */
        function init(element) {

            $newsWrapper = $(selectors.newsWrapper);
            $component = $(element);

            productId = $component.data('productid');
            maxWatches = $component.data('maxWatches');
            thresholdPrice = parseFloat($component.data('ecommerce-threshold-price'));

            $.publish('iwc:animatable:in-view');
            util.scroll.init();
            util.animatable.init();

            if ($newsWrapper.length) {
                if (isNarrow()) {
                    $newsWrapper
                    .addClass(cssClass.newsCarousel);
                }

                $.subscribe('iwc:resize', function() {
                    // remove carousel if breakoint is not narrow
                    if (isNarrow()) {
                        $newsWrapper.addClass(cssClass.newsCarousel);
                    } else {
                        $newsWrapper
                        .removeClass(cssClass.newsCarousel)
                        .find('.scroll')
                        .removeAttr('style');
                    }
                });
            }

            if (util.dataStore.isCommerceEnabled() || util.dataStore.isPpcEnabled()) {
                checkForBuyingOptions();
            }
        }

        return {
            init: init,
            setup: setUpComponent,
            buyingOptions: shareBuyingOptions,
            productData: shareProductData,
            scrollToBuyingOptions: scrollToBuyingOptions
        };
    })(iwc.$, iwc.comp, iwc.util);
}());

/*global iwc*/
/**
 * Product List component js
 */

(function() {
    'use strict';

    /**
     * Product List component
     * @namespace productlist
     * @memberof iwc.comp
     */
    iwc.comp.productlist = (function($, util) {

        var selectors = {
                filterItemBtn: '.iwc-prodlist-filterhead',
                filterTagBtn: '.iwc-prodlist-filterlink',
                clearFilterBtn: '.iwc-prodlist-clearfilters-btn',
                prodlistItem: '.iwc-prodlist-item',
                filterBtn: '.iwc-prodlist-subheading',
                loadMoreBtn: '.iwc-prodlist-loadmore-btn',
                prodlistItemHidden: '.iwc-hidden',
                loadMoreWrapper: '.iwc-prodlist-loadmore',
                prodlist: '.iwc-prodlist-wrapper',
                filterLink: '.iwc-prodlist-filterlink',
                filtered: '.iwc-filtered'
            },
            cssClass = {
                selected: 'iwc-selected',
                expanded: 'iwc-expanded',
                enabled: 'iwc-enabled',
                loading: 'iwc-loading',
                hidden: 'iwc-hidden',
                filtered: 'iwc-filtered'
            },
            CONST = {
                TIME_TO_DELAY: 500
            },
            itemsInList = 9,
            pagination = true;

        /**
         * Manage Pagination on page load
         * @memberOf iwc.comp.productlist
         * @private
         * @param  {Object} $productlist The jQuery object of the component
         */
        function managePagination($productlist) {
            if (!util.matchmedia.wide.matches) {
                itemsInList = $productlist.find(selectors.prodlist).data('itemCountMobile');
            } else {
                itemsInList = $productlist.find(selectors.prodlist).data('itemCount');
            }

            pagination = $productlist.find(selectors.prodlist).data('paginationEnabled');

            // load first page of product list on page load
            if (pagination) {
                $productlist.find(selectors.prodlistItem).slice(0, itemsInList).removeClass(cssClass.hidden);
            } else {
                $productlist.find(selectors.prodlistItem).removeClass(cssClass.hidden);
                $productlist.find(selectors.loadMoreWrapper).addClass(cssClass.hidden);
            }

            // hide load more button if list items less than required items in pagination
            if ($productlist.find(selectors.prodlistItem).length <= itemsInList) {
                $productlist.find(selectors.loadMoreWrapper).addClass(cssClass.hidden);
            }
        }

        /**
         * Update list on filter selection
         * @memberOf iwc.comp.productlist
         * @private
         * @param  {Object} $productlist The jQuery object of the component
         */
        function filterList($productlist) {
            $productlist.find(selectors.prodlistItem).addClass(cssClass.hidden);
            $productlist.find(selectors.prodlistItem).slice(0, itemsInList).removeClass(cssClass.hidden);
        }

        /**
         * Bind events
         * @memberOf iwc.comp.productlist
         * @private
         * @param  {Object} $productlist The jQuery object of the component
         */
        function bindEvents($productlist) {

            // handle click on filter item
            $productlist.on('click', selectors.filterItemBtn, function() {
                $productlist.find(selectors.filterItemBtn).not(this).removeClass(cssClass.selected);
                $(this).toggleClass(cssClass.selected);
            });

            // handle filters on tag selection
            $productlist.on('click', selectors.filterTagBtn, function(e) {
                e.preventDefault();
                $(this).toggleClass(cssClass.selected);
                $productlist.find(selectors.clearFilterBtn).addClass(cssClass.enabled);
            });

            // reset filters on button click
            $productlist.on('click', selectors.clearFilterBtn, function() {
                $productlist.find(selectors.filterItemBtn).removeClass(cssClass.selected);
                $productlist.find(selectors.filterTagBtn).removeClass(cssClass.selected);
                $productlist.find(selectors.clearFilterBtn).removeClass(cssClass.enabled);
            });

            // Handle tile overlay for narrow and wide view
            if (!util.matchmedia.wide.matches) {

                // Click on product tile will show the tile overlay in narrow
                $productlist.on('click', selectors.prodlistItem, function(e) {
                    e.stopPropagation();
                    $productlist.find(selectors.prodlistItem).not(this).removeClass(cssClass.selected);
                    $(this).addClass(cssClass.selected);
                });

                // Click open filter drop down in narrow
                $productlist.on('click', selectors.filterBtn, function() {
                    $(this).toggleClass(cssClass.expanded);
                });

                // Hide to product tile overlay when user click on document
                $(document).on('click', function() {
                    $productlist.find(selectors.prodlistItem).removeClass(cssClass.selected);
                });

            } else {

                // Hover on product tile will show the overlay in wide
                $productlist.find(selectors.prodlistItem).hover(function() {
                    $(this).stop(true, true).delay(CONST.TIME_TO_DELAY).queue(function() {
                        $productlist.find(selectors.prodlistItem).not(this).removeClass(cssClass.selected);
                        $(this).addClass(cssClass.selected).dequeue();
                    });
                }, function() {
                    $(this).stop(true, true).delay(CONST.TIME_TO_DELAY).queue(function() {
                        $productlist.find(selectors.prodlistItem).removeClass(cssClass.selected).dequeue();
                    });
                });
            }

            // load more button click to show more tiles
            $productlist.on('click', selectors.loadMoreBtn, function() {
                $(this).addClass(cssClass.loading);
                $productlist.find(selectors.prodlistItemHidden).slice(0, itemsInList).removeClass(cssClass.hidden);
                if ($productlist.find(selectors.prodlistItemHidden).length === 0) {
                    $productlist.find(selectors.loadMoreWrapper).addClass(cssClass.hidden);
                }
                $('html,body').animate({scrollTop: $(this).offset().top}, 1500);
                $(this).removeClass(cssClass.loading);
            });

            $productlist.on('click', selectors.filterLink, function() {
                filterList($productlist);
            });
        }

        /**
         * Initialise a productlist element.
         * @memberOf iwc.comp.productlist
         */
        function init(obj) {
            var $productlist = $(obj);

            // Manage Pagination
            managePagination($productlist);

            // Bind events
            bindEvents($productlist);

        }

        return {
            init: init
        };
    })(iwc.$, iwc.util);
}());

/*global iwc, Modernizr*/
/**
 * @fileOverview Provides placeholder functionality for the threesixty component
 */

(function() {
    'use strict';

    /**
     * threesixty component
     * @namespace threesixty
     * @memberof iwc.comp
     */
    iwc.comp.threesixty = (function($, util) {

        var name = 'threesixty',
            $win = $(window),
            $threeSixty,
            $threeSixtyContainer,
            $threeSixtyStages,
            $knob,
            $threeSixtyContent,
            $threeSxtyObj,
            $stepperButton,
            $baseImage,
            adaptiveImage,
            threesixtyInst,
            threeCanvasWidth,
            threeCanvasHeight,
            settings,
            selectors = {
                imageContainer: '.iwc-threesixty-container',
                textContainer: '.threesixty-text',
                steps: '.iwc-trsxty-step',
                knob: '.iwc-stage-control-arrow',
                stepperButton: '.iwc-btn-360',
                baseImage: '.iwc-threesixty-base-image'
            },
            cssClass = {
                isShown: 'iwc-show',
                hide: 'iwc-hidden'
            },
            markup = '<h3 class="iwc-heading iwc-trsxty-heading">{{heading}}</h3><p class="iwc-trsxty-text">{{text}}</p>',
            transformProp = Modernizr.prefixed('transform'),
            CONST = {
                imageCharacters: 2
            },
            /* Stages */
            stages = [{
                number: 0,
                frame: 0,
                knob: '0px'
            },
            {
                number: 1,
                frame: 15,
                knob: '86.4px'
            },
            {
                number: 2,
                frame: 30,
                knob: '172.8px'
            },
            {
                number: 3,
                frame: 45,
                knob: '259.20px'
            },
            {
                number: 4,
                frame: 60,
                knob: '345.6px'
            },
            {
                number: 5,
                frame: 72,
                knob: '432px'
            }],
            currentStage = 0,
            totalStage = stages.length || 0,
            isScrolledTo = false;

        /**
         * Update heading and text
         * @function updateStageText
         * @private
         * @param {number} index stage number
         * @memberof iwc.comp.threesixty
         */
        function updateStageText(index) {

            var $target = $threeSixtyStages.eq(index),
                heading = $target.data('stage-heading'),
                text = $target.data('stage-text'),
                $template;

            $template = markup.replace('{{heading}}', heading).replace('{{text}}', text);
            $threeSixtyContent.html($template);
        }

        /**
         * Update controller knob posibtion
         * @function updateKnob
         * @private
         * @param {object} stage stage object
         * @param {string} stage.knob
         * @memberof iwc.comp.threesixty
        */
        function updateKnob(stage) {
            $knob.css(transformProp, 'translateX(' + stage.knob + ')');
        }

        /**
         * Method for updating stage -heading, description and frame
         * @function updateStage
         * @private
         * @param {Number} index stage number
         * @memberof iwc.comp.threesixty
         */
        function updateStage(index, isBigJump) {

            //bail out if index is invalid
            if (index < 0 || index >= totalStage) {
                return;
            }

            var stage = stages[index] || 0;

            // animate frames
            $threeSxtyObj.moveFrames(stage.frame);
            if (!isBigJump) {
                // update text and knob position
                updateStageText(index);
            }
            updateKnob(stage);
            currentStage = stage.number;
            util.tracking.publish($threeSixty);
        }

        /**
         * Update frame of 360 view
         * @function updateFrame
         * @private
         * @param  {event} e event object
         * @memberof iwc.comp.threesixty
         */
        function updateFrame(e) {

            e.preventDefault();

            var isBigJump = false,
                $target = $(e.target),
                stage = $target.data('stage-no') || 0;

            if ($target && $target.is($stepperButton)) {
                stage = (currentStage === totalStage - 1) ? 0 : (currentStage + 1);
            }

            if (Math.abs(stage - currentStage) > 1) {
                isBigJump = true;
            }
            updateStage(stage, isBigJump);
        }
        /**
         * Handler for frame update
         * @function handleFrameUpdate
         * @private
         * @param  {Number} num
         * @memberof iwc.comp.threesixty
         */
        function handleFrameUpdate(num) {
            for (var key in stages) {
                if (num === stages[key].frame) {
                    var index = stages[key].number;
                    updateStageText(index);
                    currentStage = index;
                }
            }
        }
        /**
         * Handler for keyboard navigation and swipe
         * @function onSwipeOrKeyAction
         * @private
         * @param  {event} e event object
         * @memberof iwc.comp.threesixty
         */
        function onSwipeOrKeyAction(event) {

            if (!event) {
                return;
            }

            var type = event.type,
                key = event.charCode || event.keyCode,
                top = $win.scrollTop(),
                elemTop = $threeSixty.offset().top,
                elemBottom = $threeSixty.outerHeight() + elemTop;

            // bail out if the events is keyboard event and component is not visible in the fold
            if (key && top < elemTop - 200 || top > elemBottom - 300) {
                return;
            }

            if (key === 37 && currentStage > 0 || type === 'swipeLeft') {
                updateStage(currentStage - 1);

            } else if (key === 39 && currentStage < totalStage || type === 'swipeRight') {
                updateStage(currentStage + 1);
            }
        }
        /**
         * update component dimensions
         * @function handleResize
         * @private
         * @memberof iwc.comp.threesixty
         */
        function handleResize() {
            threeCanvasWidth = Math.ceil($baseImage.width());
            threeCanvasHeight = Math.ceil($baseImage.height());
            $threeSxtyObj.updateCanvas(threeCanvasWidth, threeCanvasHeight);
        }
        /**
         * Return adaptive image to be loaded on the current viewport
         * @function getAdaptiveSuffix
         * @param  {Number} width width of the viewport
         * @return {string} adaptiveImage
         * @memberof iwc.comp.threesixty
         */
        function getAdaptiveSuffix(width) {

            var vWidth = width || 0;

            if (vWidth <= 667) {
                adaptiveImage = '.transform.global_image_375.jpeg';
            } else {
                adaptiveImage = '.transform.global_image_375_2x.jpeg';
            }
            return adaptiveImage;
        }

        /**
         * Scroll event triggers on initEvent
         * on scrolled to the view, view sets to default stage
         * unbinds the scroll event once scrolled to the view
         * @memberOf iwc.comp.threesixty
         */
        function onPageScroll() {
            isScrolledTo = $threeSixty.hasClass(cssClass.isShown);
            if (isScrolledTo) {
                updateStage(0);
                $(document).off('scroll', onPageScroll);
            }
        }

        /**
         * Bind Events to component
         * @function initEvents
         * @memberof iwc.comp.threesixty
         */
        function initEvents() {

            $win.on('keyup.' + name, util.debounce(onSwipeOrKeyAction, 250));
            $.subscribe('iwc:resize', handleResize);
            $.subscribe('iwc:360:drawImage', handleFrameUpdate);
            $.subscribe('iwc:360:loaded', function() {
                //hide default images
                $baseImage.addClass(cssClass.hide);
                //bind events
                $stepperButton.on('click.' + name, updateFrame);
                $threeSixtyStages.on('click.' + name, updateFrame);

                //set default stage[0], when page scroll to the view
                $(document).on('scroll', onPageScroll);
            });
            /* TODO: Remove dependancy on Modernizr */
            // mobile
            if (Modernizr.touch) {
                var events = ['swipeLeft', 'swipeRight'];

                $threeSixtyContainer
                .touchEvents({ preventMove: events })
                .on(events.join(' ') + '.' + name, util.debounce(onSwipeOrKeyAction, 100));
            }
        }

        /**
         * Initialise a threesixty element.
         * @param {HTMLObject} obj
         * @memberOf iwc.comp.threesixty
         */
        function init(obj) {

            $threeSixty = $(obj) || {};
            $threeSixtyContainer = $threeSixty.find(selectors.imageContainer);
            $threeSixtyStages = $threeSixty.find(selectors.steps);
            $threeSixtyContent = $threeSixty.find(selectors.textContainer);
            $knob = $threeSixty.find(selectors.knob);
            $stepperButton = $threeSixty.find(selectors.stepperButton);
            $baseImage = $threeSixty.find(selectors.baseImage);

            // Get Image dimensions
            threeCanvasWidth = Math.ceil($baseImage.width());
            threeCanvasHeight = Math.ceil($baseImage.height());

            adaptiveImage = getAdaptiveSuffix(threeCanvasWidth) || '';

            var imagePath = $threeSixty.data('threesixty-image-path'),
                imgName = $threeSixty.data('threesixty-image-name'),
                fullRotation = $threeSixty.data('threesixty-full-rotation'),
                totalImages = parseInt($threeSixty.data('threesixty-length'), 10),
                path = imagePath.replace(imgName, ''),
                parts = imgName.split('.'),
                imagePrePart = parts[0].substr(0, parts[0].length - CONST.imageCharacters), // remove last 2 character
                ext = parts[1];

            settings = {
                path: path,
                imgName: imagePrePart,
                baseIndex: 1,
                max: totalImages,
                fullRotation: fullRotation,
                ext: ext,
                canvasID:'iwc-product',
                canvasWidth: threeCanvasWidth,
                canvasHeight: threeCanvasHeight,
                adaptiveImage: adaptiveImage
            };

            threesixtyInst = $threeSixtyContainer.rotate360(settings);
            $threeSxtyObj = threesixtyInst.data('rt360');

            // initialise events
            initEvents();
        }

        return {
            init: init
        };
    })(iwc.$, iwc.util);
}());

/*global iwc*/
/**
 * navigation component js
 */

(function() {
    'use strict';

    /**
     * Navigation component
     * @namespace navigation
     * @memberof iwc.comp
     */
    iwc.comp.productNav = (function($, comp, util) {
        var selectors = {
                menu: '.iwc-menu-item',
                productPrice: '[data-buyoptionsprice]',
                buyingInfo: '.iwc-productnav-buy-info',
                buyOptionButton: '.iwc-productnav-buy-link',
                pdpdnavDropDown: '.iwc-pdpdnav-countries',
                pdpdnavDropDownHidden: '.iwc-pdpdnav-countries-hidden',
                activeNumberLink: '.active-phone-number-link'
            },
            cssClass = {
                toggleNav: 'iwc-pdpdnav-dd-expanded',
                hide: 'iwc-hidden',
                goToBag: 'iwc-productnav-show-gotobag',
                goToContact: 'iwc-productnav-show-contact',
                goToBuy: 'iwc-productnav-show-buy',
                goToNotify: 'iwc-productnav-show-notify'
            },
            EVENTS,
            $items,
            $component,
            $buyingInfo,
            productRelatedData,
            productId,
            thresholdPrice,
            maxWatchesLimit,
            isMobile = util.matchmedia.narrow.matches;

        /**
         * scroll
         * scrolls to target smoothly
         * @private
         * @memberOf iwc.comp.productNav
         * @param  {e} event object
         */
        function scroll(e) {
            e.preventDefault();
            $items.removeClass('selected');
            $(e.target).addClass('selected');
            var hash = e.target.hash;
            util.smoothScroll.init($(hash).offset().top, 700, function() {});
        }

        /**
         * setProductCartData based on cart data from login status
         * @private
         * @memberOf iwc.comp.buyingoptions
         */
        function setProductCartData() {
            var limitText = $component.data('limitReached'),
            currentState = iwc.comp.cartState.get();

            if (currentState.count === currentState.limit) {
                $buyingInfo.addClass(cssClass.goToBag);
                $component.find(selectors.productPrice)
                    .removeClass(cssClass.hide)
                    .text(limitText);
                return false;
            }
        }

        /**
         * setDefaultCtas if the product call fails
         * show contact concierge
         * @private
         * @memberOf iwc.comp.productNav
         */
        function setDefaultCtas() {
            $buyingInfo.addClass(cssClass.goToContact);
        }

        /**
         * setCommerseData
         * set price and proper CTA based on product's commerse data
         * @private
         * @memberOf iwc.comp.productNav
         * @param  {object} ecommData
         */
        function setCommerseData(ecommData) {
            var productData = ecommData[productId],
                productSellable = productData.sellable,
                productStock = productData.stock,
                productPrice = parseFloat(productData.price),
                priceIsZero = (productPrice <= 0),
                thresholdPriceCrossed = productPrice > thresholdPrice,
                currentState = iwc.comp.cartState.get();

            if (currentState.count !== currentState.limit) {
                if (!priceIsZero) {
                    $component.find(selectors.productPrice)
                        .removeClass('iwc-hidden')
                        .text(productData.formattedPrice);
                }
                if (priceIsZero || thresholdPriceCrossed || !productSellable) {
                    $buyingInfo.addClass(cssClass.goToContact);
                } else if (!priceIsZero && !thresholdPriceCrossed && !productStock && productSellable) {
                    $buyingInfo.addClass(cssClass.goToNotify);
                } else if (!priceIsZero && !thresholdPriceCrossed && productStock && productSellable) {
                    $buyingInfo.addClass(cssClass.goToBuy);
                }
            }
        }

        /**
         * updateContactNumbers toggles contact numbers
         * @private
         * @memberOf iwc.comp.productNav
         * @param  {e} event object
         */
        function updateContactNumbers(e) {
            var $target = $(e.target),
                $selectedOption = $target.find('option:selected'),
                selectedOptionText = isMobile ? $selectedOption.val() : $selectedOption.data('text');
            $component.find(selectors.pdpdnavDropDownHidden)
                .find('option')
                .text(selectedOptionText);
            $component.find(selectors.activeNumberLink)
                .text($selectedOption.data('phone'))
                .attr('href', 'tel:' + $selectedOption.data('phone'));
            var updateValueGetWidth = $component.find(selectors.pdpdnavDropDownHidden).outerWidth();
            $target.width(updateValueGetWidth);
        }
        /**
         * createPDPNav shows full country names for wide view
         * @private
         * @memberOf iwc.comp.productNav
         */
        function createPDPNav() {
            if (!util.matchmedia.narrow.matches) {
                $component.find(selectors.pdpdnavDropDown + ' option').each(function() {
                    var text = $(this).data('text');
                    $(this).text(text);
                });
            }
        }

        /**
         * onStateChangeHandler update the button based on the cart state
         * @private
         * @memberOf iwc.comp.productNav
         * @param  {object} state
         */
        function onStateChangeHandler(state) {
            if (state.count === state.limit) {
                $buyingInfo.removeClass(cssClass.goToBuy).addClass(cssClass.goToBag);
                $component.find(selectors.productPrice)
                    .removeClass(cssClass.hide)
                    .text($component.data('limitReached'));
                return false;
            }
        }

        /**
         * bindEvents actions handler on CTAs
         * @private
         * @memberOf iwc.comp.productNav
         */
        function bindEvents() {
            $component.find(selectors.buyOptionButton)
                .on('click', iwc.comp.buyingoptions.addProductToBag);
            $component.on('change', selectors.pdpdnavDropDown, updateContactNumbers);
            $.subscribe('iwc:state:changed', onStateChangeHandler);
        }

        /**
         * getHeight
         * @return {number} height of the component
         */
        function getHeight() {
            return $component.height();
        }

        function init(elem) {
            $component = $(elem);
            $items = $component.find(selectors.menu);
            $buyingInfo = $component.find(selectors.buyingInfo);
            productRelatedData = comp.product.productData();
            productId = productRelatedData.globalRef;
            thresholdPrice = productRelatedData.thresholdPrice;
            maxWatchesLimit = productRelatedData.maxWatches,
            EVENTS = util.events.INTERACTION;
            $items.on(EVENTS, scroll);
            comp.account.customerDetailsData().done(setProductCartData).always(function() {
                comp.product.buyingOptions().done(setCommerseData).fail(setDefaultCtas);
            });

            createPDPNav();
            bindEvents();
        }
        return {
            init: init,
            getHeight: getHeight
        };
    })(iwc.$, iwc.comp, iwc.util);
}());

/*global iwc*/
/**
 * functionality for the watch hero component
 */

(function() {
    'use strict';

    /*
     * watchhero component
     * @namespace watchhero
     * @memberof iwc.comp
     */
    iwc.comp.watchhero = (function($, product) {
        var selectors = {
                sliderItem: '.iwc-watchhero-slide',
                defautHeroObject: '.iwc-watchhero',
                buyingOptions: '.iwc-hero-buy-info',
                buyingOptionBtn: '.iwc-hero-buyoption'
            },
            $slider,
            $buyingInfo,
            $heroCarousel,
            productRelatedData,
            productId,
            thresholdPrice;

        /**
         * setCommerceData
         * set CTA based on product's commerce data
         * @private
         * @memberOf iwc.comp.watchhero
         * @param  {object} productData
         */
        function setCommerceData(ecommData) {
            var $buyingInfo = $slider.find(selectors.buyingOptions),
                productData = ecommData[productId],
                productSellable = productData.sellable,
                productStock = productData.stock,
                productPrice = parseFloat(productData.price),
                priceIsZero = (productPrice <= 0),
                thresholdPriceCrossed = productPrice > thresholdPrice;

            if (priceIsZero || thresholdPriceCrossed || !productSellable) {
                // show concierge
                $buyingInfo.addClass('iwc-hero-show-contact');
            } else if (!priceIsZero && !thresholdPriceCrossed && !productStock && productSellable) {
                // show notify
                $buyingInfo.addClass('iwc-hero-show-notify');
            } else if (!priceIsZero && !thresholdPriceCrossed && productStock && productSellable) {
                // Add to bag
                $buyingInfo.addClass('iwc-hero-show-buy');
            }
        }
        /*
         * Initialised bind events.
         * @memberOf iwc.comp.watchhero
         * @param  {Object} $slider the object
         */
        function bindEvents() {
            $heroCarousel.find(selectors.buyingOptionBtn).on('click', product.scrollToBuyingOptions);
        }

        /**
         * Initialise a watchhero element.
         * @memberOf iwc.comp
         */
        function init(element) {
            $heroCarousel = $(element) || $(selectors.defautHeroObject);
            $slider = $heroCarousel.find('.iwc-watchhero-wrapper');
            $buyingInfo = $heroCarousel.find(selectors.buyingOptions);
            product.buyingOptions().done(setCommerceData);
            productRelatedData = product.productData();
            productId = productRelatedData.globalRef;
            thresholdPrice = productRelatedData.thresholdPrice;
            bindEvents();
        }

        return {
            init: init
        };
    })(iwc.$, iwc.comp.product);
}());

/*global iwc*/
/**
 * functionality for the variations Section
 */

(function() {
    'use strict';

    /*
     * variations component
     * @namespace variations
     * @memberof iwc.comp
     */
    iwc.comp.variations = (function($, util) {
        var selectors = {
                defaultObject: '.iwc-variations-products',
                slickElement: '.iwc-variations-products-slide',
                productSlide: '.iwc-variation-product-watch',
                techspecLink: '.iwc-variation-product-spec-link',
                exploreBuyLink: '.iwc-variation-product-explore-link',
                paginationNumber: '.iwc-numbers',
                slickCustomNextArrow: '.iwc-slick-arrow-next',
                slickCustomPrevArrow: '.iwc-slick-arrow-previous',
                watchPrice: '.iwc-variation-product-price',
                productHolder: '.iwc-variation-product-holder',
                slickClonedElement: '.slick-cloned',
                productLink: '.iwc-variation-product-anchor'
            },
            CONST = {
                maximumElements: 3,
                eCommerseDetail: 'ecommerce-details',
                productInfo: 'productinfo'
            },
            $variationWatchSection,
            $slickElement,
            $watchIndex,
            $paginationNumber,
            slickLength,
            slidesPresent,
            totalSlides,
            currentActiveSlide,
            allProductRefs = '',
            ecommEnabled,
            makeInfinite,
            $productLink,
            ppcEnabled;

        /**
         * processVariationOptions Success Handler
         * @function processVariationOptions
         * @private
         * @param {Array} data json data
         * @memberOf iwc.comp.variations
        */
        function processVariationOptions(data) {

            var variationData = (Object.keys(data).length === 0 && data.constructor === Object) ? {} : data;
            for (var values in variationData) {
                if (values) {
                    var currentElem = $slickElement.find('[data-product-ref=' + values + ']');
                    currentElem.find(selectors.watchPrice).text(variationData[values].formattedPrice);
                }
            }
        }

        /**
         * get prices for all the watches in variations.
         * @function showProductPrices
         * @private
         * @memberOf iwc.comp.variations
        */

        function showProductPrices() {
            $slickElement
                .find(selectors.productHolder)
                .not(selectors.slickClonedElement)
                .find(selectors.productSlide)
                .each(function(index, element) {
                    allProductRefs += $(element).data('productRef') + '-';
                });

            allProductRefs = allProductRefs.slice(0, -1);
            var leafPageName  = util.dataStore.getCurrentPagePath(),
                finalUrl = leafPageName + '.' + CONST.productInfo + '.' + iwc.comp.currencyselectorppc.checkCountryCodeLS() + '.REF-' + allProductRefs + '.json';
            $.get(finalUrl, processVariationOptions);
        }




        /**
         * Initialise Carousel for watch
         * @function processVariationOptions
         * @private
         * @param  {Object} $slickElement the object
         * @memberOf iwc.comp.variations
        */

        function initCarousel($slickElement) {

            //getting the number of the element present to be passed to slick
            slidesPresent = slickLength - 1;

            //events called on the slick carousel
            $slickElement.on('init reInit afterChange', function(event, slick, currentSlide) {

                // currentSlide is undefined on init -- set it to 0 in this case
                currentActiveSlide = currentSlide ? currentSlide + 1 : 1;
                totalSlides = slick.slideCount;

                $paginationNumber.text(currentActiveSlide + ' / ' + totalSlides);
                util.lazyLoadImage.checkImages();
            });

            $slickElement.slick({
                speed: 300,
                infinite: makeInfinite,
                slidesToShow: slidesPresent,
                slidesToScroll: 1,
                centerMode: true,
                centerPadding: '100px',
                variableWidth: true,
                arrows: true,
                focusOnSelect: true,
                prevArrow: $(selectors.slickCustomPrevArrow),
                nextArrow: $(selectors.slickCustomNextArrow),
                responsive: [
                    {
                        breakpoint: 768,
                        settings: {
                            slidesToShow: 1,
                            arrows: true,
                            centerMode: false,
                            centerPadding: '0px',
                            variableWidth: false
                        }
                    }
                ]
            });
        }

        /**
         * Initialise a variations element.
         * @function init
         * @public
         * @param {HTMLObject} element
         * @memberOf iwc.comp.variations
        */
        function init(element) {
            $variationWatchSection = $(element) || $(selectors.defaultObject),
            ecommEnabled = $variationWatchSection.data('ecommerceEnabled') || false ;
            $slickElement = $variationWatchSection.find(selectors.slickElement),
            slickLength = $slickElement.find(selectors.productSlide).length,
            $watchIndex = $variationWatchSection.find(selectors.watchIndex);
            $paginationNumber = $variationWatchSection.find(selectors.paginationNumber);
            $productLink = $variationWatchSection.find(selectors.productLink);
            makeInfinite = slickLength > 2 ? true : false;
            ppcEnabled = $variationWatchSection.data('ppcEnabled');
            // initCarousel on the main the main container
            initCarousel($slickElement);

            if (ecommEnabled || ppcEnabled) {
                showProductPrices();
            }

        }

        return {
            init: init
        };

    })(iwc.$, iwc.util);
}());

/*global iwc*/
/**
 * functionality for the Related Watches Section
 */

(function() {
    'use strict';

    /*
     * relatedwatches component
     * @namespace relatedwatches
     * @memberof iwc.comp
     */
    iwc.comp.relatedwatches = (function($, util) {
        var selectors = {
                defaultObject: '.iwc-related-products',
                slickElement: '.iwc-related-products-slide',
                productSlide: '.iwc-product-watch',
                productLink: '.iwc-product-link',
                productHolder: '.iwc-product-holder',
                slickClonedElement: '.slick-cloned',
                watchPrice: '.iwc-product-price'
            },
            CONST = {
                eCommerseDetail: 'ecommerce-details',
                productInfo: 'productinfo'
            },
            cssClass = {
                singleSlide: 'iwc-single-slide'
            },
            $relatedWatchesSection,
            $slickElement,
            $productLink,
            $watchIndex,
            allProductRefs = '',
            slickLength,
            slidesPresent,
            slidesPresentWide,
            ecommEnabled,
            ppcEnabled,
            isMobile = util.matchmedia.narrow.matches;

        /**
         * processWatchPrices Success Handler
         * @function processWatchPrices
         * @private
         * @param {Array} data json data
         * @memberOf iwc.comp.relatedwatches
        */
        function processWatchPrices(data) {
            var priceData = (Object.keys(data).length === 0 && data.constructor === Object) ? {} : data;
            for (var values in priceData) {
                if (values) {
                    var currentElem = $slickElement.find('[data-product-ref=' + values + ']');
                    currentElem.find(selectors.watchPrice).text(priceData[values].formattedPrice);
                }
            }
        }

        /**
         * get prices for all the watches in relatedwatches.
         * @function showProductPrices
         * @private
         * @memberOf iwc.comp.relatedwatches
        */

        function showProductPrices() {
            $slickElement
                .find(selectors.productHolder)
                .not(selectors.slickClonedElement)
                .find(selectors.productSlide)
                .each(function(index, element) {
                    allProductRefs += $(element).data('productRef') + '-';
                });

            allProductRefs = allProductRefs.slice(0, -1);
            var leafPageName  = util.dataStore.getCurrentPagePath(),
                finalUrl = leafPageName + '.' + CONST.productInfo + '.' + iwc.comp.currencyselectorppc.checkCountryCodeLS() + '.REF-' + allProductRefs + '.json';
            $.get(finalUrl, processWatchPrices);
        }

        /*
        * Initialise Carousel for watch
        * @memberOf iwc.comp.relatedwatches
        * @param  {Object} $slickElement the object
        */
        function initCarousel($slickElement) {

            //getting the number of the element present to be passed to slick
            if (slickLength <= 3) {

                slidesPresent = slickLength;
                slidesPresentWide = slickLength;

            } else if (slickLength >= 5) {

                slidesPresent = 3;
                slidesPresentWide = 5;

            } else if (slickLength === 4) {
                slidesPresent = 3;
                slidesPresentWide = slickLength;

            } else if (slickLength === 3) {
                slidesPresent = slickLength;
                slidesPresentWide = slickLength;
            } else {
                slidesPresent = 3;
            }

            var centerMode = (slickLength === 1) ? false : true;
            if (!centerMode && isMobile) {
                $slickElement.addClass(cssClass.singleSlide);
            }

            //events called on the slick carousel
            $slickElement.on('init reInit afterChange', function() {
                util.lazyLoadImage.checkImages();
            });

            $slickElement.slick({
                speed: 300,
                slidesToShow: slidesPresentWide,
                slidesToScroll: 1,
                centerMode: false,
                arrows: true,
                responsive: [
                    {
                        breakpoint: 1400,
                        settings: {
                            slidesToShow: slidesPresent
                        }
                    },
                    {
                        breakpoint: 768,
                        settings: {
                            slidesToShow: 1,
                            arrows: false,
                            centerMode: centerMode,
                            centerPadding: '25%'
                        }
                    }
                ]
            });

        }

        /**
        * Initialise a related watches element.
        * @memberOf iwc.comp
        */
        function init(element) {
            $relatedWatchesSection = $(element) || $(selectors.defaultObject);
            $slickElement = $relatedWatchesSection.find(selectors.slickElement);
            slickLength = $slickElement.find(selectors.productSlide).length;
            $watchIndex = $relatedWatchesSection.find(selectors.watchIndex);
            $productLink = $relatedWatchesSection.find(selectors.productLink);
            ecommEnabled = $relatedWatchesSection.data('ecommerceEnabled') || false ;
            ppcEnabled = $relatedWatchesSection.data('ppcEnabled');
            // initCarousel on the main the main container
            initCarousel($slickElement);
            if (ecommEnabled || ppcEnabled) {
                showProductPrices();
            }
        }

        return {
            init: init
        };

    })(iwc.$, iwc.util);
}());

/*global iwc*/
/**
 * functionality for the product Features Section
 */

(function() {
    'use strict';

    /*
     * productFeatures component
     * @namespace productFeatures
     * @memberof iwc.comp
     */
    iwc.comp.productFeatures = (function($, util) {
        var selectors = {
            defaultObject: '.iwc-product-features',
            detailsBtn: '.iwc-product-information-title',
            detailsSection: '.iwc-product-information-details'
        },
        $productFeatures,
        $detailsBtn,
        $detailsSection;

        /*
        * function for showing Toggle on mobile view
        * @function showToggle
        * @private
        * @memberOf iwc.comp
        */
        function showToggle() {
            util.toggle.init($productFeatures, {
                toggleButton: selectors.detailsBtn,
                toggleTarget: selectors.detailsSection
            });
        }

        /*
        * Initialise a product Features element.
        * @function init
        * @public
        * @params {domObject} product Features
        * @memberOf iwc.comp
        */
        function init(element) {
            $productFeatures = $(element) || $(selectors.defaultObject),
            $detailsBtn = $productFeatures.find(selectors.detailsBtn),
            $detailsSection = $productFeatures.find(selectors.detailsSection);

            if (util.matchmedia.narrow.matches) {
                showToggle();
            }
        }

        return {
            init: init
        };

    })(iwc.$, iwc.util);
}());

/*global iwc, picturefill*/
/**
 * functionality for the Related Watches Section
 */

(function() {
    'use strict';

    /*
     * familysubnav component
     * @namespace familysubnav
     * @memberof iwc.comp
     */
    iwc.comp.familysubnav = (function($, util) {
        /**
         * Initialise a familysubnav element.
         * @memberOf iwc.comp.familysubnav
         */
        var selectors = {
                calibreFirstRowNav:     '.iwc-familysubnav-primary-nav',
                familysubnavOpenLink:   '.iwc-primary-item-family-link',
                calibreSubNav:          '.iwc-familysubnav-sub-nav-list',
                subNavActive:           '.iwc-sub-nav-active-item',
                primaryItemText:        '.iwc-primary-item-text',
                calibreSubNavItem:      '.iwc-familysubnav-sub-nav-item',
                subNavLink:             '.iwc-familysubnav-sub-nav-link',
                subNavText:             '.iwc-nav-text',
                activeSlide:            '.slick-active',
                familysubnavContent:    '.iwc-familysubnav-content',
                slickList:              '.slick-list',
                template:               '.iwc-genericsubnav-links-template',
                nextPrevLinks:          '.iwc-next-prev-links',
                prevItem:               '.iwc-primary-item-prev',
                nextItem:               '.iwc-primary-item-next'
            },
            cssClass = {
                openNav:                'iwc-familysubnav-opened',
                activeNavClass:         'iwc-sub-nav-active-item',
                familysubnavPrevClass:  'iwc-primary-item-prev-link',
                familysubnavNextClass:  'iwc-primary-item-next-link',
                familysubnavOverlay:    'iwc-familysubnav-overlay'
            },
            $familysubnav,
            $calibreFirstRowNav,
            $familysubnavPrevLink,
            $familysubnavOpenLink,
            $familysubnavNextLink,
            $calibreSubNav,
            $calibreSubNavItem,
            $subNavLink,
            $subNavActive,
            $familysubnavContent = $(selectors.familysubnavContent),
            $body = $('body'),
            $template,
            template;

        /**
         * Update Next/Previous Links
         * @function setNextPrevLinks
         * @param {jQuery} elem - element to get data from
         * @return {String} Next/Prev
         * @memberOf iwc.comp.familysubnav
         */
        function setNextPrevLinks(elem, position) {
            var $target = $(elem).find(selectors.subNavLink),
                href = $target.attr('href'),
                text = $target.text(),
                linkName = $target.data('linkName'),
                index = $(elem).data('index'),
                uri = $target.data('tracking-uri'),
                updatedTemplate = template
                            .replace('{{href}}', href)
                            .replace('{{text}}', text)
                            .replace('{{index}}', index)
                            .replace('{{linkName}}', linkName)
                            .replace(/{{position}}/g, position)
                            .replace('{{uri}}', uri);

            if (position === 'prev') {
                $calibreFirstRowNav.find(selectors.prevItem).remove();
                $calibreFirstRowNav.prepend(updatedTemplate);
            } else {
                $calibreFirstRowNav.find(selectors.nextItem).remove();
                $calibreFirstRowNav.append(updatedTemplate);
            }
        }
        /**
         * Create/Update navigation next/previous
         * links in bar
         * @function updateNavigation
         * @private
         * @param {jQueryObject} $newActive
         * @memberOf iwc.comp.familysubnav
        */
        function updateNavigation($listItem) {
            var currentPageLinkIndex;
            if ($listItem) {
                currentPageLinkIndex = $listItem.data('index') - 1;
            } else {
                currentPageLinkIndex = $subNavActive.data('index') - 1;
            }
            var subNavLength = $calibreSubNavItem.length,
                currentPageTitle = $calibreSubNavItem.eq(currentPageLinkIndex).find(selectors.subNavText).text();

            document.title = currentPageTitle;

            if (subNavLength > 1) {
                $familysubnavPrevLink = $calibreSubNavItem.eq(currentPageLinkIndex - 1);
                $familysubnavPrevLink = $familysubnavPrevLink.length ? $familysubnavPrevLink : $calibreSubNavItem.eq(subNavLength);
                setNextPrevLinks($familysubnavPrevLink, 'prev');

                $familysubnavNextLink = $calibreSubNavItem.eq(currentPageLinkIndex + 1);
                $familysubnavNextLink = $familysubnavNextLink.length ? $familysubnavNextLink : $calibreSubNavItem.eq(0);
                setNextPrevLinks($familysubnavNextLink, 'next');
            }
        }
        /**
         * Hide navigation when clicked anywhere on page
         * @function hideNavigation
         * @private
         * @memberOf iwc.comp.familysubnav
        */
        function hideNavigation() {
            $familysubnav.removeClass(cssClass.openNav);
            $body.removeClass(cssClass.familysubnavOverlay);
        }
        /**
         * Load new content on page
         * @function loadContentOnPage
         * @private
         * @param  {event} e event object
         * @memberOf iwc.comp.familysubnav
        */
        function loadContentOnPage(e) {
            e.preventDefault();
            var $listItem = $(e.currentTarget),
                listItemIndex = $listItem.data('index'),
                $target = $listItem.find(selectors.subNavLink).length ? $listItem.find(selectors.subNavLink) : $listItem.find('.iwc-primary-item-link'),
                href = $target.attr('href'),
                pagename = $target.data('link-name'),
                contentURL = href.replace('.html', '.content.html'),
                stateObj = {};
            util.scrollTo.position($body.offset().top, 500);
            $.get(contentURL, function(data) {

                updateNavigation($listItem);

                var $data = $(data);
                $familysubnavContent.html($data);
                util.carousel.init($familysubnavContent);
                util.initialise($familysubnavContent);
                history.pushState(stateObj, '', pagename + '.html');
                util.animatable.reInit($data);
                util.videoPlayer.reInit($data);
                util.lazyLoadImage.init();
                util.lazyLoadImage.checkImages();
                util.lightbox.reInit($data);
                util.animatable.reInit($familysubnavContent);
                if ($body.hasClass('IE-11')) {
                    picturefill();
                }

                $calibreSubNavItem
                    .removeClass(cssClass.activeNavClass)
                    .eq(listItemIndex - 1)
                    .addClass(cssClass.activeNavClass);

                hideNavigation();
                util.tracking.publish($target);

            }).fail(function() {
                hideNavigation();
                console.log('something went wrong, please try again.');
            });
        }

        /**
         * Initialize slick slider in mobile view
         * @function mobileSubNav
         * @private
         * @memberOf iwc.comp.familysubnav
        */
        function mobileSubNav() {

            var $activeSlide = $calibreSubNav.find(selectors.subNavActive),
                activeIndex = $activeSlide.index();

            $calibreSubNav.slick({
                infinite: true,
                arrows: false,
                dots: true,
                initialSlide: activeIndex,
                centerMode: true,
                centerPadding: '25%',
                slidesToShow: 1
            });
        }

        /**
         * Mapping DOM elements for chaching
         * @function mapDomElements
         * @private
         * @param {HTMLObject} element
         * @memberOf iwc.comp.familysubnav
        */
        function mapDomElements(element) {
            $familysubnav = $(element);
            $calibreFirstRowNav = $familysubnav.find(selectors.calibreFirstRowNav);
            $familysubnavOpenLink = $familysubnav.find(selectors.familysubnavOpenLink);
            $familysubnavNextLink = $familysubnav.find(selectors.familysubnavNextLink);
            $calibreSubNav = $familysubnav.find(selectors.calibreSubNav);
            $calibreSubNavItem = $familysubnav.find(selectors.calibreSubNavItem);
            $subNavLink = $familysubnav.find(selectors.subNavLink);
            $subNavActive = $familysubnav.find(selectors.subNavActive);
            $template = $familysubnav.find(selectors.template);
        }
        /**
         * Bind click events
         * @function bindEvents
         * @private
         * @memberOf iwc.comp.familysubnav
        */
        function bindEvents() {
            $familysubnavOpenLink.on('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                $familysubnav.toggleClass(cssClass.openNav);
                $body.toggleClass(cssClass.familysubnavOverlay);
            });
            $calibreSubNavItem.on('click', loadContentOnPage);
            $familysubnav.on('click', selectors.nextPrevLinks, loadContentOnPage);
            $body.on('click', hideNavigation);
            $calibreSubNav.on('click', function(e) {
                e.stopPropagation();
            });
        }

        /**
         * Initialize Calibre Navigation Component
         * @function init
         * @private
         * @param {HTMLObject} element
         * @memberOf iwc.comp.familysubnav
        */
        function init(element) {
            mapDomElements(element);
            bindEvents();
            if (util.matchmedia.narrow.matches) {
                mobileSubNav();
            }
            template = $template.text();
            updateNavigation();
        }

        return {
            init: init
        };

    })(iwc.$, iwc.util);
}());

/*global iwc*/
/**
 * functionality for the Featured Watch Section
 */

(function() {
    'use strict';

    /*
     * featuredWatch component
     * @namespace featuredWatch
     * @memberof iwc.comp
     */
    iwc.comp.featuredWatch = (function($, util) {
        var selectors = {
                defaultObject:'.iwc-featured-watch',
                slickElement:'.iwc-featured-watch-slide',
                productSlide:'.iwc-product-watch'
            },
            cssClass = {
                singleSlide: 'iwc-single-slide',
                editMode: 'iwc-edit-mode'
            },
            $body = $('body'),
            $featuredWatchSection,
            $slickElement,
            slickLength,
            centerMode,
            isMobile = util.matchmedia.narrow.matches;

        /*
        * Initialise Carousel for watch
        * @memberOf iwc.comp.featuredWatch
        * @param  {Object} $slickElement the object
        */
        function initCarousel() {
            if (slickLength === 1 && isMobile) {
                centerMode = false;
                $slickElement.addClass(cssClass.singleSlide);
            } else if (slickLength > 1 && isMobile) {
                centerMode = true;
            }

            $slickElement.slick({
                speed: 300,
                slidesToShow: 4,
                slidesToScroll: 1,
                responsive: [
                    {
                        breakpoint: 1024,
                        settings: {
                            slidesToShow: 3
                        }
                    },{
                        breakpoint: 768,
                        settings: {
                            slidesToShow: 1,
                            arrows: false,
                            centerMode: centerMode,
                            centerPadding: '25%'
                        }
                    }
                ]
            });
        }

        /**
        * Initialise a feature watches element.
        * @memberOf iwc.comp
        */
        function init(element) {
            $featuredWatchSection = $(element) || $(selectors.defaultObject);
            $slickElement = $featuredWatchSection.find(selectors.slickElement);
            slickLength = $slickElement.find(selectors.productSlide).length;
            if (!$body.hasClass(cssClass.editMode)) {
                initCarousel();
            }
        }

        return {
            init: init
        };

    })(iwc.$, iwc.util);
}());

/*global iwc*/
/**
 * functionality for the productcollection component
 */

(function() {
    'use strict';
    /*
     * productcollection component
     * @namespace productcollection
     * @memberof iwc.comp
     */
    iwc.comp.productcollection = (function($) {
        var $component,
            $subComponents,
            selectors = {
                subComponent: '.iwc-component'
            };
        /**
         * Initialises a productcollection component
         * @memberOf iwc.comp.productcollection
         * @param {HTMLElement} elem DOM element
         * @function init
         */
        function init(elem) {
            $component = $(elem);
            $subComponents = $component.find(selectors.subComponent);
        }

        return {
            init: init
        };
    })(iwc.$, iwc.util);
}());

/*global iwc*/
/**
 * functionality for the captcha component
 */

(function() {
    'use strict';

    /*
     * captcha component
     * @namespace captcha
     * @memberof iwc.comp
     */
    iwc.comp.captcha = (function($) {
        var getCaptchaSitekey,
            getCaptchID,
            captchaAjaxUrl = '//www.google.com/recaptcha/api/js/recaptcha_ajax.js',
            selectors = {
                captchaElement: '#recaptcha_widget'
            };

        /**
         * Re-Initialise a captcha element.
         * @memberOf iwc.comp.captcha
         * @function captchaReinit
         * @private
         */
        function captchaReinit() {
            if (window.Recaptcha && window.Recaptcha.create) {
                window.Recaptcha.create(getCaptchaSitekey, getCaptchID, window.RecaptchaOptions);
            }
        }

        /**
         * Initialise a captcha element.
         * @memberOf iwc.comp.captcha
         * @function init
         * @public
         */

        function init() {
            var $elem = $(selectors.captchaElement);
            getCaptchaSitekey = $elem.data('sitekey');
            getCaptchID = $elem.attr('id');
            /* jshint ignore:start */
            /* jscs:disable*/
            window.RecaptchaOptions = {
                custom_translations: {
                    instructions_visual: $elem.data('captchaInstructionsvisual'),
                    instructions_audio: $elem.data('captchaInstructionsaudio'),
                    play_again: $elem.data('captchaPlayagain'),
                    cant_hear_this: $elem.data('captchaCanthearthis'),
                    visual_challenge: $elem.data('captchaVisualchallenge'),
                    audio_challenge: $elem.data('captchaAudiochallenge'),
                    refresh_btn: $elem.data('captchaRefreshbtn'),
                    help_btn: $elem.data('captchaHelpbtn'),
                    incorrect_try_again: $elem.data('captchaIncorrecttryagain')
                },
                theme : 'custom',
                custom_theme_widget: 'recaptcha_widget'
            }
            /* jscs:enable*/
            /* jshint ignore:end */
            $.subscribe('iwc:forms:reinit', captchaReinit);
            $.getScript(captchaAjaxUrl, function() {
                window.Recaptcha.create(getCaptchaSitekey, getCaptchID, window.RecaptchaOptions);
            });
        }

        return {
            init: init
        };
    })(iwc.$);
}());

/*global iwc, grecaptcha*/
/**
 * functionality for the captcha component
 */

(function() {
    'use strict';

    /*
     * captcha component
     * @namespace captcha
     * @memberof iwc.comp
     */
    iwc.comp.captcha2 = (function($, util) {
        var getCaptchaSitekey,
            $elem,
            selectors = {
                captchaElement: '#recaptcha_widget_v2',
                captchaDiv: '#iwc-captcha-v2 > div'
            };

        /**
        * Resizes captcha element based upon parent container.
        * @memberOf iwc.comp.captcha2
        * @function scaleCaptcha
        * @public
        */
        function scaleCaptcha() {
            var reCaptchaWidth = 304,
                containerWidth = $(selectors.captchaElement).width();
            if (reCaptchaWidth > containerWidth) {
                var captchaScale = containerWidth / reCaptchaWidth;
                $elem.find(selectors.captchaDiv).css({
                    '-moz-transform': 'scale(' + captchaScale + ')',
                    '-ms-transform':  'scale(' + captchaScale + ')',
                    '-o-transform':   'scale(' + captchaScale + ')',
                    'transform':      'scale(' + captchaScale + ')'
                });
            } else {
                $elem.find(selectors.captchaDiv).css({
                    '-moz-transform': '',
                    '-ms-transform':  '',
                    '-o-transform':   '',
                    'transform':      ''
                });
            }
        }
        /**
        * Fixes scroll issue of captcha2 on iOS10.
        * @memberOf iwc.comp.captcha2
        * @function onCaptchaCallback
        */
        window.scrollCaptcha = false;
        function onCaptchaCallback() {
            if (window.scrollCaptcha) {
                $('html, body').scrollTop(window.scrollCaptcha);
            }
        }

        /**
        * Renders a captcha element.
        * @memberOf iwc.comp.captcha2
        * @function renderCaptcha
        * @public
        */
        window.renderCaptcha = function() {
            $elem = $(selectors.captchaElement);
            getCaptchaSitekey = $elem.data('sitekey');
            //IOS 10 issue on recaptcha  workaround
            document.addEventListener('scroll', function() {
                var el =  $elem.get(0),
                    theTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop,
                    elemTop = el.getBoundingClientRect().top,
                    elemBottom = el.getBoundingClientRect().bottom,
                    isVisible = (elemTop >= 0) && (elemBottom <= window.innerHeight);
                if (isVisible) {
                    window.scrollCaptcha = theTop;
                }
            });
            // render when only  errors , or server code redirects
            grecaptcha.render('iwc-captcha-v2', {
                'sitekey' : getCaptchaSitekey ,
                'callback': onCaptchaCallback
            });
            scaleCaptcha();
            $(window).resize(util.debounce(scaleCaptcha, 250)) ;
        };

    })(iwc.$, iwc.util);
}());

/*global iwc */
/**
 * functionality for the Login
 */
(function() {
    'use strict';

    /*
     * login component
     * @memberof iwc.comp
     */
    iwc.comp.login = (function($, util) {

        var name = 'login',
            $body = $('body'),
            $overlay,
            $login,
            $form,
            $submitbtn,
            $header,
            $errorField,
            $confirmationWrapper,
            loginVariant,
            loginPath,
            errorMarkup = '<div class="iwc-login-error iwc-error iwc-hidden" role="alert" aria-labelledby="Form error"></div>',
            selectors = {
                overlay: '.iwc-lightbox-content',
                base: '.iwc-login',
                header: '.iwc-account-menu',
                loginLink: '.iwc-link-login',
                registerLink: '.iwc-link-register',
                errorSelector: '.iwc-login-error',
                confirmationWrapper: '.iwc-account-confirmation',
                loginpagepath: '#loginpagepath',
                resource: '#resource',
                loggedInLink: '.iwc-account-menu-logged-in'
            },
            cssClass = {
                hide: 'iwc-hidden'
            },
            formUrl = window.location.pathname + '/j_security_check?j_validate=true';

        /**
         * toggleError message
         * @function toggleError
         * @private
         * @param {boolean} showError true/false
         * @param {string} msg error message
         * @memberof iwc.comp.login
         */
        function toggleError(showError, msg) {
            if (msg) {
                $errorField.text(msg).toggleClass(cssClass.hide, !showError);
                $submitbtn.prop('disabled', false);
            }
            util.ajaxloader.hide();
        }

        /**
         * updateHeader
         * @function updateHeader
         * @private
         * @param {object} data object
         * @memberof iwc.comp.login
         */
        function updateHeader(data) {

            if (data && data.values) {
                // redirect to ASR if first login
                var loginLinkUrl = $body.data('login-link-url');
                if (loginLinkUrl) { window.location.href = loginLinkUrl;
                } else {
                    if (data.values.firstLogin === 'true') {
                        window.location.href = $body.data('asr-url') || window.location.reload();
                        return;
                    } else {
                        window.location.reload();
                    }
                }
            }
        }

        /**
         * Redirect Page
         * @function redirectPage
         * @private
         * @memberof iwc.comp.login
         */
        function redirectPage() {
            var checkoutPagePath = $login.data('checkoutpagepath');
            window.location.href = checkoutPagePath || window.location.reload();
        }

        /**
         * Login Handle
         * @function loginHandle
         * @private
         * @param {object} data object with user name
         * @memberof iwc.comp.login
         */
        function loginHandle(data) {
            if (loginVariant !== 'checkoutlogin') {
                updateHeader(data);
            } else {
                redirectPage();
            }
        }

        /**
         * showError
         * @function showError
         * @private
         * @param {object} response json response
         * @memberof iwc.comp.login
         */
        function showError(response) {
            var errorMessage;
            if (response && response.values) {
                errorMessage = response.values.errorMessage;
                toggleError(true, errorMessage);
            }
        }

        /**
         * login failure handler
         * @function loginError
         * @private
         * @param {string} data ajax response
         * iwc.comp.login
         */
        function loginError(jqXHR, textStatus, errorText) {
            toggleError(true, errorText);
            util.ajaxloader.hide();
        }

        /**
         * login Success Handler
         * @function loginSuccess
         * @private
         * iwc.comp.login
         */
        function loginSuccess(response) {
            util.ajaxloader.show();
            var loginjson;
            if (response && response.status) {
                showError(response);
                util.tracking.iwcCustomTracking({
                    'loginFailed': 'Yes'
                });
            } else {
                // get data
                util.tracking.iwcCustomTracking($login.data('tracking'));
                util.tracking.iwcCustomTracking({
                    'loginFailed': 'No'
                });
                $.get(loginPath)
                .done(function(response) {
                    if (response !== '') {

                        loginjson = response || null;

                        if (loginjson) {
                            loginjson.status.toLowerCase() === 'success' ? loginHandle(loginjson) : showError(loginjson);
                        }

                    } else {
                        toggleError(true);
                    }
                }).fail(loginError);
            }
        }

        /**
         * Form submit handler
         * @function submitHandler
         * @private
         * @param {object} e event object
         * iwc.comp.login
         */
        function submitHandler(e) {
            util.ajaxloader.show();

            var loginForm = e.target,
                formData = null,
                $resourcePathField,
                $loginPathField;

            if (loginForm && loginForm.name && loginForm.name.indexOf('login') !== -1) {

                e.preventDefault();

                if (!$form.valid()) {
                    util.ajaxloader.hide();
                    return;
                }

                $loginPathField = $form.find(selectors.loginpagepath);
                $resourcePathField = $form.find(selectors.resource);

                //update path
                loginPath = util.dataStore.getCurrentPagePathWithoutSelector() + '.login-status.json?cacheburst=' + new Date().getTime();

                // hidden fields
                $loginPathField.val(loginPath);
                $resourcePathField.val(loginPath);

                // serialise data
                formData = $form.serialize();
                // disable form to prevent multiple submit
                $submitbtn.prop('disabled', true);
                // post data
                $.post(formUrl, formData)
                .done(loginSuccess).fail(loginError);
            }
        }

        /**
         * Destroy login
         * @function destroy
         * @public
         * @param {HTMLObject} element
         * @memberOf iwc.comp.login
         */
        function destroy(pageName) {

            if (pageName === name) {

                $.each([$login, $form, $submitbtn, $header, $errorField], function(index, item) {
                    item = null;
                });

                $form.off('submit.' + name);
            }
        }

        /**
         * Initialize Login Component
         * @function init
         * @public
         * @param {HTMLObject} element
         * @memberOf iwc.comp.login
        */
        function init(elem) {

            $login = $(elem[0]) || $(selectors.base);

            if (!$login.is('.iwc-login')) {
                return;
            }

            $overlay = $(selectors.overlay);
            $form = $overlay.find('form');
            $submitbtn = $form.find('input[type="submit"]');
            $header = $(selectors.header);
            $form.find('.system_form_password').after(errorMarkup);
            $errorField = $form.find(selectors.errorSelector);
            //confirmation
            $confirmationWrapper = $overlay.find(selectors.confirmationWrapper);
            // is Registration complete
            if (window.location.search.indexOf('emailActivation=true') !== -1) {
                $confirmationWrapper.removeClass(cssClass.hide);
            }
            loginVariant = $login.data('variant');
            //form
            iwc.comp.forms.init($form);
            iwc.util.formsAnimation.reInit($overlay);
            iwc.util.lightbox.reInit($overlay);
            //bind events
            $form.on('submit.' + name, submitHandler);
            $.subscribe('iwc:lightbox:close', destroy);
        }

        return {
            init: init,
            destroy: destroy
        };

    })(iwc.$, iwc.util);
}());

/*global iwc */
/**
 * functionality for the Guest Login
 */
(function() {
    'use strict';

    /*
     * Guest login component
     * @memberof iwc.comp
     */
    iwc.comp.guestlogin = (function($, util) {

        var name = 'guestlogin',
            $body = $('body'),
            $overlay,
            $guestlogin,
            $form,
            $submitbtn,
            $errorWrapper,
            selectors = {
                overlay: '.iwc-lightbox-content',
                base: '.iwc-guestlogin',
                emailElement: 'input[name="guest.email"]',
                errorWrapper: '.base-forms-server-side-error',
                captchaElement: '.system_form_captcha.section'
            },
            cssClass = {
                hide: 'iwc-hidden'
            };

        /**
         * Ajax success handler
         * @function successHandler
         * @private
         * @param {object} response Ajax success response
         * iwc.comp.guestlogin
         */
        function successHandler(response) {
            var checkoutPagePath = $guestlogin.data('checkoutpagepath');
            util.ajaxloader.show();
            if (response.status.toLowerCase() === 'success') {
                window.location.href = checkoutPagePath || window.location.reload();
                return;
            } else {
                $errorWrapper.text(response.values.errorMessage);
                util.ajaxloader.hide();
            }
        }

        /**
         * Ajax error handler
         * @function errorHandler
         * @private
         * @param {object} response Ajax fail response
         * iwc.comp.guestlogin
         */
        function errorHandler(jqXHR, textStatus, errorText) {
            $errorWrapper.text(errorText);
            util.ajaxloader.hide();
        }

        /**
         * Form submit handler
         * @function submitHandler
         * @private
         * iwc.comp.guestlogin
         */
        function submitHandler() {
            if (!$form.valid()) {
                return;
            }

            util.tracking.iwcCustomTracking($guestlogin.data('tracking'));

            var formUrl = util.helper.removeHtmlExtension(util.dataStore.getCurrentPagePath()) + '.update-commerce-email.json',
                formData = {
                    emailId: $form.find(selectors.emailElement).val()
                };
            // post form data
            $.post(formUrl, formData)
                .done(successHandler).fail(errorHandler);
        }

        /**
         * Destroy login
         * @function destroy
         * @public
         * @param {HTMLObject} element
         * @memberOf iwc.comp.guestlogin
         */
        function destroy(pageName) {

            if (pageName === name) {

                $.each([$guestlogin, $form, $submitbtn], function(index, item) {
                    item = null;
                });

                $form.off('submit.' + name);
            }
        }

        /**
         * Form reinit
         * @function formInitHandler
         * @private
         * @param {Object} form Form element
         * @memberOf iwc.comp.guestlogin
         */
        function formInitHandler(form, success) {
            iwc.comp.forms.init($(form));
            util.formsAnimation.reInit($overlay);
            if (success) {
                $(selectors.captchaElement).addClass(cssClass.hide);
                submitHandler();
            }
        }

        /**
         * Initialize Login Component
         * @function init
         * @public
         * @param {HTMLObject} element
         * @memberOf iwc.comp.guestlogin
        */
        function init(elem) {

            $guestlogin = $(elem);

            $overlay = $(selectors.overlay);
            $form = $overlay.find('form');
            $submitbtn = $form.find('input[type="submit"]');
            $errorWrapper = $form.find(selectors.errorWrapper);

            //form
            iwc.comp.forms.init($form);
            util.formsAnimation.reInit($overlay);
            util.lightbox.reInit($overlay);
            //bind events
            $.subscribe('iwc:forms:reinit', formInitHandler);
            $.subscribe('iwc:lightbox:close', destroy);
            $body.scrollTop(0);
        }

        return {
            init: init,
            destroy: destroy
        };

    })(iwc.$, iwc.util);
}());

/*global iwc, base */
/**
 * functionality for the Register
 */

(function() {
    'use strict';

    /*
     * register component
     * @memberof iwc.comp
     */
    iwc.comp.register = (function($, util) {

        var name = 'register',
            $overlay,
            $register,
            $form,
            $submitbtn,
            $errorField,
            $registerWrapper,
            $confirmationWrapper,
            $resendEmailLink,
            $emailField,
            $aemCaptchaWrapper,
            guestemail,
            errorMarkup = '<div class="iwc-register-error iwc-error iwc-hidden" role="alert" aria-labelledby="Form error"></div>',
            selectors = {
                overlay: '.iwc-lightbox-content',
                base: '.iwc-register',
                loginLink: '.iwc-link-login',
                registerLink: '.iwc-link-register',
                errorSelector: '.iwc-register-error',
                registerWrapper: '.iwc-account-form',
                confirmationWrapper: '.iwc-account-confirmation',
                passwdField: '.system_form_password',
                resendEmailLink: '.iwc-resend-email',
                emailField: '.iwc-register-email',
                aemCaptchaWrapper: '.base-aemcaptcha'
            },
            cssClass = {
                hide: 'iwc-hidden'
            },
            $errElem = $('<span class="iwc-error"></span>'),
            formUrl = window.location.pathname;
        /**
         * Confirmation error handler
         * @function confirmationErrorHandler
         * @private
         * @param {object} data object with user name
         * @memberof iwc.comp.register
         */
        function confirmationErrorHandler(msg) {
            $errElem.text(msg).removeClass(cssClass.hide).appendTo($resendEmailLink);
        }

        /**
         * Activation call success handler
         * @function activationSuccess
         * @private
         * @param {object} data object with user name
         * @memberof iwc.comp.register
         */
        function activationSuccess(data) {

            var errorMessage;

            if (data.status.toLowerCase() === 'success') {
                util.lightbox.closeLightbox();
            } else {
                errorMessage = data.values.errorMessage;
                confirmationErrorHandler(errorMessage);
            }
        }
        /**
         * Activation failure handler
         * @function activationError
         * @private
         * @param {object} data object with user name
         * @memberof iwc.comp.register
         */
        function activationError() {
            confirmationErrorHandler(iwc.util.formError.getdefault());
        }

        /**
         * resendActivationHandler message
         * @function toggleError
         * @private
         * @param {object} e event object
         * @memberof iwc.comp.register
         */
        function resendActivationHandler(e) {
            e.preventDefault();
            // post data
            var activationUrl = formUrl.replace('.html', '') + '.resend-confirmation.json',
                emailData = {
                    email: $emailField.val()
                };
            // make call
            $.ajax({
                url: activationUrl,
                type: 'POST',
                data: emailData
            })
            .done(activationSuccess)
            .fail(activationError);
        }

        /**
         * showConfirmation
         * @function showConfirmation
         * @private
         * @param {boolean} data Success response true/false
         * @memberof iwc.comp.register
         */
        function showConfirmation(data) {

            if (data) {
                util.tracking.publish($register);

                $registerWrapper.addClass(cssClass.hide);
                $confirmationWrapper.removeClass(cssClass.hide);
            }
        }

        /**
         * Destroy Register
         * @function destroy
         * @public
         * @param {HTMLElement} pageName element
         * @memberOf iwc.comp.register
         */
        function destroy(pageName) {

            if (pageName === name) {

                $.each([$register, $form, $submitbtn, $errorField], function(index, item) {
                    item = null;
                });

                $form.off('submit.' + name);
            }
        }

        /**
         * Form reinit
         * @function formInitHandler
         * @private
         * @param {object} form Form element
         * @param {Boolean} data Success true/false
         * @memberOf iwc.comp.register
         */
        function formInitHandler(form, data) {
            iwc.comp.forms.init($(form));
            showConfirmation(data);
            util.formsAnimation.reInit($overlay);
        }

        /**
         * Populate EmailId of guest user
         * @function populateEmailId
         * @private
         * @memberOf iwc.comp.register
         */
        function populateEmailId() {
            guestemail = $register.data('guestemail');

            if (guestemail !== undefined) {
                $emailField.val(guestemail);
            }
        }

        /**
         * Initialize Register Component
         * @function init
         * @public
         * @param {HTMLElement} element
         * @memberOf iwc.comp.register
        */
        function init(elem) {

            $register = $(elem[0]) || $(selectors.base);

            if (!$register.is('.iwc-register')) {
                return;
            }

            $overlay = $(selectors.overlay);

            //register
            $registerWrapper = $overlay.find(selectors.registerWrapper);

            //register form
            $form = $registerWrapper.find('form');
            $submitbtn = $form.find('input[type="submit"]');
            $form.find(selectors.passwdField).after(errorMarkup);
            $errorField = $form.find(selectors.errorSelector);

            //confirmation
            $confirmationWrapper = $overlay.find(selectors.confirmationWrapper);
            $resendEmailLink = $confirmationWrapper.find(selectors.resendEmailLink);
            $emailField = $form.find(selectors.emailField);
            $aemCaptchaWrapper = $form.find(selectors.aemCaptchaWrapper);
            populateEmailId();
            //form
            iwc.comp.forms.init($form);
            iwc.util.formsAnimation.reInit($overlay);
            iwc.util.lightbox.reInit($overlay);
            if ($aemCaptchaWrapper.length) {
                base.comp.captcha.aemCaptcha.init($aemCaptchaWrapper);
            }
            //bind events
            $resendEmailLink.on(util.events.INTERACTION, resendActivationHandler);
            $.subscribe('iwc:lightbox:close', destroy);
            $.subscribe('iwc:forms:reinit', formInitHandler);
        }

        return {
            init: init,
            destroy: destroy
        };

    })(iwc.$, iwc.util, base);
}());

/*global iwc*/
/**
 * functionality for the Related Watches Section
 */

(function() {
    'use strict';

    /*
     * My Account navigation  component
     * @namespace myaccountnav
     * @memberof iwc.comp
     */
    iwc.comp.myaccountnav = (function($) {
        /**
         * Initialise a myaccountnav element.
         * @memberOf iwc.comp.myaccountnav
         */
        var selectors = {
                myaccountNavOpenLink:   '.iwc-primary-item-family-link',
                myaccountSubNav:        '.iwc-myaccount-sub-nav-list',
                subNavActive:           '.iwc-sub-nav-active-item',
                myaccountSubNavItem:    '.iwc-myaccount-sub-nav-item'
            },
            cssClass = {
                openNav:                'iwc-myaccount-nav-opened'
            },
            $myaccountNav,
            $myaccountNavOpenLink,
            $myaccountSubNav,
            $myaccountSubNavItem,
            $subNavActive;

        /**
         * Mapping DOM elements for chaching
         * @function mapDomElements
         * @private
         * @param {HTMLObject} element
         * @memberOf iwc.comp.myaccountNav
        */
        function mapDomElements(element) {
            $myaccountNav = $(element);
            $myaccountNavOpenLink = $myaccountNav.find(selectors.myaccountNavOpenLink);
            $myaccountSubNav = $myaccountNav.find(selectors.myaccountSubNav);
            $myaccountSubNavItem = $myaccountNav.find(selectors.myaccountSubNavItem);
            $subNavActive = $myaccountNav.find(selectors.subNavActive);
        }

        /**
         * Bind click events
         * @function bindEvents
         * @private
         * @memberOf iwc.comp.myaccountNav
        */
        function bindEvents() {
            $myaccountNavOpenLink.on('click', function(e) {
                e.preventDefault();
                $myaccountNav.toggleClass(cssClass.openNav, !$myaccountNav.hasClass(cssClass.openNav));
            });
        }

        /**
         * Initialize My Account Navigation Component
         * @function init
         * @public
         * @param {HTMLObject} element
         * @memberOf iwc.comp.myaccountNav
        */
        function init(element) {
            mapDomElements(element);

            //bind events
            bindEvents();
        }

        return {
            init: init
        };

    })(iwc.$);
}());

/*global iwc */
/**
 * functionality for the Login
 */
(function() {
    'use strict';

    /*
     * changepassword component
     * @memberof iwc.comp
     */
    iwc.comp.changepassword = (function($) {

        var selectors = {
                defineData: '.iwc-dd',
                defineTerm: '.iwc-dt',
                toggleLink: '.iwc-open-next'
            },
            cssClass = {
                hide: 'iwc-hidden'
            },
            $changePassComp,
            $form,
            $ddLink;

        /**
         * Show/Hide form
         * @function toggleForm
         * @private
         * @param {HTMLObject} element
         * @memberOf iwc.comp.changepassword
        */
        function toggleForm($changePassComp) {
            $ddLink = $changePassComp.find(selectors.toggleLink);
            $ddLink.on('click', function() {
                $changePassComp.find(selectors.defineData).addClass(cssClass.hide);
                $changePassComp.find(selectors.defineTerm).removeClass(cssClass.hide);
            });
        }

        /**
         * Form reinit
         * @function formInitHandler
         * @private
         * @param {object} form Form element
         * @memberOf iwc.comp.changepassword
         */
        function formInitHandler(form, data) {
            var $updatedForm = $(form);
            iwc.comp.forms.init($updatedForm);
            iwc.util.formsAnimation.reInit($changePassComp);
            if (data) {
                $updatedForm.removeClass(cssClass.hide);
            }
        }

        /**
         * Initialize Change Password Component
         * @function init
         * @public
         * @param {HTMLObject} element
         * @memberOf iwc.comp.changepassword
        */
        function init(elem) {
            $changePassComp = $(elem);
            $form = $changePassComp.find('form');
            toggleForm($changePassComp);
            //form
            iwc.comp.forms.init($form);
            $.subscribe('iwc:forms:reinit', formInitHandler);
        }

        return {
            init: init,
            toggleForm: toggleForm
        };

    })(iwc.$);
}());

/*global iwc */
/**
 * functionality for the Edit Profile
 */
(function() {
    'use strict';

    /*
     * editprofile component
     * @memberof iwc.comp
     */
    iwc.comp.editprofile = (function($, util) {

        var selectors = {
                defineData: '.iwc-dd',
                defineTerm: '.iwc-dt'
            },
            cssClass = {
                hide: 'iwc-hidden'
            },
            $body,
            $editprofile,
            $form,
            $closeLink;

        /**
         * Form reinit
         * @function formInitHandler
         * @private
         * @param {Object} form Form element
         * @param {boolean} data Success true/false
         * @memberOf iwc.comp.editprofile
         */
        function formInitHandler(form, data) {
            var $updatedForm = $(form);
            iwc.comp.forms.init($updatedForm);
            util.formsAnimation.reInit($editprofile);
            util.scrollTo.position($body.offset().top, 500);
            if (data) {
                window.location.reload();
            }
        }

        /**
         * Show/Hide form
         * @function toggleForm
         * @private
         * @param {HTMLObject} element
         * @memberOf iwc.comp.editprofile
        */
        function toggleForm($editprofile) {
            $closeLink = $editprofile.find('input[type="reset"]');
            $closeLink.on('click', function() {
                $editprofile.find(selectors.defineData).removeClass(cssClass.hide);
                $editprofile.find(selectors.defineTerm).addClass(cssClass.hide);
            });
        }

        /**
         * Initialize Edit Profile Component
         * @function init
         * @public
         * @param {HTMLObject} element
         * @memberOf iwc.comp
        */
        function init(elem) {
            $editprofile = $(elem);
            $body = $('body');
            //edit profile form
            $form = $editprofile.find('form');
            toggleForm($editprofile);
            //form init
            iwc.comp.forms.init($form);
            iwc.comp.changepassword.toggleForm($editprofile);
            $.subscribe('iwc:forms:reinit', formInitHandler);
        }

        return {
            init: init
        };

    })(iwc.$, iwc.util);
}());

/*global iwc */
/**
 * functionality for the Reset Password
 */
(function() {
    'use strict';

    /*
     * Reset Password component
     * @memberof iwc.comp
     */
    iwc.comp.resetpassword = (function($) {

        var $resetpasswordComp,
            $form,
            $overlay,
            $resetpasswordWrapper,
            selectors = {
                resetpasswordComp: '.iwc-resetpassword',
                overlay: '.iwc-lightbox-content',
                close: '.iwc-resetpassword-close',
                tokenHiddenField: 'input[name="token"]',
                emailHiddenField: 'input[name="emailAddress"]'
            },
            confirmData,
            htmlMarkup;

        /**
         * showConfirmation
         * @function showConfirmation
         * @private
         * @param {boolean} success Response true/false
         * @memberof iwc.comp.resetpassword
         */
        function showConfirmation(success) {
            confirmData = $resetpasswordComp.data('confirmMsgs');
            if (success) {
                htmlMarkup = '<div class="iwc-account-form-header" tabindex="0" role="header">' +
                    '<h3 class="iwc-heading">' + confirmData.heading + '</h3>' +
                        '<p>' + confirmData.message + '</p>' +
                    '</div>' +
                    '<div class="base-forms"><div class="base-forms-element button-wrapper">' +
                        '<input class="base-forms-button iwc-resetpassword-close" value="' + confirmData.btnText + '">' +
                    '</div></div>';
                $resetpasswordWrapper.html(htmlMarkup);
            }
        }

        /**
         * Form reinit
         * @function formInitHandler
         * @private
         * @param {object} form Form element
         * @param {Boolean} success Response true/false
         * @memberOf iwc.comp.resetpassword
         */
        function formInitHandler(form, success) {
            showConfirmation(success);
            iwc.comp.forms.init($(form));
            iwc.util.formsAnimation.reInit($overlay);
            if (window.location.href.indexOf('?') > -1) {
                history.pushState('', document.title, window.location.pathname);
            }
        }

        /**
         * Destroy Reset Password
         * @function destroy
         * @public
         * @param {String} pageName
         * @memberOf iwc.comp.resetpassword
         */
        function destroy(pageName) {

            if (pageName === name) {

                $.each([$resetpasswordComp, $form], function(index, item) {
                    item = null;
                });

                $form.off('submit.' + name);
                $.unsubscribe('iwc:forms:reinit');
                $.unsubscribe('iwc:lightbox:close');
            }
        }

        /**
         * Bind Events
         * @function bindEvents
         * @private
         * @memberOf iwc.comp.resetpassword
        */
        function bindEvents() {
            $resetpasswordWrapper.on('click', selectors.close, iwc.util.lightbox.closeLightbox);
        }

        /**
         * Update Reset Password Data
         * @function updateResetPasswordData
         * @private
         * @memberOf iwc.comp.resetpassword
        */
        function updateResetPasswordData() {
            var tokenValue = window.location.href.split('token=')[1].split('&email=')[0],
                emailValue = window.location.href.split('email=')[1];

            $overlay.find(selectors.tokenHiddenField).val(tokenValue);
            $overlay.find(selectors.emailHiddenField).val(emailValue);
        }

        /**
         * Initialize Reset Password Component
         * @function init
         * @public
         * @param {HTMLElement} element
         * @memberOf iwc.comp.resetpassword
        */
        function init(elem) {
            $resetpasswordComp = $(elem[0]);
            $overlay = $(selectors.overlay);
            $form = $overlay.find('form');
            $resetpasswordWrapper = $overlay.find(selectors.resetpasswordComp);
            iwc.util.formsAnimation.reInit($overlay);
            iwc.comp.forms.init($form);
            bindEvents();
            $.subscribe('iwc:forms:reinit', formInitHandler);
            $.subscribe('iwc:lightbox:close', destroy);

            // is Reset password url
            if (window.location.search.indexOf('resetpassword=true') !== -1) {
                updateResetPasswordData();
            }
        }

        return {
            init: init
        };

    })(iwc.$);
}());

/*global iwc */
/**
 * functionality for the Request Password
 */
(function() {
    'use strict';

    /*
     * Request Password component
     * @memberof iwc.comp
     */
    iwc.comp.requestpassword = (function($) {

        var $requestpasswordComp,
            $form,
            $overlay,
            $requestpasswordWrapper,
            selectors = {
                requestpasswordComp: '.iwc-requestpassword',
                overlay: '.iwc-lightbox-content',
                close: '.iwc-requestpassword-close',
                reset: 'input:reset'
            },
            confirmData,
            htmlMarkup,
            useremail;

        /**
         * showConfirmation
         * @function showConfirmation
         * @private
         * @param {boolean} data Success Response true/false
         * @memberof iwc.comp.requestpassword
         */
        function showConfirmation(form, success) {
            confirmData = $requestpasswordComp.data('confirmMsgs');
            useremail = $(form).find('input[name="email"]').val();
            if (success) {
                htmlMarkup = '<div class="iwc-account-form-header" tabindex="0" role="header">' +
                    '<h3 class="iwc-heading">' + confirmData.heading + '</h3>' +
                    '<p>' + confirmData.message + '</p>' +
                    '<p class="iwc-user-email">' + useremail + '</p>' +
                    '<p>' + confirmData.message2 + '</p>' +
                '</div>' +
                '<div class="base-forms"><div class="base-forms-element button-wrapper">' +
                    '<input class="base-forms-button iwc-requestpassword-close" value="' + confirmData.btnText + '">' +
                '</div></div>';

                $requestpasswordWrapper.html(htmlMarkup);
            }
        }

        /**
         * Form reinit
         * @function formInitHandler
         * @private
         * @param {HTMLElement} form Form element
         * @param {Boolean} success Response true/false
         * @memberOf iwc.comp.requestpassword
         */
        function formInitHandler(form, success) {
            iwc.comp.forms.init($(form));
            showConfirmation(form, success);
            iwc.util.formsAnimation.reInit($overlay);
        }

        /**
         * Destroy Register
         * @function destroy
         * @public
         * @param {String} pageName
         * @memberOf iwc.comp.requestpassword
         */
        function destroy(pageName) {

            if (pageName === name) {

                $.each([$requestpasswordComp, $form], function(index, item) {
                    item = null;
                });

                $form.off('submit.' + name);
                $.unsubscribe('iwc:forms:reinit');
                $.unsubscribe('iwc:lightbox:close');
            }
        }

        /**
         * Bind Events
         * @function bindEvents
         * @private
         * @memberOf iwc.comp.requestpassword
        */
        function bindEvents() {
            $requestpasswordWrapper.on('click', selectors.close, iwc.util.lightbox.closeLightbox);
            $requestpasswordWrapper.on('click', selectors.reset, iwc.util.lightbox.closeLightbox);
        }

        /**
         * Initialize Request Password Component
         * @function init
         * @private
         * @param {HTMLElement} element
         * @memberOf iwc.comp
        */
        function init(elem) {
            $requestpasswordComp = $(elem[0]);
            $overlay = $(selectors.overlay);
            $form = $overlay.find('form');
            $requestpasswordWrapper = $overlay.find(selectors.requestpasswordComp);
            iwc.util.formsAnimation.reInit($overlay);
            iwc.comp.forms.init($form);
            iwc.comp.captcha.init();
            bindEvents();
            $.subscribe('iwc:forms:reinit', formInitHandler);
            $.subscribe('iwc:lightbox:close', destroy);
        }

        return {
            init: init
        };

    })(iwc.$, iwc.util);
}());

/*global iwc, base */
/**
 * functionality for the Landing ASR
 */
(function() {
    'use strict';

    /*
     * landing ASR component
     * @memberof iwc.comp
     */
    iwc.comp.landingasr = (function($, util, base) {

        var $landingasr,
            $form,
            $body,
            selectors = {
                confirmWrapper: '.base-forms-confirmation',
                headingWrapper: '.iwc-heading',
                asrSuccessWrapper: '.iwc-success-asr'
            },
            cssClass = {
                hide: 'iwc-hidden',
                show: 'iwc-visible'
            };

        /**
         * Form reinit
         * @function formInitHandler
         * @private
         * @param {object} form Form element
         * @memberOf iwc.comp.landingasr
         */
        function formInitHandler(form, success) {
            var $updatedForm = $(form),
                successMsg = $landingasr.find(selectors.confirmWrapper).html().trim();
            if (success) {
                $landingasr.find(selectors.confirmWrapper).addClass(cssClass.hide).removeClass(cssClass.show);
                $landingasr.find(selectors.headingWrapper).html(successMsg);
                $(selectors.asrSuccessWrapper).addClass(cssClass.hide);
            } else {
                iwc.comp.forms.init($updatedForm);
                util.formsAnimation.reInit($landingasr);
            }
            util.scrollTo.position($body.offset().top, 500);
        }

        /**
         * Initialize Change Password Component
         * @function init
         * @public
         * @param {HTMLElement} elem
         * @memberOf iwc.comp.landingasr
        */
        function init(elem) {
            $landingasr = $(elem);
            $body = $('body');
            $form = $landingasr.find('form');
            //form
            iwc.comp.forms.init($form);
            $.subscribe('iwc:forms:reinit', formInitHandler);

            //in case of base form js on EU
            $.subscribe(base.util.customEvents.FORMS_SUCCESS, formInitHandler);
        }

        return {
            init: init
        };

    })(iwc.$, iwc.util, base);
}());

/*global iwc*/
/**
 * Newsletter register component
 */

(function() {
    'use strict';

    /**
     * Newsletter register component
     * @namespace newsletterregister
     * @memberof iwc.comp
     */
    iwc.comp.newsletterregister = (function($, util) {

        var selectors = {
                successMessage: '.iwc-newsletterregister-regular-success',
                optinSuccessMessage: '.iwc-newsletterregister-optin-success',
                formWrapper: '.iwc-newsletterregister-form-wrapper',
                optinEmail: '.iwc-newsletterregister-optin-email',
                countryHidden: '.system_form_hidden.section input[type="hidden"][name="country"]',
                salutationHidden: '.system_form_hidden.section input[type="hidden"][name="salutation"]',
                countryDropdown: 'select[name="country"]',
                salutationDropdown: 'select[name="salutation"]',
                email: 'input[name="email"]',
                confirmEmail: 'input[name="confirm-email"]',
                firstName: 'input[name="firstName1"]',
                lastName: 'input[name="lastName1"]'
            },
            cssClass = {
                hide: 'iwc-hidden'
            },
            $newsletterregister,
            $successMessageWrapper,
            $optinSuccessMessageWrapper,
            $formWrapper,
            $optinEmail,
            $countryHiddenField,
            $salutationHiddenField,
            customerType,
            doubleOptin;

        /**
         * Setup form for checked in user
         * @function loggedinUserSetup
         * @param {string | Number} customerType Form element
         * @param {object} $wrapperElement Form element
         * @private
         * @memberOf iwc.comp.newsletterregister
         */
        function loggedinUserSetup(customerType, $wrapperElement) {
            if (customerType !== 'Guest') {
                $wrapperElement.find(selectors.countryDropdown).prop('disabled', true);
                $wrapperElement.find(selectors.salutationDropdown).prop('disabled', true);
                $wrapperElement.find(selectors.firstName).prop('readonly', true);
                $wrapperElement.find(selectors.lastName).prop('readonly', true);
                $wrapperElement.find(selectors.email).prop('readonly', true);
                $wrapperElement.find(selectors.confirmEmail).prop('readonly', true);
            } else {
                $countryHiddenField.remove();
                $salutationHiddenField.remove();
            }
        }

        /**
         * Form reinit
         * @function formInitHandler
         * @private
         * @param {object} form Form element
         * @memberOf iwc.comp.newsletterregister
         */
        function formInitHandler(form, data) {
            var userEmail = $formWrapper.find('input[name="email"]').val();
            iwc.comp.forms.init($(form));
            util.formsAnimation.reInit($newsletterregister);
            util.scrollTo.position($newsletterregister.offset().top, 500);
            if (data) {
                if (doubleOptin) {
                    $optinEmail.text(userEmail);
                    $formWrapper.addClass(cssClass.hide);
                    $optinSuccessMessageWrapper.removeClass(cssClass.hide);
                } else {
                    $formWrapper.addClass(cssClass.hide);
                    $successMessageWrapper.removeClass(cssClass.hide);
                }
            }
            loggedinUserSetup(customerType, $(form));
        }

        /**
         * initialise newsletter register component
         * @function init
         * @public
         * @param {HTMLElement} element
         * @memberOf iwc.comp.newsletterregister
         */
        function init(elem) {
            $newsletterregister = $(elem);
            customerType = $newsletterregister.data('customerId');
            $formWrapper = $newsletterregister.find(selectors.formWrapper);
            $successMessageWrapper = $newsletterregister.find(selectors.successMessage);
            $optinSuccessMessageWrapper = $newsletterregister.find(selectors.optinSuccessMessage);
            doubleOptin = $newsletterregister.data('doubleOptin');
            $optinEmail = $newsletterregister.find(selectors.optinEmail);
            $countryHiddenField = $newsletterregister.find(selectors.countryHidden);
            $salutationHiddenField = $newsletterregister.find(selectors.salutationHidden);
            $.subscribe('iwc:forms:reinit', formInitHandler);
            loggedinUserSetup(customerType, $newsletterregister);
        }

        return {
            init: init
        };
    })(iwc.$, iwc.util);
}());

/*global iwc*/
/**
 * functionality for the preferred boutique
 */

(function() {
    'use strict';

    /*
     * Preferred boutique component
     * @namespace preferredboutique
     * @memberof iwc.comp
     */
    iwc.comp.preferredboutique = (function($, util) {
        var selectors = {
                mapObject: '.iwc-pref-btq-map-area',
                setBoutiqueBtn: '.iwc-pref-btq-btn-set',
                addressHolder: '.iwc-pref-btq-address',
                feedbackMessage: '.iwc-pref-btq-message',
                boutiqueContent: '.iwc-pref-btq-address-wrapper',
                addressTemplate: '.iwc-pref-btq-tmpl-address',
                changeBoutiqueBtn: '.iwc-pref-btq-btn-change',
                headingNearest: '.iwc-pref-btq-subheading-nearest',
                headingPrefered: '.iwc-pref-btq-subheading-preferred',
                toggleGroup: '[data-toggle-group]'
            },
            cssClass = {
                expand: 'expanded',
                success: 'iwc-success',
                error: 'iwc-error',
                hide: 'iwc-hidden'
            },
            CONST = {
                update: 'update',
                set: 'set'
            },
            $preferredBoutique,
            $mapObject,
            $setBoutiqueBtn,
            $feedbackMessage,
            $boutiqueContent,
            $addressTemplate,
            boutiqueData = [],
            userLocationLat,
            userLocationLng,
            nearestBoutiqueData;

        /**
         * show feedback message for success case
         * @function showSuccessMessage
         * @private
         * @memberOf iwc.comp.preferredboutique
         */
        function showSuccessMessage() {
            $feedbackMessage.addClass(cssClass.success).removeClass(cssClass.hide);
            $preferredBoutique.find(selectors.changeBoutiqueBtn).addClass(cssClass.hide);
            $setBoutiqueBtn.addClass(cssClass.hide);
            util.ajaxloader.hide();
        }

        /**
         * show feedback message for error case
         * @function showErrorMessage
         * @private
         * @param {Object} data ajax response
         * @memberOf iwc.comp.preferredboutique
         */
        function showErrorMessage(data) {
            $feedbackMessage.addClass(cssClass.error).removeClass(cssClass.hide).text(data.values.errorMessage);
            util.ajaxloader.hide();
        }

        /**
         * Set Boutique callback function for success
         * @function setBoutiqueSuccess
         * @private
         * @param {Object} data ajax response
         * @memberOf iwc.comp.preferredboutique
         */
        function setBoutiqueSuccess(data) {
            if (data) {
                data.status.toLowerCase() === 'success' ? showSuccessMessage() : showErrorMessage(data);
            }
        }

        /**
         * Set Boutique callback function for error
         * @function setBoutiqueError
         * @private
         * @memberOf iwc.comp.preferredboutique
         */
        function setBoutiqueError() {
            var errorMessage = iwc.util.formError.getdefault();
            $feedbackMessage.html(errorMessage).addClass(cssClass.error).removeClass(cssClass.hide);
            util.ajaxloader.hide();
        }

        /**
         * Set Boutique function
         * @function setBoutique
         * @private
         * @memberOf iwc.comp.preferredboutique
         */
        function setBoutique() {
            util.ajaxloader.show();
            var setBoutiqueUrl = iwc.util.dataStore.getCurrentPagePath() + '.update-boutique.json?cacheburst=' + new Date().getTime(),
                boutiqueidVal = $preferredBoutique.find(selectors.addressHolder).data('boutiqueId');
            $.post(setBoutiqueUrl, { boutiqueId : boutiqueidVal })
            .done(setBoutiqueSuccess)
            .fail(setBoutiqueError);
        }

        /**
         * Set nearest boutique content
         * @function setNearestBoutiqueData
         * @private
         * @param {Object} data Nearest boutique data
         * @param {string} state set/update
         * @memberOf iwc.comp.preferredboutique
         */
        function setNearestBoutiqueData(data, state) {
            util.mapRenderer.addMapOnRequest($mapObject, data.location.latitude, data.location.longitude);

            var openingHoursItems = '';
            $.each(data.openingHours, function(i, val) {
                openingHoursItems += ('<dd class="iwc-pref-btq-opening-time">' + val.dayOfWeek + ': ' + val.openingTime + ' - ' + val.closingTime + '</dd>');
            });

            var boutiqueTemplate = $addressTemplate.html()
                .replace('{{id}}', data.id)
                .replace('{{name}}', data.name || '')
                .replace('{{street}}', data.address.street || '')
                .replace('{{city}}', data.address.city || '')
                .replace('{{zipCode}}', data.address.zipCode || '')
                .replace('{{country}}', data.address.state || data.address.country || '')
                .replace('{{phone}}', data.phoneNumber || '')
                .replace('{{openingHours}}', openingHoursItems || '');
            $boutiqueContent.html(boutiqueTemplate);
            if (state === CONST.update) {
                $preferredBoutique.find(selectors.headingNearest).addClass(cssClass.hide);
                $preferredBoutique.find(selectors.headingPrefered).removeClass(cssClass.hide);
            }
            util.toggle.init($boutiqueContent.find(selectors.toggleGroup));
        }

        /**
         * Get user's location
         * @function getUserLocation
         * @private
         * @memberOf iwc.comp.preferredboutique
         */
        function getUserLocation() {
            util.userlocation.get().done(function(response) {
                userLocationLat = response.latitude;
                userLocationLng = response.longitude;
                nearestBoutiqueData = util.userlocation.nearestBoutique(userLocationLat, userLocationLng, boutiqueData);
                setNearestBoutiqueData(nearestBoutiqueData, CONST.set);
            }).fail(function() {
                $preferredBoutique.addClass(cssClass.hide);
            });
        }

        /**
         * Get boutique data
         * @function getBoutiqueData
         * @private
         * @memberOf iwc.comp.preferredboutique
         */
        function getBoutiqueData() {
            util.dataStore.getBoutiqueData().done(function(response) {
                boutiqueData = response;
                getUserLocation();
            }).fail(function() {
                $preferredBoutique.addClass(cssClass.hide);
            });
        }

        /**
         * update boutique data
         * @function updateBoutiqueData
         * @private
         * @param {number} boutiqueId Boutique id
         * @memberOf iwc.comp.preferredboutique
         */
        function updateBoutiqueData(boutiqueId) {
            for (var i = 0; i < boutiqueData.length; i++) {
                if (parseInt(boutiqueData[i].id, 10) === boutiqueId) {
                    setNearestBoutiqueData(boutiqueData[i], CONST.update);
                    $setBoutiqueBtn.addClass(cssClass.hide);
                }
            }
        }

        /**
         * Bind Events
         * @function bindEvents
         * @private
         * @memberOf iwc.comp.preferredboutique
        */
        function bindEvents() {
            //expand map on mobile
            $mapObject.on('click', function() {
                $mapObject.addClass(cssClass.expand);
            });

            // setting boutique
            $setBoutiqueBtn.on('click', setBoutique);
        }

        /**
         * Initialise a preferredBoutique element
         * @function init
         * @public
         * @memberOf iwc.comp.preferredboutique
         * @param {HTMLElement} elem element
         */
        function init(elem) {
            $preferredBoutique = $(elem);
            $mapObject = $preferredBoutique.find(selectors.mapObject);
            $setBoutiqueBtn = $preferredBoutique.find(selectors.setBoutiqueBtn);
            $feedbackMessage = $preferredBoutique.find(selectors.feedbackMessage);
            $boutiqueContent = $preferredBoutique.find(selectors.boutiqueContent);
            $addressTemplate = $preferredBoutique.find(selectors.addressTemplate);
            bindEvents();
            getBoutiqueData();
        }

        return {
            init: init,
            update: updateBoutiqueData
        };
    })(iwc.$, iwc.util);
}());

/*global iwc, base */
/**
 * functionality for the Address Book
 */
(function() {
    'use strict';

    /*
     * Address Book component
     * @namespace addressbook
     * @memberof iwc.comp
     */
    iwc.comp.addressbook = (function($, util, base) {

        var $addressBook,
            $addressWrapper,
            $addressItem,
            $addButton,
            $editButton,
            $removeButton,
            $template,
            $errorWrapper,
            $form,
            selectors = {
                base: '.iwc-addressbook',
                addressWrapper: '.iwc-address-wrapper',
                addressItem: '.iwc-address-item',
                addressItemContent: '.iwc-address-item-content',
                add: '.iwc-address-add-btn',
                edit: '.iwc-icn-edit',
                remove: '.iwc-icn-close',
                template: '.iwc-address-form',
                error: '.iwc-address-error',
                title: '.iwc-address-title',
                salutation: '.iwc-address-salutation',
                firstname: '.iwc-address-firstname',
                lastname: '.iwc-address-lastname',
                country: '.iwc-address-country',
                company: '.iwc-address-company',
                state: '.iwc-address-state',
                streetName: '.iwc-address-streetName',
                streetNumber: '.iwc-address-streetNumber',
                additionalAddress: '.iwc-address-additionalAddress',
                zip: '.iwc-address-zip',
                city: '.iwc-address-city',
                phone: '.iwc-address-phone',
                mobile: '.iwc-address-mobile',
                addressIdElement: 'input[name="addressId"]',
                residenceLabelElement: 'input[name="shipping-label"]',
                salutationElement: 'select[name="shipping.salutation"]',
                firstNameElement: 'input[name="shipping.firstname"]',
                lastNameElement: 'input[name="shipping.lastname"]',
                countryElement: 'select[name="shipping.country"]',
                countryEuElement: 'select[name="shipping.selector.field.name"]',
                countryEuHiddenField: 'input[name="shipping.selector.field.name"]',
                companyElement: 'input[name="shipping.company"]',
                stateElement: 'select[name="shipping.state"]',
                streetNameElement: 'input[name="shipping.streetname"]',
                streetNumberElement: 'input[name="shipping.streetnumber"]',
                additionalAddressElement: 'input[name="shipping.additionalAddress"]',
                additionalAddressElementUS: 'input[name="shipping.address2"]',
                zipElement: 'input[name="shipping.zip"]',
                postcodeElement: 'input[name="shipping.postcode"]',
                cityElement: 'input[name="shipping.city"]',
                phoneElement: 'input[name="shipping.phone"]',
                mobileElement: 'input[name="shipping.mobile"]',
                addressActionButtons: '.iwc-address-item-buttons',
                addressText: '.iwc-address-text',
                baseServerError: '.base-forms-server-side-error',
                cancel: '.base-forms-button[type="reset"]',
                baseFormsElement: '.base-forms-element'
            },
            cssClass = {
                remove: 'iwc-deleted',
                hide: 'iwc-hidden',
                addressbookus: 'iwc-addressbookus',
                addressbookeu: 'iwc-addressbookeu',
                inputFocused: 'input-focused'
            },
            CONST = {
                max: 9
            };

        /**
         * Scroll Top
         * @function scrollTop
         * @private
         * @memberOf iwc.comp.addressbook
         */
        function scrollTop() {
            util.scrollTo.position($addressBook.offset().top, 500);
        }

        /**
         * On add address button click
         * @function onAddAddress
         * @private
         * @param {object} e Event object
         * @memberOf iwc.comp.addressbook
         */
        function onAddAddress(e) {
            var $newItem,
                $target = $(e.target),
                maxlimitMessage = $addressBook.data('messageMaxlimit');

            $errorWrapper.empty();
            $addressWrapper.find(selectors.baseServerError).empty();
            $addressItem = $addressBook.find(selectors.addressItem) || {};
            $addressItem.find(selectors.addressIdElement).val('');
            $addressItem.find(selectors.stateElement).val('');
            $addressItem.find(selectors.countryElement).val('');

            if ($addressItem.length < CONST.max) {
                $target.addClass(cssClass.hide);
                $newItem = $addressItem
                    .last()
                    .clone(true);

                $newItem
                    .removeAttr('data-address-id')
                    .find(selectors.addressItemContent)
                    .empty()
                    .append($template.removeClass(cssClass.hide));
                $addressWrapper.append($newItem);

                if ($addressItem.hasClass(cssClass.hide)) {
                    $newItem.removeClass(cssClass.hide);
                    $addressItem.remove();
                }

                $newItem.find(selectors.addressActionButtons).addClass(cssClass.hide);

                $form = $newItem.find('form');

                $form.find(selectors.baseFormsElement).each(function(index, item) {
                    $(item).removeClass(cssClass.inputFocused);
                });

                iwc.comp.forms.init($form);
                iwc.util.formsAnimation.reInit($newItem);

            } else {
                $errorWrapper.text(maxlimitMessage);
                scrollTop();
            }

        }

        /**
         * Cache all elements
         * @function addressLoader
         * @private
         * @param {Object} $addressItem
         * @memberOf iwc.comp.addressbook
         */
        function addressLoader($addressItem) {
            var $addressId = $addressItem.find(selectors.addressIdElement),
                $residenceLabel = $addressItem.find(selectors.residenceLabelElement),
                $salutation = $addressItem.find(selectors.salutationElement),
                $firstName = $addressItem.find(selectors.firstNameElement),
                $lastName = $addressItem.find(selectors.lastNameElement),
                $country = $addressItem.find(selectors.countryElement),
                $streetNumber = $addressItem.find(selectors.streetNumberElement),
                $streetName = $addressItem.find(selectors.streetNameElement),
                $additionalAddress = $addressItem.find(selectors.additionalAddressElement),
                $zip = $addressItem.find(selectors.zipElement),
                $city = $addressItem.find(selectors.cityElement),
                addressId = $addressItem.data('addressId'),
                residenceLabel = $.trim($addressItem.find(selectors.title).text()),
                salutation = $.trim($addressItem.find(selectors.salutation).data('salutation')),
                firstName = $.trim($addressItem.find(selectors.firstname).text()),
                lastName = $.trim($addressItem.find(selectors.lastname).text()),
                country = $.trim($addressItem.find(selectors.country).first().text()),
                streetNumber = $.trim($addressItem.find(selectors.streetNumber).text()),
                streetName = $.trim($addressItem.find(selectors.streetName).text()),
                additionalAddress = $.trim($addressItem.find(selectors.additionalAddress).text()),
                zip = $.trim($addressItem.find(selectors.zip).text()),
                city = $.trim($addressItem.find(selectors.city).text());

            $addressId.val(addressId);
            $residenceLabel.val(residenceLabel);
            $salutation.val(salutation);
            $firstName.val(firstName);
            $lastName.val(lastName);
            $country.val(country);
            $streetNumber.val(streetNumber);
            $streetName.val(streetName);
            $additionalAddress.val(additionalAddress);
            $zip.val(zip);
            $city.val(city);
        }

        /**
         * Cache all elements for US
         * @function addressLoaderUS
         * @private
         * @param {Object} $addressItem
         * @memberOf iwc.comp.addressbook
         */
        function addressLoaderUS($addressItem) {
            var $addressId = $addressItem.find(selectors.addressIdElement),
                $residenceLabel = $addressItem.find(selectors.residenceLabelElement),
                $salutation = $addressItem.find(selectors.salutationElement),
                $firstName = $addressItem.find(selectors.firstNameElement),
                $lastName = $addressItem.find(selectors.lastNameElement),
                $state = $addressItem.find(selectors.stateElement),
                $streetName = $addressItem.find(selectors.streetNameElement),
                $streetNumber = $addressItem.find(selectors.streetNumberElement),
                $additionalAddress = $addressItem.find(selectors.additionalAddressElementUS),
                $zip = $addressItem.find(selectors.zipElement),
                $city = $addressItem.find(selectors.cityElement),
                $phone = $addressItem.find(selectors.phoneElement),
                $mobile = $addressItem.find(selectors.mobileElement),
                addressId = $addressItem.data('addressId'),
                residenceLabel = $.trim($addressItem.find(selectors.title).text()),
                salutation = $.trim($addressItem.find(selectors.salutation).data('salutation')),
                firstName = $.trim($addressItem.find(selectors.firstname).text()),
                lastName = $.trim($addressItem.find(selectors.lastname).text()),
                state = $.trim($addressItem.find(selectors.state).text()),
                streetName = $.trim($addressItem.find(selectors.streetName).text()),
                streetNumber = $.trim($addressItem.find(selectors.streetNumber).text()),
                additionalAddress = $.trim($addressItem.find(selectors.additionalAddress).text()),
                zip = $.trim($addressItem.find(selectors.zip).text()),
                city = $.trim($addressItem.find(selectors.city).text()),
                phone = $.trim($addressItem.find(selectors.phone).text()),
                mobile = $.trim($addressItem.find(selectors.mobile).text());

            $addressId.val(addressId);
            $residenceLabel.val(residenceLabel);
            $salutation.val(salutation);
            $firstName.val(firstName);
            $lastName.val(lastName);
            $state.find('option:contains(' + state + ')').attr('selected', true);
            $streetName.val(streetName);
            $streetNumber.val(streetNumber);
            $additionalAddress.val(additionalAddress);
            $zip.val(zip);
            $city.val(city);
            $phone.val(phone);
            $mobile.val(mobile);
        }

        /**
         * Cache all elements for EU
         * @function addressLoaderEU
         * @private
         * @param {Object} $addressItem
         * @memberOf iwc.comp.addressbook
         */
        function addressLoaderEU($addressItem) {
            var $addressId = $addressItem.find(selectors.addressIdElement),
                $countryEu = $addressItem.find(selectors.countryEuElement),
                $countryEuHiddenField = $addressItem.find(selectors.countryEuHiddenField),
                addressId = $addressItem.data('addressId'),
                residenceLabel = $.trim($addressItem.find(selectors.title).text()),
                salutation = $.trim($addressItem.find(selectors.salutation).data('salutation')),
                firstName = $.trim($addressItem.find(selectors.firstname).text()),
                lastName = $.trim($addressItem.find(selectors.lastname).text()),
                countryEu = $.trim($addressItem.find(selectors.country).first().text()),
                company = $.trim($addressItem.find(selectors.company).first().text()),
                state = $.trim($addressItem.find(selectors.state).text()),
                streetName = $.trim($addressItem.find(selectors.streetName).text()),
                streetNumber = $.trim($addressItem.find(selectors.streetNumber).text()),
                additionalAddress = $.trim($addressItem.find(selectors.additionalAddress).text()),
                zip = $.trim($addressItem.find(selectors.zip).text()),
                city = $.trim($addressItem.find(selectors.city).text()),
                phone = $.trim($addressItem.find(selectors.phone).text()),
                mobile = $.trim($addressItem.find(selectors.mobile).text());

            function formAddressLoader($formObject) {
                var $residenceLabel = $addressItem.find(selectors.residenceLabelElement),
                $salutation = $addressItem.find(selectors.salutationElement),
                $firstName = $addressItem.find(selectors.firstNameElement),
                $lastName = $addressItem.find(selectors.lastNameElement),
                $company = $addressItem.find(selectors.companyElement),
                $state = $addressItem.find(selectors.stateElement),
                $streetName = $addressItem.find(selectors.streetNameElement),
                $streetNumber = $addressItem.find(selectors.streetNumberElement),
                $additionalAddress = $addressItem.find(selectors.additionalAddressElementUS),
                $zip = $addressItem.find(selectors.zipElement),
                $postcode = $addressItem.find(selectors.postcodeElement),
                $city = $addressItem.find(selectors.cityElement),
                $phone = $addressItem.find(selectors.phoneElement),
                $mobile = $addressItem.find(selectors.mobileElement);

                $residenceLabel.val(residenceLabel);
                $salutation.val(salutation);
                $firstName.val(firstName);
                $lastName.val(lastName);
                $company.val(company);
                $state.find('option:contains(' + state + ')').attr('selected', true);
                $streetName.val(streetName);
                $streetNumber.val(streetNumber);
                $additionalAddress.val(additionalAddress);
                $zip.val(zip);
                $postcode.val(zip);
                $city.val(city);
                $phone.val(phone);
                $mobile.val(mobile);
                util.formsAnimation.htmlInit($formObject);
            }

            $addressId.val(addressId);

            if ($countryEu.length) {
                $countryEu.val(countryEu).trigger('change');
            } else {
                formAddressLoader($addressItem);
            }

            $.subscribe(base.util.customEvents.DOM_UPDATED, function($response) {
                formAddressLoader($response);
            });

        }

        /**
         * Cancel Address Form
         * @function onCancelAddress
         * @private
         * @param {object} e Event object
         * @memberOf iwc.comp.addressbook
         */
        function onCancelAddress(e) {
            $addressItem = $(e.target).closest(selectors.addressItem) || {};
            var addressId = $addressItem.attr('data-address-id');

            if (addressId !== undefined) {
                $addressItem.find(selectors.template).addClass(cssClass.hide);
                $addressItem.find(selectors.addressText).removeClass(cssClass.hide);
            } else if ((addressId === undefined) && ($addressWrapper.find(selectors.addressItem).length < 2)) {
                $addressItem.addClass(cssClass.hide);
            } else {
                $addressBook.append($template.addClass(cssClass.hide));
                $addressItem.remove();
            }

            $addButton.removeClass(cssClass.hide);
            $addressItem.find(selectors.addressActionButtons).removeClass(cssClass.hide);
            scrollTop();
        }

        /**
         * Open form on edit button click
         * @function onEditAddress
         * @private
         * @param {object} e Event object
         * @memberOf iwc.comp.addressbook
         */
        function onEditAddress(e) {
            var $target = $(e.target);
            onCancelAddress(e);
            $addressItem = $target.closest(selectors.addressItem) || {};
            $errorWrapper.empty();
            $addressWrapper.find(selectors.addressActionButtons).removeClass(cssClass.hide);
            $addressItem.find(selectors.addressActionButtons).addClass(cssClass.hide);
            $addressWrapper.find(selectors.addressText).removeClass(cssClass.hide);
            $addressItem.find(selectors.addressText).addClass(cssClass.hide);
            $addressWrapper.find(selectors.baseServerError).empty();
            $addButton.addClass(cssClass.hide);

            $addressItem.find(selectors.addressItemContent)
                .addClass(cssClass.hide)
                .append($template.removeClass(cssClass.hide));

            $addressWrapper.find(selectors.addressItem).each(function(index, item) {
                if ($(item).data('addressId') === undefined) {
                    $(item).remove();
                }
            });
            $form = $addressItem.find('form');

            if ($addressBook.hasClass(cssClass.addressbookus)) {
                addressLoaderUS($addressItem);
            } else if ($addressBook.hasClass(cssClass.addressbookeu)) {
                addressLoaderEU($addressItem);
            } else {
                addressLoader($addressItem);
            }

            iwc.comp.forms.init($form);
            iwc.util.formsAnimation.reInit($addressWrapper);
        }

        /**
         * Delete address
         * @function onDeleteAddress
         * @private
         * @param {object} e Event object
         * @memberOf iwc.comp.addressbook
         */
        function onDeleteAddress(e) {
            var formUrl = util.dataStore.getCurrentPagePath() + '.delete-address.json',
                deleteMessage = $addressBook.data('messageDelete');

            $errorWrapper.empty();
            $addressItem = $(e.target).closest(selectors.addressItem) || {};
            if (window.confirm(deleteMessage)) {
                $addressItem.addClass(cssClass.remove);
                // make call
                $.ajax({
                    url: formUrl,
                    type: 'POST',
                    data: {
                        addressId: $addressItem.data('address-id')
                    }
                })
                .done(function() {
                    $addressItem.remove();
                })
                .fail(function(jqXHR, textStatus, errorText) {
                    $errorWrapper.text(errorText);
                    $addressItem.removeClass(cssClass.remove);
                });
            }
        }

        /**
         * Bind events
         * @function bindEvents
         * @private
         * @memberOf iwc.comp.addressbook
         */
        function bindEvents() {
            $addButton.on('click', onAddAddress);
            $editButton.on('click', onEditAddress);
            $removeButton.on('click', onDeleteAddress);
            $addressBook.on('click', selectors.cancel, onCancelAddress);
        }

        /**
         * Form reinit
         * @function formInitHandler
         * @private
         * @param {HTMLElement} form Form element
         * @param {Boolean} success true/false
         * @memberOf iwc.comp.addressbook
         */
        function formInitHandler(form, success) {
            if (success) {
                scrollTop();
                window.location.reload();
            } else {
                iwc.comp.forms.init($(form));
                util.formsAnimation.reInit($addressWrapper);
            }
        }

        /**
         * Initialize Address Book
         * @function init
         * @public
         * @param {HTMLElement} elem HTML element
         * @memberOf iwc.comp.addressbook
         */
        function init(elem) {
            $addressBook = $(elem) || $(selectors.base);
            $addressWrapper = $addressBook.find(selectors.addressWrapper);
            $addButton = $addressBook.find(selectors.add);
            $editButton = $addressBook.find(selectors.edit);
            $removeButton = $addressBook.find(selectors.remove);
            $template = $addressBook.find(selectors.template);
            $errorWrapper = $addressBook.find(selectors.error);
            // bind events
            bindEvents();
            $.subscribe('iwc:forms:reinit', formInitHandler);

            //in case of base form js on EU
            $.subscribe(base.util.customEvents.FORMS_SUCCESS, formInitHandler);
        }

        return {
            init: init
        };

    })(iwc.$, iwc.util, base);
}());

/*global iwc */
/**
 * functionality for the subcollectionnavigation
 */
(function() {
    'use strict';

    /*
     * subcollectionnavigation component
     * @memberof iwc.comp
     */
    iwc.comp.subcollectionnavigation = (function($, util) {

        var $collectionWrapper,
            $tabWrapper,
            $tab,
            $tabPanelWrapper,
            $tabPanel,
            $closeBtn,
            $expandBtn,
            selectors = {
                base: '.iwc-collection-family',
                wrapper: '.iwc-account-wrapper',
                tabWrapper: '.iwc-collection-tab-wrapper',
                tab: '.iwc-collection-tab',
                tabPanelWrapper: '.iwc-collection-tabpanel-wrapper',
                tabPanel: '.iwc-collection-tabpanel',
                expand: '.iwc-read-more',
                close: '.iwc-tab-close',
                gallery: '.iwc-collection-gallery',
                galleryItem: '.iwc-collection-gallery-item',
                controlWrapper: '.iwc-slick-control-wrapper',
                slickInit: '.slick-initialized',
                control: '.iwc-slick-control',
                nextBtn: '.iwc-next',
                prevBtn: '.iwc-prev',
                navBtn: '.slick-dots li button',
                itemList: '.slick-list'
            },
            cssClass = {
                selected: 'iwc-selected',
                hover: 'iwc-hover',
                expanded: 'iwc-expanded',
                hide: 'iwc-hidden',
                show: 'iwc-visible',
                tabCarousel: 'iwc-tab-carousel',
                single: 'iwc-collection-single-family',
                slickInit: 'slick-initialized',
                play: 'iwc-icn-play',
                pause: 'iwc-icn-pause'
            },
            events = {
                tabOpen: 'iwc:collection:open',
                tabClose: 'iwc:collection:close'
            },
            $activeTab;
        /**
         * Reset all tabs
         * @function resetFamilyNav
         * @memberOf iwc.comp.subcollectionnavigation
         */
        function resetFamilyNav() {
            $tab.removeClass(cssClass.hover);
            $collectionWrapper.removeClass(cssClass.hover);
        }
        /**
         * Expand the tab and show details on mouse hover
         * @function onTabMouseOver
         * @param  {object} e event object
         * @memberOf iwc.comp.subcollectionnavigation
         */
        function onTabMouseOver(e) {
            e.preventDefault();
            var $target = $(e.currentTarget);

            // bail out if already in hovered state
            if ($target.hasClass(cssClass.hover)) {
                return;
            }

            $tab.removeClass(cssClass.hover);
            $target.addClass(cssClass.hover);
            $collectionWrapper.addClass(cssClass.hover);

            if ($target.data('trackingSubfamily') !== undefined) {
                util.tracking.publish($target);
            }
        }
        /**
         * Handler for Tab opened
         * @function onTabOpened
         * @memberOf iwc.comp.subcollectionnavigation
         */
        function onTabOpened(options) {
            var slide = options && options.slide || 0;
            // add carousel to tabswrapper
            if (!$tabWrapper.hasClass(cssClass.slickInit)) {
                $tabWrapper
                .addClass(cssClass.tabCarousel)
                .slick({
                    dots: true,
                    arrows: false,
                    adaptiveHeight: true,
                    initialSlide: slide
                });

                //  show gallery on slide change in mobile.
                if (util.matchmedia.narrow.matches) {
                    $tabWrapper.on('afterChange', function(event, slick, currentSlide) {

                        $tabPanel.removeClass(cssClass.expanded)
                        .attr('aria-expanded', false)
                        .eq(currentSlide)
                        .addClass(cssClass.expanded)
                        .attr('aria-expanded', true);
                    });
                }
            }

            // tabs panel
            if (!$tabPanelWrapper.find(selectors.gallery).hasClass(cssClass.slickInit)) {
                $tabPanelWrapper.addClass(cssClass.show);
                var $gallery = $tabPanelWrapper.find(selectors.gallery);
                // iterate over gallery
                $gallery.each(function(index, item) {
                    var $item = $(item),
                        $currentTabPanel = $item.closest(selectors.tabPanel),
                        $controlWrapper,
                        $playPauseBtn,
                        $nextBtn,
                        $prevBtn;
                    // init slick carousel
                    if ($item.find(selectors.galleryItem).length > 1) {
                        $controlWrapper = $currentTabPanel.find(selectors.controlWrapper);
                        $playPauseBtn = $controlWrapper.find(selectors.control);
                        $nextBtn = $controlWrapper.find(selectors.nextBtn);
                        $prevBtn = $controlWrapper.find(selectors.prevBtn);
                        // bind slick event
                        $item.on('init reInit', function() {

                            // bind event on play/pause button
                            $playPauseBtn.on('click', function() {

                                if ($playPauseBtn.hasClass(cssClass.pause)) {
                                    $playPauseBtn.addClass(cssClass.play).removeClass(cssClass.pause).attr('role', 'Play');
                                    $item.slick('slickPause');
                                } else {
                                    $playPauseBtn.removeClass(cssClass.play).addClass(cssClass.pause).attr('role', 'Pause');
                                    $item.slick('slickPlay');
                                }
                            });
                        });

                        $item.slick({
                            centerMode: true,
                            speed: 750,
                            autoplay: true,
                            autoplaySpeed: 3000,
                            fade: true,
                            prevArrow: $prevBtn,
                            nextArrow: $nextBtn
                        });
                    }
                });
            }
        }
        /**
         * Expand the tab and show details on click and hide other tabs
         * @function onTabClick
         * @param  {object} e event object
         * @memberOf iwc.comp.subcollectionnavigation
         */
        function onTabClick(e) {
            e.preventDefault();

            var $target = $(e.currentTarget);
            // main component
            $collectionWrapper.addClass(cssClass.selected);
            // reset all tabs
            $tab.removeClass(cssClass.selected);
            // get current tab & mark as active
            $activeTab = $target.closest($tab);
            $activeTab
            .addClass(cssClass.selected)
            .attr('aria-selected', true);

            // expand button
            $expandBtn.removeClass(cssClass.hide);
            $target.addClass(cssClass.hide);
            // target panel
            $tabPanel
            .removeClass(cssClass.expanded);

            $tabPanelWrapper.find('#' + $activeTab.attr('aria-controls'))
            .addClass(cssClass.expanded)
            .attr('aria-expanded', true);
            // publish event
            $.publish(events.tabOpen, [{slide: $activeTab.data('slide-number')}]);
        }
        /**
         * Hide the currently selected tab
         * @function onCloseClick
         * @param  {object} e event object
         * @memberOf iwc.comp.subcollectionnavigation
         */
        function onCloseClick(e) {
            e.preventDefault();
            e.stopPropagation();

            var $target = $(e.currentTarget);

            // deactive & accessibility
            $tab.removeClass(cssClass.selected + ' ' + cssClass.hover + ' ' + cssClass.hide);
            $activeTab
            .removeClass(cssClass.selected)
            .attr('aria-selected', false);

            // Reset main component
            $collectionWrapper.removeClass(cssClass.selected);

            // expand button
            $expandBtn.removeClass(cssClass.hide);

            // target panel
            $tabPanel
            .attr('aria-expanded', false)
            .removeClass(cssClass.expanded);
            // publish event
            $.publish(events.tabClose, [$target]);
        }
        /**
         * Handler for Tab Closed
         * @function onTabClosed
         * @memberOf iwc.comp.subcollectionnavigation
         */
        function onTabClosed() {
            $tabWrapper
            .removeClass(cssClass.tabCarousel)
            .slick('unslick');

            // tabs panel
            $tabPanelWrapper
            .removeClass(cssClass.show)
            .find(selectors.slickInit)
            .slick('unslick');
        }

        /**
         * Handler for Explore collection
         * @function onExplore
         * @param {number} itemIndex
         * @memberOf iwc.comp.subcollectionnavigation
         */
        function onExplore(itemIndex) {
            var $subCollectionList = $tabWrapper.find(selectors.itemList),
                $subCollectionTab = $subCollectionList.find(selectors.tab).eq(itemIndex + 1),
                $detailBtn = $subCollectionTab.find(selectors.expand);

            $detailBtn.trigger('click');
        }

        /**
         * Bind component specific events
         * @function bindEvents
         * @memberOf iwc.comp.subcollectionnavigation
         */
        function bindEvents() {

            if (util.matchmedia.narrow.matches) {
                $tab.on('click', onTabClick);
            } else {
                $tab.on('mouseover', onTabMouseOver);
            }

            $expandBtn.on('click', onTabClick);
            $closeBtn.on('click', onCloseClick);
            $collectionWrapper.on('mouseleave', resetFamilyNav);

            $collectionWrapper.on('click', selectors.navBtn, function(event) {
                onExplore($(event.currentTarget).parent().index());
            });

            $tabWrapper.on('afterChange', function(event, slick, currentSlide) {
                onExplore(currentSlide);
            });

            $.subscribe(events.tabOpen, onTabOpened);
            $.subscribe(events.tabClose, onTabClosed);
        }
        /**
         * Initialize subcollectionnavigation
         * @function init
         * @public
         * @memberOf iwc.comp.subcollectionnavigation
        */
        function init(elem) {
            // component
            $collectionWrapper = $(elem) || $(selectors.wrapper);
            // tabs
            $tabWrapper = $collectionWrapper.find(selectors.tabWrapper);
            $tab = $tabWrapper.find(selectors.tab);
            // tabpanels
            $tabPanelWrapper = $collectionWrapper.find(selectors.tabPanelWrapper);
            $tabPanel = $tabPanelWrapper.find(selectors.tabPanel);
            // buttons
            $closeBtn = $tab.find(selectors.close);
            $expandBtn = $tab.find(selectors.expand);

            // events
            bindEvents();

            if ($collectionWrapper.hasClass(cssClass.single)) {
                $expandBtn.trigger('click');
            }
        }

        return {
            init: init
        };

    })(iwc.$, iwc.util);
}());

/*global iwc*/
/**
 * functionality for the collection hero component
 */

(function() {
    'use strict';
    /*
     * collectionhero component
     * @namespace collectionhero
     * @memberof iwc.comp
     */
    iwc.comp.collectionhero = (function($, util) {
        var $component,
            selectors = {
                closeHeroBtn: '.iwc-close-hero-video',
                collectionHeroDownLink: '.iwc-collection-hero-down'
            };
        /**
         * Scroll page to Div from attribe href
         * @private
         * @memberOf iwc.comp.collectionhero
         * @param {object} e event object
         * @function scrollTo
         */
        function scrollTo(e) {
            e.preventDefault();
            var toScroll = $(e.target).attr('href'),
                scrollTop = $(toScroll).offset().top;
            util.scrollTo.position(scrollTop, 500);
        }
        /**
         * Initialises a collectionhero component
         * @memberOf iwc.comp.collectionhero
         * @param {HTMLElement} elem DOM element
         * @function init
         */
        function init(elem) {
            $component = $(elem);
            $component.find(selectors.collectionHeroDownLink).on('click', scrollTo);
        }

        return {
            init: init
        };
    })(iwc.$, iwc.util);
}());

/*global iwc, noUiSlider*/
/**
 * functionality for the history module
 */

(function() {
    'use strict';

    /*
     * timeline component
     * @namespace timeline
     * @memberof iwc.comp
     */
    iwc.comp.timeline = (function($) {
        var selectors = {
                defaultObject: '.iwc-collection-timeline',
                historySlider: '.iwc-history-slider',
                carousel: '[data-iwc-carousel="timeline"]',
                sliderPips: '.noUi-pips',
                sliderPipsValue: '.noUi-value-horizontal',
                yearData: '[data-history-year]',
                carouselSlides: '.iwc-highlight-slide'
            },
            cssClass = {
                active: 'active'
            };

        /**
         * Update the slider after the interaction
         * @function carouselChanged
         * @param  {number, jQuery} activeslide prevActive sliderVal, $markers, $historySlider
         * @memberOf iwc.comp.timeline
         */
        function carouselChanged(activeSlide, prevActive, sliderVal, $markers, $historySlider) {
            var diff,
                marginVal;

            $markers.find(selectors.sliderPipsValue)
                .eq(sliderVal).addClass(cssClass.active)
                .siblings()
                .removeClass(cssClass.active);

            if (prevActive > activeSlide) {
                diff = prevActive - activeSlide;
                marginVal = '+=' + diff * 110 + 'px';
                $historySlider.css({
                    'margin-left' : marginVal
                });
            } else if (prevActive < activeSlide) {
                diff = activeSlide - prevActive;
                marginVal = '-=' + diff * 110 + 'px';
                $historySlider.css({
                    'margin-left' : marginVal
                });
            }
        }

        /**
         * initSlider for Carousel
         * @function initSlider
         * @param  {jQuery} $timelineSection
         * @memberOf iwc.comp.timeline
         */
        function initSlider($timelineSection) {
            var $historySlider = $timelineSection.find(selectors.historySlider),
                $carouselSection = $timelineSection.find(selectors.carousel),
                $markers,
                $years,
                $min = 0,
                $max,
                yearSlider,
                activeSlide,
                prevActive,
                sliderVal,
                prevSliderVal,
                sliderPips;

            $years = $timelineSection.find(selectors.yearData).map(function() {
                return $(this).data('historyYear');
            }).get();
            $max = $years.length;

            // show History slider when there are nore than one slide
            if ($max > 1) {

                $historySlider.css({
                    'width' : ($max - 1) * 110 + 'px'
                });

                yearSlider = $historySlider[0];
                sliderPips = ($max === 12 || $max === 23) ?  $max + 1 : $max;

                noUiSlider.create(yearSlider, {
                    start: [0],
                    step: 1,
                    range: {
                        'min': $min,
                        'max': $max - 1
                    },
                    pips: {
                        mode: 'count',
                        values: sliderPips,
                        density: -1,
                        stepped: true
                    }
                });

                // Find the current set of markers on the slider and add custom text.
                $markers = $historySlider.find(selectors.sliderPips);
                $markers.find(selectors.sliderPipsValue).each(function(index, element) {
                    $(element).addClass('rcms_collectiontimeline');
                    if (index === 0) {
                        $(element).addClass(cssClass.active);
                    }
                    $(element).text($years[index]);

                });

                //bind events on the slider and the carousel for linked interaction
                $carouselSection.on('beforeChange', function(event, slick, currentSlide) {
                    prevActive = currentSlide;
                });

                $carouselSection.on('init afterChange', function(event, slick, currentSlide) {
                    activeSlide = currentSlide;
                    if (activeSlide !== prevActive) {
                        yearSlider.noUiSlider.set(activeSlide);
                        carouselChanged(activeSlide, prevActive, sliderVal, $markers, $historySlider);
                    }
                });

                yearSlider.noUiSlider.on('start', function(values, handle) {
                    prevSliderVal = parseFloat(values[handle]);
                });

                yearSlider.noUiSlider.on('update', function(values, handle) {
                    sliderVal = parseFloat(values[handle]);
                    if (prevSliderVal !== sliderVal) {
                        $carouselSection.slick('slickGoTo', sliderVal);
                        carouselChanged(activeSlide, prevActive, sliderVal, $markers, $historySlider);
                    }
                });
            }
        }

        /**
        * Initialise a timeline element.
        * @memberOf iwc.comp
        * @param  {object} element instance of the current component.
        */
        function init(element) {
            var $timelineSection = $(element) || $(selectors.defaultObject);
            initSlider($timelineSection);
        }

        return {
            init: init
        };

    })(iwc.$);
}());

/*global iwc*/
/**
 * Engineering Template component
 */

(function() {
    'use strict';

    /**
     * Engineering Template component
     * @namespace engineeringtemplate
     * @memberof iwc.comp
     */
    iwc.comp.engineeringtemplate = (function($, util) {
        /**
         * initialise engineering template
         * @function init
         * @private
         * @memberOf iwc.comp.engineeringtemplate
         */
        function init() {
            util.scroll.init();
            util.animatable.init();
        }

        return {
            init: init
        };
    })(iwc.$, iwc.util);
}());

/*global iwc*/

/**
 * Social links component
 */

(function() {
    'use strict';

    /**
     * Social links component
     * @namespace sociallinks
     * @memberof iwc.comp
     */
    iwc.comp.sociallinks = (function($) {
        var selectors = {
                shareObject: '.iwc-share-channels-wrapper',
                shareLink: '.iwc-link'
            },
            url = window.location.href,
            $shareSection,
            $shareItems;

        /**
         * initialise share channels
         * @function init
         * @public
         * @param {HTMLElement} element HTML element
         * @memberOf iwc.comp.sociallinks
         */
        function init(element) {
            $shareSection = $(element) || $(selectors.shareObject);
            $shareItems = $shareSection.find(selectors.shareLink);
            $shareItems.each(function(index, element) {
                if (!$(element).data('lightbox')) {
                    var addlink =  $(element).data('url');
                    $(element).attr('href', addlink + url);
                }
            });
        }

        return {
            init: init
        };

    })(iwc.$);
}());



/*global iwc*/
/**
 * editorial Template component
 */

(function() {
    'use strict';

    /**
     * Editorial Template component
     * @namespace editorial
     * @memberof iwc.comp
     */
    iwc.comp.editorial = (function($, util) {

        var selectors = {
            carouselElement: '.iwc-cards-list'
        };

        /**
         * initialise editorial template
         * @function init
         * @private
         * @param {HTMLElement} elem element
         * @memberOf iwc.comp.editorial
         */
        function init(elem) {
            var $editorial = $(elem),
            $carouselElement = $editorial.find(selectors.carouselElement);
            util.scroll.init();
            $.publish('iwc:animatable:in-view');
            util.animatable.init();
            if (util.matchmedia.narrow.matches) {
                util.carousel.contextualInit($carouselElement);
                $carouselElement.on('afterChange', function() {
                    util.lazyLoadImage.checkImages();
                });
            }
        }

        return {
            init: init
        };
    })(iwc.$, iwc.util);
}());

/*global iwc, JSON, base*/
/**
 * functionality for Buying Options on PDP page
 */

(function() {
    'use strict';

    /*
     * Buying Options component
     * @namespace buyingoptions
     * @memberof iwc.comp
     */
    iwc.comp.buyingoptions = (function($, comp, util, baseUtil) {
        /**
         * Initialise a familysubnav element.
         * @memberOf iwc.comp.familysubnav
         */
        var $component,
            bagDisclaimerUrl,
            $body = $('body'),
            $window = $(window),
            $uberRideLink,
            productId = 0,
            $submit,
            maxWatchesLimit,
            productRelatedData,
            anotherProduct,
            thresholdPrice,
            appointmentUrl,
            $productVariations,
            $buyingOptions,
            defaultScale = 1,
            breakPointWidth = 1024,
            zoomInterval = 2,
            maxScale = 2.5,
            $iadvizeTrackingElem,
            $buyingButton,
            windowWidth,
            $addToWishlist,
            selectors = {
                addToWishlist: '.iwc-add-to-wishlist-btn',
                wishlistDisclaimerPagePath: '#wishlistDisclaimerPagePath',
                tabsList: '.iwc-tablist',
                tab : '.iwc-tab',
                tabContent: '.iwc-content',
                tabsWrapper: '.iwc-tabs-wrapper',
                buyTab: '.iwc-buy-tab',
                helpTab: '.iwc-help-tab',
                helpTabs: '.iwc-help-tabs',
                productBuyCarousel: '.iwc-buying-options-carousel',
                inStoreTab: '.iwc-instore-tab',
                buyBoutique: '.iwc-buy-boutique',
                buyBoutiqueName: '.iwc-buy-boutique-name',
                buyBoutiqueAddress: '.iwc-buy-boutique-address',
                buyBoutiqueStreet: '.iwc-buy-boutique-street',
                buyBoutiqueZip: '.iwc-buy-boutique-zip',
                buyBoutiqueCity: '.iwc-buy-boutique-city',
                buyBoutiquePhone: '.iwc-buy-boutique-phone',
                openingHours: '#iwc-opening-hours',
                addToBag: '.iwc-addtobag',
                addToEUBag: '.iwc-addtobag-eu',
                addToBagForm: '.iwc-addtobag-form',
                addToBagError: '.iwc-error',
                buyingOptions: '.iwc-buying-options-availability ',
                boutiqueTiming: '.iwc-buy-btq-time',
                uberRideContainer: '.iwc-buy-boutique-uber',
                uberRideLink: '.iwc-buy-boutique-uber-site',
                productBuyPrice: '.iwc-buying-options-price',
                productShowTaxInfo: '.iwc-show-tax-info',
                makeAppointment: '.iwc-buying-options-make-appointment',
                seeVariations: '.iwc-view-variations',
                productVariations: '.iwc-variations-products',
                scrollable: '[data-scrollto]',
                imageThumbnails: '.iwc-buying-option-thumbnails',
                imageThumbContainer: '.iwc-watch-thumbnail-container',
                imageThumnail: '.iwc-watch-thumbnail',
                zoomImageSlide: '.iwc-buying-options-carousel-slide',
                zoomImage: '.iwc-watch-image-zoom',
                zoomInBtn: '.iwc-icn-zoom-in',
                zoomOutBtn: '.iwc-icn-zoom-out',
                toggleGroups: '[data-toggle-group]',
                iadvizeTrackingElem: '.iwc-iadvize-pdp-tracking',
                pdpZoomIcon: '.iwc-pdp-zoom-icon',
                pdpLoader: '.iwc-pdp-image-loader-big',
                buyingOptionsShare: '.iwc-buying-options-share',
                legacyCheckout: '.iwc-legacy-checkout',
                productTitle: '.iwc-buying-options-title',
                buyingOptionsBoutique: '.iwc-buying-options-nearest-boutique'
            },
            cssClass = {
                selected: 'selected',
                opened: 'opened',
                hide: 'iwc-hidden',
                inStoreTab: 'iwc-instore-tab',
                specialCase: 'iwc-special-case-instore-data',
                helpTab: 'iwc-help-tab',
                helpParentTab: 'iwc-help-parent-tab',
                loadingIcon: 'iwc-post-loader',
                stickyPDPNav: 'iwc-sticky-pdp-nav',
                active: 'iwc-active',
                showHelp: 'iwc-show-help',
                useBaidu: 'iwc-use-baidu',
                boutiqueAccessError: 'iwc-boutique-access-error',
                hideVariations: 'iwc-hide-variations'
            },
            componentOffset,
            isBaidu = $body.hasClass(cssClass.useBaidu),
            legacyCheckout,
            postUrl = util.dataStore.getCurrentPagePath();

        /*
         * Show/Hide Help Text Overlay
         * @memberOf iwc.comp.buyingoptions
         * @private
         * @function showHideHelpOverlay
         */
        function showHideHelpOverlay() {
            var getHelpState = util.webstorage.get('showHelpOverlay');
            if (!getHelpState) {
                util.webstorage.set('showHelpOverlay', 'hide');
                $(selectors.productBuyCarousel).addClass(cssClass.showHelp);
                setTimeout(function() {
                    $(selectors.productBuyCarousel).removeClass(cssClass.showHelp);
                }, 3000);
            } else {
                $(selectors.productBuyCarousel).removeClass(cssClass.showHelp);
            }
        }
        /*
         * Initialise zoom gallery element with panzoom.
         * @memberOf iwc.comp.buyingoptions
         * @private
         * @function createPanZoom
         */
        function createPanZoom() {
            $component.find(selectors.zoomImage).panzoom({
                startTransform: 'scale(' + defaultScale + ')',
                increment: zoomInterval,
                minScale: defaultScale,
                maxScale: maxScale,
                contain: 'automatic',
                panOnlyWhenZoomed: true,
                $zoomIn: $component.find(selectors.zoomInBtn),
                $zoomOut: $component.find(selectors.zoomOutBtn),
                onZoom: function() {
                    showHideHelpOverlay();
                },
                onPan: function() {
                    showHideHelpOverlay();
                }
            });
        }
        /**
         * Based on the Watch limit, disable button
         * @function changeAddToBagButtonState
         * @private
         * @memberOf iwc.comp.buyingoptions
         */
        function changeAddToBagButtonState(productType) {
            var currentState = iwc.comp.cartState.get();
            anotherProduct = false;
            if (productType === 'watch') {
                // disable button if limit reached
                if (currentState.count === currentState.limit) {
                    anotherProduct = true;
                    $submit.removeClass(cssClass.loadingIcon)
                        .prop('disabled', true)
                        .text($submit.data('limitReached'));
                } else {
                    $submit.removeClass(cssClass.loadingIcon).prop('disabled', false);
                }
            } else {
                if (currentState.accessoryCount === currentState.accessoryLimit) {
                    anotherProduct = true;
                    $submit.removeClass(cssClass.loadingIcon)
                        .prop('disabled', true)
                        .text($submit.data('limitReached'));
                } else {
                    $submit.removeClass(cssClass.loadingIcon).prop('disabled', false);
                }
            }
        }
        /**
         * Based on the Watch limit, disable button for EU
         * @function changeAddToBagButtonStateEU
         * @private
         * @memberOf iwc.comp.buyingoptions
         */
        function changeAddToBagButtonStateEU($submitEU, data) {
            var currentState = iwc.comp.cartState.get(),
                currentCount = 0;
            anotherProduct = false;
            $submit = $submit || $submitEU;
            currentCount = data ? data.entries.length : currentState.count;
            //update state with current
            iwc.comp.cartState.set ({
                    count: currentCount
                });
            // disable button if limit reached
            if (currentCount === (currentState.limit || maxWatchesLimit)) {
                anotherProduct = true;
                $submit.removeClass(cssClass.loadingIcon)
                    .prop('disabled', true)
                    .text($submit.data('limitReached') || $component.find('[name="limitText"]').val());
            } else {
                $submit.removeClass(cssClass.loadingIcon).prop('disabled', false);
            }
        }
        /**
         * Event handler for add to bag submit
         * @function getShoppingBag
         * @private
         * @memberOf iwc.comp.buyingoptions
         * @param {string} url path to shoppingbag popup page
         */
        function getShoppingBag(url, options) {
            util.notification.showBar(url, options, anotherProduct);
            /*
            // Not required as on cart hover update state is fetched
             url = url + '.popup.html';
             $.get(url)
                .done(function(data) {
                    if (!util.matchmedia.narrow.matches) {
                        util.notification.content(data);
                    }
                });
            */
        }
        /**
         * Function to update wishlist dom to new state to perform cart movement to wishlist
         * @function updateWishlistAttibute
         * @private
         * @memberOf iwc.comp.buyingoptions
         */
        function updateWishlistAttibute() {
            if ($addToWishlist.length) {
                $addToWishlist[0].setAttribute('data-formAction', '.move-cart-items-to-wishlist.json');
                if ($addToWishlist[0].getAttribute('data-action') === 'iwc-remove-from-wishlist') {
                    $addToWishlist[0].setAttribute('data-revertToAction', $addToWishlist[0].getAttribute('data-action'));
                    $addToWishlist[0].setAttribute('data-action', 'iwc-add-to-wishlist');
                }
            }
        }
        /**
         * Function to trigger move to wishlist by adding new data attribute to element
         * @function moveProductToWishlist
         * @public
         * @memberOf iwc.comp.buyingoptions
         */
        function moveProductToWishlist() {
            updateWishlistAttibute();
            $addToWishlist[0].click();
        }
        /**
         * Function to revert wishlist dom back to its original state.
         * @function revertWishlistAttribute
         * @private
         * @memberOf iwc.comp.buyingoptions
         */
        function revertWishlistAttribute() {
            if ($addToWishlist) {
                if ($addToWishlist.length) {
                    $addToWishlist[0].removeAttribute('data-formAction');
                }
                if ($addToWishlist[0].getAttribute('data-revertToAction')) {
                    $addToWishlist[0].setAttribute('data-action', $addToWishlist[0].getAttribute('data-revertToAction'));
                }
            }
        }

        /**
         * Event handler for add to bag submit
         * @function errorMessage
         * @private
         * @memberOf iwc.comp.buyingoptions
         * @param {object} option
         * @param {jquery} option.element
         * @param {boolean} option.show
         */
        function errorMessage(option) {
            var message = option.message || option.$element.data('default');
            if (option.show) {
                option.$element
                    .text(message)
                    .removeClass(cssClass.hide)
                    .attr('aria-hidden', false);
            } else {
                option.$element.addClass(cssClass.hide)
                    .attr('aria-hidden', true);
            }
        }

        /**
         * Event handler for add to bag submit
         * @function addProductToBag
         * @private
         * @memberOf iwc.comp.buyingoptions
         * @param {event} event
         */
        function addProductToBag(event) {
            var $form,
                $errorMessage,
                productId,
                quantity,
                engravingId,
                engravingText,
                obj,
                $ssWrapper,
                targetBtn;
            // add to bag for non us checkout
            if (legacyCheckout === false) {
                $form = $component.find(selectors.addToBagForm),
                $errorMessage = $form.find(selectors.addToBagError),
                productId = $form.find('[name="productId"]').val(),
                quantity = $form.find('[name="quantity"]').val();
                targetBtn = $(event.target);
                obj = {
                    'operation:': 'add',
                    'productId': productId,
                    'quantity': Number(quantity),
                    'summary': false ,
                    'domElement': targetBtn
                };
                targetBtn.prop('disabled',true);
                // added product to bag via contextHUB
                baseUtil.cartManager.addItemInCart(obj);
                //TODO: golden go to bag nav bar to be done when DSCMSE-6477 gets resolved

            } else {
                // notify configurator
                var isConfigurator = (window.configurator && window.configurator.updateNotification) || false,
                    productType = 'watch';

                if (!iwc.data.cart.configurable || event.action) {
                    if (event && !event.action) {
                        event.preventDefault();
                        $submit = $(event.target);
                    } else if (!$submit) {
                        $submit = $component ? $component.find(selectors.addToBag) : $($submit);
                    }

                    if ($submit.hasClass('iwc-ss-addtobag')) {
                        productType = 'accessory';
                        $ssWrapper = $submit.closest(selectors.addToBagForm),
                        $errorMessage = $ssWrapper.find(selectors.addToBagError),
                        postUrl = postUrl.split('.')[0] + '.cart-add.json',
                        productId = $submit.data('productid'),
                        quantity = 1;
                    }

                    if ($component) {
                        $form = $component.find(selectors.addToBagForm),
                        $errorMessage = $form.find(selectors.addToBagError),
                        postUrl = postUrl + '.cart-add.json',
                        productId = $form.find('[name="productId"]').val(),
                        quantity = $form.find('[name="quantity"]').val();
                    }

                    if (event) {
                        if (event.action) {
                            postUrl = postUrl + '.' + event.action + '.json';
                        }

                        if (event.productId) {
                            productId = event.productId;
                            quantity = 1;
                            engravingId = event.engravingId || '';
                            engravingText = event.engravingText || '';
                        }
                    }
                    $submit.addClass(cssClass.loadingIcon)
                        .prop('disabled', true);

                    $.post(postUrl, {
                        'productId': productId,
                        'quantity': quantity,
                        'engravingId': engravingId,
                        'engravingText' : engravingText
                    })
                    .done(function(data) {
                        if (data.status === 'SUCCESS') {
                            revertWishlistAttribute();
                            // get state and set state
                            var currentState = iwc.comp.cartState.get();

                            if (productType === 'watch') {
                                iwc.comp.cartState.set({
                                    count: currentState.count + 1
                                });
                            } else {
                                iwc.comp.cartState.set({
                                    accessoryCount: currentState.accessoryCount + 1
                                });
                            }

                            util.tracking.publish($submit);
                            $.publish('iwc:shoppingbag:changed', ['add']);

                            changeAddToBagButtonState(productType);
                            if ($form) {
                                getShoppingBag($form.data('url'), $form.data('bagActions'));
                            }
                            if ($ssWrapper) {
                                getShoppingBag($ssWrapper.data('url'), $ssWrapper.data());
                            }

                            if ($errorMessage) {
                                errorMessage({
                                    $element: $errorMessage,
                                    show: false
                                });
                            }
                            // notify configurator
                            if (isConfigurator) {
                                window.configurator.updateNotification({
                                    action: 'addedtobag'
                                });
                            }
                        }
                    })
                    .fail(function() {
                        revertWishlistAttribute();
                        errorMessage({
                            $element: $errorMessage,
                            show: true
                        });
                        $submit.removeClass(cssClass.loadingIcon)
                            .prop({'disabled': false});

                        // notify configurator
                        if (isConfigurator) {
                            window.configurator.updateNotification({
                                action: 'failedAddToBag'
                            });
                        }
                    });
                } else {
                    // TODO read from langmaster
                    iwc.util.lightbox.openUrlInLightbox(bagDisclaimerUrl);
                }
            }
        }

        /**
         * stickyPDPNav to make navigation visible after buying options passed
         * @private
         * @memberOf iwc.comp.buyingoptions
         */
        function stickyPDPNav() {
            var $pdpSocialShare = $component.find(selectors.buyingOptionsShare);
            componentOffset = $pdpSocialShare.offset().top + $pdpSocialShare.outerHeight() || $component.offset().top + $component.outerHeight();
            if ($window.scrollTop() > componentOffset) {
                $body.addClass(cssClass.stickyPDPNav);
            } else {
                $body.removeClass(cssClass.stickyPDPNav);
            }
        }

        /**
         * showCtaWithTaxInfo based on the product price
         * @private
         * @memberOf iwc.comp.buyingoptions
         * @param buyingOptions
         * @param price
         * @param ctaClass
         */
        function showCtaWithTaxInfo(buyingOptionsElem, price, ctaClass) {
            buyingOptionsElem.addClass(ctaClass);
            if (price !== 0) {
                $component.find(selectors.productShowTaxInfo).removeClass(cssClass.hide);
            }
        }

        /**
         * setProductCartData based on cart data from login status
         * @private
         * @memberOf iwc.comp.buyingoptions
         * @param  {object} loginStatusData
         */
        function setProductCartData(loginStatusData) {
            var addedWatchCount;
            // modifed to update watch count from contextHub
            if (loginStatusData.entries) {
                addedWatchCount = loginStatusData.entries.length || 0;
            } else {
                addedWatchCount = loginStatusData.values.cartStatus.watchCount || 0;
            }
            iwc.comp.cartState.set({
                count: addedWatchCount,
                limit: maxWatchesLimit
            });
        }

        /**
         * onStateChangeHandler update the button based on the cart state
         * @private
         * @memberOf iwc.comp.buyingoptions
         * @param  {object} state
         */
        function onStateChangeHandler(state) {
            if (state.count === state.limit) {
                $buyingButton.prop('disabled', true).text($buyingButton.data('limitReached'));
            }
        }

        /**
         * setDefaultCtas if the product call fails
         * show contact concierge
         * @private
         * @memberOf iwc.comp.buyingoptions
         */
        function setDefaultCtas() {
            var defaultPrice = 0;
            showCtaWithTaxInfo($buyingOptions, defaultPrice, 'iwc-buy-show-unavailable');
        }

        /**
         * showProperBuyCtas based on product's ecommerse data
         * show hide either buy, contact, or notify buttons.
         * Done by CSS
         * @private
         * @memberOf iwc.comp.buyingoptions
         * @param  {object} productData
         */
        function showProperBuyCtas(ecommData) {
            var productData = ecommData[productId],
                productSellable = productData.sellable,
                productStock = productData.stock,
                productPrice = parseFloat(productData.price),
                priceIsZero = (productPrice <= 0),
                thresholdPriceCrossed = productPrice > thresholdPrice;

            if (!priceIsZero) {
                $component.find(selectors.productBuyPrice)
                .text(productData.formattedPrice);
            }

            if (util.dataStore.isCommerceEnabled()) {
                if (priceIsZero || thresholdPriceCrossed || !productSellable) {
                    // show concierge
                    showCtaWithTaxInfo($buyingOptions, productPrice, 'iwc-buy-show-unavailable');
                } else if (!priceIsZero && !thresholdPriceCrossed && !productStock && productSellable) {
                    // show notify
                    showCtaWithTaxInfo($buyingOptions, productPrice, 'iwc-buy-show-outofstock');
                } else if (!priceIsZero && !thresholdPriceCrossed && productStock && productSellable) {
                    // Add to bag
                    showCtaWithTaxInfo($buyingOptions, productPrice, 'iwc-buy-show-available');
                }
            }

        }

        /**
         * mapBoutiqueId
         * For a list of boutique id, method provides list of corresponding boutique data
         * @private
         * @memberOf iwc.comp.buyingoptions
         * @param  {Array} boutiqueIdList
         * @param  {Array} boutiqueData list of all boutique data
         * @returns {Array} list of boutique data respective to boutiqueIdList
         */
        function mapBoutiqueId(boutiqueIdList, boutiqueData) {
            return boutiqueIdList.map(function(boutiqueId) {
                        var boutiqueIndex = boutiqueData.findIndex(function(data) { return data.id === boutiqueId;});
                        return (boutiqueIndex > -1) ? boutiqueData[boutiqueIndex] : undefined;
                    }).filter(function(data) {
                        return !!data;
                    });
        }

        /**
         * setBoutiuqeData
         * Set boutiuqe's data on DOM for provided boutique data
         * @private
         * @memberOf iwc.comp.buyingoptions
         * @param {Object} data
         */
        function setBoutiuqeData(data) {
            if (data) {
                var uberRideDestination = '',
                    openingHoursItems = '',
                    boutiqueUrlWithID = appointmentUrl.replace('{{boutiqueID}}', data.id);
                $.each(data.openingHours, function(i, val) {
                    $.each(val, function(j, val2) {
                        var workingDay = j === 0 ? val2.dayOfWeek + ':' : '';
                        openingHoursItems += ('<dd class="iwc-buy-btq-opening-time"><span class="iwc-buying-options-day">' + workingDay + '</span> ' + val2.openingTime + ' - ' + val2.closingTime + '</dd>');
                    });
                });
                $component.find(selectors.boutiqueTiming).append($(openingHoursItems));
                $component.find(selectors.buyBoutiqueName).text(data.name);
                $component.find(selectors.buyBoutiqueStreet).text(data.address.street);
                $component.find(selectors.buyBoutiqueZip).text(data.address.zipCode);
                $component.find(selectors.buyBoutiqueCity).text(data.address.city);
                $component.find(selectors.buyBoutiquePhone).text(data.phoneNumber).attr('href', 'tel:' + data.phoneNumber);
                $component.find(selectors.makeAppointment).attr('href', boutiqueUrlWithID);

                uberRideDestination += '&dropoff[latitude]=' +  data.location.latitude;
                uberRideDestination += '&dropoff[longitude]=' +  data.location.longitude;
                uberRideDestination += '&dropoff[nickname]=' +  encodeURIComponent(data.name);
                uberRideDestination += '&dropoff[formatted_address]=' +  encodeURIComponent(data.address.street);

                $uberRideLink.attr({
                    'href': $uberRideLink.attr('href') + uberRideDestination
                });

                util.webstorage.set('storeData', JSON.stringify(data));
                util.toggle.init($component.find(selectors.toggleGroups));
            }
        }

        /**
         * showBoutiqueId
         * Works to show a boutique's data for provided a boutique id
         * @private
         * @memberOf iwc.comp.buyingoptions
         * @param {string} boutiqueId
         */
        function showBoutiqueId(boutiqueId) {
            util.dataStore.getBoutiqueData().done(function(boutiqueData) {
                var boutiqueIdString = boutiqueId && boutiqueId.toString(),
                    mappedBoutiqueData = mapBoutiqueId([boutiqueIdString], boutiqueData);
                setBoutiuqeData(mappedBoutiqueData[0]);
            });
        }

        /**
         * showFlagshipBoutique
         * @private
         * @memberOf iwc.comp.buyingoptions
         */
        function showFlagshipBoutique() {
            var flagshipBoutiqueId = $component.data('flagship-boutique');
            showBoutiqueId(flagshipBoutiqueId);
        }

        /**
         * Scroll to target elements
         * @function scrollToElements
         * @private
         * @param {e} event
         * @memberOf iwc.util.buyingoptions
         */
        function scrollToElements(e) {
            e.preventDefault();
            var getSectionName = $(e.target).data('scrollto'),
                getSectionOffset = $('.' + getSectionName).offset().top;
            util.smoothScroll.init(getSectionOffset, 700, function() {});
        }

        /**
         * Cache elements
         * @function cacheElements
         * @private
         * @memberOf iwc.util.buyingoptions
         */
        function cacheElements() {
            $addToWishlist = $(selectors.addToWishlist);
            $productVariations = $(selectors.productVariations);
            bagDisclaimerUrl = $(selectors.wishlistDisclaimerPagePath).attr('href');
        }
        /**
         * iAdvize specific tracking
         * @function trackPDPiAdvize
         * @private
         * @memberOf iwc.util.buyingoptions
         * @param  {object} productData
         */
        function trackPDPiAdvize(data) {
            var productData = data[productId],
                getTitle = $('.iwc-iadvize-pdp-tracking').data('tracking-product-name'),
                SKU = productData.productId,
                price = productData.price,
                productOOS = 'no';
            if (!productData.stock) {
                productOOS = 'yes';
            }
            util.tracking.iwcCustomTracking({
                'productName': getTitle,
                'productSku': SKU,
                'productPrice': price,
                'productOOS': productOOS
            });
        }

        /**
         * Bind add to bag button with configurator
         * @function bindBtnWithConfigurator
         * @public
         * @memberOf iwc.util.buyingoptions
         * @param {HTMLObject} element
         */
        function bindBtnWithConfigurator(domBtn) {
            $submit = $(domBtn);
        }
        /**
        * Operations to be performed after add to cart on NonLegacy
        * @functionn addToCartCallbackNonLegacy
        * @private
        * @memberOf iwc.util.buyingoptions
        */
        function addToCartCallbackNonLegacy(reqData) {
            var $form = $component.find(selectors.addToBagForm);
            if ($form) {
                util.notification.showBar($form.data('url'), $form.data('bagActions'), anotherProduct);
            }
            if (reqData.domElement) {
                var btnSelector = reqData.domElement.get(0).className.split(' ').map(function(val) { return '.' + val }).join('');
                $body.find(btnSelector).prop('disabled', false);
            }
        }
        /**
         * Initialise Non Legacy chekcout events
         * @function bindNonLegacyEvents
         * @private
         * @memberOf iwc.util.buyingoptions
         */
        function bindNonLegacyEvents() {
            $.subscribe('iwc:eu:buyingOptions:revertWishlist', revertWishlistAttribute);
            $.subscribe('iwc:eu:buyingOptions:updated', addToCartCallbackNonLegacy);
            $.subscribe('iwc:eu:checkCartState', changeAddToBagButtonStateEU);
        }

        /**
         * Fill nearest store on PDP
         * @function fillNearestStore
         * @public
         * @memberOf iwc.util.buyingoptions
         */
        function fillNearestStore() {
            $uberRideLink = $component.find(selectors.uberRideLink);
            if (util.matchmedia.narrow.matches) {
                $uberRideLink.attr({
                    'href': $component.find(selectors.uberRideContainer).data('url')
                });
            }
            // extracting boutique data and user location to find out nearest boutique if not available.
            if (!('storeData' in util.webstorage.storage())) {
                util.dataStore.getBoutiqueData().done((function($boutique, boutiqueData) {
                    //TODO:preferredBoutique need to be removed from all cust details calls
                    if (!isBaidu && legacyCheckout) {
                        util.userlocation.get().done(function(response) {
                            var userLocationLat = response.latitude,
                                userLocationLng = response.longitude,
                                nearestBoutiqueData = util.userlocation.nearestBoutique(userLocationLat, userLocationLng, boutiqueData);
                            setBoutiuqeData(nearestBoutiqueData);
                        }).fail(function(response) {
                            showFlagshipBoutique();
                        });
                    } else {
                        showFlagshipBoutique();
                    }
                }).bind(undefined, $component)).fail(function(jqXHR) {
                    $component.find(selectors.buyingOptionsBoutique).addClass(cssClass.boutiqueAccessError);
                    util.toggle.init($component.find(selectors.toggleGroups));
                });
            } else {
                setBoutiuqeData(JSON.parse(util.webstorage.get('storeData')));
            }
        }

        /**
         * Initialise Buying Options
         * @function init
         * @public
         * @memberOf iwc.util.buyingoptions
         * @param {HTMLObject} element
         */
        function init(element) {
            bindNonLegacyEvents();
            $component = $(element);
            $buyingButton = $component.find(selectors.addToBag);
            windowWidth = $window.width();
            appointmentUrl = $component.find(selectors.makeAppointment).attr('href');
            cacheElements();
            productRelatedData = comp.product.productData();
            maxWatchesLimit = productRelatedData.maxWatches;
            $buyingOptions = $component.find(selectors.buyingOptions);
            legacyCheckout = $body.find(selectors.legacyCheckout).length ? false : true;

            if (!$productVariations.length) {
                $component.find(selectors.seeVariations).addClass(cssClass.hideVariations);
            }

            $component.find(selectors.scrollable).on('click', scrollToElements);

            $.subscribe('scroll', stickyPDPNav);
            $component.find(selectors.imageThumbnails).slick({
                slidesToShow: 6,
                arrows: true,
                dots: false,
                prevArrow: false,
                draggable: util.matchmedia.wide.matches ? false : true,
                responsive: [
                    {
                        breakpoint: breakPointWidth,
                        settings: {
                            slidesToShow: 4
                        }
                    }
                ]
            });
            $component.find(selectors.imageThumnail).css('height', $component.find(selectors.imageThumbContainer).width());
            $component.find(selectors.imageThumbContainer).on('click', function() {
                var newSrcImg = $(this).find(selectors.imageThumnail).data('src'),
                newSrcImgSet = $(this).find(selectors.imageThumnail).data('srcset'),
                imageEle = $component.find(selectors.zoomImage),
                imageEleZoom = $component.find(selectors.zoomImageSlide).find('img[role="presentation"]'),
                pdpLoader = $component.find(selectors.pdpLoader);
                pdpLoader.addClass(cssClass.hide);
                $component.find(selectors.imageThumbContainer).removeClass(cssClass.active);
                $component.find(selectors.zoomInBtn).removeClass(cssClass.hide);
                $component.find(selectors.zoomOutBtn).addClass(cssClass.hide);
                $(this).addClass(cssClass.active);
                imageEle.fadeOut(150, function() {
                    var _this = $(this);
                    _this.attr('srcset', newSrcImgSet);
                    _this.attr('src', newSrcImg);
                    if (imageEleZoom.length > 0) {
                        imageEleZoom.attr('src', newSrcImg);
                        imageEleZoom.attr('srcset', newSrcImgSet);
                    } else {
                        $component.find(selectors.zoomImage).panzoom('reset');
                    }
                    _this.one('load',function() {
                        pdpLoader.addClass(cssClass.hide);
                        imageEle.fadeIn(150);
                    }).each (function() {
                        if (this.complete) {
                            _this.trigger('load');
                        } else {
                            pdpLoader.removeClass(cssClass.hide);
                        }
                    });
                });
            });
            $component.find(selectors.pdpZoomIcon).removeClass(cssClass.hide);
            if (windowWidth <= breakPointWidth) {
                createPanZoom();
                $component.find(selectors.zoomImage).on('panzoomzoom', function(e, panzoom) {
                    $component.find(selectors.pdpLoader).addClass(cssClass.hide);
                    if (panzoom.scale > 1) {
                        $component.find(selectors.zoomInBtn).addClass(cssClass.hide);
                        $component.find(selectors.zoomOutBtn).removeClass(cssClass.hide);
                    } else {
                        $component.find(selectors.zoomInBtn).removeClass(cssClass.hide);
                        $component.find(selectors.zoomOutBtn).addClass(cssClass.hide);
                    }
                });
            } else {
                $component.find(selectors.zoomImageSlide).zoom();
            }
            $component.find(selectors.zoomImageSlide).css('height', $component.find(selectors.zoomImageSlide).width());
            $.subscribe('iwc:resize', function() {
                $component.find(selectors.imageThumnail).css('height', $component.find(selectors.imageThumbContainer).width());
                $component.find(selectors.zoomImageSlide).css('height', $component.find(selectors.zoomImageSlide).width());
            });
            fillNearestStore();
            if (util.dataStore.isCommerceEnabled() || util.dataStore.isPpcEnabled()) {
                productId = productRelatedData.globalRef;
                thresholdPrice = productRelatedData.thresholdPrice;
                $component.find(selectors.addToBag).on('click', addProductToBag);
                $component.find(selectors.addToEUBag).on('click', function(event) {
                    window.setTimeout(function() {
                        $(event.target).prop('disabled', true);
                    }, 0);
                })
                comp.product.buyingOptions()
                .done(showProperBuyCtas, trackPDPiAdvize)
                .fail(setDefaultCtas);
                comp.account.customerDetailsData().done(setProductCartData);
            } else {
                util.tracking.publish($iadvizeTrackingElem);
            }

            $.subscribe('iwc:state:changed', onStateChangeHandler);
        }

        return {
            init: init,
            addProductToBag: addProductToBag,
            bindBtnWithConfigurator: bindBtnWithConfigurator,
            moveProductToWishlist: moveProductToWishlist
        };

    })(iwc.$, iwc.comp, iwc.util, base.util);
}());

/*global iwc*/
/**
 * Notify user for product availablity
 */

(function() {
    'use strict';

    /*
     * Notify user for product availablity
     * @namespace notifyproductavailability
     * @memberof iwc.comp
     */
    iwc.comp.notifyproductavailability = (function($, util) {
        var $form,
            $overlay,
            $componentWrapper,
            $confirmationWrapper,
            $formWrapper,
            $notifyBtn,
            $currentPagePathField,
            $cancel,
            $emailField,
            selectors = {
                componentWrapper: '.iwc-notifyproductavailability',
                overlay: '.iwc-lightbox-content',
                emailField: 'input[type="email"]',
                confirmationWrapper: '.iwc-confirmation-wrapper',
                formWrapper: '.iwc-notifyproductavailability-form',
                currentPagePathField: 'input[name="currentPagePath"]',
                cancel: 'input[type="reset"], .iwc-close-lightbox'
            },
            cssClass = {
                iwcHidden: 'iwc-hidden'
            },
            currentPagePath = iwc.util.dataStore.getCurrentPagePath(),
            name = 'notifyproductavailability';
        /**
         * Destroy overlay
         * @function destroy
         * @private
         * @param {string} component name
         * @memberOf iwc.comp.notifyproductavailability
         */
        function destroy(pageName) {
            if (pageName === name) {
                $form.off('submit.' + name);
            }
        }
        /**
         * Mapping DOM elements for chaching
         * @function mapDomElements
         * @private
         * @memberOf iwc.comp.notifyproductavailability
        */
        function mapDomElements() {
            $overlay = $(selectors.overlay);
            $form = $overlay.find('form');
            $emailField = $overlay.find(selectors.emailField);
            $componentWrapper = $overlay.find(selectors.componentWrapper);
            $confirmationWrapper = $overlay.find(selectors.confirmationWrapper);
            $formWrapper = $overlay.find(selectors.formWrapper);
            $currentPagePathField = $overlay.find(selectors.currentPagePathField);
            $cancel = $overlay.find(selectors.cancel);
        }
        /**
         * Form reinit
         * @function formInitHandler
         * @private
         * @param {HTMLElement} form Form element
         * @param {boolean} data Success true/false
         * @memberOf iwc.comp.notifyproductavailability
         */
        function formInitHandler(form, success) {
            iwc.comp.forms.init($(form));
            util.formsAnimation.reInit($overlay);
            if (success) {
                $confirmationWrapper.removeClass(cssClass.iwcHidden);
                $formWrapper.addClass(cssClass.iwcHidden);
                util.tracking.publish($notifyBtn);
            }
        }
        /**
         * Initialize Notify Component
         * @function init
         * @public
         * @param {HTMLElement} element
         * @memberOf iwc.comp.notifyproductavailability
        */
        function init() {
            mapDomElements();
            $currentPagePathField.val(currentPagePath);
            iwc.comp.forms.init($form);
            iwc.util.formsAnimation.reInit($overlay);
            iwc.util.lightbox.reInit($overlay);
            iwc.comp.captcha.init();
            if ($overlay.find('[data-disabled]').length) {
                $emailField.prop('disabled', true);
            }
            $.subscribe('iwc:lightbox:close', destroy);
            $.subscribe('iwc:forms:reinit', formInitHandler);
            $.subscribe('iwc:lightbox:content:set', function(e) {
                if (e.pageName === name) {
                    $notifyBtn = e.target;
                }
            });

            $cancel.on('click', function() {
                util.lightbox.closeLightbox();
            });
        }

        return {
            init: init
        };

    })(iwc.$, iwc.util);
}());

/*global iwc*/
/**
 * Payment component js
 */

(function() {
    'use strict';
    /**
     * Payment component
     * @namespace payment
     * @memberof iwc.comp
     */
    iwc.comp.payment = (function($, util) {
        var $component,
            $form,
            $ifrm,
            $ifrmContent,
            iwcCardTypeVal,
            sendCounter = 0,
            $paymentType,
            selectors = {
                paymentContent: '#paymentContent',
                paymentType: '.iwc-payment-type',
                cardType: '.iwc-card-type',
                cardNumber: '.iwc-card-number',
                cardMonth: '.iwc-card-month',
                cardYear: '.iwc-card-year',
                cardCode: '.iwc-card-code',
                nologCardtype: '#nolog_cardtype',
                nologCardno: '#nolog_cardno',
                nologCardmonth: '#nolog_cardmonth',
                nologCardyear: '#nolog_cardyear',
                CCToken: '#CCToken',
                ccBin: '#cc_bin',
                creditcard: '#creditcard',
                CARD: '#CARD',
                paymentComp: '.iwc-payment',
                ifrm: '#ifrm',
                paymentForm: '.iwc-payment-form',
                submitBtn: '.iwc-payment-submit',
                deliveryOptionTab: '#deliveryOptionTab',
                orderSummaryTab: '#orderSummaryTab',
                orderSummaryContent: '#orderSummaryContent',
                summaryComponent: '.iwc-summary',
                errorMessage: '.iwc-payment-failure',
                paymentOptionContent: '.iwc-payment-option-content',
                fieldset: 'fieldset',
                hidden: '.iwc-hidden'
            },
            iframeSelectors = {
                paymetricCreditCardType: '#Paymetric_CreditCardType',
                paymetricCreditCardNumber: '#Paymetric_CreditCardNumber',
                paymetricExpMonth: '#Paymetric_Exp_Month',
                paymetricExpYear: '#Paymetric_Exp_Year',
                paymetricCVV: '#Paymetric_CVV',
                payNowButton: '#PayNowButton',
                responseJson: '#responseJson',
                errorLogging: '#Paymetric_ErrorLogging'
            },
            cssClass = {
                disabled: 'disabled',
                hiddenClass: 'iwc-hidden'
            },
            CONST = {
                disabled: 'disabled'
            };
        /**
         * Map card type numbers for Paymetric
         * @function ccNoChar
         * @memberOf iwc.comp.payment
         */
        function ccNoChar(no) {
            if (no === 'VISA') {
                return '4000';
            }
            if (no === 'DISC') {
                return '6000';
            }
            if (no === 'MAST') {
                return '5000';
            }
            if (no === 'AMEX') {
                return '3000';
            }
            if (no === 'DINE') {
                return 'PM_Cust_Card_Type_Header1000';
            }
            if (no === 'JCB') {
                return 'PM_Cust_Card_Type_Header7000';
            }
        }
        /**
         * Sync paymetric fields when card details filled in
         * @function syncFields
         * @memberOf iwc.comp.payment
         */
        function syncFields() {
            iwcCardTypeVal = $form.find(selectors.cardType + ':checked').val();
            var iwcCardNumberVal = $form.find(selectors.cardNumber).val(),
                iwcCardExpireMonthVal = $form.find(selectors.cardMonth).val(),
                iwcCardExpireYearVal = $form.find(selectors.cardYear).val(),
                iwcCardCVVVal = $form.find(selectors.cardCode).val();
            iwcCardNumberVal = iwcCardNumberVal.replace(/ /g,'');

            $ifrmContent.find(iframeSelectors.paymetricCreditCardType).val(ccNoChar(iwcCardTypeVal));
            $ifrmContent.find(iframeSelectors.paymetricCreditCardNumber).val(iwcCardNumberVal);
            $ifrmContent.find(iframeSelectors.paymetricExpMonth).val(iwcCardExpireMonthVal);
            $ifrmContent.find(iframeSelectors.paymetricExpYear).val(iwcCardExpireYearVal);
            $ifrmContent.find(iframeSelectors.paymetricCVV).val(iwcCardCVVVal);
            sendCounter = 1;
        }
        function reloadIframe() {
            var iframe = document.getElementById('ifrm');
            iframe.src = iframe.src;
            sendCounter = 0;
        }
        function replaceSpace(val) {
            return val.replace(/\s/g, '');
        }
        /**
         * Submit complete payment form after validating from Paymatric
         * @function ifrmLoad
         * @memberOf iwc.comp.payment
         */
        function ifrmLoad() {
            $ifrmContent = $ifrm.contents();
            if (sendCounter > 0) {
                var creditCardNumberWithoutSpaces = replaceSpace($form.find(selectors.creditcard).val()),
                    jsonResponse = $.parseJSON($ifrmContent.find(iframeSelectors.responseJson).text());
                if (jsonResponse.successFlag === 'true') {
                    $form.find(selectors.nologCardtype).val(jsonResponse.CCType);
                    $form.find(selectors.nologCardno).val(jsonResponse.CCToken);
                    $form.find(selectors.nologCardmonth).val(jsonResponse.Month);
                    $form.find(selectors.nologCardyear).val(jsonResponse.Year);
                    $form.find(selectors.CCToken).val(jsonResponse.CCToken);
                    $form.find(selectors.ccBin).val(creditCardNumberWithoutSpaces.substring(0, 6));
                    if (jsonResponse.CCType.length > 0) {
                        if (ccNoChar(iwcCardTypeVal) === jsonResponse.CCType) {
                            $form.find(selectors.creditcard).attr(CONST.disabled, true);
                            $form.find(selectors.nologCardtype).val(iwcCardTypeVal);
                            $form.submit();
                        }
                    }
                }
            } else {
                if ($ifrmContent.find('body').text().indexOf('Status') !== -1) {
                    reloadIframe();
                }
            }
        }

        function showHideAccordions() {
            $(selectors.orderSummaryTab).attr({'tabindex': 0, 'aria-disabled': 'false'});
            $(selectors.orderSummaryTab).removeClass(cssClass.disabled).trigger('click');
            $form.find(selectors.creditcard).attr(CONST.disabled, false);
            reloadIframe();
        }
        /*
         * triggering AJAX call to fetch summary data
         * @function loadSummaryContent
         * @memberof iwc.comp.payment
         */
        function loadSummaryContent() {
            var pageURL = window.location.href,
            pageURLAJAX = pageURL.replace('.html', '.summary.html?cacheburst=' + new Date().getTime());
            $.get(pageURLAJAX, function(data) {
                $(selectors.orderSummaryContent).html(data);
                var comp = $(selectors.orderSummaryContent).find(selectors.summaryComponent);
                util.initialise(comp);
                util.lightbox.reInit(comp);
                util.ajaxloader.hide();
            });
        }
        /**
         * Submit complete payment form after validating from Paymatric
         * @function submitForm
         * @param {event} e event object
         * @memberOf iwc.comp.payment
         */
        function submitForm(e) {
            e.preventDefault();
            util.ajaxloader.show();
            var $errorMessageElem = $form.find(selectors.paymentOptionContent).not(selectors.hidden).find(selectors.errorMessage);
            $.ajax({
                url: $form.attr('action'),
                type: $form.attr('method'),
                data: $form.serialize(),
                success: function(response) {
                    if (response.status === 'SUCCESS') {
                        loadSummaryContent();
                        showHideAccordions();
                        $(selectors.errorMessage).addClass(cssClass.hiddenClass);
                        iwc.util.tracking.publish($form.find(selectors.submitBtn));
                        $errorMessageElem.text('');
                    } else if (response.status === 'FAILURE') {
                        $errorMessageElem.text(response.values.errorMessage);
                        reloadIframe();
                        $form.find(selectors.creditcard).attr(CONST.disabled, false);
                        util.ajaxloader.hide();
                    }
                },
                error: function(response) {
                    $errorMessageElem.text(response.statusText);
                    $form.find(selectors.creditcard).attr(CONST.disabled, false);
                    util.ajaxloader.hide();
                }
            });
        }
        /**
         * Divide card number in goups of 4 digits
         * @function creditCardFormatter
         * @param {event} e event object
         * @memberOf iwc.comp.payment
         */
        function creditCardFormatter(e) {
            $(e.target).val(function(index, value) {
                return value.replace(/[^a-z0-9]+/gi, '').replace(/(.{4})/g, '$1 ');
            });
        }
        /**
         * Select payment type e.g. paypal, credit/debit cards
         * @function selectPaymentType
         * @param {event} e event object
         * @memberOf iwc.comp.payment
         */
        function selectPaymentType(e) {
            $paymentType = $(e.target);
            $paymentType.parent()
                .siblings(selectors.paymentOptionContent)
                .addClass(cssClass.hiddenClass)
                .find(selectors.fieldset)
                .prop('disabled', true);

            $paymentType.parent()
                .next(selectors.paymentOptionContent)
                .removeClass(cssClass.hiddenClass)
                .find(selectors.fieldset)
                .prop('disabled', false);
            $form.find(selectors.submitBtn).attr('data-tracking-payment', $paymentType.val());
        }
        /**
         * Select card based on number entered
         * @function creditCardTypeFromNumber
         * @param {event} e event object
         * @memberOf iwc.comp.payment
         */
        function creditCardTypeFromNumber(e) {
            var num = $(e.target).val(),
                type = 'VISA';
            num = num.replace(/[^\d]/g,'');
            if (num.match('^4[0-9]{0,15}$')) {
                type = 'VISA';
            } else if (num.match('^5$|^5[1-5][0-9]{0,14}$')) {
                type = 'MAST';
            } else if (num.match('^3[47][0-9]{0,13}$')) {
                type = 'AMEX';
            } else if (num.match('^3$|^3[068]$|^3(?:0[0-5]|[68][0-9])[0-9]{0,11}$')) {
                type = 'DINE';
            } else if (num.match('^6$|^6[05]$|^601[1]?$|^65[0-9][0-9]?$|^6(?:011|5[0-9]{2})[0-9]{0,12}$')) {
                type = 'DISC';
            } else if (num.match('^2[1]?$|^21[3]?$|^1[8]?$|^18[0]?$|^(?:2131|1800)[0-9]{0,11}$|^3[5]?$|^35[0-9]{0,14}$')) {
                type = 'JCB';
            }
            if (num.length > 2) {
                $('#' + type).prop('checked', true);
            }
        }
        /**
         * After every submit in iframe
         * it will check if there are errors
         * @function checkForErrors
         * @memberOf iwc.comp.payment
         */
        function checkForErrors() {
            var errorText = $ifrmContent.find(iframeSelectors.errorLogging).text();
            $form.find(selectors.paymentOptionContent)
                .not(selectors.hidden)
                .find(selectors.errorMessage)
                .text(errorText);
        }
        /**
         * Initialise a product element.
         * @memberOf iwc.comp.payment
         */
        function init(obj) {
            $component = $(obj);
            util.tracking.iwcCustomTracking($component.data('tracking'));
            $form = $(obj).find(selectors.paymentForm);
            $ifrm = $(obj).find(selectors.ifrm);
            $ifrm.on('load', ifrmLoad);
            $form.find(selectors.submitBtn).on('click', function(e) {
                e.preventDefault();
                if ($form.valid()) {
                    if ($form.find(selectors.CARD).is(':checked')) {
                        syncFields();
                        $ifrmContent.find(iframeSelectors.payNowButton).click();
                        checkForErrors();
                    } else {
                        $form.submit();
                    }
                }
            });
            $form.on('submit', submitForm);
            iwc.util.formsAnimation.init();
            $form.validate({
                errorElement: 'span',
                rules: {
                    creditcard: {
                        required: true,
                        creditcard: true
                    }
                }
            });
            $form.find(selectors.creditcard).on('keypress change blur', creditCardFormatter);
            $form.find(selectors.creditcard).on('keypress change blur', creditCardTypeFromNumber);
            $form.find(selectors.paymentType).on('click', selectPaymentType);
            $form.find(selectors.cardType).on('click', function() {
                $form.find(selectors.creditcard).val('');
            });
        }

        return {
            init: init
        };

    })(iwc.$, iwc.util);
}());

/*global iwc*/
/**
 * Boutique component
 */

(function() {
    'use strict';

    /**
     * Boutique component
     * @namespace boutique
     * @memberof iwc.comp
     */
    iwc.comp.boutique = (function($, util) {

        var selectors = {
            print: '.iwc-btq-print',
            explore: '.iwc-btq-hero-down',
            favourite: '.iwc-btq-favourite-cta',
            error: '.iwc-btq-error-wrapper',
            preferred: '.iwc-btq-preferred-text',
            login: '.iwc-btq-login-cta',
            appointmentBtn: '.iwc-btq-appointment'
        },
        cssClass = {
            hide: 'iwc-hidden',
            error: 'iwc-error',
            success: 'iwc-success'
        },
        $boutique,
        $printButton,
        $exploreButton,
        $favouriteButton,
        $errorWrapper,
        $preferredText,
        $loginButton,
        $appointmentBtn,
        boutiqueId,
        setBoutiqueUrl;

        /**
         * On print button click
         * @function onPrint
         * @private
         * @memberOf iwc.comp.boutique
        */
        function onPrint() {
            window.print();
        }

        /**
         * On explore button click
         * @function onExplore
         * @private
         * @param {object} e Event object
         * @memberOf iwc.comp.boutique
        */
        function onExplore(e) {
            e.preventDefault();
            var toScroll = $(e.currentTarget).attr('href'),
                scrollTop = $(toScroll).offset().top;
            util.scrollTo.position(scrollTop, 500);
        }

        /**
         * show feedback message for success case
         * @function showSuccess
         * @private
         * @memberOf iwc.comp.boutique
         */
        function showSuccess() {
            $preferredText.removeClass(cssClass.hide);
            $favouriteButton.addClass(cssClass.hide);
            util.ajaxloader.hide();
        }

        /**
         * show feedback message for remove favourite boutique
         * @function showRemoveSuccess
         * @private
         * @memberOf iwc.comp.boutique
         */
        function showRemoveSuccess() {
            $preferredText.addClass(cssClass.hide);
            $favouriteButton.removeClass(cssClass.hide);
            util.ajaxloader.hide();
        }

        /**
         * show feedback message for error case
         * @function showError
         * @private
         * @param {Object} data ajax response
         * @memberOf iwc.comp.boutique
         */
        function showError(data) {
            if (data.values) {
                $errorWrapper.addClass(cssClass.error).removeClass(cssClass.hide).text(data.values.errorMessage);
            }
            util.ajaxloader.hide();
        }

        /**
         * Set Boutique callback function for success
         * @function setBoutiqueSuccess
         * @private
         * @param {Object} data ajax response
         * @memberOf iwc.comp.boutique
         */
        function setBoutiqueSuccess(data) {
            if (data) {
                data.status.toLowerCase() === 'success' ? showSuccess() : showError(data);
            }
        }

        /**
         * Set Remove Boutique callback function for success
         * @function setRemoveBoutiqueSuccess
         * @private
         * @param {Object} data ajax response
         * @memberOf iwc.comp.boutique
         */
        function setRemoveBoutiqueSuccess(data) {
            if (data) {
                data.status.toLowerCase() === 'success' ? showRemoveSuccess() : showError(data);
            }
        }

        /**
         * Set Boutique callback function for error
         * @function setBoutiqueError
         * @private
         * @memberOf iwc.comp.boutique
         */
        function setBoutiqueError() {
            var errorMessage = util.formError.getdefault();
            $errorWrapper.html(errorMessage).addClass(cssClass.error).removeClass(cssClass.hide);
            util.ajaxloader.hide();
        }

        /**
         * On favourite button click
         * @function onFavourite
         * @private
         * @param {object} e Event object
         * @memberOf iwc.comp.boutique
        */
        function onFavourite(e) {
            e.preventDefault();
            util.ajaxloader.show();
            boutiqueId = $boutique.data('boutiqueId');
            setBoutiqueUrl = util.dataStore.getCurrentPagePath() + '.update-boutique.json?cacheburst=' + new Date().getTime();
            $.post(setBoutiqueUrl, { boutiqueId: boutiqueId })
                .done(setBoutiqueSuccess)
                .fail(setBoutiqueError);
        }

        /**
         * On remove favourite button click
         * @function onRemoveFavourite
         * @private
         * @param {object} e Event object
         * @memberOf iwc.comp.boutique
        */
        function onRemoveFavourite(e) {
            e.preventDefault();
            util.ajaxloader.show();
            boutiqueId = '';
            setBoutiqueUrl = util.dataStore.getCurrentPagePath() + '.update-boutique.json?cacheburst=' + new Date().getTime();
            $.post(setBoutiqueUrl, { boutiqueId: boutiqueId })
                .done(setRemoveBoutiqueSuccess)
                .fail(setBoutiqueError);
        }

        /**
         * Bind events
         * @function bindEvents
         * @private
         * @memberOf iwc.comp.boutique
        */
        function bindEvents() {
            $printButton.on('click', onPrint);
            $exploreButton.on('click', onExplore);
            $favouriteButton.on('click', onFavourite);
            $preferredText.on('click', onRemoveFavourite);
            $appointmentBtn.on('click', function() {
                util.tracking.publish($appointmentBtn);
            });
        }

        /**
         * initialise boutique template
         * @function init
         * @public
         * @param {HTMLElement} element
         * @memberOf iwc.comp.boutique
         */
        function init(elem) {
            $boutique = $(elem);
            $printButton = $boutique.find(selectors.print);
            $exploreButton = $boutique.find(selectors.explore);
            $favouriteButton = $boutique.find(selectors.favourite);
            $errorWrapper = $boutique.find(selectors.error);
            $preferredText = $boutique.find(selectors.preferred);
            $loginButton = $boutique.find(selectors.login);
            $appointmentBtn = $boutique.find(selectors.appointmentBtn);
            bindEvents();
        }

        return {
            init: init
        };
    })(iwc.$, iwc.util);
}());

/*global iwc*/
/**
 * Boutique preferences component
 */

(function() {
    'use strict';

    /**
     * Boutique preferences component
     * @namespace boutiquepreferences
     * @memberof iwc.comp
     */
    iwc.comp.boutiquepreferences = (function($, util) {

        var selectors = {
            appointmentBtn: '.iwc-btq-pref-appointment'
        },
        $boutiquepreferences,
        $appointmentBtn;

        /**
         * initialise boutiquepreferences template
         * @function init
         * @public
         * @param {HTMLElement} element
         * @memberOf iwc.comp.boutiquepreferences
         */
        function init(elem) {
            $boutiquepreferences = $(elem);
            $appointmentBtn = $boutiquepreferences.find(selectors.appointmentBtn);
            $appointmentBtn.on('click', function() {
                util.tracking.publish($appointmentBtn);
            });
        }

        return {
            init: init
        };
    })(iwc.$, iwc.util);
}());

/*global iwc, JSON */

/**
 * functionality for the Delivery Section in Checkout
 */
(function() {
    'use strict';
    /*
     * delivery component
     * @memberof iwc.comp.delivery
     */
    iwc.comp.delivery = (function($, util) {

        var selectors = {
                deliverySection: '.iwc-delivery',
                deliveryMethod: 'input[name="iwc-shipping-options"]',
                shipAddrDrpdwn: '.iwc-shipping-choose-address',
                billAddrDrpdwn: '.iwc-billing-choose-address',
                residenceLabel: '.shipping-label',
                saveNewAddress: '.saveAddressToProfile',
                shippingOption: '.deliveryType',
                customerAddrResponse : '.iwc-address-response',
                billingAddrSection: '.us-billing-address',
                shippingAddrSection: '.us-shipping-address',
                baseFormElement: '.base-forms-element',
                baseFormElementGroup:'.base-forms-element-group',
                baseFormElementWrapper:'.base-forms-element-wrapper',
                checkboxSection: '.system_form_checkbox.section',
                systemFormCheckbox:'.system_form_checkbox',
                errorBlock: '.iwc-delivery-errors',
                baseFormResponse: '.base-forms-response',
                shippingOptionRadio: 'input[name="deliveryType"]',
                shippingOptionRadioChecked: 'input[name="deliveryType"]:checked',
                saveAddressChkbx: '#saveAddressToProfile',
                contactEmail: 'input[name="emailAddress"]',
                useSameAddress: 'input[name="BillingAddressSameAsShipping"]',
                shippingAddressDropdown: 'select[name="iwc-shipping-choose-address"]',
                billingAddressDropdown:'select[name="iwc-billing-choose-address"]',
                paymentTab: '#paymentTab',
                expectedDeliveryDate: 'input[name="expectedDeliveryDate"]',
                priceIncludingTax: 'input[name="priceIncludingTax"]',
                baseConfirmationMessage: '.base-forms-confirmation',
                paymentComp: '.iwc-payment',
                paymentContent: '#paymentContent',
                checkoutBoutiques: '.iwc-btqp',
                checkoutBoutiquesFieldset: '.iwc-btqp-options',
                fieldset: 'fieldset',
                boutiqueRadioBtn: '#BTQP',
                shippingAddress: 'input[name="shipping-address"]',
                billingAddress: 'input[name="billing-address"]',
                formId: '#checkoutdelivery',
                availableShipOptions: '.iwc-available-shipping-options',
                billingAddressHiddenField: 'input[name="billing-address-section"]',
                billingStateField: '.billing\\.state',
                serverSideErrorBlock: '.base-forms-server-side-error',
                baseFormfieldErrorBlock: '.base-forms-field-error',
                formInputElements: 'form input, form select',
                checkoutWrapper: '.iwc-checkout',
                checkoutTabs: '.iwc-checkout .iwc-panel-link'
            },
            cssClass = {
                hide: 'iwc-hidden',
                focusedClass: 'input-focused',
                disabled: 'disabled',
                visible: 'iwc-visible',
                hideShippingAddress: 'iwc-hide-shipping-address',
                selected: 'selected'
            },
            customerType,
            currentPagePath,
            $customerAddrResponse,
            customerAddrData,
            customerHasAddr = false,
            addressKeys,
            freeText,
            currenyText,
            customerEmail,
            shipMode,
            currentStepLabel,
            $deliverySection,
            $residenceLabel,
            $form,
            $errorBlock,
            $billingCountryDropdown,
            $billingSalutationDropdown,
            $billingStateDropdown,
            $shippingStateDropdown,
            $shippingSalutationDropdown,
            $shippingCountry,
            $shippingLastName,
            $shippingStreetNumber,
            $shippingStreetName,
            $shippingAdditionalAddress,
            $shippingCity,
            $shippingFirstName,
            $shippingZip,
            $shippingPhone,
            $shippingMobile,
            $billingLastName,
            $billingStreetNumber,
            $billingStreetName,
            $billingAdditionalAddress,
            $billingCity,
            $billingFirstName,
            $billingZip,
            $billingPhone,
            $billingMobile,
            $body = $('body'),
            $checkoutBoutiques,
            $checkoutBoutiquesFieldset,
            $deliveryMethod,
            $sameAddressCheckbox,
            $submitButton,
            $billingAddressHiddenField,
            $billingStateField,
            $btqpRadio,
            $checkoutTabs,
            $checkoutWrapper,
            boutiquePickupOption,
            emptyObject = {
                addressId: '',
                city: '',
                country: '',
                firstName1: '',
                label: '',
                lastName1: '',
                phoneNumber: '',
                region: '',
                salutation: '',
                state: '',
                streetName: '',
                streetNumber: '',
                zip: '',
                additionalAddress: ''
            };

        /**
         * Handle billing state based on the country
         * @function handleBillingState
         * @private
         * @memberOf iwc.comp.delivery
        */
        function handleBillingState() {
            var billingCountry = $billingCountryDropdown.val();
            if (billingCountry !== 'US') {
                $billingStateDropdown.attr('disabled', true);
                $billingStateField.addClass(cssClass.hide);
            } else {
                $billingStateDropdown.attr('disabled', false);
                $billingStateField.removeClass(cssClass.hide);
            }
        }

        /**
         * Handle billing section hidden field based on the checkbox
         * @function handleBillingSection
         * @private
         * @memberOf iwc.comp.delivery
        */
        function handleBillingSection() {
            var useSameAddress = $sameAddressCheckbox.is(':checked');
            if (useSameAddress) {
                $billingAddressHiddenField.val(true);
            } else {
                $billingAddressHiddenField.val(false);
            }
        }

        /**
         * Toggle billing section based on the checkbox
         * @function toggleBilling
         * @private
         * @memberOf iwc.comp.delivery
        */
        function toggleBilling(event) {
            var $billingAddrSection = $(selectors.billingAddrSection);

            if ($(event.target).is(':checked')) {
                $billingAddrSection
                .addClass(cssClass.hide)
                .find('input[name^="billing."], select')
                .attr('disabled', true);

                $(selectors.useSameAddress).parents(selectors.systemFormCheckbox).next().next().next().addClass(cssClass.hide);

                if (customerType !== 'Guest' && customerHasAddr === true) {
                    $deliverySection.find(selectors.billAddrDrpdwn).addClass(cssClass.hide);
                }

            } else {
                $(selectors.useSameAddress).parents(selectors.systemFormCheckbox).next().next().next().removeClass(cssClass.hide);
                $billingAddrSection
                .removeClass(cssClass.hide)
                .find('input, select').removeAttr('disabled');

                if (customerType !== 'Guest' && customerHasAddr === true) {
                    $deliverySection.find(selectors.billAddrDrpdwn).removeClass(cssClass.hide);
                }
                handleBillingState();
            }
            handleBillingSection();
        }

        /**
         * Show Address Label Field
         * @function addressFieldToggle
         * @param {object} event jquery event object
         * @private
         * @memberOf iwc.comp.delivery
         */
        function addressFieldToggle(event) {
            if ($(event.target).is(':checked')) {
                $residenceLabel.removeClass(cssClass.hide);
            } else {
                $residenceLabel.addClass(cssClass.hide);
            }
        }

        /**
         * Set expected date for delivery
         * @function setExpectedDate
         * @private
         * @param {object} event jquery event object
         * @memberOf iwc.comp.delivery
        */
        function setExpectedDate(event) {
            var currentObject = $(event.target),
                expDate = currentObject.data('expected-date'),
                priceIncludingTax = currentObject.data('shipping-price');

            $deliverySection.find(selectors.expectedDeliveryDate).val(expDate);
            $deliverySection.find(selectors.priceIncludingTax).val(parseFloat(priceIncludingTax).toFixed(1));
        }
        /**
         * Load shipping options only if cart has non-configured products
         * Also set exp date from 7 days from today along with the priceIncludingTax
         * A safe check on cart configurable products when the function is triggered via subscribed event
         * @private
         * @memberOf iwc.comp.delivery
         */
        function updateDeliveryOptionsHandler() {
            if (iwc.data.cart && iwc.data.cart.configurable) {
                $(selectors.shippingOption).find(selectors.baseFormElementGroup).empty().append('<input type="radio" id="STDD" name="deliveryType" checked="true" value="STDD" />');
                var dateobj = new Date(),
                    futureDate = new Date(dateobj.setDate(dateobj.getDate() + 84)),
                    month = futureDate.getMonth() + 1,
                    day = futureDate.getDate(),
                    year = futureDate.getFullYear(),
                    expDate = month + '/' + day + '/' + year,
                    priceIncludingTax = '0.0';
                $deliverySection.find(selectors.expectedDeliveryDate).val(expDate);
                $deliverySection.find(selectors.priceIncludingTax).val(parseFloat(priceIncludingTax).toFixed(1));
                //hide Shipping Options when product type is configurable
                $(selectors.shippingOption)
                    .parents(selectors.checkboxSection)
                    .addClass(cssClass.hide)
                    .prev()
                    .addClass(cssClass.hide);
            }
        }

        /**
         * Show avaiable Shipping Methods based on the state
         * @function deliverySuccess
         * @private
         * @param {HTMLElement} data ajax response
         * @memberOf iwc.comp.delivery
        */
        function deliverySuccess(data) {
            var deliveryHtml = '';
            shipMode = data;

            if ($(data).find(selectors.baseFormElementWrapper)) {
                $errorBlock.addClass(cssClass.hide);
                deliveryHtml = data;

                $(selectors.shippingOption).find(selectors.baseFormElementGroup).empty().append(deliveryHtml);
                $(selectors.shippingOption).find(selectors.shippingOptionRadioChecked).trigger('click');

                var checkedRadio = $deliverySection.find(selectors.deliveryMethod + ':checked').val();
                if (checkedRadio !== 'BTQP') {
                    //Show Shipping Options only on ship-it
                    $(selectors.shippingOption)
                    .parents(selectors.checkboxSection)
                    .removeClass(cssClass.hide)
                    .prev()
                    .removeClass(cssClass.hide);
                }
            }
            updateDeliveryOptionsHandler();
        }

        /**
         * Show error if findDeliveryOptions ajax failed
         * @function deliveryError
         * @private
         * @memberOf iwc.comp.delivery
        */
        function deliveryError() {
            var errorMessage = iwc.util.formError.getdefault();
            $errorBlock.removeClass(cssClass.hide).text(errorMessage);
        }

        /**
         * find the available delivery options based on the current state
         * @function findDeliveryOptions
         * @private
         * @param {string} state shipping state
         * @memberOf iwc.comp.delivery
        */
        function findDeliveryOptions(state) {
            if (state) {
                var deliveryUrl = util.helper.removeHtmlExtension(currentPagePath) + '.shippingOptions.' + state + '.html';
                $.get(deliveryUrl).done(deliverySuccess).fail(deliveryError);
            }
            // Update delivery options if cart data is present and update options accordingly
            // or else Subscribe to event when customer details is not updated so as to modify delivery options
            // according to cart state
            if (iwc.data.cart && iwc.data.cart.configurable) {
                updateDeliveryOptionsHandler();
            } else {
                $.subscribe('iwc:customer:data:update', updateDeliveryOptionsHandler);
            }
        }

        /**
         * Return address data based on the user selection
         * @function getAddressData
         * @param  {Number} currentVal
         * @return {object} dataValues
         * @memberof iwc.comp.delivery
         */
        function getAddressData(currentVal) {
            var dataValues;
            if (currentVal === 'Select') {
                dataValues = emptyObject;
            } else {
                for (addressKeys in customerAddrData) {
                    if (customerAddrData[addressKeys].addressId === parseInt(currentVal, 10)) {
                        dataValues = customerAddrData[addressKeys];
                    }
                }
            }
            return dataValues;
        }

        /**
         * Loads the address on change of shipping Address dropdown
         * @function shippingAddressLoader
         * @private
         * @memberOf iwc.comp.delivery
        */
        function shippingAddressLoader() {

            var currentVal = $(selectors.shippingAddressDropdown).val(),
                dataValues;

            dataValues = getAddressData(currentVal);

            $shippingSalutationDropdown.val(dataValues.salutation);
            $shippingStateDropdown.val(dataValues.state);
            $shippingCountry.val(dataValues.country);
            $shippingLastName.val(dataValues.lastName1).parents(selectors.baseFormElement).addClass(cssClass.focusedClass);
            $shippingStreetNumber.val(dataValues.streetNumber).parents(selectors.baseFormElement).addClass(cssClass.focusedClass);
            $shippingStreetName.val(dataValues.streetName).parents(selectors.baseFormElement).addClass(cssClass.focusedClass);
            $shippingAdditionalAddress.val(dataValues.additionalAddress).parents(selectors.baseFormElement).addClass(cssClass.focusedClass);
            $shippingCity.val(dataValues.city).parents(selectors.baseFormElement).addClass(cssClass.focusedClass);
            $shippingFirstName.val(dataValues.firstName1).parents(selectors.baseFormElement).addClass(cssClass.focusedClass);
            $shippingZip.val(dataValues.zip).parents(selectors.baseFormElement).addClass(cssClass.focusedClass);
            $shippingPhone.val(dataValues.phoneNumber).parents(selectors.baseFormElement).addClass(cssClass.focusedClass);
            $shippingMobile.val(dataValues.mobileNumber).parents(selectors.baseFormElement).addClass(cssClass.focusedClass);
            findDeliveryOptions(dataValues.state);

        }

        /**
         * Loads the address on change of billing Address dropdown
         * @function billingAddressLoader
         * @private
         * @memberOf iwc.comp.delivery
        */
        function billingAddressLoader() {

            var currentVal = $(selectors.billingAddressDropdown).val(),
            dataValues;

            dataValues = getAddressData(currentVal);

            $billingCountryDropdown.val(dataValues.country);
            $billingSalutationDropdown.val(dataValues.salutation);
            $billingStateDropdown.val(dataValues.state);
            $billingLastName.val(dataValues.lastName1).parents(selectors.baseFormElement).addClass(cssClass.focusedClass);
            $billingStreetNumber.val(dataValues.streetNumber).parents(selectors.baseFormElement).addClass(cssClass.focusedClass);
            $billingStreetName.val(dataValues.streetName).parents(selectors.baseFormElement).addClass(cssClass.focusedClass);
            $billingAdditionalAddress.val(dataValues.additionalAddress).parents(selectors.baseFormElement).addClass(cssClass.focusedClass);
            $billingCity.val(dataValues.city).parents(selectors.baseFormElement).addClass(cssClass.focusedClass);
            $billingFirstName.val(dataValues.firstName1).parents(selectors.baseFormElement).addClass(cssClass.focusedClass);
            $billingZip.val(dataValues.zip).parents(selectors.baseFormElement).addClass(cssClass.focusedClass);
            $billingPhone.val(dataValues.phoneNumber).parents(selectors.baseFormElement).addClass(cssClass.focusedClass);
            $billingMobile.val(dataValues.mobileNumber).parents(selectors.baseFormElement).addClass(cssClass.focusedClass);
            handleBillingState();
        }

        /**
         * Bind user address with the drop down
         * @function bindAddressDropdown
         * @private
         * @memberOf iwc.comp.delivery
        */
        function bindAddressDropdown() {
            var drpdwnHtml = '';
            for (addressKeys in customerAddrData) {
                if (addressKeys) {
                    drpdwnHtml += '<option value="' + customerAddrData[addressKeys].addressId + '">' + customerAddrData[addressKeys].label + '</option>';
                }
            }
            //append address to dropdowns
            $(selectors.shippingAddressDropdown).append(drpdwnHtml);
            $(selectors.billingAddressDropdown).append(drpdwnHtml);

        }

        /**
         * Reset server side error on user interaction.
         * @function resetServerSideError
         * @private
         * @memberOf iwc.comp.delivery
        */
        function resetServerSideError() {
            var $serverSideError = $deliverySection.find(selectors.serverSideErrorBlock),
            $baseFieldError = $deliverySection.find(selectors.baseFormfieldErrorBlock);

            $deliverySection.find(selectors.formInputElements).one('keydown', function() {
                if ($serverSideError) {
                    $serverSideError.empty();
                }
                if ($baseFieldError) {
                    $baseFieldError.empty();
                }
            });
        }

        /**
         * create hidden fields in the form
         * @function createHiddenFields
         * @private
         * @memberOf iwc.comp.delivery
        */
        function createHiddenFields() {
            var hiddenFields = '<input id="expectedDeliveryDate" type="hidden" name="expectedDeliveryDate" value="00/00/0000">' +
            '<input id="priceIncludingTax" type="hidden" name="priceIncludingTax" value="0.00">';
            $deliverySection.find('form').append(hiddenFields);
        }
        /**
         * Publish custom data to push to Analytics
         * @function publishCheckoutDelivery
         * @private
         * @memberOf iwc.comp.delivery
        */
        function publishCheckoutDelivery() {
            var checkedRadio = $deliverySection.find(selectors.deliveryMethod + ':checked').val(),
                trackingData = $deliverySection.data('tracking');

            if (checkedRadio === 'BTQP') {
                trackingData.delivery = $deliverySection.data('text-btqp');
            } else {
                trackingData.delivery = $deliverySection.data('text-shipiing');
            }
            iwc.util.tracking.iwcCustomTracking(trackingData);
        }
        /**
         * Ajax call to fetch Payment options
         * for next accordion tab
         * @function callPaymentObjects
         * @private
         * @param {Object} - the element which needs to be selected
         * @memberOf iwc.comp.delivery
        */
        function callPaymentObjects(arg, param) {
            util.ajaxloader.show();
            var pageURL = window.location.href,
                params = param || '',
                pageURLAJAX = pageURL.replace('.html', '.payment.html') + params;
            $.get(pageURLAJAX, function(data) {
                $(selectors.paymentContent).html(data);
                var comp = $(selectors.paymentContent).find(selectors.paymentComp);
                iwc.comp.payment.init(comp);
                util.scrollTo.position($deliverySection.offset().top, 500);
                $body.find(selectors.paymentTab).attr({'tabindex': 0, 'aria-disabled': 'false'});
                $body.find(selectors.paymentTab).removeClass(cssClass.disabled).trigger('click');
                $deliverySection.find('form').removeClass(cssClass.hide);
                if (arg !== undefined) {
                    comp.find('input[value="' + arg + '"]').trigger('click');
                }
            }).always(function() {
                util.ajaxloader.hide();
            });
        }
        /**
         * Cache all elements
         * @function cacheElements
         * @private
         * @memberOf iwc.comp.delivery
        */
        function cacheElements() {
            $errorBlock = $deliverySection.find(selectors.errorBlock);
            $form = $deliverySection.find('form');
            $billingCountryDropdown = $deliverySection.find('select[name="billing.country"]');
            $billingSalutationDropdown = $deliverySection.find('select[name="billing.salutation"]');
            $billingStateDropdown = $deliverySection.find('select[name="billing.state"]');
            $shippingStateDropdown = $deliverySection.find('select[name="shipping.state"]');
            $shippingSalutationDropdown = $deliverySection.find('select[name="shipping.salutation"]');
            $shippingCountry = $deliverySection.find('input[name="shipping.country"]');
            $shippingLastName = $deliverySection.find('input[name="shipping.lastname"]');
            $shippingStreetNumber = $deliverySection.find('input[name="shipping.streetnumber"]');
            $shippingStreetName = $deliverySection.find('input[name="shipping.streetname"]');
            $shippingAdditionalAddress = $deliverySection.find('input[name="shipping.address2"]');
            $shippingCity = $deliverySection.find('input[name="shipping.city"]');
            $shippingFirstName = $deliverySection.find('input[name="shipping.firstname"]');
            $shippingZip = $deliverySection.find('input[name="shipping.zip"]');
            $shippingPhone = $deliverySection.find('input[name="shipping.phone"]');
            $shippingMobile = $deliverySection.find('input[name="shipping.mobile"]');
            $billingLastName = $deliverySection.find('input[name="billing.lastname"]');
            $billingStreetNumber = $deliverySection.find('input[name="billing.streetnumber"]');
            $billingStreetName = $deliverySection.find('input[name="billing.streetname"]');
            $billingAdditionalAddress = $deliverySection.find('input[name="billing.address2"]');
            $billingCity = $deliverySection.find('input[name="billing.city"]');
            $billingFirstName = $deliverySection.find('input[name="billing.firstname"]');
            $billingZip = $deliverySection.find('input[name="billing.zip"]');
            $billingPhone = $deliverySection.find('input[name="billing.phone"]');
            $billingMobile = $deliverySection.find('input[name="billing.mobile"]');
            $residenceLabel = $deliverySection.find(selectors.residenceLabel);
            $deliveryMethod = $deliverySection.find(selectors.deliveryMethod);
            $checkoutBoutiques = $deliverySection.find(selectors.checkoutBoutiques);
            $checkoutBoutiquesFieldset = $checkoutBoutiques.find(selectors.checkoutBoutiquesFieldset);
            $sameAddressCheckbox = $deliverySection.find(selectors.useSameAddress);
            $submitButton = $deliverySection.find('input[type="submit"]');
            $billingAddressHiddenField = $deliverySection.find(selectors.billingAddressHiddenField);
            $billingStateField = $deliverySection.find(selectors.billingStateField);
            $btqpRadio = $deliverySection.find('input[id="BTQP"][name="iwc-shipping-options"]');
        }

        /**
         * Set checkout loader Address for billing
         * and shipping that is present in the backend
         * @function setSelectedAddress
         * @private
         * @memberOf iwc.comp.delivery
        */
        function setSelectedAddress() {
            var shippingLabel = $(selectors.shippingAddress).val(),
                billingLabel = $(selectors.billingAddress).val();
            if (typeof shippingLabel === 'string') {
                for (addressKeys in customerAddrData) {
                    if (addressKeys) {
                        if (customerAddrData[addressKeys].label === shippingLabel) {
                            shippingLabel = customerAddrData[addressKeys].addressId;
                        }
                        if (customerAddrData[addressKeys].label === billingLabel) {
                            billingLabel = customerAddrData[addressKeys].addressId;
                        }
                    }
                }
            }
            $(selectors.shippingAddressDropdown).val(shippingLabel);
            $(selectors.billingAddressDropdown).val(billingLabel);
        }

        /**
         * Show/hide boutique pickup option
         * @function showHideBoutiquePickup
         * @private
         * @param {obj} e - event object
         * @memberOf iwc.comp.delivery
        */
        function showHideBoutiquePickup(e) {
            var action = $(e.target).val() || e;

            if (action === 'BTQP') {
                $form.addClass(cssClass.hideShippingAddress);
                $checkoutBoutiques.removeClass(cssClass.hide);
                $checkoutBoutiquesFieldset.prop('disabled', false);
                $deliverySection.find(selectors.shippingAddrSection).closest(selectors.fieldset).prop('disabled', true);
                if ($(selectors.useSameAddress).is(':checked')) {
                    $(selectors.useSameAddress).trigger('click');
                }
                $sameAddressCheckbox.closest(selectors.baseFormElement).addClass(cssClass.hide);
                $(selectors.shippingOption).find(selectors.baseFormElementGroup + ' input[type="radio"]').prop('disabled', true);
                $(selectors.shippingOption)
                    .parents(selectors.checkboxSection)
                    .addClass(cssClass.hide)
                    .prev()
                    .addClass(cssClass.hide);
            } else {
                $form.removeClass(cssClass.hideShippingAddress);
                $checkoutBoutiques.addClass(cssClass.hide);
                $checkoutBoutiquesFieldset.prop('disabled', true);
                $deliverySection.find(selectors.shippingAddrSection).closest(selectors.fieldset).prop('disabled', false);
                if (!$(selectors.useSameAddress).is(':checked')) {
                    $(selectors.useSameAddress).trigger('click');
                }
                if ($deliverySection.find(selectors.availableShipOptions).length) {
                    $(selectors.shippingOption).find(selectors.baseFormElementGroup + ' input[type="radio"]').prop('disabled', false);
                    $(selectors.shippingOption)
                        .parents(selectors.checkboxSection)
                        .removeClass(cssClass.hide)
                        .prev()
                        .removeClass(cssClass.hide);
                }
                $(selectors.useSameAddress).closest(selectors.baseFormElement).removeClass(cssClass.hide);
            }
        }

        /**
         * Setup the default form based on the user
         * @function formReInitHandler
         * @private
         * @memberOf iwc.comp.delivery
        */
        function formReInitHandler() {
            createHiddenFields();
            handleBillingState();
            resetServerSideError();
            var checkedRadio = $deliverySection.find(selectors.deliveryMethod + ':checked').val(),
                billingAddressVisible = JSON.parse($billingAddressHiddenField.val());
            $deliverySection.find(selectors.useSameAddress).prop('checked', billingAddressVisible);
            if (checkedRadio === 'BTQP') {
                showHideBoutiquePickup(checkedRadio);
            }
            iwc.comp.boutiquepickup.init($deliverySection.find(selectors.checkoutBoutiques));

            //On reinit Hide BTQP from delivery Method if its not available from backend
            if (boutiquePickupOption === 'notpresent' && $btqpRadio) {
                $btqpRadio.parent(selectors.baseFormElementWrapper).addClass(cssClass.hide);
            }

            //Hide Shipping Options
            $deliverySection.find(selectors.shippingOption)
                .parents(selectors.checkboxSection)
                .addClass(cssClass.hide)
                .prev()
                .addClass(cssClass.hide);

            if ($deliverySection.find(selectors.useSameAddress).is(':checked')) {
                //.next().next().next() is used to hide the Billing Address Label
                $deliverySection.find(selectors.useSameAddress).parents(selectors.systemFormCheckbox).next().next().next().addClass(cssClass.hide);
                $deliverySection.find(selectors.billAddrDrpdwn).addClass(cssClass.hide);
                $deliverySection.find(selectors.billingAddrSection)
                .addClass(cssClass.hide)
                .find('input[name^="billing."], select').attr('disabled', true);

            } else {
                $deliverySection.find(selectors.useSameAddress).parents(selectors.systemFormCheckbox).next().next().next().removeClass(cssClass.hide);
                $deliverySection.find(selectors.billAddrDrpdwn).removeClass(cssClass.hide);
                $deliverySection.find(selectors.billingAddrSection).removeClass(cssClass.hide);
            }

            if (customerType === 'Guest') {
                $deliverySection.find(selectors.shipAddrDrpdwn).remove();
                $deliverySection.find(selectors.billAddrDrpdwn).remove();
                $residenceLabel.remove();
                $deliverySection.find(selectors.saveNewAddress).remove();

            } else if (customerType !== 'Guest' && customerHasAddr === true) {
                $deliverySection.find(selectors.saveNewAddress).remove();
                $residenceLabel.remove();
                bindAddressDropdown();
                setSelectedAddress();

            } else if (customerType !== 'Guest' && customerHasAddr === false) {
                $deliverySection.find(selectors.shipAddrDrpdwn).remove();
                $deliverySection.find(selectors.billAddrDrpdwn).remove();
                $residenceLabel.addClass(cssClass.hide);
                $residenceLabel.toggleClass(cssClass.hide, !($deliverySection.find(selectors.saveAddressChkbx).is(':checked')));

            }
            iwc.util.formsAnimation.reInit($deliverySection);
            findDeliveryOptions($shippingStateDropdown.val());
        }

        /**
         * Form reinit
         * @function formInitHandler
         * @param {object} form Form element
         * @param {Boolean} data Success true/false
         * @memberOf iwc.comp.delivery
         */
        function formInitHandler(form, data) {
            cacheElements();
            iwc.comp.forms.init($(form));
            formReInitHandler();

            iwc.util.lightbox.init($(selectors.checkoutBoutiques)[0]);

            if (data) {
                //TODO - there should be a handshake function for talking to other component.
                $(selectors.baseConfirmationMessage).removeClass(cssClass.visible).addClass(cssClass.hide);
                $form.removeClass(cssClass.hide);
                if (form.is(selectors.formId)) {
                    setTimeout(function() {
                        callPaymentObjects();
                    }, 0);
                }
                util.tracking.iwcCustomTracking({
                    'deliveryError': 'No'
                });
            } else {
                util.tracking.iwcCustomTracking({
                    'deliveryError': 'Yes'
                });
            }
        }

        /**
         * Add dynamic title to checkout tabs
         * @function changeCheckoutTabs
         * @private
         * @param {object} event - event object
         * @param {object} toggleInstance current tab.
         * @memberOf iwc.comp.delivery
        */
        function changeCheckoutTabs(event, toggleInstance) {
            if (toggleInstance.$currentToggleButton.length) {
                if (toggleInstance.$currentToggleButton.hasClass(cssClass.selected)) {
                    $checkoutTabs.each(function() {
                        $(this).attr('title', $(this).html());
                    });
                    toggleInstance.$currentToggleButton.attr('title', toggleInstance.$currentToggleButton.html() + currentStepLabel);
                } else {
                    $checkoutTabs.each(function() {
                        $(this).attr('title', $(this).html());
                    });
                }
            }
        }

        /**
         * Bind Events
         * @function bindEvents
         * @private
         * @memberOf iwc.comp.delivery
        */
        function bindEvents() {
            $deliverySection.on('click', selectors.shippingOptionRadio, setExpectedDate);
            $deliverySection.on('change', selectors.useSameAddress,toggleBilling);
            $deliverySection.on('change', selectors.shippingAddressDropdown, shippingAddressLoader);
            $deliverySection.on('change', selectors.billingAddressDropdown, billingAddressLoader);
            $deliverySection.on('change', selectors.saveAddressChkbx, addressFieldToggle);
            $deliverySection.on('change', 'select[name="shipping.state"]', function(event) {
                findDeliveryOptions($(event.target).val());
            });
            $deliverySection.on('click', selectors.deliveryMethod, showHideBoutiquePickup);
            $submitButton.on('click', publishCheckoutDelivery);
            $deliverySection.on('change', 'select[name="billing.country"]', handleBillingState);
            $checkoutWrapper.on('toggle-change', changeCheckoutTabs);
        }

        /**
         * Setup the default form for user
         * @function formInit
         * @private
         * @memberOf iwc.comp.delivery
        */
        function formInit() {
            //Hide BTQP from delivery Method if its not available from backend
            if (boutiquePickupOption === 'notpresent' && $btqpRadio) {
                $btqpRadio.parent(selectors.baseFormElementWrapper).addClass(cssClass.hide);
            }

            //fill contact email if it exists
            if (typeof customerEmail !== 'undefined') {
                $(selectors.contactEmail).val(customerEmail).parents(selectors.baseFormElement).addClass(cssClass.focusedClass);
            }

            //Hide Shipping Options
            $(selectors.shippingOption)
            .parents(selectors.checkboxSection)
            .addClass(cssClass.hide)
            .prev()
            .addClass(cssClass.hide);

            // hide/show the billing section based on the user interaction
            if ($deliverySection.find(selectors.useSameAddress).is(':checked')) {
                //.next().next().next() is used to hide the Billing Address Label
                $deliverySection.find(selectors.useSameAddress).parents(selectors.systemFormCheckbox).next().next().next().addClass(cssClass.hide);
                $deliverySection.find(selectors.billAddrDrpdwn).addClass(cssClass.hide);
                $deliverySection.find(selectors.billingAddrSection)
                .addClass(cssClass.hide)
                .find('input[name^="billing."], select').attr('disabled', true);

            } else {
                $deliverySection.find(selectors.useSameAddress).parents(selectors.systemFormCheckbox).next().next().next().removeClass(cssClass.hide);
                $deliverySection.find(selectors.billAddrDrpdwn).removeClass(cssClass.hide);
                $deliverySection.find(selectors.billingAddrSection).removeClass(cssClass.hide)
                .find('input[name^="billing."], select').attr('disabled', false);
            }

            //checking if the customer has addresses
            if ($.trim($customerAddrResponse.html()) !== '') {
                customerAddrData = JSON.parse($customerAddrResponse.html());
                customerHasAddr = (customerAddrData.length > 0) ? true : false;
            }

            createHiddenFields();
            $deliverySection.find(selectors.shippingAddrSection + ' input').attr('placeholder','');
            $deliverySection.find(selectors.billingAddrSection + ' input').attr('placeholder','');

            if (customerType === 'Guest') {
                $deliverySection.find(selectors.shipAddrDrpdwn).remove();
                $deliverySection.find(selectors.billAddrDrpdwn).remove();
                $residenceLabel.remove();
                $deliverySection.find(selectors.saveNewAddress).remove();

            } else if (customerType !== 'Guest' && customerHasAddr === true) {
                $deliverySection.find(selectors.saveNewAddress).remove();
                $residenceLabel.remove();

            } else if (customerType !== 'Guest' && customerHasAddr === false) {
                $deliverySection.find(selectors.shipAddrDrpdwn).remove();
                $deliverySection.find(selectors.billAddrDrpdwn).remove();
                $residenceLabel.addClass(cssClass.hide);
            }
            if (customerHasAddr) {
                bindAddressDropdown();
                setSelectedAddress();
            }
        }
        /**
         * Hide pick up boutique radio
         * when there is no boutique to show
         * @function hideBoutiquePickupTab
         * @public
         * @memberOf iwc.comp.delivery
        */
        function hideBoutiquePickupTab() {
            $(selectors.boutiqueRadioBtn).parent().addClass(cssClass.hide);
        }

        /**
         * Initialize Delivery Component
         * @function init
         * @public
         * @memberOf iwc.comp.delivery
        */
        function init(element) {
            $deliverySection = $(element) || $(selectors.deliverySection);
            customerType = $deliverySection.data('customerId');
            currentPagePath = $deliverySection.data('url');
            customerEmail = $deliverySection.data('customerEmail');
            freeText = $deliverySection.data('delivery-free'),
            currenyText = $deliverySection.data('delivery-currency');
            boutiquePickupOption = $deliverySection.data('boutique-pickup');
            $customerAddrResponse = $deliverySection.find(selectors.customerAddrResponse);
            $checkoutWrapper = $(selectors.checkoutWrapper);
            $checkoutTabs = $(selectors.checkoutTabs);
            currentStepLabel = $checkoutWrapper.data('current-step');
            //bindings on fields
            cacheElements();
            formInit();
            bindEvents();



            var checkedRadio = $deliverySection.find(selectors.deliveryMethod + ':checked').val();
            if (checkedRadio === 'BTQP') {
                showHideBoutiquePickup(checkedRadio);
            }

            iwc.comp.forms.init($form);
            $.subscribe('iwc:forms:reinit', formInitHandler);
            findDeliveryOptions($shippingStateDropdown.val());
            handleBillingState();
            handleBillingSection();
            if (window.location.hash) {
                var hash = window.location.hash.substring(1),
                    hashValue = hash.match(/returningfrompaypal/g),
                    params = window.location.search;
                if (hashValue[0] === 'returningfrompaypal') {
                    callPaymentObjects('PPAL', params);
                }
            }
        }

        return {
            init: init,
            hideBoutiquePickupTab: hideBoutiquePickupTab
        };

    })(iwc.$, iwc.util);
}());

/*global iwc*/
/**
 * Order Summary component
 */

(function() {
    'use strict';
    /*
     * paymentaddress component
     * @namespace paymentaddress
     * @memberof iwc.comp
     */
    iwc.comp.paymentaddress = (function($) {
        var $comp,
            $editAddressLink,
            $editPaymentLink,
            selectors = {
                comp: '[data-component-name="paymentaddress"]',
                editAddressLink: '.iwc-order-edit-address-link',
                editPaymentLink: '.iwc-order-edit-payment-link',
                deliveryOptionTab: '#deliveryOptionTab',
                paymentTab: '#paymentTab'
            },
            cssClass = {
                disabled: 'disabled'
            };
        /*
         * bind click events for accordions
         * @function bindEvents
         * @memberof iwc.comp.paymentaddress
         */
        function bindEvents() {
            $editAddressLink.on('click', function(e) {
                e.preventDefault();
                $(selectors.deliveryOptionTab).removeClass(cssClass.disabled).trigger('click');
            });
            $editPaymentLink.on('click', function(e) {
                e.preventDefault();
                $(selectors.paymentTab).removeClass(cssClass.disabled).trigger('click');
            });
        }
        /*
         * Mapping elements in the component
         * @function mapDOMElements
         * @memberof iwc.comp.paymentaddress
         */
        function mapDOMElements() {
            $editAddressLink = $comp.find(selectors.editAddressLink);
            $editPaymentLink = $comp.find(selectors.editPaymentLink);
        }
        /*
         * Initializes the function
         * @function init
         * @memberof iwc.comp.paymentaddress
         */
        function init(comp) {
            $comp = $(comp) || $(selectors.comp);
            mapDOMElements();
            bindEvents();
        }
        return {
            init: init
        };
    })(iwc.$);
}());

/*global iwc */
/**
 * functionality for the order details confirmation in Checkout
 */
(function() {
    'use strict';

    /*
     * ordersummary component
     * @memberof iwc.comp
     */
    iwc.comp.ordersummary = (function($) {

        var selectors = {
                orderConfirmForm: '#iwc-order-details-confirm',
                orderConfirmSection : '.iwc-order-summary',
                paymentTab: '#paymentTab',
                shippingAmount: '.iwc-order-summary-ship-amount',
                contactBrand: 'input[name="contactByBrand"]'
            },
            $form,
            $orderConfirmSection,
            $shippingAmount,
            $contactBrandChkbox,
            customerType,
            userContactBrand;


        /**
         * contact brand checkbox state
         * @function contactBrandHandler
         * @private
         * @param {string} customerType Customer Type
         * @memberOf iwc.comp.ordersummary
         */
        function contactBrandHandler(customerType) {
            if (customerType !== 'Guest' && userContactBrand) {
                $contactBrandChkbox.prop('checked', userContactBrand);
            }
        }

        /**
         * Form reinit
         * @function formReinitHandler
         * @private
         * @param {object} form Form element
         * @memberOf iwc.comp.ordersummary
         */
        function formReinitHandler(form) {
            iwc.comp.forms.init($(form));
            contactBrandHandler();
        }

        /**
         * Initialize order summary section
         * @function init
         * @public
         * @memberOf iwc.comp.ordersummary
        */
        function init(element) {
            $orderConfirmSection = $(element) || $(selectors.orderConfirmSection);
            customerType = $orderConfirmSection.data('customerId');
            userContactBrand = $orderConfirmSection.data('contactBrand');
            iwc.util.tracking.iwcCustomTracking($orderConfirmSection.data('tracking'));
            $form = $orderConfirmSection.find(selectors.orderConfirmForm);
            $shippingAmount = $orderConfirmSection.find(selectors.shippingAmount);
            $contactBrandChkbox = $orderConfirmSection.find(selectors.contactBrand);
            iwc.comp.forms.init($form);
            contactBrandHandler(customerType);
            $.subscribe('iwc:forms:reinit', formReinitHandler);
        }

        return {
            init: init
        };

    })(iwc.$);
}());

/*global iwc */
/**
 * Shopping Bag entry point
 */
(function($) {
    'use strict';

    iwc.comp.shoppingbag = {};
    iwc.comp.shoppingbag.module = {};

    var bagList = [],
        $summaryWrapper,
        $checkoutBtn,
        $disclaimerWrapper,
        $disclaimerRow,
        $disclaimerInput,
        selectors = {
            summaryWrapper: '.iwc-bag-summary-container',
            checkoutBtn: '.iwc-bag-checkout',
            disclaimerWrapper: '.iwc-bag-detail-summary-disclaimer-wrapper',
            disclaimerRow: '.iwc-bag-detail-summary-disclaimer-btns',
            disclaimerInput: '#iwc-shopping-disclaimer-checkbox'
        },
        cssClass = {
            error: 'iwc-error'
        };

    /**
	 * aBasketReloaded After change in a bag reload other
	 * @param  {number} reloadedBagKey id of reloaded bag
	 */
    function aBasketReloaded(reloadedBagKey) {
        var index, bag;
        for (index = 0; index < bagList.length; index++) {
            bag = bagList[index];
            if (bag.key !== reloadedBagKey) {
                bag.refreshBag();
            }
        }
    }

    /**
    * checkout button click handler
    * @function onCheckoutBtnClick
    * @param {object} e event object
    * @memberOf iwc.comp.shoppingbag
    */
    function onCheckoutBtnClick(e) {

        var $target = $(e.target);

        if (!$disclaimerInput.prop('checked')) {
            e.preventDefault();
            showDisclaimerError();
        } else if (!$target.data('loggedin')) {
            e.preventDefault();
            hideDisclaimerError();
        }
    }
    /**
    * Show disclaimer and remove events from checkout btn
    * @function showDisclaimerError
    * @memberOf iwc.comp.shoppingbag
    */
    function showDisclaimerError() {
        $checkoutBtn.removeAttr('data-lightbox').off('click');
        // re cache selector
        $checkoutBtn = $summaryWrapper.find(selectors.checkoutBtn);
        $checkoutBtn.on('click.checkout', onCheckoutBtnClick);
        $disclaimerWrapper.addClass(cssClass.error);
    }
    /**
    * Hide disclaimer and rebind events on checkout btn
    * @function hideDisclaimerError
    * @memberOf iwc.comp.shoppingbag
    */
    function hideDisclaimerError() {
        $disclaimerWrapper.removeClass(cssClass.error);
        // add attribute required for lightbox
        $checkoutBtn.attr('data-lightbox', true);
        // re init lightbox selector
        iwc.util.lightbox.reInit($summaryWrapper[0]);
        // trigger click
        $checkoutBtn.off('click.checkout').trigger('click');
    }
    /**
    *
    * Change handler for disclaimer checkbox
    * @function onInputChange
    * @memberOf iwc.comp.shoppingbag
    */
    function onInputChange() {
        if (!$disclaimerInput.prop('checked')) {
            showDisclaimerError();
        } else {
            $disclaimerWrapper.removeClass(cssClass.error);
        }
    }
    /**
	 * init Shoping bag component initialization
	 * @param  {HTMLElement} elem bag's container
	 */
    iwc.comp.shoppingbag.init = function(elem) {
        var bagInitializer = iwc.comp.shoppingbag.module.bag,
        bag = bagInitializer($(elem), {onBasketReloaded: aBasketReloaded});

        // call configurator util
        iwc.util.configurator.init();

        $summaryWrapper = $(elem).find(selectors.summaryWrapper);
        $disclaimerWrapper = $summaryWrapper.find(selectors.disclaimerWrapper);

        if ($disclaimerWrapper.length) {
            $disclaimerRow = $disclaimerWrapper.find(selectors.disclaimerRow);
            $disclaimerInput = $disclaimerRow.find(selectors.disclaimerInput);
            $checkoutBtn = $summaryWrapper.find(selectors.checkoutBtn);

            $checkoutBtn.on('click.checkout', onCheckoutBtnClick);
            $disclaimerInput.on('change.checkout', onInputChange);
        }

        //Main list of all bags
        bagList.push(bag);
    };

})(iwc.$);

/*global iwc */

/*
 * Shopping Bag - Module Bag
 * Bag level functionality
 * @namespace bag
 * @memberof iwc.comp.shoppingbag.module
 */
iwc.comp.shoppingbag.module.bag = (function($, util) {
    'use strict';
    /**
	* Bag Constructor
	* @param {jQuery} $elem   bag element
	* @param {Object} options properties to override defaults
	*/
    function Bag($elem, options) {
        this.productsList = [];
        this.subTotal = 0;
        this.$bag = $elem;
        this.key = (new Date()).getTime();
        this.$targetBtn;
        this.selectors = {
            product: '.iwc-bag-product',
            component: '.iwc-component.iwc-shoppingbag',
            removeBtn: '.iwc-bag-action-remove'
        };
        this.CONST = {
            productAdd: 'add',
            productRemove: 'remove'
        };
        this.options = {
            onBasketReloaded: function() {}
        };

        $.extend(this.options, options);

        this.initProducts();

        $.subscribe('iwc:wishlist:changed', (function() {
            $.subscribe('iwc:customer:data:update', (function() {
                $.unsubscribe('iwc:customer:data:update');
                util.wishlist.reInit(this.$bag);
            }).bind(this));
        }).bind(this));
    }

    /**
	 * refreshBag destroy current content and load init new content.
	 */
    Bag.prototype.refreshBag = function() {
        $.get(this.$bag.data('url'))
            .done((function(data) {
                var newBagHtml = $(data).find(this.selectors.component).html();

                this.destroyProducts();
                this.$bag.html(newBagHtml);
                this.initProducts();
                util.lightbox.reInit(this.$bag);
                util.wishlist.reInit(this.$bag);
                util.ajaxloader.hide();
                var giftWrapper = this.$bag.find('.iwc-gift-options-wrapper'),
                    featuredWatches = this.$bag.find('.iwc-featured-watch');
                iwc.comp.giftoptions.init(giftWrapper);
                iwc.comp.featuredWatch.init(featuredWatches);
            }).bind(this));
        //TODO: When all bags on the page has same view,
        //all bags makes its own network request
        //and all has same data.
        //Should allow some how to share the data, and have one network request.
    };

    /**
	 * addProduct Product add request to the server
	 * Handler of front end product's add
	 * @param {jQuery} $product existing element request received from
	 */
    Bag.prototype.addProduct = function($product) {
        var productId = $product.data('productid');
        util.ajaxloader.show();
        $.post(
            util.dataStore.getCurrentPagePath() + '.cart-add.json',
            {'productId': productId, 'quantity': '1'},
            this.onProductChange.bind(this, this.CONST.productAdd)
        );
    };

    /**
	 * removeProduct Product remove request to the server
	 * Handler of front end product's remove
	 * @param {jQuery} $product existing element request received from
	 */
    Bag.prototype.removeProduct = function($product) {
        var removeProductIndex = $product.data('bag-index');
        this.$targetBtn = $product.find(this.selectors.removeBtn);
        $.post(
            util.dataStore.getCurrentPagePath() + '.cart-delete.json',
			{'index': removeProductIndex},
            this.onProductChange.bind(this, this.CONST.productRemove)
        );
    };

    /**
	 * onProductChange response handler of product add/remove
     * @param  {string} changeType type of change add or remove
	 * @param  {Object} data server response
	 */
    Bag.prototype.onProductChange = function(changeType, data) {
        if (data.status === 'SUCCESS') {

            util.tracking.publish(this.$targetBtn);
            $.publish('iwc:shoppingbag:changed', [changeType]);

            this.refreshBag();
            var basketReloadedCallback = this.options.onBasketReloaded;
            if (basketReloadedCallback && typeof basketReloadedCallback === 'function') {
                basketReloadedCallback(this.key);
            }
        } else {
            util.ajaxloader.hide();
        }
        util.lightbox.closeLightbox();
    };

    /**
	 * initProducts create & bind JS instance of Product
	 */
    Bag.prototype.initProducts = function() {
        var productInitializer = iwc.comp.shoppingbag.module.product,
            $products = this.$bag.find(this.selectors.product),
            productOptions = {};
        productOptions.onRemove = this.removeProduct.bind(this);
        productOptions.onAdd = this.addProduct.bind(this);

        $.each($products, (function(index) {
            var product = productInitializer($products.eq(index), productOptions);
            this.productsList.push(product);
        }).bind(this));
    };

    /**
	 * destroyProducts destroy each existing JS product
	 */
    Bag.prototype.destroyProducts = function() {
        $.each(this.productsList, function(index, product) {
            product.destroy();
        });
        this.productsList = [];
    };

    /**
	 * init The only function exported as module
	 * @param  {HTMLElement} elem    bag element
	 * @param  {Object} options
	 */
    function init(elem, options) {
        var $elem = $(elem),
        bag = {};

        if (!$elem.data('bag')) {
            bag = new Bag(elem, options);
            $elem.data('bag', bag);
        } else {
            bag = $elem.data('bag');
        }
        return bag;
    }

    return init;

})(iwc.$, iwc.util);


/*global iwc */

/*
 * Shopping Bag - Module Product
 * Bag's product level functionality
 * @namespace product
 * @memberof iwc.comp.shoppingbag.module
 */
iwc.comp.shoppingbag.module.product = (function($) {
    'use strict';
    /**
	 * Product Constructor
	 * @param {jQuery} $elem   product element
	 * @param {Object} options properties to override defaults
	 */
    function Product($elem, options) {
        this.$elem = $elem;
        this.options = {
            onRemove: function() {},
            onAdd: function() {}
        };
        this.selectors = {
            remove: '.iwc-bag-action-remove',
            add: '.iwc-bag-action-another, .iwc-bag-addition-another'
        };

        this.cssClass = {
            showMore: 'iwc-bag-show-addition',
            actionDisabled: 'iwc-bag-action-disabled',
            bagOverlayVisible: 'iwc-remove-shopping-overlay-active'
        };

        this.$removeBtn = this.$elem.find(this.selectors.remove);
        this.$addBtn = this.$elem.find(this.selectors.add);
        this.$body = $('body');

        $.extend(this.options, options);

        this.bindEvents();

    }

    /**
	 * removeProduct event handler of remove click
	 * @param  {event} event
	 */
    Product.prototype.removeProduct = function(event) {
        this.$body.addClass(this.cssClass.bagOverlayVisible);
        var removeCallback = this.options.onRemove;
        if (removeCallback && typeof removeCallback === 'function') {
            removeCallback(this.$elem);
        }
        event.preventDefault();
    };

    /**
	 * addProduct event handler of add click
	 * @param  {event} event
	 */
    Product.prototype.addProduct = function(event) {
        var addCallback = this.options.onAdd,
            $target = $(event.currentTarget);

        if (addCallback && typeof addCallback === 'function' && !$target.hasClass(this.cssClass.actionDisabled)) {
            addCallback(this.$elem);
        }
        event.preventDefault();
    };

    /**
	 * bindEvents
	 */
    Product.prototype.bindEvents = function() {
        this.$removeBtn.on('click', this.removeProduct.bind(this));
        this.$addBtn.on('click', this.addProduct.bind(this));
    };

    /**
	 * destroy does cleanup work
	 */
    Product.prototype.destroy = function() {
        this.$elem.off('click');
        this.$addBtn.off('click');
    };

    /**
	 * init The only function exported as module
	 * @param  {HTMLElement} elem    product element
	 * @param  {Object} options
	 */
    function init (elem, options) {
        var $elem = $(elem),
        product = {};

        if (!$elem.data('product')) {
            product = new Product($elem, options);
            $elem.data('product', product);
        } else {
            product = $elem.data('product');
        }
        return product;
    }

    return init;

})(iwc.$);

/*global iwc */

/**
 * functionality for the Remove product from Bag
 */
(function() {
    'use strict';
    /*
     * removefrombag component
     * @namespace iwc.comp.removefrombag
     */
    iwc.comp.removefrombag = (function($) {

        var $overlay,
            $confirmBtn,
            $removeBtn,
            selectors = {
                overlay: '.iwc-lightbox-content',
                confirmBtn: '.iwc-remove-product',
                removeForm: '.iwc-bag-remove-form',
                removeBtn: '.iwc-bag-action-remove'
            },
            cssClass = {
                shoppingBagOverlayVisible: 'iwc-remove-shopping-overlay-active'
            },
            $body = $('body');

        /**
         * Get the real form button to perform delete after confirmation
         * @function getRemoveBtn
         * @private
         * @param {Object} targetButton object
         * @memberof iwc.util.removefrombag
         */
        function getRemoveBtn(requester) {
            $removeBtn = $(requester.target)
                            .next(selectors.removeForm)
                            .find(selectors.removeBtn);
        }
        /**
         * Initialize Remove product overlay
         * @function init
         * @public
         * @memberOf iwc.comp.removefrombag
        */
        function init() {
            $overlay = $(selectors.overlay);
            $confirmBtn = $overlay.find(selectors.confirmBtn);
            $.subscribe('iwc:lightbox:content:set', getRemoveBtn);
            $confirmBtn.on('click', function(e) {
                e.preventDefault();
                $removeBtn.trigger('click');
            });

            $.subscribe('iwc:lightbox:close', function() {
                $body.removeClass(cssClass.shoppingBagOverlayVisible);
            });
        }

        return {
            init: init
        };

    })(iwc.$);
}());

/*global iwc */
/**
 * functionality for the order details confirmation in Checkout
 */
(function() {
    'use strict';

    /*
     * giftoptions component
     * @memberof iwc.comp
     * @namespace giftoptions
     */
    iwc.comp.giftoptions = (function($) {

        var $giftoptions,
            $giftMessageWrapper,
            $printedMessageDiv,
            $removeBtn,
            $addWrappingCheckbox,
            $addWrappingForm,
            $errorWrapper,
            $addMessageBtn,
            selectors = {
                giftMessageWrapper:     '.iwc-gift-message',
                printedMessageDiv:      '.iwc-printed-message',
                removeBtn:              '.iwc-remove-message',
                editBtn:                '.iwc-edit-message',
                overlay:                '.iwc-lightbox-wrapper',
                targetTextarea:         '.base-forms-textarea',
                addWrappingCheckbox:    '.iwc-add-wrapping',
                addWrappingForm:        '.iwc-add-wrapping-form',
                errorWrapper:           '.iwc-error',
                addMessageBtn:          '.iwc-add-message'
            },
            cssClass = {
                iwcHidden:      'iwc-hidden'
            },
            formUrlCartMessage = iwc.util.dataStore.getCurrentPagePath() + '.cart-message-option.json',
            formUrlAddWrapping = iwc.util.dataStore.getCurrentPagePath() + '.gift-wrap-option.json';

        /**
         * Get server response and show error
         * @function errorHandler
         * @private
         * @param {Object} data - Json object
         * @memberOf iwc.comp.giftoptions
        */
        function errorHandler(data) {
            $errorWrapper.text(data.statusText || data.errorMessage);
        }
        /**
         * Show/Hide "Add Message Button"
         * @function showHideAddMessageBtn
         * @private
         * @param {Object} data - string
         * @memberOf iwc.comp.giftoptions
        */
        function showHideAddMessageBtn(action) {
            if (action === 'show') {
                $addMessageBtn.removeClass(cssClass.iwcHidden);
            } else {
                $addMessageBtn.addClass(cssClass.iwcHidden);
            }
        }
        /**
         * Return printed message from page
         * @function printedMessage
         * @private
         * @return printed message from wrapper
         * @memberOf iwc.comp.giftoptions
        */
        function printedMessage() {
            return $printedMessageDiv.html();
        }
        /**
         * Format data and show message on page
         * @function formatData
         * @private
         * @param {Object} responseData - Response data
         * @memberOf iwc.comp.giftoptions
        */
        function formatData(responseData) {
            if (responseData) {
                responseData = responseData.replace(/\n/g, '<br />');
                $printedMessageDiv.html(responseData);
                $giftMessageWrapper.removeClass(cssClass.iwcHidden);
                showHideAddMessageBtn('hide');
            }
        }
        /**
         * Hide note message section when message removed
         * @function removeSuccessHandler
         * @private
         * @memberOf iwc.comp.giftoptions
        */
        function removeSuccessHandler() {
            $giftMessageWrapper.addClass(cssClass.iwcHidden);
            $printedMessageDiv.html('');
            showHideAddMessageBtn('show');
        }
        /**
         * Send blank message to remove message
         * @function removeMessage
         * @private
         * @memberOf iwc.comp.giftoptions
        */
        function removeMessage() {
            $.post(formUrlCartMessage, '')
                .done(removeSuccessHandler)
                .fail(errorHandler);
        }
        /**
         * AJAX call to set gift wrapping true/false and set status of gift wrapping
         * @function addWrappingHandler
         * @private
         * @param {Object} e - Event object
         * @memberOf iwc.comp.giftoptions
        */
        function addWrappingHandler(e) {
            var $target = $(e.target),
                serializeData;
            if ($target.is(':checked')) {
                serializeData = 'giftwrap=true';
            } else {
                serializeData = 'giftwrap=false';
            }
            $.post(formUrlAddWrapping, serializeData)
                .fail(errorHandler);
        }
        /**
         * Mapping DOM Elements within Component
         * @function mapDOMElements
         * @private
         * @memberOf iwc.comp.giftoptions
        */
        function mapDOMElements() {
            $giftMessageWrapper = $giftoptions.find(selectors.giftMessageWrapper);
            $printedMessageDiv = $giftoptions.find(selectors.printedMessageDiv);
            $removeBtn = $giftoptions.find(selectors.removeBtn);
            $addWrappingForm = $giftoptions.find(selectors.addWrappingForm);
            $addWrappingCheckbox = $giftoptions.find(selectors.addWrappingCheckbox);
            $errorWrapper = $giftoptions.find(selectors.errorWrapper);
            $addMessageBtn  = $giftoptions.find(selectors.addMessageBtn);
        }
        /**
         * Initialize gift message section
         * @function init
         * @public
         * @memberOf iwc.comp.giftoptions
        */
        function init(obj) {
            $giftoptions = $(obj);
            mapDOMElements();
            $removeBtn.on('click', removeMessage);
            $addWrappingCheckbox.on('click', addWrappingHandler);
            if (printedMessage()) {
                formatData(printedMessage().trim());
            }
        }

        return {
            init: init,
            printedMessage: printedMessage,
            formatData: formatData
        };

    })(iwc.$, iwc.util);
}());

/*global iwc */
/**
 * functionality for the order details confirmation in Checkout
 */
(function() {
    'use strict';
    /*
     * giftmessageform component
     * @memberof iwc.comp
     * @namespace giftmessageform
     */
    iwc.comp.giftmessageform = (function($, util) {
        var $messageWrapper,
            $overlay,
            $form,
            $targetTextarea,
            $submitbtn,
            $errorPlaceholder,
            $resetbtn,
            selectors = {
                overlay:            '.iwc-lightbox-content',
                addMessageForm:     '.iwc-add-message-form',
                targetTextarea:     '.base-forms-textarea',
                editBtn:            '.iwc-edit-message',
                errorPlaceholder:   '.base-forms-server-side-error'
            },
            formData,
            printedData,
            formUrl = iwc.util.dataStore.getCurrentPagePath() + '.cart-message-option.json';

        /**
         * Get response data deformat to display in textarea
         * @function deSanitiseFormData
         * @private
         * @param {HTML} printedData - Response data
         * @memberOf iwc.comp.giftmessageform
        */
        function deSanitiseFormData(printedData) {
            printedData = printedData.replace(/<br\s*[\/]?>/gi, '\n');
            $targetTextarea.val(printedData);
        }
        /**
         * Get server response and show error
         * @function errorHandler
         * @private
         * @param {Object} data - Json object
         * @memberOf iwc.comp.giftmessageform
        */
        function errorHandler(data) {
            $errorPlaceholder.html(data.statusText);
            $submitbtn.prop('disabled', false);
        }
        /**
         * Get response data and format
         * @function submitForm
         * @private
         * @param {HTML} data - Response data
         * @memberOf iwc.comp.giftmessageform
        */
        function successHandler(data) {
            if (data.status === 'SUCCESS') {
                util.tracking.publish($submitbtn);
                $.get(formUrl)
                    .done(function(data) {
                        iwc.comp.giftoptions.formatData(data.values.cartmessage);
                        iwc.util.lightbox.closeLightbox();
                    })
                    .fail(errorHandler);
            }
        }
        /**
         * Submit message form
         * @function submitForm
         * @private
         * @param {Object} e - Event object
         * @memberOf iwc.comp.giftmessageform
        */
        function submitForm(e) {
            e.preventDefault();
            formData = $form.serialize();
            $submitbtn.prop('disabled', true);
            $.post(formUrl, formData)
                .done(successHandler)
                .fail(errorHandler);
        }
        /**
         * Call a utility to handle character count
         * @function charaterCount
         * @private
         * @memberOf iwc.comp.giftmessageform
        */
        function charaterCount() {
            util.charcount.init($overlay);
        }
        /**
         * Map DOM elements within component
         * @function mapDomElements
         * @private
         * @memberof iwc.util.giftmessageform
         */
        function mapDomElements() {
            $overlay = $(selectors.overlay);
            $form = $overlay.find('form');
            $targetTextarea = $overlay.find(selectors.targetTextarea);
            $submitbtn = $form.find('input[type="submit"]');
            $resetbtn = $form.find('input[type="reset"]');
            $errorPlaceholder  = $overlay.find(selectors.errorPlaceholder);
        }
        /**
         * close the lightbox when form resetted
         * @function closeLightbox
         * @private
         * @memberOf iwc.comp.giftmessageform
        */
        function closeLightbox() {
            iwc.util.lightbox.closeLightbox();
        }
        /**
         * Initialize gift message section
         * @function init
         * @public
         * @param {HTML} obj
         * @memberOf iwc.comp.giftmessageform
        */
        function init(obj) {
            $messageWrapper = $(obj) || $(selectors.addMessageForm);
            mapDomElements();
            charaterCount();
            $form.on('submit', submitForm);
            printedData = iwc.comp.giftoptions.printedMessage().trim();
            if (printedData === '') {
                deSanitiseFormData('');
            } else {
                deSanitiseFormData(printedData);
            }
            $resetbtn.on('click', closeLightbox);
        }

        return {
            init: init
        };

    })(iwc.$, iwc.util);
}());

/*global iwc */
/**
 * functionality for Boutique Pickup
 */
(function() {
    'use strict';

    /*
     * boutiquepickup component
     * @namespace boutiquepickup
     * @memberof iwc.comp
     */
    iwc.comp.boutiquepickup = (function($, util) {

        var $component,
            $boutiqueHeading,
            $boutiqueJSONWrapper,
            $boutiqueMapLink,
            $boutiqueTemplate,
            $displayBoutique,
            selectors = {
                boutiqueHeading: '.iwc-btqp-heading',
                boutiqueJSONWrapper: '.boutiqueJSONWrapper',
                boutiqueMapLink: '.iwc-boutique-map-link',
                boutiqueTemplate: '.iwc-boutique-template',
                displayBoutique: '.iwc-btqp-selected-address',
                deliveryboutiquecode: 'input[name="deliveryboutiquecode"]'
            },
            cssClass = {
                hidden: 'iwc-hidden',
                error: 'iwc-error',
                fallbackList: 'iwc-fallback-list',
                singleBoutique: 'iwc-single-boutique'
            },
            boutiqueJSONData,
            boutiqueCount,
            boutiqueTemplate,
            updateTemplate,
            userLatLng,
            boutiqueList = '';

        /**
         * Expose customer location
         * @function userLocationSuccess
         * @public
         * @memberOf iwc.comp.boutiquepickup
         * @return {Object} userLatLng - user's location
         */
        function customerNearestCoords() {
            return userLatLng;
        }
        /**
         * Expose customer location
         * @function userLocationSuccess
         * @public
         * @memberOf iwc.comp.boutiquepickup
         * @return {Object} boutiqueJSONData - Boutique list
         */
        function botiqueListContainer() {
            return boutiqueJSONData;
        }
        /**
         * Update boutique display template
         * @function displayBoutique
         * @public
         * @param {Object} displayBoutique - selected or nearest boutique
         * @return {String} updateTemplate
         * @memberOf iwc.comp.boutiquepickup
         */
        function displayBoutique(displayBoutique, checked) {
            if (displayBoutique === undefined) {
                return;
            }
            var timingItems = '';
            for (var i = 0; i < displayBoutique.openingHours.length; i++) {
                timingItems += ('<li class="iwc-dd-item">' + displayBoutique.openingHours[i] + '</li>');
            }
            updateTemplate = boutiqueTemplate
                            .replace('{{checked}}', checked)
                            .replace(/{{id}}/g, displayBoutique.id)
                            .replace('{{title}}', displayBoutique.title)
                            .replace('{{address}}', displayBoutique.address)
                            .replace('{{city}}', displayBoutique.city)
                            .replace('{{zip}}', displayBoutique.zip)
                            .replace('{{state}}', displayBoutique.state)
                            .replace('{{tel}}', displayBoutique.tel)
                            .replace(/{{showTimings}}/g, 'showTimings')
                            .replace('{{storeTimings}}', timingItems);

            return updateTemplate;
        }
        /**
         * Update HTML content for boutique to display
         * @function updateBoutiqueContent
         * @public
         * @param {Object} boutiqueList - data to inject
         * @memberOf iwc.comp.boutiquepickup
         */
        function updateBoutiqueContent(boutiqueList) {
            var boutiqueId = $(boutiqueList).find('input[name="boutiquecode"]').val();
            boutiqueId = parseInt(boutiqueId, 10);
            $displayBoutique.html(boutiqueList);
            $(selectors.deliveryboutiquecode).val(boutiqueId);
        }

        /**
         * Get nearest boutique form user's location
         * Ref URL: http://stackoverflow.com/questions/4057665/google-maps-api-v3-find-nearest-markers
         * @function getNearestBoutique
         * @private
         * @param {Number} lat, lng, user's current location
         * @memberOf iwc.comp.boutiquepickup
         */
        function getNearestBoutique(lat, lng) {
            var nearestBoutique = util.userlocation.nearestBoutique(lat, lng, boutiqueJSONData);
            boutiqueList = displayBoutique(nearestBoutique, 'checked');
            userLatLng = nearestBoutique;
            updateBoutiqueContent(boutiqueList);
        }
        /**
         * Show user message if getting location fails
         * @function userLocationSuccess
         * @private
         * @param {Object} data - location data of user
         * @memberOf iwc.comp.boutiquepickup
         */
        function userLocationSuccess(data) {
            userLatLng = data;
            getNearestBoutique(data.latitude, data.longitude);
        }
        /**
         * Show user message if getting location fails
         * @function userLocationFailure
         * @private
         * @memberOf iwc.comp.boutiquepickup
         */
        function userLocationFailure() {
            $component.addClass(cssClass.fallbackList);
            var count = 0;
            for (var i = 0; i < boutiqueJSONData.length; i++) {
                count += 1;
                if (count === 1) {
                    boutiqueList += displayBoutique(boutiqueJSONData[i], 'checked');
                } else {
                    boutiqueList += displayBoutique(boutiqueJSONData[i], '');
                }
            }
            updateBoutiqueContent(boutiqueList);
        }
        /**
         * Get User's location on POST call
         * @function getUserLocation
         * @private
         * @memberOf iwc.comp.boutiquepickup
         */
        function getUserLocation() {
            $component.addClass(cssClass.singleBoutique);
            util.userlocation.get()
                .done(userLocationSuccess)
                .fail(userLocationFailure);
        }
        /**
         * Hide actions button "Map Buton" & "Pickup Radio"
         * @function hideActionButtons
         * @private
         * @param {Number} boutiqueCount count to take action
         * @memberOf iwc.comp.boutiquepickup
         */
        function hideActionButtons(boutiqueCount) {
            if (boutiqueCount === 0) {
                iwc.comp.delivery.hideBoutiquePickupTab();
                $boutiqueMapLink.addClass(cssClass.hidden);
            } else if (boutiqueCount === 1) {
                $boutiqueMapLink.addClass(cssClass.hidden);
            }
        }
        /**
         * Get boutique template which will be shown to user
         * @function getBoutiqueTemplate
         * @public
         * @memberOf iwc.comp.boutiquepickup
         * @return {String} boutiqueTemplate
         */
        function getBoutiqueTemplate() {
            boutiqueTemplate = $boutiqueTemplate.text();
            return boutiqueTemplate;
        }
        /**
         * If boutique exists from Backend show that
         * @function preSelectedBoutique
         * @private
         * @param {Number} boutique id
         * @memberOf iwc.comp.boutiquepickup
         */
        function preSelectedBoutique(boutiqueId) {
            var boutique,
                boutiqueExists = parseInt(boutiqueId, 10);
            boutiqueTemplate = getBoutiqueTemplate();
            $.each(boutiqueJSONData, function(i, obj) {
                if (obj.id === boutiqueExists) {
                    boutique = obj;
                }
            });
            boutiqueList = displayBoutique(boutique, 'checked');
            updateBoutiqueContent(boutiqueList);
        }
        /**
         * Get boutique data from page as string and parse into JSON
         * @function getBoutiqueData
         * @private
         * @memberOf iwc.comp.boutiquepickup
         */
        function getBoutiqueData() {
            boutiqueJSONData = $boutiqueJSONWrapper.text();
            if (boutiqueJSONData !== '') {
                boutiqueJSONData = $.parseJSON(boutiqueJSONData);
            }
            boutiqueCount = boutiqueJSONData.length;
            hideActionButtons(boutiqueCount);
            // Check if backend loader is loading the boutique ID
            var boutiqueIdFromLoader = $(selectors.deliveryboutiquecode).val();
            if (boutiqueIdFromLoader !== '') {
                preSelectedBoutique(boutiqueIdFromLoader);
            } else {
                getUserLocation();
            }
        }
        /**
         * Mapping required elements in component
         * @function mapDOMElements
         * @private
         * @memberOf iwc.comp.boutiquepickup
         */
        function mapDOMElements() {
            $boutiqueHeading = $component.find(selectors.boutiqueHeading);
            $boutiqueJSONWrapper = $component.find(selectors.boutiqueJSONWrapper);
            $boutiqueMapLink = $component.find(selectors.boutiqueMapLink);
            $boutiqueTemplate = $component.find(selectors.boutiqueTemplate);
            $displayBoutique = $component.find(selectors.displayBoutique);
        }
        /**
         * Initialize Boutique pickup component
         * @function init
         * @public
         * @memberOf iwc.comp.boutiquepickup
        */
        function init(element) {
            $component = $(element);
            mapDOMElements();
            getBoutiqueData();
            getBoutiqueTemplate();
        }

        return {
            init: init,
            customerNearestCoords: customerNearestCoords,
            botiqueListContainer: botiqueListContainer,
            getBoutiqueTemplate: getBoutiqueTemplate,
            displayBoutique: displayBoutique,
            updateBoutiqueContent: updateBoutiqueContent
        };

    })(iwc.$, iwc.util);
}());

/*global iwc, base */
/**
 * functionality for Boutique Pickup Map
 */
(function() {
    'use strict';

    /*
     * boutiquepickupmap component
     * @namespace boutiquepickupmap
     * @memberof iwc.comp
     */
    iwc.comp.boutiquepickupmap = (function($, util) {

        var $overlay,
            $component,
            $mapWrapper,
            $cancelAction,
            $openedInfoWindow,
            selectors = {
                overlay: '.iwc-lightbox-content',
                component: '.iwc-boutiquepickup-map',
                mapWrapper: '.iwc-map-wrapper',
                selectBoutiqueLink: '.iwc-select-boutique',
                cancelAction: '.iwc-cancel-action'
            },
            boutiques,
            map,
            boutiqueTemplate,
            userNearestBoutique,
            boutiqueList,
            zoomLevel;

        /**
         * Open detail info overlay on marker click on map
         * @function openInfoWindow
         * @private
         * @memberOf iwc.comp.boutiquepickupmap
        */
        function openInfoWindow (infowindow, map, marker) {
            if ($openedInfoWindow) {
                $openedInfoWindow.close();
            }
            infowindow.open(map, marker);
            $openedInfoWindow = infowindow;

        }

        /**
         * Open map based on user's nearest boutique
         * @function showMap
         * @private
         * @param {Number} lat, lng - user latitude and longitude number
         * @memberOf iwc.comp.boutiquepickupmap
        */
        function showMap(lat, lng) {
            base.util.googlemaps.loadGoogleMaps(function() {
                var latLng = new window.google.maps.LatLng(lat, lng),
                    mapOptions = {
                        zoom: zoomLevel,
                        center: latLng,
                        scrollwheel: false,
                        mapTypeControl: false,
                        streetViewControl: false,
                        mapTypeId: window.google.maps.MapTypeId.ROADMAP,
                        cluster: {
                            isEnabled: true,
                            opts: {}
                        }
                    };
                map = new window.google.maps.Map($mapWrapper[0], mapOptions);
                map.setOptions({styles: util.mapOptions.config.map.type.defaultStyles});
                boutiqueTemplate = iwc.comp.boutiquepickup.getBoutiqueTemplate();

                /* jshint ignore:start */
                /* jscs:disable*/
                var markers = boutiques.map(function(boutique, i) {
                    var location = {lat: boutique.location.latitude, lng: boutique.location.longitude},
                        timingItems = '';
                    for (var j = 0; j < boutique.openingHours.length; j++) {
                        timingItems += ('<li class="iwc-dd-item">' + boutique.openingHours[j] + '</li>');
                    }
                    var contentString = boutiqueTemplate
                                        .replace(/{{id}}/g, boutique.id)
                                        .replace('{{title}}', boutique.title)
                                        .replace('{{address}}', boutique.address)
                                        .replace('{{city}}', boutique.city)
                                        .replace('{{zip}}', boutique.zip)
                                        .replace('{{state}}', boutique.state)
                                        .replace('{{tel}}', boutique.tel)
                                        .replace('{{lat}}', location.lat)
                                        .replace('{{lng}}', location.lng)
                                        .replace(/{{showTimings}}/g, 'showTimings' + i)
                                        .replace('{{storeTimings}}', timingItems),

                        infowindow = new google.maps.InfoWindow({
                                content:  contentString,
                                maxWidth: 250
                            }),
                        marker = new google.maps.Marker({
                            position: location,
                            icon: util.mapOptions.config.markerIconImage
                        });
                    marker.addListener('click', function() {
                        openInfoWindow(infowindow, map, marker);
                    });
                    return marker;
                });
                util.ajaxloader.hide();
                var markerCluster = new MarkerClusterer(map, markers,{styles:[
                    util.mapOptions.config.map.cluster.opts.styles[0]
                ]});
                /* jscs:enable*/
                /* jshint ignore:end */
            });
        }
        /**
         * Calling lightbox close utility
         * @function closeLightBox
         * @private
         * @memberOf iwc.comp.boutiquepickupmap
        */
        function closeLightBox() {
            iwc.util.lightbox.closeLightbox();
        }
        /**
         * Initialize Boutique pickup component
         * @function updateSelectedBoutique
         * @private
         * @param {Object} event object
         * @memberOf iwc.comp.boutiquepickupmap
        */
        function updateSelectedBoutique(e) {
            var $target = $(e.target),
                thisID = $target.data('boutiqueid'),
                getSelectedBoutique;
            for (var i = 0; i < boutiques.length; i++) {
                if (boutiques[i].id === thisID) {
                    getSelectedBoutique = boutiques[i];
                }
            }
            boutiqueList = iwc.comp.boutiquepickup.displayBoutique(getSelectedBoutique, 'checked');
            iwc.comp.boutiquepickup.updateBoutiqueContent(boutiqueList);
            closeLightBox();
        }
        /**
         * Initialize Boutique pickup component
         * @function init
         * @public
         * @memberOf iwc.comp.boutiquepickupmap
        */
        function init() {
            util.ajaxloader.show();
            boutiques = iwc.comp.boutiquepickup.botiqueListContainer();
            $overlay = $(selectors.overlay);
            $component = $overlay.find(selectors.component);
            $mapWrapper = $overlay.find(selectors.mapWrapper);
            $cancelAction = $overlay.find(selectors.cancelAction);
            userNearestBoutique = iwc.comp.boutiquepickup.customerNearestCoords();
            if (util.matchmedia.narrow.matches) {
                zoomLevel = 3;
            } else {
                zoomLevel = 4;
            }
            // By default it sets to USA
            showMap(37.09024, -95.712891);
            $overlay.on('click', selectors.selectBoutiqueLink, updateSelectedBoutique);
            $cancelAction.on('click', closeLightBox);
        }

        return {
            init: init
        };

    })(iwc.$, iwc.util, base);
}());

/*global base*/
/**
 * @fileOverview Provides basic functionality for the storelocator component
 */

(function(base, $, util) {
    'use strict';

    var CONST = {
        selectors: {
            searchContainer: '.base-storelocator-filters',
            mapContainer: '.base-storelocator-results',
            resultContainer: '.base-storelocator-list',
            resultHeading: '.base-storelocator-message',
            txtSearchBox: '.base-storelocator-autosearch',
            btnGeoLoc: '.base-storelocator-location',
            btnReset: '.base-storelocator-reset',
            map: '.base-storelocator-map',
            templateResultItem: '.base-storelocator-tmpl-result-item',
            templateMarkerInfoWindow: '.base-storelocator-tmpl-marker-infowindow',
            resultList: '.base-storelocator-listitems',
            resultItem: '.base-storelocator-listitem',
            templateTypeFilters: '.base-storelocator-tmpl-type-filters',
            typeFiltersWrapper: '.base-storelocator-filters-wrapper',
            typeFilterCheckbox: '.base-forms-checkbox',
            moreDetailsText:'.base-storelocator-moredetails-text',
            loadMore: '.base-storelocator-loadmore',
            loadMoreBtn: '.base-storelocator-loadmore-btn',
            mapOptions: '.base-storelocator-options',
            listBtn: '.iwc-boutiquelocator-list-btn',
            mapBtn: '.iwc-boutiquelocator-map-btn',
            sliderBtn: '.iwc-boutiquelocator-slider-btn',
            clearBtn: '.iwc-boutiquelocator-reset-btn',
            filtersNarrow: '.base-storelocator-filters-narrow',
            filtersWide: '.base-storelocator-filters-wide',
            resultListWrapper: '.base-storelocator-list-wrapper',
            filtersLegend: '.base-storelocator-legend'
        },
        cssClass: {
            active: 'base-storelocator-active',
            hide: 'base-storelocator-hide',
            found: 'base-storelocator-found',
            filtered: 'base-storelocator-filtered',
            notfiltered: 'base-storelocator-notfiltered',
            loading: 'base-storelocator-loading',
            mapNotLoaded: 'base-storelocator-map-not-loaded',
            hidden: 'base-hidden',
            inpagination: 'base-storelocator-inpagination',
            notinpagination: 'base-storelocator-notinpagination',
            dataNotLoaded: 'base-storelocator-data-not-loaded',
            expanded: 'iwc-expanded',
            contracted: 'iwc-contracted'
        },
        GeoLocStatus: {
            LOADED: 'loaded',
            LOADING: 'loading'
        },
        GeoLocSuccessResult: {
            formattedAddress: 'formatted_address'
        },
        defaultLatitude: 25.812218,
        defaultLongitude: -80.19258,
        defaultZoom: 2,
        boutiqueTypeInternal: 'internal',
        boutiqueTypeExternal: 'external'
    },
    _defaultOptions = {
        map: null,
        geoLocation: null,
        searchedLocation: {
            showPin: false
        },
        userPosition: null
    },
    Storelocator = function(_settings) {
        this._opts = $.extend(true, {}, _defaultOptions, _settings.options);
        this.OPTIONS = {};
        this.geoLocation = {
            status: false,
            $location: null,
            $marker: null,
            $infoWindow: null,
            $circle: null
        };
        this.config = {
            elems: {
                $comp: _settings.$el,
                $searchContainer: _settings.$el.find(CONST.selectors.searchContainer),
                $mapContainer: _settings.$el.find(CONST.selectors.mapContainer),
                $resultContainer: _settings.$el.find(CONST.selectors.resultContainer),
                $resultHeading: _settings.$el.find(CONST.selectors.resultHeading),
                $txtSearchBox: _settings.$el.find(CONST.selectors.txtSearchBox),
                $btnGeoLoc: _settings.$el.find(CONST.selectors.btnGeoLoc),
                $btnReset: _settings.$el.find(CONST.selectors.btnReset),
                $map: _settings.$el.find(CONST.selectors.map),
                $templateResultItem: _settings.$el.find(CONST.selectors.templateResultItem),
                $templateMarkerInfoWindow: _settings.$el.find(CONST.selectors.templateMarkerInfoWindow),
                $resultList: _settings.$el.find(CONST.selectors.resultList),
                $templateTypeFilters: _settings.$el.find(CONST.selectors.templateTypeFilters),
                $typeFiltersWrapper: _settings.$el.find(CONST.selectors.typeFiltersWrapper),
                $typeFilterCheckbox: _settings.$el.find(CONST.selectors.typeFilterCheckbox),
                $loadMoreBtn:  _settings.$el.find(CONST.selectors.loadMoreBtn),
                $listBtn:  _settings.$el.find(CONST.selectors.listBtn),
                $mapBtn:  _settings.$el.find(CONST.selectors.mapBtn),
                $sliderBtn:  _settings.$el.find(CONST.selectors.sliderBtn),
                $clearBtn:  _settings.$el.find(CONST.selectors.clearBtn),
                $filtersNarrow:  _settings.$el.find(CONST.selectors.filtersNarrow),
                $filtersWide:  _settings.$el.find(CONST.selectors.filtersWide),
                $resultListWrapper: _settings.$el.find(CONST.selectors.resultListWrapper),
                $markers: [],
                $infoWindows: [],
                $openedInfoWindow: null,
                $markerClusterer:null,
                place: {
                    lastPlaceObj: null,
                    $marker: null,
                    $infoWindow: null
                }
            },
            mapAPI: base.comp.storelocator[_settings.$el.data('mapType') === 'baidu' ? 'modBaiduApi' : 'modGoogleApi'],
            dataArr: null, // contains all data
            isMapInitialized : false,
            showfilters: _settings.$el.data('showfilters') || false,
            showlist: (_settings.$el.data('showlist') || _settings.$el.data('showfilters')) || false,
            dataURL: _settings.$el.data('storePath'),
            mapType: _settings.$el.data('mapType'),
            defaultLatitude: _settings.$el.find(CONST.selectors.map).data('mapLatitude'),
            defaultLongitude: _settings.$el.find(CONST.selectors.map).data('mapLongitude'),
            defaultZoom: _settings.$el.find(CONST.selectors.map).data('mapZoom'),
            storeTitle: _settings.$el.data('storeTitle')
        };

        // initialize this map
        this.init(this);
    };

    Storelocator.prototype = {
        /**
         * Initializes the map
         * @memberof base.comp
         * @private
         * @param {Object} thisSL Current storelocator instance
         * @return {Promise} Initialized map promise
         */
        initializeMap: function(thisSL) {
            var q = new $.Deferred();
            thisSL.config.mapAPI.loadMap(thisSL).done(function(successSL) {
                q.resolve(successSL);
            }).fail(function(failSL) {
                // if map load failed
                q.reject(failSL);
            });

            return q.promise();
        },

        updateItemClass: function(thisSL, index) {
            // update the active class based on selection
            if (thisSL.config.showlist) {
                thisSL.config.elems.$resultList.find(CONST.selectors.resultItem + '[data-marker-id="' + index + '"]')
                    .addClass(CONST.cssClass.active)
                    .siblings('.' + CONST.cssClass.active)
                    .removeClass(CONST.cssClass.active);
            }
        },

        /**
         * Call back when the list item/ marker is selected
         * @memberof base.comp
         * @private
         * @param {Object} thisSL Current storelocator instance
         * @param {int} index Index of the current store item
         */
        onItemSelection: function(thisSL, index) {

            // update the active class based on selection
            thisSL.updateItemClass(thisSL, index);

            // open map infowindow
            if (typeof thisSL.config.mapAPI.openInfoWindow === 'function') {
                thisSL.config.mapAPI.openInfoWindow(thisSL, index, thisSL.config.elems.$markers[index], thisSL.config.elems.$map);
            }
        },

        /**
         * Add pagination on page load
         * @memberof base.comp
         * @private
         * @param {Object} thisSL Current storelocator instance
         */
        managePagination: function(thisSL) {
            if (util.matchmedia.narrow.matches) {
                var $pageItem = thisSL.config.elems.$resultList.find(CONST.selectors.resultItem),
                    $resultContainer = thisSL.config.elems.$resultContainer;

                CONST.itemsInList = thisSL.config.elems.$mapContainer.data('itemCountMobile');
                $pageItem.removeClass(CONST.cssClass.inpagination + ' ' + CONST.cssClass.notinpagination);
                if ($pageItem.length > CONST.itemsInList) {
                    $pageItem.not('.' + CONST.cssClass.hide).addClass(CONST.cssClass.notinpagination);
                    $pageItem.not('.' + CONST.cssClass.hide).slice(0, CONST.itemsInList).addClass(CONST.cssClass.inpagination).removeClass(CONST.cssClass.notinpagination);
                    $resultContainer.find(CONST.selectors.loadMore).removeClass(CONST.cssClass.hidden);
                }
            }
        },

        /**
         * update pagination on load more button click
         * @memberof base.comp
         * @private
         * @param {Object} thisSL Current storelocator instance
         */
        updatePagination: function(thisSL, e) {
            e.preventDefault();
            var $pageItem = thisSL.config.elems.$resultList.find('.' + CONST.cssClass.notinpagination),
                $resultContainer = thisSL.config.elems.$resultContainer;
            if ($pageItem.length > 0) {
                $pageItem.slice(0, CONST.itemsInList).addClass(CONST.cssClass.inpagination).removeClass(CONST.cssClass.notinpagination);
                $resultContainer.find(CONST.selectors.loadMore).removeClass(CONST.cssClass.hidden);
                if (thisSL.config.elems.$resultList.find('.' + CONST.cssClass.notinpagination).length === 0) {
                    $resultContainer.find(CONST.selectors.loadMore).addClass(CONST.cssClass.hidden);
                }
            }
        },

        /**
         * Updates the result heading
         * @memberof base.comp
         * @private
         * @param {Object} thisSL Current storelocator instance
         * @param {int} found Number of stores on the map
         */
        updateResultHeading: function(thisSL, found) {
            var $resHead = thisSL.config.elems.$resultHeading;

            thisSL.config.elems.$resultListWrapper.toggleClass(CONST.cssClass.hidden, found === 0);
            if (found === 0) {
                $resHead.removeClass(CONST.cssClass.hidden);
            } else {
                $resHead.addClass(CONST.cssClass.hidden);
            }
        },

        /**
         * Populate Store Types Filters
         * @memberof base.comp
         * @private
         * @param {Object} thisSL Current storelocator instance
         * @param {Object} data containing store data
         */
        populateTypeFilters: function(thisSL, data) {
            var storeType = {},
                uniqueStoreType = [],
                dupes = {},
                sortedStoreTitles = [];
            storeType = $.map(data, function(obj) {
                return {
                    type: obj.type,
                    typeCode: obj.typeCode
                };
            });

            $.each(storeType, function(i, el) {
                if (!dupes[el.typeCode]) {
                    dupes[el.typeCode] = true;
                    uniqueStoreType.push(el);
                }
            });

            for (var key in thisSL.config.storeTitle) {
                if (key) {
                    sortedStoreTitles.push([key, thisSL.config.storeTitle[key]]);
                }
            }

            // Sort type filters using i18n value in sightly
            sortedStoreTitles.sort(function(a, b) {
                if (a[1] < b[1]) {
                    return -1;
                }
                if (a[1] > b[1]) {
                    return 1;
                }
                return 0;
            });

            if (uniqueStoreType.length > 1) {
                $.each(sortedStoreTitles, function(index, value) {
                    var $item;
                    for (var i = 0 ; i < uniqueStoreType.length ; i++) {
                        if (uniqueStoreType[i].typeCode === value[0]) {
                            $item = thisSL.config.elems.$templateTypeFilters.html()
                                .replace(/{{type}}/g, value[1])
                                .replace(/{{typeCode}}/g, value[0]);

                            if (util.matchmedia.narrow.matches) {
                                thisSL.config.elems.$filtersNarrow.append($item);
                            } else {
                                thisSL.config.elems.$filtersWide.find(CONST.selectors.typeFiltersWrapper).append($item);
                            }
                        }
                    }
                });
            } else {
                if (!util.matchmedia.narrow.matches) {
                    thisSL.config.elems.$filtersWide.find(CONST.selectors.filtersLegend).addClass(CONST.cssClass.hidden);
                }
            }
        },

        /**
         * Geolocation Button click handler
         * @memberof base.comp
         * @private
         * @param {Object} thisSL Current storelocator instance
         */
        geoLocationBtnClickHandler: function(thisSL, e) {
            e.preventDefault();

            thisSL.geoLocation.status = CONST.GeoLocStatus.LOADING;
            thisSL.config.elems.$mapContainer.addClass(CONST.cssClass.loading);

            if (!window.navigator.geolocation) {
                thisSL.config.mapAPI.geoLocErrorHandler(thisSL, false, undefined);
                return false;
            }

            window.navigator.geolocation.getCurrentPosition(function(pos) {
                thisSL.config.mapAPI.geoLocSuccessHandler(thisSL, pos);
                thisSL.showClearBtn(thisSL);
                thisSL.showHideListContainer(thisSL, 'show');
            }, function(err) {
                thisSL.config.mapAPI.geoLocErrorHandler(thisSL, true, err);
            }, thisSL._opts.geoLocation.options);
        },

        /**
         * Reset Button click handler
         * @memberof base.comp
         * @private
         * @param {Object} thisSL Current storelocator instance
         */
        resetBtnClickHandler: function(thisSL, e) {
            e.preventDefault();

            var center = null,
                $resultListItems = thisSL.config.elems.$resultList.find('.' + CONST.cssClass.active),
                $resultFoundItems = thisSL.config.elems.$resultList.find('.' + CONST.cssClass.found);

            if (thisSL.config.isMapInitialized) {
                // clear any open infoWindow
                if (thisSL.config.elems.$openedInfoWindow) {
                    thisSL.config.elems.$openedInfoWindow.close();
                }

                // get default map center
                center = thisSL.config.mapAPI.resetMap(thisSL);

                // reset map to default state
                thisSL.config.elems.$map.setZoom(thisSL._opts.map.type.defaultZoom);
                thisSL.config.elems.$map.panTo(center);

                // hide geolocation pin if any
                if (thisSL.geoLocation.$marker) {
                    thisSL.config.mapAPI.resetGeoLocation(thisSL);
                }
            }

            // clear textbox & trigger text change event
            thisSL.config.elems.$txtSearchBox.val('');
            thisSL.clearTextBoxSelection($resultListItems);

            // reset any selected resultItem
            $resultListItems.removeClass(CONST.cssClass.active);
            $resultFoundItems.removeClass(CONST.cssClass.found);

            thisSL.config.elems.$clearBtn.addClass(CONST.cssClass.hidden);
            thisSL.config.elems.$btnGeoLoc.removeClass(CONST.cssClass.hidden);

            thisSL.config.elems.$searchContainer.find(CONST.selectors.typeFilterCheckbox).prop('checked', true).change();
        },

        /**
         * Clear Textbox selection
         * @memberof base.comp
         * @private
         * @param {Object} $resultList Results list
         */
        clearTextBoxSelection: function($resultList) {
            $resultList.find(CONST.selectors.resultItem)
                .removeClass(CONST.cssClass.found);
        },

        /**
         * On key press event in search textbox
         * @memberof base.comp
         * @private
         * @param {Object} thisSL Current storelocator instance
         */
        onKeyEvent: function(thisSL, e) {
            e.preventDefault();

            var textStr = thisSL.config.elems.$txtSearchBox.val(),
                $resultList = thisSL.config.elems.$resultList,
                $results;

            if (textStr.length >= 3) {
                $results = $resultList.find(CONST.selectors.resultItem)
                    .removeClass(CONST.cssClass.found)
                    .filter(function() {
                        return $(this).text().trim().toLowerCase().indexOf(textStr) > -1;
                    });

                if ($results.length) {
                    $results.addClass(CONST.cssClass.found);
                    thisSL.config.elems.$resultContainer.data('show', true);
                }
            } else if (textStr.length > 0) {
                thisSL.showClearBtn(thisSL);
                thisSL.config.elems.$resultContainer.data('show', true);
            } else {
                thisSL.clearTextBoxSelection($resultList);
            }
        },

        /**
         * Store type checkbox checked events for filters
         * @memberof base.comp
         * @private
         * @param {Object} thisSL Current storelocator instance
         */
        filterTypeHandler: function(thisSL, e) {
            e.preventDefault();
            var $resultItem = thisSL.config.elems.$resultList.find(CONST.selectors.resultItem),
                $results,
                $checkedTypeFilters = thisSL.config.elems.$searchContainer.find(CONST.selectors.typeFilterCheckbox + ':checked'),
                filterResultsLength = 0;

            $resultItem.removeClass(CONST.cssClass.filtered + ' ' + CONST.cssClass.notfiltered);
            $resultItem.each(function() {
                thisSL.config.mapAPI.filterMarker(thisSL, $(this).data('markerId'), true);
            });

            $checkedTypeFilters.each(function(i, obj) {
                $results = $resultItem
                    .filter(function() {
                        return $(this).data('storeType') === obj.value;
                    });
                $results.addClass(CONST.cssClass.filtered);
            });

            if (thisSL.config.elems.$resultContainer.data('show')) {
                thisSL.showHideListContainer(thisSL, 'show');
                thisSL.config.elems.$resultContainer.data('show', false);
            }

            $resultItem.not('.' + CONST.cssClass.filtered).addClass(CONST.cssClass.notfiltered);
            filterResultsLength = thisSL.config.elems.$resultList.find('.' + CONST.cssClass.filtered).not('.' + CONST.cssClass.hide).length;
            // update the heading
            thisSL.updateResultHeading(thisSL, filterResultsLength);
            // update markers
            $resultItem.not('.' + CONST.cssClass.filtered).each(function() {
                thisSL.config.mapAPI.filterMarker(thisSL, $(this).data('markerId'), false);
            });

            thisSL.config.mapAPI.updateClusterer(thisSL);
        },


        /**
         * show store map on show map icon button click
         * @memberof base.comp
         * @private
         * @param {Object} thisSL Current storelocator instance
         */
        showMapView: function(thisSL) {
            thisSL.config.elems.$mapBtn.addClass(CONST.cssClass.hidden);
            thisSL.config.elems.$listBtn.removeClass(CONST.cssClass.hidden);
            thisSL.config.elems.$resultContainer.addClass(CONST.cssClass.contracted);
        },

        /**
         * show store list on list icon button click
         * @memberof base.comp
         * @private
         * @param {Object} thisSL Current storelocator instance
         */
        showListView: function(thisSL) {
            thisSL.config.elems.$listBtn.addClass(CONST.cssClass.hidden);
            thisSL.config.elems.$mapBtn.removeClass(CONST.cssClass.hidden);
            thisSL.config.elems.$resultContainer.removeClass(CONST.cssClass.contracted);
            thisSL.config.elems.$sliderBtn.closest(CONST.selectors.searchContainer).removeClass(CONST.cssClass.expanded);
        },

        /**
         * show clear button and hide geolocation button on search input
         * @memberof base.comp
         * @private
         * @param {Object} thisSL Current storelocator instance
         */
        showClearBtn: function(thisSL) {
            thisSL.config.elems.$clearBtn.removeClass(CONST.cssClass.hidden);
            if (util.matchmedia.narrow.matches) {
                thisSL.config.elems.$btnGeoLoc.addClass(CONST.cssClass.hidden);
            }
        },

        /**
         * Update filters markup for wide and narrow view on page load
         * @memberof base.comp
         * @private
         * @param {Object} thisSL Current storelocator instance
         */
        updateFilters: function(thisSL) {
            if (util.matchmedia.narrow.matches) {
                thisSL.config.elems.$resultContainer.addClass(CONST.cssClass.contracted);
                thisSL.config.elems.$filtersWide.remove();
            } else {
                thisSL.config.elems.$filtersNarrow.remove();
            }
        },

        /**
         * Show/Hide Result list
         * @memberof base.comp
         * @private
         * @param {Object} thisSL Current storelocator instance
         * @param {Strint} showHide whether to show or hide
         */
        showHideListContainer: function(thisSL, showHide) {
            if (showHide === 'show') {
                thisSL.config.elems.$resultContainer.removeClass(CONST.cssClass.hidden);
            } else {
                thisSL.config.elems.$resultContainer.addClass(CONST.cssClass.hidden);
            }
        },

        /**
         * Bind basic events
         * @memberof base.comp
         * @private
         * @param {Object} thisSL Current storelocator instance
         */
        bindEvents: function(thisSL) {
            // bind the geolocation button click event
            thisSL.config.elems.$btnGeoLoc.on('click', function(e) {
                thisSL.geoLocationBtnClickHandler(thisSL, e);
            });

            // bind the reset button click event
            this.config.elems.$btnReset.on('click', function(e) {
                thisSL.resetBtnClickHandler(thisSL, e);
                thisSL.showHideListContainer(thisSL, 'hide');
            });

            // bind the textbox events for live search
            thisSL.config.elems.$txtSearchBox.on({
                'keyup change blur': function(e) {thisSL.onKeyEvent(thisSL, e);}
            });

            // bind the store type checkbox checked events for filters
            thisSL.config.elems.$searchContainer.on('change', CONST.selectors.typeFilterCheckbox, function(e) {
                thisSL.filterTypeHandler(thisSL, e);
            });

            // clear textbox & trigger text change event
            this.config.elems.$clearBtn.on('click', function(e) {
                thisSL.resetBtnClickHandler(thisSL, e);
                thisSL.showHideListContainer(thisSL, 'hide');
            });

            if (util.matchmedia.narrow.matches) {
                thisSL.config.elems.$resultContainer.addClass(CONST.cssClass.contracted);

                this.config.elems.$loadMoreBtn.on('click', function(e) {
                    thisSL.updatePagination(thisSL, e);
                });

                this.config.elems.$listBtn.on('click', function() {
                    thisSL.showListView(thisSL);
                });

                this.config.elems.$mapBtn.on('click', function() {
                    thisSL.showMapView(thisSL);
                });

                this.config.elems.$sliderBtn.on('click', function() {
                    thisSL.config.elems.$sliderBtn.closest(CONST.selectors.searchContainer).toggleClass(CONST.cssClass.expanded);
                    thisSL.showMapView(thisSL);
                });
            }

        },

        /**
         * Sets the store data template for the given index & add in DOM
         * @memberof base.comp
         * @private
         * @param {Object} thisSL Current storelocator instance
         * @param {int} index Index of the current store item
         */
        addListDataInDOM: function(thisSL, index) {

            var obj = thisSL.config.dataArr[index],
                $item = thisSL.config.elems.$templateResultItem.html()
                    .replace('{{id}}', obj.id)
                    .replace('{{name}}', obj.name)
                    .replace('{{shortName}}', obj.shortName)
                    .replace('{{markerId}}', index)
                    .replace('{{city}}', obj.address.city)
                    .replace('{{typeCode}}', obj.typeCode);

            // add items to results list
            thisSL.config.elems.$resultList.append($item);
        },

        /**
         * Sets the data in storelocator container
         * @memberof base.comp
         * @private
         * @param {Object} thisSL Current storelocator instance
         * @param {JSON} dataObj Stores data
         */
        setDataInSL: function(thisSL, dataObj) {
            // set data in memory
            thisSL.config.dataArr = dataObj;

            // embed data in the result item template & insert the resultant html in result container
            for (var i = 0; i < dataObj.length; i++) {
                thisSL.addListDataInDOM(thisSL, i);
            }

            // update the heading
            thisSL.updateResultHeading(thisSL, dataObj.length);

            // bind result click, to open the respective infoWindow
            thisSL.config.elems.$resultList.find(CONST.selectors.resultItem)
                .on('click', function(e) {
                    var index = $(e.currentTarget).data('markerId');
                    thisSL.onItemSelection(thisSL, index);

                    util.throttle(function() {
                        thisSL.config.elems.$resultContainer.scrollTop(0).animate({
                            scrollTop: thisSL.config.elems.$resultList.find('[data-marker-id="' + index + '"]').position().top
                        }, 100);
                    }, 500);
                });
        },

        /**
         * Get store data from server
         * @memberof base.comp
         * @private
         * @param {Object} thisSL Current storelocator instance
         */
        getData: function(thisSL) {
            var q = new $.Deferred();

            $.getJSON(thisSL.config.dataURL).done(function(resp) {
                thisSL.config.dataArr = resp;
                q.resolve(resp);
            }).fail(function(resp) {
                q.reject(resp);
            });

            return q.promise();
        },

        /**
         * Get map options from json template
         * @memberof base.comp
         * @private
         * @param {Object} thisSL Current storelocator instance
         */
        getOptions: function(thisSL) {
            var mapOptions = base.util.mapOptions.config;
            if (mapOptions) {
                // get options
                thisSL.OPTIONS = mapOptions;
                // Adding map styles/options from store options json template
                this._opts.map = thisSL.OPTIONS.map;
                // Adding geoLocation styles/options from store options json template
                this._opts.geoLocation = thisSL.OPTIONS.geoLocation;

                // Adding default map options from author dialog available in data attributes on map element
                this._opts.map.type.defaultLat = thisSL.config.defaultLatitude || CONST.defaultLatitude;
                this._opts.map.type.defaultLon = thisSL.config.defaultLongitude || CONST.defaultLongitude;
                this._opts.map.type.defaultZoom = thisSL.config.defaultZoom || CONST.defaultZoom;
            } else {
                thisSL.config.elems.$comp.addClass(CONST.cssClass.dataNotLoaded);
                thisSL.OPTIONS.markerIconImage = '';
            }
        },

        /**
         * Set map data from server
         * @memberof base.comp
         * @private
         * @param {Object} thisSL Current storelocator instance
         */
        setMapData: function(thisSL) {

            // get options data
            thisSL.getOptions(thisSL);

            // get data
            thisSL.getData(thisSL).done(function(data) {

                //cleanup data to filter out stores without location info.
                var objects = [];
                for (var i in data) {
                    if (data[i].location) {
                        objects.push(data[i]);
                    }
                }
                data = objects;

                // initialize map
                if (thisSL.config.mapType === 'google') {
                    thisSL.initializeMap(thisSL).done(function(thisSLdata) {
                        thisSL.config.isMapInitialized = true;

                        if (thisSL.config.showlist) {
                            // set data in DOM
                            thisSL.setDataInSL(thisSL, data);
                        }

                        if (thisSL.config.showfilters) {
                            // set type filters
                            thisSL.populateTypeFilters(thisSL, data);
                        }

                        // add map markers
                        thisSL.config.mapAPI.addMapMarkers(thisSLdata);

                        // add map events
                        thisSL.config.mapAPI.bindMapEvents(thisSLdata);

                    }).fail(function() {
                        thisSL.config.isMapInitialized = false;

                        if (thisSL.config.showlist) {
                            // set data in DOM
                            thisSL.setDataInSL(thisSL, data);
                        }
                        // hide map & related elements
                        thisSL.config.elems.$comp.addClass(CONST.cssClass.mapNotLoaded);
                    });
                    window.mysl = thisSL;
                } else {
                    thisSL.config.mapAPI.loadMap(thisSL);
                    if (thisSL.config.showlist) {
                        // set data in DOM
                        thisSL.setDataInSL(thisSL, data);
                    }
                    if (thisSL.config.showfilters) {
                        // set type filters
                        thisSL.populateTypeFilters(thisSL, data);
                    }
                    // add map markers
                    thisSL.config.mapAPI.addMapMarkers(thisSL);
                    // add map events
                    thisSL.config.mapAPI.bindMapEvents(thisSL);
                }
            }).fail(function() {
                thisSL.config.elems.$comp.addClass(CONST.cssClass.dataNotLoaded);
            });
        },

        /**
         * Initiates the current storelocator
         * @memberof base.comp
         * @private
         * @param {Object} thisSL Current storelocator instance
         */
        init: function(thisSL) {

            // bind events
            thisSL.bindEvents(thisSL);

            // get data
            thisSL.setMapData(thisSL);

            // update filters for narrow and wide view
            thisSL.updateFilters(thisSL);
        }
    };

    /**
     * Storelocator component
     * @namespace storelocator
     * @memberof base.comp
     */
    base.comp.storelocator = (function() {

        /**
         * Initialize Storelocator component
         * @public
         * @param {HTML} el The storelocator container to initialize.
         * @description Initialise & returns new storelocator component.
         * @return {Object} Initialized store locator
         */
        function init(el) {
            var slOpts = {
                    $el: $(el), // MANDATORY OPTION
                    options: {
                        map: {
                            isPanningRequired: false,
                            cluster: {
                                isEnabled: true,
                                opts: {}
                            },
                            type: {
                                defaultZoom: 2,
                                defaultStyles: []
                            }
                        }
                    }
                };

            return new Storelocator(slOpts);
        }

        function getVars() {
            return CONST;
        }

        return {
            init: init,
            getVars: getVars
        };
    })();
})(base, base.$, base.util);

/*global base*/
/**
 * @fileOverview Provides basic functionality for the storelocator's Google api
 *
 */

(function(base, $, util, MarkerClusterer) {
    'use strict';

    var CONST = null;

    /**
     * Bind events for map
     * @memberof base.comp
     * @private
     * @param {Object} thisSL Current storelocator instance
     */
    function bindMapEvents(thisSL) {
        var $map = thisSL.config.elems.$map,
            $resultList = thisSL.config.elems.$resultList,
            center = null,
            autocomplete = null,
            fn = {
                // calculates the map center
                calculateCenter: function() {
                    center = $map.getCenter();
                },
                // set map center on resize
                // refer resize.js for the published event
                onWindowResize: function() {
                    thisSL.config.elems.$map.panTo(center);
                },
                onMapBoundsChanged: function() {
                    var currentBounds = $map.getBounds(),
                        $markers = thisSL.config.elems.$markers,
                        notInMap = 0;

                    if (thisSL.config.showlist) {
                        // hide all the items
                        $resultList.find(CONST.selectors.resultItem)
                            .removeClass(CONST.cssClass.hide);

                        // show the marker which are in viewport, else hide
                        for (var i = 0; i < $markers.length; i++) {
                            if (!currentBounds.contains($markers[i].getPosition())) {
                                notInMap++;

                                $resultList.find(CONST.selectors.resultItem + '[data-marker-id="' + $markers[i].id + '"]')
                                        .addClass(CONST.cssClass.hide);
                            }
                        }
                    }
                    thisSL.updateResultHeading(thisSL, $markers.length - notInMap);

                    if (thisSL.config.showfilters) {
                        thisSL.config.elems.$searchContainer.find(CONST.selectors.typeFilterCheckbox).change();
                    }
                },
                onMapIdleState: function() {
                    fn.calculateCenter();
                    fn.onMapBoundsChanged();
                },
                onPlaceChanged: function(autocomplete) {
                    var place = autocomplete.getPlace();

                    if (!place.geometry) {
                        console.warn('Autocomplete\'s returned place contains no geometry');
                        return;
                    }
                    if (thisSL.config.showlist) {
                        var $resultListItems = thisSL.config.elems.$resultList.find('.' + CONST.cssClass.active);
                        // reset any selected resultItem, & clear any open infoWindow
                        $resultListItems.removeClass(CONST.cssClass.active);
                        if (thisSL.config.elems.$openedInfoWindow) {
                            thisSL.config.elems.$openedInfoWindow.close();
                        }
                    }
                    // close/hide any last searched location from map
                    if (thisSL.config.elems.place.lastPlaceObj) {
                        thisSL.config.elems.place.$infoWindow.close();
                        thisSL.config.elems.place.$marker.setVisible(false);
                    }

                    // updatings vars
                    thisSL.config.elems.place.lastPlaceObj = place;
                    thisSL.config.elems.place.$infoWindow = new window.google.maps.InfoWindow();
                    thisSL.config.elems.place.$marker = new window.google.maps.Marker({
                        map: thisSL.config.elems.$map,
                        anchorPoint: new window.google.maps.Point(0, -29)
                    });

                    // set map zoom/center
                    if (place.geometry.viewport) {
                        thisSL.config.elems.$map.fitBounds(place.geometry.viewport);
                    } else {
                        thisSL.config.elems.$map.panTo(place.geometry.location);
                    }

                    // show marker/infoWindow with address of place
                    if (thisSL._opts.searchedLocation.showPin) {

                        // set marker icon
                        thisSL.config.elems.place.$marker.setIcon(/** @type {google.maps.Icon} */({
                            url: place.icon,
                            size: new window.google.maps.Size(71, 71),
                            origin: new window.google.maps.Point(0, 0),
                            anchor: new window.google.maps.Point(17, 34),
                            scaledSize: new window.google.maps.Size(35, 35)
                        }));

                        // add marker
                        thisSL.config.elems.place.$marker.setPosition(place.geometry.location);
                        thisSL.config.elems.place.$marker.setVisible(true);

                        // add infoWindow
                        thisSL.config.elems.place.$infoWindow.setContent(place.name);
                        thisSL.config.elems.place.$infoWindow.open(thisSL.config.elems.$map, thisSL.config.elems.place.$marker);
                    }
                },
                onMapClickHandler: function() {
                    // close previously opened info window
                    if (thisSL.config.elems.$openedInfoWindow) {
                        thisSL.config.elems.$openedInfoWindow.close();
                    }

                    if (thisSL.config.showlist) {
                        // reset any selected/found resultItem
                        thisSL.config.elems.$resultList.find('.' + CONST.cssClass.active)
                            .removeClass(CONST.cssClass.active);
                        thisSL.config.elems.$resultList.find('.' + CONST.cssClass.found)
                            .removeClass(CONST.cssClass.found);
                    }
                }
            };

        // window resize handler
        $.subscribe(util.customEvents.RESIZE, fn.onWindowResize);

        // map idle handler
        window.google.maps.event.addDomListener($map, 'idle', fn.onMapIdleState);

        // map click handler
        window.google.maps.event.addDomListener($map, 'click', fn.onMapClickHandler);

        if (thisSL.config.showfilters) {
            autocomplete = new window.google.maps.places.Autocomplete(thisSL.config.elems.$txtSearchBox[0]);
            autocomplete.bindTo('bounds', thisSL.config.elems.$map);

            // search box text change handler
            autocomplete.addListener('place_changed', function() {
                fn.onPlaceChanged(autocomplete);
            });
        }
    }

    /**
     * Load Map
     * @memberof base.comp
     * @private
     * @param {Object} thisSL Current storelocator instance
     */
    function loadMap(thisSL) {

        var q = new $.Deferred();

        // load map using util
        util.googlemaps.loadGoogleMaps(function() {
            var mapOptions = {
                zoom: thisSL._opts.map.type.defaultZoom,
                center: new window.google.maps.LatLng(thisSL._opts.map.type.defaultLat, thisSL._opts.map.type.defaultLon),
                scrollwheel: false,
                mapTypeControl: false,
                streetViewControl: false,
                mapTypeId: window.google.maps.MapTypeId.ROADMAP
            };

            // initialize the map & store the instance in thisSL
            thisSL.config.elems.$map = new window.google.maps.Map(thisSL.config.elems.$map[0], mapOptions);

            // set the map styles, if provided
            if (thisSL._opts.map.type.defaultStyles) {
                thisSL.config.elems.$map.setOptions({styles: thisSL._opts.map.type.defaultStyles});
            }

            q.resolve(thisSL);

        }, function(thisSL) {
            // if map load failed
            q.reject(thisSL);
        });

        return q.promise();
    }

    /**
     * Open info window
     * @memberof base.comp
     * @private
     * @param {Object} thisSL Current storelocator instance
     * @param {int} index Index of the current store item
     */
    function openInfoWindow(thisSL, index) {
        var $marker = null,
            $infoWindow = null,
            newLocation = null;

        if (thisSL.config.isMapInitialized) {
            $marker = thisSL.config.elems.$markers[index];
            $infoWindow = thisSL.config.elems.$infoWindows[index];
            newLocation = $marker.getPosition();

            // close previously opened info window
            if (thisSL.config.elems.$openedInfoWindow) {
                thisSL.config.elems.$openedInfoWindow.close();
            }

            // store infoWindow in global var
            thisSL.config.elems.$openedInfoWindow = $infoWindow;

            if ($marker.getVisible()) {
                // open info window based on selection
                $infoWindow.open(thisSL.config.elems.$map, $marker);
            }

            thisSL.config.elems.$map.setCenter(newLocation);

            // pan to selection made
            if (thisSL._opts.map.isPanningRequired) {

                if (window.screen.width <= 767) {

                    var d = newLocation.toJSON(),
                    n = d.lat + 0.0400000000;

                    setTimeout(function() {
                        thisSL.config.elems.$map.panTo({
                            lat: n,
                            lng: d.lng
                        });
                    }, 500);

                } else {
                    thisSL.config.elems.$map.panTo(newLocation);
                }
            }


            thisSL.config.elems.$map.setZoom(thisSL._opts.map.zoomForInfoWindow);

            if (thisSL.config.showlist) {
                setTimeout(function() {
                    thisSL.config.elems.$resultContainer.scrollTop(0).animate({
                        scrollTop: thisSL.config.elems.$resultList.find('[data-marker-id="' + index + '"]').position().top
                    }, 100);
                }, 500);
            }
        }
    }

    /**
     * Filter show hide markers on map
     * @memberof base.comp
     * @private
     * @param {Object} thisSL Current storelocator instance
     * @param {int} index Index of the current store item
     * @param {boolean} view true or false for markers
     */
    function filterMarker(thisSL, index, view) {
        var $marker = null,
            $infoWindow = null;

        if (thisSL.config.isMapInitialized) {
            $marker = thisSL.config.elems.$markers[index];
            $infoWindow = thisSL.config.elems.$infoWindows[index];
            $marker.setVisible(view);
            if (!view) {
                $infoWindow.close();
            }
        }
    }

    /**
     * Update clusterer after store type filtering
     * @memberof base.comp
     * @private
     * @param {Object} thisSL Current storelocator instance
     */
    function updateClusterer(thisSL) {
        thisSL.config.elems.$markerClusterer.setIgnoreHidden(true);
        thisSL.config.elems.$markerClusterer.repaint();
    }

    /**
     * Call back when the list item/ marker is selected
     * @memberof base.comp
     * @private
     * @param {Object} thisSL Current storelocator instance
     * @param {int} index Index of the current store item
     */
    function markerSelected(thisSL, index) {
        openInfoWindow(thisSL, index);

        // update the active class based on selection
        thisSL.updateItemClass(thisSL, index);
    }

    /**
     * Populate marker for map
     * @memberof base.comp
     * @private
     * @param {Object} thisSL Current storelocator instance
     * @param {int} index Index of the current store item
     */
    function populateMarkers(thisSL, index) {
        var image,
            resultItem = thisSL.config.elems.$resultList.find(CONST.selectors.resultItem + '[data-marker-id="' + index + '"]');

        if (resultItem.data('storeType') === CONST.boutiqueTypeInternal || resultItem.data('storeType') === CONST.boutiqueTypeExternal) {
            image = thisSL.OPTIONS.markerIconImage;
        } else {
            image = thisSL.OPTIONS.defaultMarker;
        }

        var obj = thisSL.config.dataArr[index],
            myLatLng = new window.google.maps.LatLng(obj.location.latitude, obj.location.longitude),
            markerOptions = {
                position: myLatLng,
                map: thisSL.config.elems.$map,
                id: index,
                title: thisSL.config.dataArr[index].name || '',
                icon: image || '',
                optimized: false
            },
            marker = new window.google.maps.Marker(markerOptions);

        marker.setMap(thisSL.config.elems.$map);
        thisSL.config.elems.$markers[index] = marker;

        // bind marker click event, to open infoWindow
        window.google.maps.event.addListener(thisSL.config.elems.$markers[index], 'click', function() {
            markerSelected(thisSL, this.id);
        });

        // bind list item click event, to open infoWindow
        window.google.maps.event.addListener(thisSL.config.elems.$resultList.find(CONST.selectors.resultItem), 'click', function(e) {
            markerSelected(thisSL, $(e.currentTarget).data('markerId'));
        });
    }

    /**
     * Populate info window for map
     * @memberof base.comp
     * @private
     * @param {Object} thisSL Current storelocator instance
     * @param {int} index Index of the current store item
     */
    function populateInfoWindow(thisSL, index) {
        var infoWindow = new window.google.maps.InfoWindow({
                id: index,
                maxWidth: 260
            }),
            contentString = thisSL.config.elems.$templateMarkerInfoWindow.html()
                    .replace(/{{name}}/g, thisSL.config.dataArr[index].name)
                    .replace(/{{pagePath}}/g, thisSL.config.dataArr[index].pagePath)
                    .replace('{{street}}', thisSL.config.dataArr[index].address.street)
                    .replace('{{city}}', thisSL.config.dataArr[index].address.city)
                    .replace('{{zip}}', thisSL.config.dataArr[index].address.zipCode)
                    .replace('{{country}}', thisSL.config.dataArr[index].address.state || thisSL.config.dataArr[index].address.country)
                    .replace('{{latitude}}', thisSL.config.dataArr[index].location.latitude)
                    .replace('{{longitude}}', thisSL.config.dataArr[index].location.longitude)
                    .replace('{{phone}}', thisSL.config.dataArr[index].phoneNumber || '')
                    .trim();

        // set infowindow content
        infoWindow.setContent(contentString);

        // storing infowindow
        thisSL.config.elems.$infoWindows[index] = infoWindow;
    }

    /**
     * Add marker and info window on map
     * @memberof base.comp
     * @private
     * @param {Object} thisSL Current storelocator instance
    */
    function addMapMarkers(thisSL) {
        var dataObj = thisSL.config.dataArr;
        for (var i = 0; i < dataObj.length; i++) {
            populateMarkers(thisSL, i);
            populateInfoWindow(thisSL, i);
        }
        // create clusters if enabled
        if (thisSL.config.isMapInitialized && thisSL._opts.map.cluster.isEnabled) {
            //draw markers cluster on map
            thisSL.config.elems.$markerClusterer = new MarkerClusterer(thisSL.config.elems.$map, thisSL.config.elems.$markers, thisSL._opts.map.cluster.opts);
        }
    }

    /**
     * Success handler for user's gelocation details
     * @memberof base.comp
     * @private
     * @param {Object} thisSL Current storelocator instance
     * @param {Object} pos containg user's geolocation details
     */
    function geoLocSuccessHandler(thisSL, pos) {
        var crd = pos.coords,
            center = null,
            geocoder = null,
            markerOptions = null,
            marker = null,
            infoWindow = null,
            circle = null,
            $resultListItems = thisSL.config.elems.$resultList.find('.' + CONST.cssClass.active),
            $resultFoundItems = thisSL.config.elems.$resultList.find('.' + CONST.cssClass.found),
            fn = {
                geoCodeHandler: function(results, status) {
                    if (status === window.google.maps.GeocoderStatus.OK) {
                        // update the textbox with the geolocated address
                        thisSL.config.elems.$txtSearchBox.val(results[0][CONST.GeoLocSuccessResult.formattedAddress]);
                    } else {
                        console.warn('Geocoder failed due to: ' + status);
                    }
                }
            };

        if (thisSL.config.isMapInitialized) {
            // settings google based vars
            center = new window.google.maps.LatLng(crd.latitude, crd.longitude);
            geocoder = new window.google.maps.Geocoder();
            markerOptions = {
                position: center,
                map: thisSL.config.elems.$map,
                title: thisSL._opts.geoLocation.map.title || '',
                icon: {
                    url: thisSL._opts.geoLocation.map.iconImage,
                    size: new window.google.maps.Size(30, 30),
                    scaledSize: new window.google.maps.Size(30, 30),
                    origin: new window.google.maps.Point(0, 0),
                    anchor: new window.google.maps.Point(15, 15)
                }
            };
            marker = new window.google.maps.Marker(markerOptions);
            infoWindow = new window.google.maps.InfoWindow();

            // clear previous infoWindow
            if (thisSL.config.elems.$openedInfoWindow) {
                thisSL.config.elems.$openedInfoWindow.close();
            }

            // enable pan/zoom if enabled
            if (thisSL._opts.geoLocation.map.isPanZoomRequired) {
                //positioning map, marker & infoWindow
                thisSL.config.elems.$map.panTo(center);
                thisSL.config.elems.$map.setZoom(thisSL._opts.geoLocation.map.zoom);
            }

            // set marker on map
            marker.setMap(thisSL.config.elems.$map);

            // if circle is enabled, foo
            if (thisSL._opts.geoLocation.map.showCircle) {

                circle = new window.google.maps.Circle({
                    map: thisSL.config.elems.$map,
                    radius: thisSL._opts.geoLocation.map.radius,
                    fillColor: thisSL._opts.geoLocation.map.fillColor,
                    strokeColor: thisSL._opts.geoLocation.map.strokeColor,
                    strokeWeight: thisSL._opts.geoLocation.map.strokeWeight
                });

                // clear circle
                if (thisSL.geoLocation.$circle) {
                    thisSL.geoLocation.$circle.setMap(null);
                }

                // set circle on map
                thisSL.geoLocation.$circle = circle;
                thisSL.geoLocation.$circle.bindTo('center', marker, 'position');
            }

            // updating vars
            thisSL.geoLocation.$location = center;
            thisSL.geoLocation.$marker = marker;
            thisSL.geoLocation.$infoWindow = infoWindow;
            thisSL.config.elems.$openedInfoWindow = infoWindow;

            // get the corresponding address for the current location
            geocoder.geocode({'location': center}, fn.geoCodeHandler);
        }

        // reset any selected/found resultItem
        $resultListItems.removeClass(CONST.cssClass.active);
        $resultFoundItems.removeClass(CONST.cssClass.found);

        // updating status
        thisSL.geoLocation.status = CONST.GeoLocStatus.LOADED;

        // remove loading class
        thisSL.config.elems.$mapContainer.removeClass(CONST.cssClass.loading);

    }

    /**
     * Error handler for user's gelocation details
     * @memberof base.comp
     * @private
     * @param {Object} thisSL Current storelocator instance
     * @param {Object} isGeoLocExist
     * @param {Object} err error object
     */
    function geoLocErrorHandler(thisSL, isGeoLocExist, err) {
        var error = isGeoLocExist ? 'ERROR(' + err.code + '): ' + err.message : 'ERROR(-1): Your browser doesn\'t support geolocation.';
        console.warn(error);
        thisSL.geoLocation.status = 'error';
        thisSL.config.elems.$mapContainer.removeClass(CONST.cssClass.loading);
    }

    /**
     * Return default map
     * @memberof base.comp
     * @private
     * @param {Object} thisSL Current storelocator instance
     */
    function resetMap(thisSL) {
        return new window.google.maps.LatLng(thisSL._opts.map.type.defaultLat, thisSL._opts.map.type.defaultLon);
    }

    /**
     * Reset geolocation circle and marker
     * @memberof base.comp
     * @private
     * @param {Object} thisSL Current storelocator instance
     */
    function resetGeoLocation(thisSL) {
        thisSL.geoLocation.$circle.setMap(null);
        thisSL.geoLocation.$marker.setMap(null);
    }

    base.comp.storelocator.modGoogleApi = (function() {

        function init() {
            CONST = base.comp.storelocator.getVars();
        }

        init();

        return {
            addMapMarkers: addMapMarkers,
            openInfoWindow: openInfoWindow,
            bindMapEvents: bindMapEvents,
            loadMap: loadMap,
            filterMarker: filterMarker,
            geoLocSuccessHandler: geoLocSuccessHandler,
            geoLocErrorHandler: geoLocErrorHandler,
            resetMap: resetMap,
            updateClusterer: updateClusterer,
            resetGeoLocation: resetGeoLocation,
            init: init
        };
    })();
})(base, base.$, base.util, window.MarkerClusterer);

/*global base, BMap*/
/**
 * @fileOverview Provides basic functionality for the storelocator's Baidu api
 */

(function($, base, util) {
    'use strict';

    var CONST = null;

    /**
     * Bind events for map
     * @memberof base.comp
     * @private
     * @param {Object} thisSL Current storelocator instance
     */
    function bindMapEvents(thisSL) {
        var $map = thisSL.config.elems.$map,
            $resultList = thisSL.config.elems.$resultList,
            center = null,
            autocomplete = null,
            fn = {
                // calculates the map center
                calculateCenter: function() {
                    center = $map.getCenter();
                },
                // set map center on resize
                // refer resize.js for the published event
                onWindowResize: function() {
                    thisSL.config.elems.$map.setCenter(center);
                },
                onMapBoundsChanged: function() {
                    var currentBounds = $map.getBounds(),
                        $markers = thisSL.config.elems.$markers,
                        notInMap = 0;

                    if (thisSL.config.showlist) {
                        // hide all the items
                        $resultList.find(CONST.selectors.resultItem)
                            .removeClass(CONST.cssClass.hide);

                        // show the marker which are in viewport, else hide
                        for (var i = 0; i < $markers.length; i++) {
                            if (!currentBounds.containsPoint($markers[i].getPosition())) {
                                notInMap++;
                                $resultList.find(CONST.selectors.resultItem + '[data-marker-id="' + i + '"]')
                                    .addClass(CONST.cssClass.hide);
                            }
                        }
                    }
                    thisSL.updateResultHeading(thisSL, $markers.length - notInMap);

                    if (thisSL.config.showfilters) {
                        thisSL.config.elems.$searchContainer.find(CONST.selectors.typeFilterCheckbox).change();
                    }
                },
                onMapIdleState: function() {
                    fn.calculateCenter();
                    fn.onMapBoundsChanged();
                },
                onPlaceChanged: function(autocomplete, e) {
                    var value = e.item.value,
                        place = value.province + value.city + value.district + value.street + value.business,
                        icon = new window.BMap.Icon(thisSL.OPTIONS.defaultMarker, new window.BMap.Size(25, 32), {
                            anchor: new window.BMap.Size(25, 32),
                            infoWindowAnchor: new window.BMap.Size(25, 32)
                        }),
                        local, points;

                    if (thisSL.config.showlist) {
                        var $resultListItems = thisSL.config.elems.$resultList.find('.' + CONST.cssClass.active);
                        // reset any selected resultItem, & clear any open infoWindow
                        $resultListItems.removeClass(CONST.cssClass.active);
                        // close previously opened info window
                        if (thisSL.config.elems.$openedInfoWindow) {
                            thisSL.config.elems.$openedInfoWindow.close();
                        }
                    }

                    local = new window.BMap.LocalSearch(thisSL.config.elems.$map, {
                        onSearchComplete: function() {
                            points = local.getResults().getPoi(0).point;
                            thisSL.config.elems.$map.centerAndZoom(points, 15);
                        }
                    });

                    local.search(place);

                    // show marker/infoWindow with address of place
                    if (thisSL._opts.searchedLocation.showPin) {
                        if (thisSL.config.elems.place.lastPlaceObj) {
                            $map.closeInfoWindow(thisSL.config.elems.place.$infoWindow);
                            thisSL.config.elems.place.$marker.hide();
                        }

                        thisSL.config.elems.place.lastPlaceObj = place;
                        thisSL.config.elems.place.$infoWindow = new window.google.maps.InfoWindow();

                        thisSL.config.elems.place.$infoWindow = new window.BMap.InfoWindow(place, {
                            enableMessage: true
                        });

                        thisSL.config.elems.place.$marker = new window.BMap.Marker(points, {
                            icon: icon,
                            title: place
                        });

                        thisSL.config.elems.$map.addOverlay(thisSL.config.elems.place.$marker);

                        thisSL.config.elems.place.$marker.addEventListener('click', function() {
                            $map.openInfoWindow(thisSL.config.elems.place.$infoWindow, points);
                        });
                    }
                },
                onMapClickHandler: function() {

                    if (thisSL.config.showlist) {
                        // reset any selected/found resultItem
                        thisSL.config.elems.$resultList.find('.' + CONST.cssClass.active)
                            .removeClass(CONST.cssClass.active);
                        thisSL.config.elems.$resultList.find('.' + CONST.cssClass.found)
                            .removeClass(CONST.cssClass.found);
                    }
                }
            };

        // window resize handler
        $.subscribe(util.customEvents.RESIZE, fn.onWindowResize);

        // map idle handler
        $map.addEventListener('tilesloaded', fn.onMapIdleState);

        // map click handler
        $map.addEventListener('click', fn.onMapClickHandler);

        if (thisSL.config.showfilters) {
            autocomplete = new window.BMap.Autocomplete({
                'input': thisSL.config.elems.$txtSearchBox[0],
                'location': $map
            });

            // search box text change handler
            autocomplete.addEventListener('onconfirm', function(e) {
                fn.onPlaceChanged(autocomplete, e);
            });

        }
    }

    function pointConvertor(gglon, gglat) {
        var xpi = 3.14159265358979324 * 3000.0 / 180.0,
            x = gglon,
            y = gglat,
            z = Math.sqrt(x * x + y * y) + 0.00002 * Math.sin(y * xpi),
            theta = Math.atan2(y, x) + 0.000003 * Math.cos(x * xpi),
            bdlon = z * Math.cos(theta) + 0.0065,
            bdlat = z * Math.sin(theta) + 0.006,
            points = {
                lon: bdlon,
                lat: bdlat
            };

        return points;
    }

    /**
     * Load Map
     * @memberof base.comp
     * @private
     * @param {Object} thisSL Current storelocator instance
     */
    function loadMap(thisSL) {
        thisSL.config.isMapInitialized = true;

        thisSL.config.elems.$map = new BMap.Map('base-storelocator-map');
        var points = pointConvertor(thisSL._opts.map.type.defaultLon, thisSL._opts.map.type.defaultLat);
        points = new BMap.Point(points.lon, points.lat);
        thisSL.config.elems.$map.centerAndZoom(points, thisSL._opts.map.type.defaultZoom); // init baidu map
        thisSL.config.elems.$map.addControl(new BMap.NavigationControl()); // enable Nav Control
        /* jshint ignore:start */
        thisSL.config.elems.$map.addControl(new BMap.NavigationControl({
            anchor: BMAP_ANCHOR_BOTTOM_RIGHT,
            type: BMAP_NAVIGATION_CONTROL_SMALL
        }));
        /* jshint ignore:end */
        thisSL.config.elems.$map.disable3DBuilding();
        thisSL.config.elems.$map.enableScrollWheelZoom(false); // enable zoom control on mousewheel
        // set the map styles, if provided
        if (thisSL._opts.map.type.baiduMapStyles) {
            thisSL.config.elems.$map.setMapStyle({styleJson: thisSL._opts.map.type.baiduMapStyles});
        }
    }

    /**
     * Open info window
     * @memberof base.comp
     * @private
     * @param {Object} thisSL Current storelocator instance
     * @param {int} index Index of the current store item
     * @param {Object} marker Current marker instance
     * @param {Object} map Current map instance
     */
    function openInfoWindow(thisSL, index, marker, map) {
        var $map = null,
            $marker = null,
            $infoWindow = null,
            newLocation = null;

        if (thisSL.config.isMapInitialized) {
            $map = map;
            $marker = marker;
            $infoWindow = thisSL.config.elems.$infoWindows[index];
            newLocation = $marker.getPosition();

            // open info window based on selection
            $map.openInfoWindow($infoWindow, newLocation);
            thisSL.config.elems.$openedInfoWindow = $infoWindow;

            // pan to selection made
            if (thisSL._opts.map.isPanningRequired) {
                $map.panTo(newLocation);
            }

            $map.setCenter($marker.getPosition());

            if (thisSL.config.showlist) {
                setTimeout(function() {
                    thisSL.config.elems.$resultContainer.scrollTop(0).animate({
                        scrollTop: thisSL.config.elems.$resultList.find('[data-marker-id="' + index + '"]').position().top
                    }, 100);
                }, 500);
            }
        }
    }

    /**
     * Filter show hide markers on map
     * @memberof base.comp
     * @private
     * @param {Object} thisSL Current storelocator instance
     * @param {int} index Index of the current store item
     * @param {boolean} view true or false for markers
     */
    function filterMarker(thisSL, index, view) {
        var $marker = thisSL.config.elems.$markers[index];
        if (view) {
            $marker.show();
            if (thisSL._opts.map.cluster.isEnabled) {
                thisSL.config.elems.$markerClusterer.addMarker($marker);
            }
        } else {
            $marker.hide();
            if (thisSL._opts.map.cluster.isEnabled) {
                thisSL.config.elems.$markerClusterer.removeMarker($marker);
            }
        }
    }

    /**
     * Update clusterer after store type filtering
     * @memberof base.comp
     * @private
     * @param {Object} thisSL Current storelocator instance
     */
    function updateClusterer() {
        // do nothing
    }
    /**
     * Open infor window on marker
     * @memberof base.comp
     * @private
     * @param {Object} thisSL Current storelocator instance
     * @param {String} content Content info
     * @param {Object} e event object
     */
    function openInfo(thisSL, content, index) {
        var point = thisSL.config.elems.$markers[index].getPosition(),
            infoWindow = thisSL.config.elems.$infoWindows[index];

        thisSL.config.elems.$map.openInfoWindow(infoWindow,point);
        thisSL.config.elems.$openedInfoWindow = infoWindow;

    }
    /**
     * Add click handler to open info window
     * @memberof base.comp
     * @private
     * @param {Object} thisSL Current storelocator instance
     * @param {String} content Content for current marker
     * @param {Object} marker Marker object
     */
    function addClickHandler(thisSL, content, marker, index) {
        marker.addEventListener('click',function() {
            openInfo(thisSL, content, index);
        });
    }
    /**
     * Add marker and info window on map
     * @memberof base.comp
     * @private
     * @param {Object} thisSL Current storelocator instance
     */
    function addMapMarkers(thisSL) {
        var dataObj = thisSL.config.dataArr;
        for (var i = 0; i < dataObj.length; i++) {
            var obj = dataObj[i],
                myLatLng = pointConvertor(obj.location.longitude, obj.location.latitude),
                imageIcon,
                icon,
                resultItem = thisSL.config.elems.$resultList.find(CONST.selectors.resultItem + '[data-marker-id="' + i + '"]'),
                marker;

            if (resultItem.data('storeType') === CONST.boutiqueTypeInternal || resultItem.data('storeType') === CONST.boutiqueTypeExternal) {
                imageIcon = thisSL.OPTIONS.markerIconImage;
                icon = new window.BMap.Icon(imageIcon, new window.BMap.Size(44, 36), {
                    anchor: new window.BMap.Size(10, 32),
                    infoWindowAnchor: new window.BMap.Size(10, 0)
                });
            } else {
                imageIcon = thisSL.OPTIONS.defaultMarker;
                icon = new window.BMap.Icon(imageIcon, new window.BMap.Size(25, 32), {
                    anchor: new window.BMap.Size(10, 32),
                    infoWindowAnchor: new window.BMap.Size(10, 0)
                });
            }

            var content = thisSL.config.elems.$templateMarkerInfoWindow.html()
                        .replace(/{{name}}/g, obj.name)
                        .replace(/{{pagePath}}/g, obj.pagePath)
                        .replace('{{street}}', obj.address.street)
                        .replace('{{city}}', obj.address.city)
                        .replace('{{zip}}', obj.address.zipCode)
                        .replace('{{country}}', obj.address.state || obj.address.country)
                        .replace(/{{latitude}}/g, obj.location.latitude)
                        .replace(/{{longitude}}/g, obj.location.longitude)
                        .replace('{{phone}}', obj.phoneNumber || '')
                        .trim();
            myLatLng = new window.BMap.Point(myLatLng.lon, myLatLng.lat);
            marker = new window.BMap.Marker(myLatLng, {
                icon: icon,
                id: obj.id,
                title: obj.name || ''
            });
            var infoWindow = new window.BMap.InfoWindow(content, {width: 300});
            thisSL.config.elems.$markers[i] = marker;
            thisSL.config.elems.$map.addOverlay(thisSL.config.elems.$markers[i]);
            thisSL.config.elems.$infoWindows[i] = infoWindow;
            thisSL.updateItemClass(thisSL, i);
            addClickHandler(thisSL, content, marker, i);
        }
        // create clusters if enabled
        if (thisSL._opts.map.cluster.isEnabled) {
            /* jshint ignore:start */
            /* jscs:disable*/
            var baiduMapStyles = [{
                url: thisSL._opts.map.cluster.opts.styles[0].url,
                size: new window.BMap.Size(thisSL._opts.map.cluster.opts.styles[0].height, thisSL._opts.map.cluster.opts.styles[0].width),
                opt_anchor: thisSL._opts.map.cluster.opts.styles[0].anchorIcon,
                textColor: thisSL._opts.map.cluster.opts.styles[0].textColor,
                opt_textSize: thisSL._opts.map.cluster.opts.styles[0].textSize
            }];
            thisSL.config.elems.$markerClusterer = new window.BMapLib.MarkerClusterer(thisSL.config.elems.$map, {
                markers: thisSL.config.elems.$markers
            });
            thisSL.config.elems.$markerClusterer.setGridSize(thisSL._opts.map.cluster.opts.gridSize);
            thisSL.config.elems.$markerClusterer.setMaxZoom(thisSL._opts.map.cluster.opts.maxZoom);
            thisSL.config.elems.$markerClusterer.setMinClusterSize(thisSL._opts.map.cluster.opts.minimumClusterSize);
            thisSL.config.elems.$markerClusterer.setStyles(baiduMapStyles);
            /* jscs:enable*/
            /* jshint ignore:end */
        }
    }

    /**
     * Success handler for user's gelocation details
     * @memberof base.comp
     * @private
     * @param {Object} thisSL Current storelocator instance
     * @param {Object} pos containg user's geolocation details
     */
    function geoLocSuccessHandler(thisSL, pos) {
        var points = pointConvertor(pos.coords.longitude, pos.coords.latitude),
        icon = new window.BMap.Icon(thisSL._opts.geoLocation.map.iconImage, new window.BMap.Size(17, 17), {
            anchor: new window.BMap.Size(8, 8),
            infoWindowAnchor: new window.BMap.Size(17, 17)
        }),
        $resultListItems = thisSL.config.elems.$resultList.find('.' + CONST.cssClass.active),
        $resultFoundItems = thisSL.config.elems.$resultList.find('.' + CONST.cssClass.found),
        marker = null,
        circle = null,
        infoWindow = null;

        points = new window.BMap.Point(points.lon, points.lat);
        marker = new window.BMap.Marker(points, {
            icon: icon
        });

        // enable pan/zoom if enabled
        if (thisSL._opts.geoLocation.map.isPanZoomRequired) {
            //positioning map, marker & infoWindow
            thisSL.config.elems.$map.centerAndZoom(points, thisSL._opts.geoLocation.map.zoom);
        }

        thisSL.config.elems.$map.addOverlay(marker);
        // if circle is enabled, foo
        if (thisSL._opts.geoLocation.map.showCircle) {

            circle = new window.BMap.Circle(points, thisSL._opts.geoLocation.map.radius, {
                fillColor: thisSL._opts.geoLocation.map.fillColor,
                strokeColor: thisSL._opts.geoLocation.map.strokeColor,
                strokeWeight: thisSL._opts.geoLocation.map.strokeWeight
            });

            // clear circle
            if (thisSL.geoLocation.$circle) {
                thisSL.config.elems.$map.removeOverlay(thisSL.geoLocation.$circle);
            }

            // set circle on map
            thisSL.geoLocation.$circle = circle;
            thisSL.config.elems.$map.addOverlay(thisSL.geoLocation.$circle);

        }
        // updating vars
        thisSL.geoLocation.$location = points;
        thisSL.geoLocation.$marker = marker;
        thisSL.geoLocation.$infoWindow = infoWindow;
        thisSL.config.elems.$openedInfoWindow = infoWindow;

        // reset any selected/found resultItem
        $resultListItems.removeClass(CONST.cssClass.active);
        $resultFoundItems.removeClass(CONST.cssClass.found);

        // updating status
        thisSL.geoLocation.status = CONST.GeoLocStatus.LOADED;

        // remove loading class
        thisSL.config.elems.$mapContainer.removeClass(CONST.cssClass.loading);
    }

    /**
     * Error handler for user's gelocation details
     * @memberof base.comp
     * @private
     * @param {Object} thisSL Current storelocator instance
     * @param {Object} isGeoLocExist
     * @param {Object} err error object
     */
    function geoLocErrorHandler(thisSL, isGeoLocExist, err) {
        var error = isGeoLocExist ? 'ERROR(' + err.code + '): ' + err.message : 'ERROR(-1): Your browser doesn\'t support geolocation.';
        console.warn(error);
        thisSL.geoLocation.status = 'error';
        thisSL.config.elems.$mapContainer.removeClass(CONST.cssClass.loading);
    }

    /**
     * Calculate store distance from user's location
     * @memberof base.comp
     * @private
     * @param {Object} thisSL Current storelocator instance
     * @param {Object} pos containing user's geolocation details
     */
    function distanceMatrix(thisSL, pos) {
        var userLocation = pointConvertor(pos.coords.longitude, pos.coords.latitude),
            targetLocation,
            distance;

        userLocation = new window.BMap.Point(userLocation.lon, userLocation.lat);
        thisSL.config.elems.$resultList.find(CONST.selectors.resultItemDistance).removeClass(CONST.cssClass.hidden);

        thisSL.config.elems.$resultList.find(CONST.selectors.resultItem).each(function(i) {
            targetLocation = pointConvertor(thisSL.config.dataArr[i].location.longitude, thisSL.config.dataArr[i].location.latitude);
            targetLocation = new window.BMap.Point(targetLocation.lon, targetLocation.lat);
            if (thisSL.config.elems.$mapContainer.data('distanceUnit') === CONST.kmUnit) {
                distance = Math.round(thisSL.config.elems.$map.getDistance(userLocation, targetLocation) * CONST.kmConversion);
                $(this).find(CONST.selectors.resultItemDistanceValue).html(distance + ' ' + CONST.kmUnit);
            } else {
                distance = Math.round(thisSL.config.elems.$map.getDistance(userLocation, targetLocation) * CONST.milesConversion);
                $(this).find(CONST.selectors.resultItemDistanceValue).html(distance + ' ' + CONST.milesUnit);
            }
        });
    }

    /**
     * Return default map
     * @memberof base.comp
     * @private
     * @param {Object} thisSL Current storelocator instance
     */
    function resetMap(thisSL) {
        var points = pointConvertor(thisSL._opts.map.type.defaultLon, thisSL._opts.map.type.defaultLat);
        return new window.BMap.Point(points.lon, points.lat);
    }

    /**
     * Reset geolocation circle and marker
     * @memberof base.comp
     * @private
     * @param {Object} thisSL Current storelocator instance
     */
    function resetGeoLocation(thisSL) {
        thisSL.config.elems.$map.removeOverlay(thisSL.geoLocation.$circle);
        thisSL.config.elems.$map.removeOverlay(thisSL.geoLocation.$marker);
    }

    base.comp.storelocator.modBaiduApi = (function() {

        function init() {
            CONST = base.comp.storelocator.getVars();
        }

        init();

        return {
            loadMap: loadMap,
            addMapMarkers: addMapMarkers,
            openInfoWindow: openInfoWindow,
            bindMapEvents: bindMapEvents,
            filterMarker: filterMarker,
            geoLocSuccessHandler: geoLocSuccessHandler,
            geoLocErrorHandler: geoLocErrorHandler,
            distanceMatrix: distanceMatrix,
            resetMap: resetMap,
            updateClusterer: updateClusterer,
            resetGeoLocation: resetGeoLocation,
            init: init
        };
    })();
})(base.$, base, base.util);

/*global iwc */
/**
 * Watch Finder entry point
 */
(function($) {
    'use strict';

    iwc.comp.watchfinder = {};
    iwc.comp.watchfinder.module = {};
    iwc.comp.watchfinder.utility = {};

    /**
     * init Watch finder component initialization
     * @memberof iwc.comp.watchfinder
     * @public
     * @param  {HTMLElement} elem bag's container
     */
    iwc.comp.watchfinder.init = function(elem) {
        var $comp = $(elem),
            filterManagerInstance = iwc.comp.watchfinder.module.filterManager.init($comp),
            dataManagerInstance = iwc.comp.watchfinder.module.dataManager.init($comp);

        iwc.comp.watchfinder.module.uiManager.init($comp, filterManagerInstance, dataManagerInstance);

    };

})(iwc.$);

/*global iwc, JSON*/
/**
 * Add to wishlist form component
 */

(function() {
    'use strict';

    /**
     * Add to wishlist form component
     * @namespace addtowishlistform
     * @memberof iwc.comp
     */
    iwc.comp.addtowishlistform = (function($, comp, util) {

        var $body = $('body'),
            $overlay,
            $component,
            $form,
            $productId,
            $wishlist,
            $cancel,
            $targetBtn,
            $existingWishlist,
            $existingWishlistItem,
            $wishlistName,
            $newWishListName,
            $wishlistSection,
            $wishlistCount,
            selectors = {
                overlay: '.iwc-lightbox-content',
                component: '.iwc-addtowishlistform',
                form: '.iwc-add-to-wishlist-form',
                productId: 'input[name="productId"]',
                wishlist: 'input[name="wishListName"]',
                engravingId: 'input[name="engravingId"]',
                engravingText: 'input[name="engravingText"]',
                newWishListName: 'input[name="newWishListName"]',
                cancel: 'input[type=reset]',
                existingWishlistItem: '.iwc-existing-wishlists-item',
                productLink: '.iwc-product-link',
                productTitle: '.iwc-product-title',
                notifyProductDetail: '.iwc-notify-product-detail',
                img: 'img',
                productWatch: '.iwc-product-watch',
                existingWishlist: '.iwc-existing-wishlists',
                inputWrapper: '.input-wrapper',
                wishlistName: '.iwc-wishlist-name',
                wishlistSection: '.iwc-wishlist-section',
                wishlistActions: '.iwc-wishlist-actions',
                wishlistCount: '.iwc-wishlist-size',
                wishlistProduct: '.iwc-wishlist-product',
                wishlistTitle: '.iwc-wishlist-title',
                wishlistList: '.iwc-wishlist-list',
                addToWishlistBtn: '.iwc-add-to-wishlist-btn',
                deleteWishlist: '.iwc-delete-wishlist',
                emailWishlist: '.iwc-email-wishlist',
                wishlistAccountFormHeader: '.iwc-account-form-header',
                legacyCheckout: '.iwc-legacy-checkout'
            },
            cssClass = {
                selected: 'selected',
                existingWishlistsItemText: 'iwc-existing-wishlists-item-text',
                inputFocused: 'input-focused',
                removeWishlistAlso: 'iwc-wishlist-last-product',
                existingWishlistItem: 'iwc-existing-wishlists-item'
            },
            CONST = {
                addToWishlist: 'add-wishlist',
                deleteFromWishlist: 'delete-item-wishlist',
                productId: 'productId',
                wishListName: 'wishListName',
                addtowishlistData: 'addtowishlist'
            },
            currentPageURL = util.dataStore.getCurrentPagePath(),
            productData,
            formURL,
            formData,
            callToAction,
            wishlistData,
            defaultWishListName,
            existingList,
            legacyCheckout;

        /**
         * Closes the lighbox when called
         * @function closeLightbox
         * @private
         * @memberof iwc.comp.addtowishlistform
         */
        function closeLightbox() {
            util.lightbox.closeLightbox();
        }

        /**
         * If it is last product in wishlist notify user
         * about remvoing wishlist also
         * @function lastProductInWishlist
         * @private
         * @param {String} Wishlist name of the product
         * @memberof iwc.comp.addtowishlistform
         */
        function lastProductInWishlist(wishListName) {
            if (legacyCheckout === false) {
                getWishListData(function(data) {
                    $.each(data.wishlists, function(i, item) {
                        if (item.listId === wishListName) {
                            if (item.entries.length === 1) {
                                $component.addClass(cssClass.removeWishlistAlso);
                                return false;
                            }
                        }
                    });

                });
            } else {
                comp.account.customerDetailsData().done(function(customerData) {
                    $.each(customerData.values.customerDetails.wishlists, function(i, item) {
                        if (item.wishListName === wishListName) {
                            if (item.wishlistItems.length === 1) {
                                $component.addClass(cssClass.removeWishlistAlso);
                                return false;
                            }
                        }
                    });
                });
            }
        }

        /**
         * Update overlay content on open
         * @function updateOverlay
         * @public
         * @param {Object} requester event object
         * @memberof iwc.comp.addtowishlistform
         */
        function updateOverlay(requester) {
            existingList = [];
            //Configurator fix
            if (requester.target.attr('id') === 'configuratorWishlistButton') {
                $targetBtn = $('#configuratorWishlistButton');
                $targetBtn.removeData();
            } else {
                $targetBtn = $(requester.target[0]);
            }

            $targetBtn = $(requester.target[0]);
            callToAction = $targetBtn.attr('data-action');
            productData = $targetBtn[0].getAttribute('data-addtowishlist');
            if (typeof productData === 'string') {
                productData = JSON.parse($targetBtn[0].getAttribute('data-addtowishlist'));
            }
            if (productData) {
                $component
                    .addClass(callToAction)
                    .find('.' + callToAction).prop('disabled', false)
                    .find(selectors.productId).val(productData.productId);


                //triggering aria-hidden to false for the visisble button text
                if ($component.find('button').find('.' + callToAction)) {
                    $component.find('button').find('.' + callToAction).attr('aria-hidden','false');
                }
                //triggering aria-hidden to false for the visisble header text
                if ($component.find(selectors.wishlistAccountFormHeader).find('.' + callToAction)) {
                    $component.find(selectors.wishlistAccountFormHeader).find('.' + callToAction).attr('aria-hidden','false');
                }
                $.publish('iwc:wishlistform:opened');
                // assign engraving data
                $component.find(selectors.engravingId).val(productData.engravingId);
                $component.find(selectors.engravingText).val(productData.engravingText);
                // assign engraving data
                $component
                    .find('.' + callToAction)
                    .find(selectors.wishlist)
                    .val(productData.wishListName);

                lastProductInWishlist(productData.wishListName);

                if (callToAction === 'iwc-add-to-wishlist') {
                    if (legacyCheckout === false) {
                        $.each(wishlistData, function(i, val) {
                            existingList.push('<li><a href="javascript:void(0);" class="iwc-existing-wishlists-item"><span class="iwc-existing-wishlists-item-text">' + val.listId + '</span></a></li>');
                        });
                    } else {
                        $.each(wishlistData.wishlists, function(i, val) {
                            existingList.push('<li><a href="javascript:void(0);" class="iwc-existing-wishlists-item"><span class="iwc-existing-wishlists-item-text">' + val.wishListName + '</span></a></li>');
                        });
                    }
                    $existingWishlist.html(existingList);
                }
            }
            util.ajaxloader.hide();
        }
        /**
         * Fetch wishlist data for non legacy masions
         * @function getWishListData
         * @public
         * @success {function} success Callback
         * @memberof iwc.comp.addtowishlistform
         */

        function getWishListData(success) {
            $.ajax({
                    url: window.location.href.replace('.html','.rcq.wishlist.json'),
                    method: 'POST',
                    data: {
                        op: 'getWishlists'
                    }
                })
                .done(function(data) {
                    if (data.success) {
                        success(data);
                    }
                })
                .fail(function(xhr) {
                    console.error(xhr);
                });
        }
        /**
         * Add product to wishlist
         * @function openWishlitForm
         * @public
         * @param {Object} requester event object
         * @memberof iwc.comp.addtowishlistform
         */
        function openWishlitForm(requester) {
            util.ajaxloader.show();
            if (legacyCheckout === false) {
                // fetch wish list data for non legacy()
                var wishListCallback = function(data) {
                    wishlistData = data.wishlists;
                    updateOverlay(requester);
                };
                getWishListData(wishListCallback);
            } else {
                comp.account.customerDetailsData()
                    .done(function(data) {
                        wishlistData = data.values.customerDetails;
                        updateOverlay(requester);
                    });
            }
        }
        /**
         * If we have wishlists add them on click
         * @function addExistingWishlist
         * @private
         * @param {Object} event object
         * @memberof iwc.comp.addtowishlistform
         */
        function addExistingWishlist(e) {
            var $this = $(e.target).hasClass(cssClass.existingWishlistItem) ? $(e.target.childNodes[0]) : $(e.target);
            if ($this.hasClass(cssClass.existingWishlistsItemText)) {
                var exitingItemText = $this.text();
                $wishlist.val(exitingItemText).parent(selectors.inputWrapper).addClass(cssClass.inputFocused);
                $existingWishlistItem.find(selectors.existingWishlistItem).removeClass(cssClass.selected);
                $this.parent().addClass(cssClass.selected);
            }
        }

        /**
         * Show mini bag for wishlist product added
         * @function showMiniWishlist
         * @private
         * @param {string} url to fetch data
         * @memberof iwc.comp.addtowishlistform
         */
        function showMiniWishlist(url) {
            var productTitle = $targetBtn.data('producttitle'),
                productImage = $targetBtn.data('imagepath');

            $.get(url)
                .done(function(data) {
                    data = $(data);
                    data.find('img').attr('src', productImage);
                    data.find(selectors.notifyProductDetail).text(productTitle);
                    util.notification.content(data);
                    util.notification.open({
                        variant:'wishlist'
                    });
                });
        }

        /**
         * Remove product from Wishlist
         * @function removeFromWishlistHandler
         * @private
         * @param {jQuery} element
         * @memberof iwc.comp.addtowishlistform
         */
        function removeFromWishlistHandler($targetBtn) {
            var itemsInWishlistLength = $targetBtn.parents(selectors.wishlistProduct).siblings().length;

            if (comp.wishlistpage.getWishlistPageLength()) {

                if (!itemsInWishlistLength) {
                    $wishlistSection = $targetBtn.closest(selectors.wishlistSection);
                    $wishlistSection.remove();
                } else {
                    $targetBtn.parents(selectors.wishlistProduct).remove();
                }

                if (!comp.wishlistpage.getWishlistsCount() && !itemsInWishlistLength) {
                    comp.wishlistpage.updateWishlistView();
                }
            } else {

                util.wishlist.markButtonWishlistRemoved($targetBtn);
                util.wishlist.updateSimilarProducts($targetBtn, 'remove');
                var reinitBtn = $targetBtn.parent();
                util.lightbox.reInit(reinitBtn);
            }
            if (legacyCheckout === false) {
                $.publish('iwc:eu:wishlist:changed', ['removed']);
            } else {
                $.publish('iwc:wishlist:changed', ['removed']);
            }
        }

        /**
         * Add to wishlist success handler
         * @function successHandler
         * @private
         * @param {Object} response object
         * @memberof iwc.comp.addtowishlistform
         */
        function successHandler(response) {
            if (response.status.toLowerCase() === 'success') {
                var productRef = $targetBtn.data('tracking-product-ref');

                if ($targetBtn.attr('data-action') === 'iwc-add-to-wishlist') {

                    util.tracking.publish($targetBtn);

                    if (!util.matchmedia.narrow.matches && !comp.wishlistpage.getWishlistPageLength()) {
                        showMiniWishlist($form.data('url'));
                    }

                    if (comp.wishlistpage.getWishlistPageLength()) {
                        comp.wishlistpage.updateWishlistView();
                        util.smoothScroll.init(0, 700, function() {});
                        $targetBtn.closest('.iwc-featured-watch').remove();
                    }
                    var addedWishlistName = $wishlist.val() !== '' ? $wishlist.val() : defaultWishListName;
                    // Do not update configurator wishlist button
                    if (!$targetBtn.is('#configuratorWishlistButton')) {
                        util.wishlist.markButtonWishlistAdded($targetBtn, addedWishlistName);
                    }

                    util.wishlist.updateSimilarProducts($targetBtn, addedWishlistName);
                    if (legacyCheckout === false) {
                        $.publish('iwc:eu:wishlist:changed', ['added']);
                    } else {
                        $.publish('iwc:wishlist:changed', ['added']);
                    }

                    /*
                    * Update configurator about item added in wishlist
                    */
                    if (window.configurator && window.configurator.wishlist) {
                        window.configurator.wishlist({
                            action: 'add',
                            ref: productRef
                        });
                    }

                } else if ($targetBtn.attr('data-action') === 'iwc-remove-from-wishlist') {

                    removeFromWishlistHandler($targetBtn);
                    /*
                    * Update configurator about item added in wishlist
                    */
                    if (window.configurator && window.configurator.wishlist) {
                        window.configurator.wishlist({
                            action: 'remove',
                            ref: productRef
                        });
                    }
                } else {

                    if ($targetBtn.attr('data-selector') === '.rename-wishlist.json') {
                        var renamedWishlist = $newWishListName.val(),
                            renameWishListStr = JSON.stringify({ 'wishListName': renamedWishlist });
                        $wishlistName = $targetBtn.parent(selectors.wishlistActions).siblings(selectors.wishlistName);
                        $wishlistName.text($newWishListName.val());
                        var $wishlistButtonsInWishlist = $targetBtn
                                .parents(selectors.wishlistTitle)
                                .siblings(selectors.wishlistList)
                                .find(selectors.addToWishlistBtn),
                            $deleteWishlistBtn = $targetBtn.prev(selectors.deleteWishlist),
                            $sendToFriendBtn = $targetBtn.parents(selectors.wishlistActions).find(selectors.emailWishlist);

                        $targetBtn.attr('data-addtowishlist', renameWishListStr);
                        $sendToFriendBtn.attr('data-emailwishlist', renamedWishlist);
                        $deleteWishlistBtn.attr('data-addtowishlist', renameWishListStr);
                        $wishlistButtonsInWishlist.each(function() {
                            var  oldData = JSON.parse($(this).attr('data-addtowishlist'));
                            oldData.wishListName = renamedWishlist;
                            $(this).attr('data-addtowishlist', JSON.stringify(oldData));
                        });
                    } else if ($targetBtn.attr('data-selector') === '.delete-wishlist.json') {
                        $wishlistSection = $targetBtn.closest(selectors.wishlistSection);
                        $wishlistSection.remove();
                        if (!comp.wishlistpage.getWishlistsCount()) {
                            comp.wishlistpage.updateWishlistView();
                        }
                        if (legacyCheckout === false) {
                            $.publish('iwc:eu:wishlist:changed', ['removed']);
                        } else {
                            $.publish('iwc:wishlist:changed', ['removed']);
                        }
                    }
                }
            } else if (response.status.toLowerCase() === 'ask') {
                if (legacyCheckout === false) {
                    $.publish('iwc:eu:wishlist:changed', ['added']);
                } else {
                    $.publish('iwc:wishlist:changed', ['added']);
                }
                var responseObj = {};
                responseObj[response.values.message[0].split('=')[0]] = response.values.message[0].split('=')[1];
                responseObj[response.values.message[1].split('=')[0]] = response.values.message[1].split('=')[1];
                //read engravings data from target button i.e. wishlist icon
                responseObj.engravingId = $targetBtn.data('addtowishlist').engravingId;
                responseObj.engravingText = $targetBtn.data('addtowishlist').engravingText;
                iwc.comp.buyingoptions.addProductToBag(responseObj);
            } else {
                console.log('something went wrong!');
            }
            closeLightbox();
            util.ajaxloader.hide();
        }
        /**
         * Add to wishlist error handler
         * @function errorHandler
         * @private
         * @memberof iwc.comp.addtowishlistform
         */
        function errorHandler() {
            util.ajaxloader.hide();
        }
        /**
         * Add to wishlist form submit
         * @function submitHandler
         * @private
         * @param {Object} event object
         * @memberof iwc.comp.addtowishlistform
         */
        function submitHandler(e) {
            e.preventDefault();
            if (callToAction === 'iwc-rename-wishlist') {
                if (!$form.valid()) {
                    return;
                }
            }
            util.ajaxloader.show();
            formURL = currentPageURL;
            if ($targetBtn[0].getAttribute('data-formaction')) {
                formURL += $targetBtn[0].getAttribute('data-formaction');
            } else {
                formURL += $targetBtn[0].getAttribute('data-selector');
            }
            defaultWishListName = $form[0].getAttribute('data-default-wishlistname');
            formData = $form.serializeArray();
            formData.forEach(function(item) {
                if (item.name === 'wishListName' && item.value === '') {
                    item.value = defaultWishListName ? defaultWishListName : '';
                }
            });
            $.post(formURL, $.param(formData))
                .done(successHandler)
                .fail(errorHandler);
        }
        /**
         * Map DOM elements on page
         * @function mapDOMElements
         * @private
         * @memberof iwc.comp.addtowishlistform
         */
        function mapDOMElements() {
            $form = $overlay.find(selectors.form);
            $productId = $overlay.find(selectors.productId);
            $wishlist = $overlay.find(selectors.wishlist);
            $cancel = $overlay.find(selectors.cancel);
            $existingWishlistItem = $overlay.find(selectors.existingWishlistItem);
            $existingWishlist = $overlay.find(selectors.existingWishlist);
            $newWishListName = $overlay.find(selectors.newWishListName);
            $wishlistCount = $body.find(selectors.wishlistCount);
        }
        /**
         * Initialise add to wishlist form
         * @function mapDOMElements
         * @private
         * @memberof iwc.comp.addtowishlistform
         */
        function init() {
            legacyCheckout = $body.find(selectors.legacyCheckout).length ? false : true;
            $overlay = $body.find(selectors.overlay);
            $component = $overlay.find(selectors.component);
            mapDOMElements();
            $form.on('submit', submitHandler);
            comp.forms.init($form);
            $cancel.on('click', closeLightbox);
            util.formsAnimation.reInit($overlay);
            $body.on('click', $existingWishlistItem, addExistingWishlist);
        }

        return {
            init: init,
            openWishlitForm: openWishlitForm,
            getWishListData: getWishListData
        };

    })(iwc.$, iwc.comp, iwc.util);
}());

/*global iwc*/
/**
 * Add to wishlist page component
 */

(function() {
    'use strict';

    /**
     * Add to wishlist form component
     * @namespace wishlistpage
     * @memberof iwc.comp
     */
    iwc.comp.wishlistpage = (function($, util) {

        var $component,
            $printBtn,
            $wishlistSection,
            selectors = {
                printBtn: '.iwc-wishlist-print-btn',
                wishlistSection: '.iwc-wishlist-section',
                wishlistWrapper: '.iwc-wishlist-page-wrapper',
                wishlistList: '.iwc-wishlist-list',
                toggleGroups: '[data-toggle-group]',
                imagesOnPage: '.iwc-adaptive-image-util'
            },
            currentPageURL = util.dataStore.getCurrentPagePath(),
            images,
            imagesLength;

        /**
         * Map DOM elements on page
         * @function mapDOMElements
         * @private
         * @memberof iwc.comp.wishlistpage
         */
        function mapDOMElements() {
            $printBtn = $component.find(selectors.printBtn);
            images = $component.find(selectors.imagesOnPage);
            imagesLength = images.length;
        }
        /**
         * For other forms to know if we are on wishlist page.
         * @function getWishlistPageLength
         * @public
         * @returns {Number} - Page length
         * @memberof iwc.comp.wishlistpage
         */
        function getWishlistPageLength() {
            return $(selectors.wishlistWrapper).length;
        }
        /**
         * Get the number of Wishlists on page
         * @function getWishlistsCount
         * @public
         * @returns {Number} - Number of wishlists
         * @memberof iwc.comp.wishlistpage
         */
        function getWishlistsCount() {
            $wishlistSection = $component.find(selectors.wishlistSection);
            return $wishlistSection.length;
        }
        /**
         * Update wishlist section using AJAX call
         * @function updateWishlistView
         * @public
         * @memberof iwc.comp.wishlistpage
         */
        function updateWishlistView() {
            var url = currentPageURL + '.content.html?cacheburst=' + new Date().getTime();
            $.get(url)
                .done(function(data) {
                    var $responseData = $(data),
                        $wishlistButtonsContext = $responseData.find(selectors.wishlistList),
                        $featuredWatch = $responseData.find('.iwc-featured-watch');
                    $component.replaceWith($responseData);
                    /* jshint ignore:start */
                    init($responseData);
                    /* jshint ignore:end */
                    util.wishlist.reInit($wishlistButtonsContext);
                    util.lightbox.reInit($responseData);
                    iwc.comp.featuredWatch.init($featuredWatch);
                });
        }
        /**
         * Remove images from array after they are loaded
         * and initialise toggle after all loaded
         * @function imagesLoaded
         * @private
         * @memberof iwc.comp.wishlistpage
         */
        function imagesLoaded() {
            imagesLength--;
            if (imagesLength === 0) {
                util.toggle.init($component.find(selectors.toggleGroups));
            }
        }
        /**
         * Check if all images are loaded
         * @function checkImages
         * @private
         * @memberof iwc.comp.wishlistpage
         */
        function checkImages() {
            images.each(function() {
                if (this.complete) {
                    imagesLoaded.call(this);
                } else {
                    $(this).one('load', imagesLoaded);
                }
            });
        }
        /**
         * Initialise add to wishlist page
         * @function mapDOMElements
         * @private
         * @parem {elem} wishlist section
         * @memberof iwc.comp.wishlistpage
         */
        function init(elem) {
            $component = $(elem);
            mapDOMElements();
            checkImages();
            $printBtn.on('click', function() {
                window.print();
            });
        }

        return {
            init: init,
            getWishlistsCount: getWishlistsCount,
            updateWishlistView: updateWishlistView,
            getWishlistPageLength: getWishlistPageLength
        };

    })(iwc.$, iwc.util);
}());

/*global iwc*/

/**
 * Watch finder UI Manager module
 */

(function($, util) {
    'use strict';

    /**
     * Watch finder UI module
     * @namespace iwc.comp.watchfinder.module.uiManager
     * @memberof iwc.comp.watchfinder.module
     */
    iwc.comp.watchfinder.module.uiManager = (function() {
        var $body = $('body'),
            wfPriceUrl,
            selectors = {
                wfResultBox: '.iwc-finder-result-box',
                wfProductItem: '.iwc-finder-result-product',
                wfProductPrice: '.iwc-product-fromprice'
            },
            cssClass = {
                priceLoader: 'price-loader'
            },
            CONST = {
                pricedetails: 'pricedetails'
            },
            composition = {

                /**
                 * animateProductTile animate in a product tile
                 * @memberof iwc.comp.watchfinder.module.uiManager
                 * @public
                 * @param {number} index of the data in the filtered list
                 */
                animateProductTile: function(index) {
                    var self = this;
                    return function() {
                        self.filteredData[index].$domInstance.addClass(self.cssClasses.animateShow);
                    };
                },

                /**
                 * showMoreFilteredData show's more filtered products
                 * @memberof iwc.comp.watchfinder.module.uiManager
                 * @public
                 * @param {boolean} controls when to do auto scroll. false for first search.
                 */
                showMoreFilteredData: function(doScroll) {
                    var top = 0;
                    for (var index = this.shownDataIndex + 1;
                        index < this.filteredData.length && index <= this.shownDataIndex + this.showMoreJump;
                        index++) {

                        this.filteredData[index].$domInstance.removeClass(this.cssClasses.hide);

                        if (!doScroll && index < this.showMoreJump) {
                            window.setTimeout(this.animateProductTile.bind(this)(index), 300);
                        }
                    }
                    this.shownDataIndex += this.showMoreJump;

                    if (this.shownDataIndex + 1 >= this.filteredData.length) {
                        this.$showMore.addClass(this.cssClasses.hide);
                    } else {
                        this.$showMore.removeClass(this.cssClasses.hide);
                    }

                    if (!doScroll) {
                        util.lazyLoadImage.checkImages();
                    } else {
                        top = this.$window.scrollTop() || this.$body.scrollTop();
                        util.scrollTo.position(top + 200, 500, function() {});
                    }
                }
            };

        /**
         * populatePriceProductItem show's formatted price for each product.
         * @function populatePriceProductItem
         * @memberof iwc.comp.watchfinder.module.uiManager
         * @private
         * @param {object} response.
         */
        function populatePriceProductItem(response) {
            var responseRefCodes = Object.keys(response.values),
                $that,
                htmlProductRef;
            $(selectors.wfResultBox).find(selectors.wfProductItem).each(function() {
                $that = $(this);
                htmlProductRef = $(this).data('productRef');
                responseRefCodes.forEach(function(v) {
                    if (v === htmlProductRef && response.values[v] !== '') {
                        $that.find(selectors.wfProductPrice).html(response.values[v]).removeClass(cssClass.priceLoader);
                    }
                });
            });
        }

        /**
         * success handler for receiving array of products with price.
         * @function onSuccess
         * @memberof iwc.comp.watchfinder.module.uiManager
         * @private
         * @param {object} response.
         */
        function onSuccess(response) {
            // populate price for product item on basis of response price received from ajax.
            if (response !== null) {
                populatePriceProductItem(response);
            }
        }

        /**
         * Failure handler for ajax call to fetch prices of products.
         * @function onFail
         * @memberof iwc.comp.watchfinder.module.uiManager
         * @private
         * @param {object} response.
         */
        function onFail() {
            console.log('Fetch failed');
        }
        /**
         * return url for fetching price
         * @function wfinderPriceUrl
         * @memberof iwc.comp.watchfinder.module.uiManager
         * @private
         */
        function wfinderPriceUrl() {
            // check country code in localstorage
            wfPriceUrl = iwc.util.dataStore.getCurrentPagePathWithoutSelector() + '.' + CONST.pricedetails + '.' + iwc.comp.currencyselectorppc.checkCountryCodeLS() + '.json';
            return wfPriceUrl;
        }

        /**
         * Fire an ajax call to receive prices for products
         * @function fetchPrice
         * @memberof iwc.comp.watchfinder.module.uiManager
         * @private
         */
        function fetchPrice() {
            $.get(wfinderPriceUrl())
                .done(function(data) {
                    onSuccess(data);
                })
                .fail(onFail);
        }

        /**
         * initialise watch finder UI
         * @public
         * @memberOf iwc.comp.watchfinder.module.uiManager
         * @param {jQuery} $comp watchfinder component
         * @param {Object} filterManger an instance of contructor
         * @param {Object} dataManager an instance of contructor
         */
        function init($comp, filterManager, dataManager) {
            if ($comp.data('viewtype') === 'general') {
                iwc.comp.watchfinder.module.generalUi.init($comp, filterManager, dataManager);
            } else {
                iwc.comp.watchfinder.module.manualUi.init($comp, filterManager, dataManager);
            }
            // Fetch price on load.
            if (util.dataStore.isCommerceEnabled() || util.dataStore.isPpcEnabled()) {
                fetchPrice();
            } else {
                // remove loader if ppc/ecommerce not enabled.
                $(selectors.wfResultBox).find(selectors.wfProductPrice).removeClass(cssClass.priceLoader);
            }

            util.scroll.init();
            util.animatable.init();
        }

        return {
            init: init,
            composition: composition
        };

    })();

}(iwc.$, iwc.util));

/*global iwc*/

/**
 * Watch finder General UI module
 */

(function($, util) {
    'use strict';

    /**
     * GeneralUi
     * @constructor
     * @memberof iwc.comp.watchfinder.module.generalUi
     * @private
     * @param {jQuery} $comp watchfinder component
     * @param {Object} filterManager an instance of contructor
     * @param {Object} dataManager an instance of contructor
     */
    function GeneralUi($comp, filterManager, dataManager) {
        this.$comp = $comp;
        this.$body = $('body');
        this.$window = $(window);
        this.filterManager = filterManager;
        this.dataManager = dataManager;
        this.filterState = {};
        this.filteredData = [];
        this.critaria = [];
        this.silentFilterChange = false;
        this.selectors = {
            narrowFilterShow: '.iwc-finder-show',
            narrowFilterHide: '.iwc-finder-hide',
            finderFormContainer: '.iwc-finder-form',
            finderFilters: '.iwc-finder-filters',
            clearFilter: '.iwc-finder-clear, .iwc-reset-search',
            searchButtons: '.iwc-finder-search',
            searchButtonByRef: '.iwc-finder-byref-search',
            byRefInput: '.iwc-finder-byref-input',
            appliedFiltersList: '.iwc-finder-result-filters',
            appliedFilter: '.iwc-finder-result-filter',
            appliedFilterTemplate: '.iwc-finder-result-filter-template',
            productTile: '.iwc-finder-result-product',
            resultCollectionTitle: '.iwc-finder-result-title-all-collection',
            showMoreButton: '.iwc-finder-result-more',
            finderProductLink: '.iwc-finder-product-link',
            resultAllView: '.iwc-finder-result-all-view',
            resultCollectionView: '.iwc-finder-result-collections-view',
            collectionViewCollections: '.iwc-finder-result-collection',
            veil: '.iwc-finder-result-veil',
            noResult: '.iwc-no-result'
        };
        this.cssClasses = {
            showFilters: 'iwc-finder-showfilters',
            hide: 'iwc-hidden',
            bodyNarrowFilterShown: 'iwc-finder-filter-shown',
            categoryTabExpanded: 'iwc-finder-tab-expanded',
            animateShow: 'iwc-show',
            selected: 'selected'
        };
        this.CONST = {
            showMoreJumpMobile: (this.$comp.data('showmore-size-mobile') || 12),
            showMoreJumpDesktop: (this.$comp.data('showmore-size-desktop') || 4),
            collectionFilterKey: 'collection_filter0'
        };
        this.showMoreJump = 4;
        this.i18n = {};
        this.$formContainer = {};
        this.$searchButtons = {};
        this.$appliedFiltersList = {};
        this.appliedFilterTemplate = '';
        this.$resultAllView = {};
        this.$resultCollectionView = {};
        this.$collectionViewCollections = [];
        this.$veil = {};
        this.firstTabItem = {};
        this.lastTabItem = {};
        this.shownDataIndex = -1;//Index of product in filtered data shown

        this.init();
    }

    /**
     * showProperResultView Decide and show right view of product listing.
     * Either All View, or Collection View
     * Apply filter in the view to be shown
     * @memberof iwc.comp.watchfinder.module.generalUi.GeneralUi
     * @public
     */
    GeneralUi.prototype.showProperResultView = function() {
        var filtersCategoryLength = Object.keys(this.filterState).length;
        if (filtersCategoryLength === 0 || (this.filterState[this.CONST.collectionFilterKey] && filtersCategoryLength === 1)) {
            this.updateCollectionsView();
            this.showAllView(false);
            util.lazyLoadImage.checkImages();
        } else {
            this.showFilteredData();
            this.showAllView(true);
        }
        this.showAppliedFilters();
    };

    /**
     * updateCollectionsView Show the right collection group
     * @memberof iwc.comp.watchfinder.module.generalUi.GeneralUi
     * @public
     */
    GeneralUi.prototype.updateCollectionsView = function() {
        var hasAnyFilterSelected = false;
        if (this.filterState[this.CONST.collectionFilterKey]) {

            this.$collectionViewCollections.addClass(this.cssClasses.hide);
            this.filterState[this.CONST.collectionFilterKey].values.forEach((function(key) {
                this.$resultCollectionView
                    .find(this.selectors.collectionViewCollections + '[data-collection-tagid="' + key.tag + '"]')
                    .removeClass(this.cssClasses.hide);
            }).bind(this));
            hasAnyFilterSelected = true;
        } else {
            this.$collectionViewCollections.removeClass(this.cssClasses.hide);
        }
        this.$resultCollectionView
            .find(this.selectors.productTile + '.' + this.cssClasses.animateShow)
            .removeClass(this.cssClasses.animateShow);

        this.toggleResultTitle(hasAnyFilterSelected);

        window.setTimeout(util.animatable.scrollingAnimations, 300);
    };

    /**
     * showAllView switches between All View and Collections View of product list
     * @memberof iwc.comp.watchfinder.module.generalUi.GeneralUi
     * @param {boolean} showView should the All View be shown and show collection view or other way
     * @public
     */
    GeneralUi.prototype.showAllView = function(showView) {
        this.$resultAllView.toggleClass(this.cssClasses.hide, !showView);
        this.$resultCollectionView.toggleClass(this.cssClasses.hide, showView);
        util.toggle.close(this.$formContainer);
    };

    /**
     * clearFilter event handler of clear button
     * @memberof iwc.comp.watchfinder.module.generalUi.GeneralUi
     * @public
     */
    GeneralUi.prototype.clearFilters = function() {
        this.clearFiltersInTab();
        this.$byRefInput.val('');
        this.hideNarrowFilters();
    };

    /**
     * clearFiltersInTab
     * @memberof iwc.comp.watchfinder.module.generalUi.GeneralUi
     * @public
     */
    GeneralUi.prototype.clearFiltersInTab = function() {
        this.filterManager.clear();
        this.filterState = {};
        this.filtersChanged(this.filterState);
        this.updateCollectionsView();
        this.showAllView(false);
        this.createDeepLink();
        this.showAppliedFilters();
        this.$searchButtons.prop('disabled', false);
        this.noResultView(true);
        this.critaria = [];
        util.scrollTo.position(0, 500);
    };

    /**
     * showNarrowFilters
     * @memberof iwc.comp.watchfinder.module.generalUi.GeneralUi
     * @public
     */
    GeneralUi.prototype.showNarrowFilters = function() {
        this.$comp.addClass(this.cssClasses.showFilters);
        this.$body.addClass(this.cssClasses.bodyNarrowFilterShown);
    };

    /**
     * hideNarrowFilters
     * @memberof iwc.comp.watchfinder.module.generalUi.GeneralUi
     * @public
     */
    GeneralUi.prototype.hideNarrowFilters = function() {
        this.$comp.removeClass(this.cssClasses.showFilters);
        this.$body.removeClass(this.cssClasses.bodyNarrowFilterShown);
    };

    /**
     * filterTabToggled
     * @memberof iwc.comp.watchfinder.module.generalUi.GeneralUi
     * @public
     * @param {Event} event
     * @param {Object} toggleInstance instance of toggle which some change
     */
    GeneralUi.prototype.filterTabToggled = function(event, toggleInstance) {

        // setting cyclic tabbing when watch-finder tab opens
        if (toggleInstance.$currentToggleButton.length) {
            if (toggleInstance.$currentToggleButton.hasClass(this.cssClasses.selected)) {
                this.firstTabItem = toggleInstance.$currentToggleButton;
                this.lastTabItem = toggleInstance.$targetElement.find(this.selectors.searchButtons);
                if (this.firstTabItem && this.lastTabItem) {
                    util.lightbox.circularTabbing(this.firstTabItem, this.lastTabItem);
                }
            } else {
                toggleInstance.$currentToggleButton.unbind('keydown');
                toggleInstance.$currentToggleButton.focus();
            }
        }
        if (!util.matchmedia.narrow.matches) {
            this.$comp.toggleClass(this.cssClasses.categoryTabExpanded, toggleInstance.anyExpanded());
        }
    };

    /**
     * navigateAfterTracking
     * @memberof iwc.comp.watchfinder.module.generalUi.GeneralUi
     * @private
     * @param {Event} event
     */
    GeneralUi.prototype.navigateAfterTracking = function(event) {
        event.preventDefault();
        var $target = $(event.currentTarget),
            href = $target.attr('href');
        iwc.util.tracking.publish($target);
        setTimeout(function() {
            window.location.href = href;
        }, 300);
    };

    /**
     * Stick filter box
     * @private
     * @memberOf iwc.comp.watchfinder.module.generalUi.GeneralUi
     * @function onWindowScrolled
    */
    GeneralUi.prototype.onWindowScrolled = function() {
        var rect = this.$comp[0].getBoundingClientRect();
        this.$comp.toggleClass('iwc-finder-floated-filters', (rect.top <= 0));
    };

    /**
     * Handler of click on veil. To close filter tabs.
     * @private
     * @memberOf iwc.comp.watchfinder.module.generalUi.GeneralUi
     * @function closeFilterTabs
    */
    GeneralUi.prototype.closeFilterTabs = function() {
        util.toggle.close(this.$formContainer);
    };

    /**
     * bindEvents description
     * @memberof iwc.comp.watchfinder.module.generalUi.GeneralUi
     * @public
     */
    GeneralUi.prototype.bindEvents = function() {

        this.$comp.find(this.selectors.narrowFilterShow).on('click', this.showNarrowFilters.bind(this));

        this.$comp.find(this.selectors.narrowFilterHide).on('click', this.hideNarrowFilters.bind(this));

        this.$comp.find(this.selectors.clearFilter).on('click', this.clearFilters.bind(this));

        this.$comp.find(this.selectors.finderProductLink).on('click', this.navigateAfterTracking.bind(this));

        this.$appliedFiltersList.on('click', this.selectors.appliedFilter, this.removeFilter.bind(this));

        this.$searchButtons.on('click', this.applyFiltersInTab.bind(this));

        this.$searchButtonByRef.on('click', this.applyFilterByRef.bind(this));

        this.$showMore.on('click', this.showMoreFilteredData.bind(this, true));

        this.$veil.on('click', this.closeFilterTabs.bind(this));

        this.$formContainer.on('toggle-change', this.filterTabToggled.bind(this));

        $.subscribe('iwc:watchfinder:filters:changed', this.filtersChanged.bind(this));

        $.subscribe('iwc:watchfinder:hash:changed', this.applyDeepLink.bind(this));

        $.subscribe('scroll', this.onWindowScrolled.bind(this));

    };

    /**
     * applyToggleFeature run toggle on defined selectors
     * @memberof iwc.comp.watchfinder.module.generalUi.GeneralUi
     * @public
     */
    GeneralUi.prototype.applyToggleFeature = function() {
        var $categoryFilters = {};

        util.toggle.init(
                this.$formContainer,
                {
                    toggleButton: '.iwc-finder-category',
                    toggleTarget: '.iwc-finder-category-content'
                });

        if (util.matchmedia.narrow.matches) {
            $categoryFilters = this.$comp.find(this.selectors.finderFilters);
            $categoryFilters.each(function(index) {

                util.toggle.init($categoryFilters.eq(index),
                    {
                        toggleButton: '.iwc-finder-filter-title',
                        toggleTarget: '.iwc-finder-filter-subitems'
                    });
            });
        }
    };

    /**
     * filtersChanged listener of publish event from filterManager
     * Also apply filters on data to see what will be the final count,
     * but don't reflect on result tile.
     * @memberof iwc.comp.watchfinder.module.generalUi.GeneralUi
     * @public
     * @param  {Object} filterState currently applied filters
     */
    GeneralUi.prototype.filtersChanged = function(filterState) {
        var newFilterResult,
            buttonText = '',
            critaria = [];
        this.filterState = filterState;

        //Don't listen to filter changes. Avoid triggering data processing.
        if (this.silentFilterChange) {
            return false;
        }

        newFilterResult = this.dataManager.filterData(filterState);
        this.$searchButtons.prop('disabled', false);

        $.each(filterState, function(i, val) {
            $.each(val.values, function(j, val2) {
                critaria.push(val2.text);
            });
        });
        this.critaria = critaria;

        if (newFilterResult.length > 0 && Object.keys(filterState).length > 0) {
            buttonText = this.i18n.showWatches.replace('{0}', newFilterResult.length);
            this.filteredData = newFilterResult;
        } else if (newFilterResult.length > 0) {
            buttonText = this.i18n.search;
            this.filteredData = newFilterResult;
        } else {
            buttonText = this.i18n.noShowWatches;
            this.$searchButtons.prop('disabled', true);
        }
        this.$searchButtons.text(buttonText);
    };

    /**
     * createDeepLink create a minimal filter object for deeplink
     * @memberof iwc.comp.watchfinder.module.generalUi.GeneralUi
     * @public
     */
    GeneralUi.prototype.createDeepLink = function() {
        var self = this,
            linkFilterState = {};
        Object.keys(self.filterState).forEach(function(key) {
            linkFilterState[key] = [];
            self.filterState[key].values.forEach(function(value) {
                linkFilterState[key].push(value.tag);
            });
        });
        iwc.comp.watchfinder.utility.deeplink.set(linkFilterState);
    };


    /**
     * applyDeepLink reads deepLink and apply filters state and result
     * @memberof iwc.comp.watchfinder.module.generalUi.GeneralUi
     * @public
     */
    GeneralUi.prototype.applyDeepLink = function() {
        var self = this,
            changeSilently = true,
            filterRequiredState = iwc.comp.watchfinder.utility.deeplink.get(),
            requiredFiltersKeys = [];

        self.filterManager.clear();

        //Two types of possible deeplink, 1. Open tab, or 2. Apply filters
        //Currently only one works
        if (filterRequiredState.openTab) {
            this.filtersChanged({});
            this.showNarrowFilters();
            util.toggle.openTab(this.$formContainer, 'iwc-finder-' + filterRequiredState.openTab);
        } else {
            this.silentFilterChange = true;

            requiredFiltersKeys = Object.keys(filterRequiredState);
            requiredFiltersKeys.forEach(function(key) {
                filterRequiredState[key].forEach(function(value) {
                    self.filterManager.selectFilter(key, value, changeSilently);
                });
            });

            this.silentFilterChange = false;

            this.filtersChanged(requiredFiltersKeys.length ? this.filterState : {});

            this.showProperResultView();
        }

    };

    GeneralUi.prototype.noResultView = function(showHideNoResult) {
        this.$resultAllView.find(this.selectors.noResult).toggleClass(this.cssClasses.hide, showHideNoResult);
    };

    /**
     * showFilteredData Search in data as per filters, cache the product's DOM
     * @memberof iwc.comp.watchfinder.module.generalUi.GeneralUi
     * @public
     */
    GeneralUi.prototype.showFilteredData = function() {

        this.$resultAllView.find(this.selectors.productTile + '.' + this.cssClasses.animateShow)
            .addClass(this.cssClasses.hide)
            .removeClass(this.cssClasses.animateShow);

        if (!this.filteredData.length) {
            this.noResultView(false);
        }

        this.filteredData.forEach((function(product) {
            var productRef = product.REFERENCE[0];
            if (!product.$domInstance) {
                //Cache the product tile instance for future access
                product.$domInstance = this.$resultAllView.find(this.selectors.productTile + '[data-product-ref="' + productRef + '"]');
            }
        }).bind(this));

        this.shownDataIndex = -1;
        window.setTimeout((function() {
            this.showMoreFilteredData(false);
        }).bind(this), 10);


    };

    /**
     * animateProductTile composed from the uiManager module
     * @memberof iwc.comp.watchfinder.module.generalUi.GeneralUi
     * @public
     */
    GeneralUi.prototype.animateProductTile = iwc.comp.watchfinder.module.uiManager.composition.animateProductTile;

    /**
     * showMoreFilteredData composed from the uiManager module
     * @memberof iwc.comp.watchfinder.module.generalUi.GeneralUi
     * @public
     */
    GeneralUi.prototype.showMoreFilteredData = iwc.comp.watchfinder.module.uiManager.composition.showMoreFilteredData;

    /**
     * applyFiltersInTab Event handler of search click in tabs
     * @memberof iwc.comp.watchfinder.module.generalUi.GeneralUi
     * @public
     * @param  {Event} event
     */
    GeneralUi.prototype.applyFiltersInTab = function(event) {
        event.preventDefault();

        if (this.$searchButtons.prop('disabled')) {
            return false;
        }

        util.scrollTo.position(0, 500);

        this.showProperResultView();

        util.toggle.close(this.$comp.find(this.selectors.finderFormContainer));
        this.hideNarrowFilters();

        this.$byRefInput.val('');
        this.createDeepLink();

        $(event.target).attr('data-tracking-critaria', this.critaria.join(', '));
        iwc.util.tracking.publish($(event.target));
    };

    /**
     * applyFilterByRef Event handler of search by ref click
     * @memberof iwc.comp.watchfinder.module.generalUi.GeneralUi
     * @public
     * @param  {Event} event
     */
    GeneralUi.prototype.applyFilterByRef = function(event) {
        var inputRefNumber = $.trim(this.$byRefInput.val()).toLowerCase();
        event.preventDefault();
        this.clearFiltersInTab();
        this.filteredData = this.dataManager.filterDataByRef(inputRefNumber);

        //When ref filter is applied with cleared tab filters which ideally show collection view
        //instead of collection view show the all view.
        this.showFilteredData();
        this.showAppliedFilters();
        this.showAllView(true);

        this.hideNarrowFilters();
        this.toggleResultTitle(inputRefNumber.length > 0);
    };

    /**
     * showAppliedFilters Creates UI of applied filters on result box
     * @memberof iwc.comp.watchfinder.module.generalUi.GeneralUi
     * @public
     */
    GeneralUi.prototype.showAppliedFilters = function() {
        var self = this,
            listFragment = document.createDocumentFragment(),
            filterTemplate = this.appliedFilterTemplate,
            filterString = '',
            filterKeys = Object.keys(self.filterState);

        this.$appliedFiltersList.html('');

        filterKeys.forEach(function(key) {

            self.filterState[key].values.forEach(function(value) {
                filterString = filterTemplate
                                .replace('{{filterName}}', self.filterState[key].title + ': ' + value.text)
                                .replace('{{objectKey}}', key)
                                .replace('{{filterTag}}', value.tag)
                                .replace('{{remove}}', self.i18n.remove);

                listFragment.appendChild($(filterString)[0]);
            });

        });
        this.$appliedFiltersList.append(listFragment);

        this.toggleResultTitle(filterKeys.length > 0);
    };

    /**
     * toggleResultTitle decide the show/hide collection's title based on if any filter is applied
     * @memberof iwc.comp.watchfinder.module.generalUi.GeneralUi
     * @public
     * @param {boolean} anyFilterApplied
     */
    GeneralUi.prototype.toggleResultTitle = function(anyFilterApplied) {
        if (anyFilterApplied) {
            this.$resultTitleCollection.addClass(this.cssClasses.hide);
        } else {
            this.$resultTitleCollection.removeClass(this.cssClasses.hide);
        }
    };

    /**
     * removeFilter event handler to remove filters from result box
     * @memberof iwc.comp.watchfinder.module.generalUi.GeneralUi
     * @public
     */
    GeneralUi.prototype.removeFilter = function(event) {
        var $target = $(event.currentTarget);
        this.filterManager.deSelectFilter($target.data('filter-id'), $target.data('filter-value-tag'));
        this.showProperResultView();
        this.createDeepLink();
        $target.remove();
    };

    /**
     * initialise do finder UI setup
     * @memberof iwc.comp.watchfinder.module.generalUi.GeneralUi
     * @public
     */
    GeneralUi.prototype.init = function() {
        var $appliedFilterTemplate = this.$comp.find(this.selectors.appliedFilterTemplate);

        this.$formContainer = this.$comp.find(this.selectors.finderFormContainer);
        this.$searchButtons = this.$comp.find(this.selectors.searchButtons);
        this.$searchButtonByRef = this.$comp.find(this.selectors.searchButtonByRef);
        this.$byRefInput = this.$comp.find(this.selectors.byRefInput);
        this.$resultTitleCollection = this.$comp.find(this.selectors.resultCollectionTitle);
        this.$veil = this.$comp.find(this.selectors.veil);

        this.$resultAllView = this.$comp.find(this.selectors.resultAllView);
        this.$resultCollectionView = this.$comp.find(this.selectors.resultCollectionView);

        this.$showMore = this.$resultAllView.find(this.selectors.showMoreButton);

        this.$appliedFiltersList = this.$comp.find(this.selectors.appliedFiltersList);
        this.appliedFilterTemplate = $appliedFilterTemplate.text();

        this.$collectionViewCollections = this.$resultCollectionView.find(this.selectors.collectionViewCollections);

        this.i18n = {
            showWatches: this.$comp.data('i18n-show-watches'),
            noShowWatches: this.$comp.data('i18n-no-watches'),
            search: this.$comp.data('i18n-search'),
            remove: $appliedFilterTemplate.data('i18n-remove')
        };

        this.showMoreJump = util.matchmedia.narrow.matches ? this.CONST.showMoreJumpMobile : this.CONST.showMoreJumpDesktop;

        this.bindEvents();
        this.applyToggleFeature();
        this.applyDeepLink();

        iwc.comp.watchfinder.utility.deeplink.init();
        util.lazyLoadImage.checkImages();
    };

    /**
     * Watch finder UI module
     * @namespace iwc.comp.watchfinder.module.generalUi
     * @memberof iwc.comp.watchfinder.module
     */
    iwc.comp.watchfinder.module.generalUi = (function() {

        /**
         * initialise watch finder UI
         * @public
         * @memberOf iwc.comp.watchfinder.module.generalUi
         * @param {jQuery} $comp watchfinder component
         * @param {Object} filterManger an instance of contructor
         * @param {Object} dataManager an instance of contructor
         */
        function init($comp, filterManager, dataManager) {
            return new GeneralUi($comp, filterManager, dataManager);
        }

        return {
            init: init
        };

    })();

}(iwc.$, iwc.util));

/*global iwc*/

/**
 * Watch finder Manual UI module
 */

(function($, util) {
    'use strict';

    /**
     * ManualUi
     * @constructor
     * @memberof iwc.comp.watchfinder.module.manualUi
     * @private
     * @param {jQuery} $comp watchfinder component
     * @param {Object} filterManager an instance of contructor
     * @param {Object} dataManager an instance of contructor
     */
    function ManualUi($comp, filterManager, dataManager) {
        this.$comp = $comp;
        this.$body = $('body');
        this.$window = $(window);
        this.filterManager = filterManager;
        this.dataManager = dataManager;
        this.filteredData = [];
        this.selectors = {
            searchButton: '.iwc-finder-manual-search',
            searchInput: '.iwc-finder-manual-input',
            productTile: '.iwc-finder-result-product',
            resultTitle: '.iwc-finder-result-search-title',
            showMoreButton: '.iwc-finder-result-more',
            finderProductLink: '.iwc-finder-product-link',
            resultBox: '.iwc-finder-result-box'
        };
        this.cssClasses = {
            hide: 'iwc-hidden',
            animateShow: 'iwc-show'
        };
        this.CONST = {
            showMoreJumpMobile: (this.$comp.data('showmore-size-mobile') || 12),
            showMoreJumpDesktop: (this.$comp.data('showmore-size-desktop') || 4)
        };
        this.showMoreJump = 4;
        this.i18n = {};
        this.$searchButton = {};
        this.$searchInput = {};
        this.$showMore = {};
        this.$resultBox = {};

        this.shownDataIndex = -1;//Index of product in filtered data shown

        this.init();
    }


    /**
     * navigateAfterTracking
     * @memberof iwc.comp.watchfinder.module.manualUi.ManualUi
     * @private
     * @param {Event} event
     */
    ManualUi.prototype.navigateAfterTracking = function(event) {
        event.preventDefault();
        var $target = $(event.currentTarget),
            href = $target.attr('href');
        iwc.util.tracking.publish($target);
        setTimeout(function() {
            window.location.href = href;
        }, 300);
    };

    /**
     * bindEvents description
     * @memberof iwc.comp.watchfinder.module.manualUi.ManualUi
     * @public
     */
    ManualUi.prototype.bindEvents = function() {

        this.$comp.find(this.selectors.finderProductLink).on('click', this.navigateAfterTracking.bind(this));

        this.$searchInput.on('keyup', util.debounce(this.applyFilter.bind(this), 100));

        this.$searchButton.on('click', this.showFilteredData.bind(this));

        this.$showMore.on('click', this.showMoreFilteredData.bind(this, true));
    };

    /**
     * showFilteredData Search in data as per filters, cache the product's DOM
     * @memberof iwc.comp.watchfinder.module.manualUi.ManualUi
     * @public
     */
    ManualUi.prototype.showFilteredData = function(event) {
        event.preventDefault();
        this.$comp.addClass('iwc-finder-manual-searched');
        this.$resultBox.removeClass('iwc-hidden');

        this.$comp.find(this.selectors.productTile + '.' + this.cssClasses.animateShow)
            .addClass(this.cssClasses.hide)
            .removeClass(this.cssClasses.animateShow);

        this.filteredData.forEach((function(product) {
            var productRef = product.REFERENCE[0];
            if (!product.$domInstance) {
                //Cache the product tile instance for future access
                product.$domInstance = this.$comp.find(this.selectors.productTile + '[data-product-ref="' + productRef + '"]');
            }
        }).bind(this));
        this.shownDataIndex = -1;

        window.setTimeout((function() {
            this.showMoreFilteredData(false);
        }).bind(this), 10);

        this.setResultTitle(this.$searchInput.val().length > 0, this.filteredData.length);
    };

    /**
     * animateProductTile composed from the uiManager module
     * @memberof iwc.comp.watchfinder.module.manualUi.ManualUi
     * @public
     */
    ManualUi.prototype.animateProductTile = iwc.comp.watchfinder.module.uiManager.composition.animateProductTile;

    /**
     * showMoreFilteredData composed from the uiManager module
     * @memberof iwc.comp.watchfinder.module.manualUi.ManualUi
     * @public
     */
    ManualUi.prototype.showMoreFilteredData = iwc.comp.watchfinder.module.uiManager.composition.showMoreFilteredData;


    /**
     * applyFilter Event handler of search by ref click
     * @memberof iwc.comp.watchfinder.module.manualUi.ManualUi
     * @public
     * @param  {Event} event
     */
    ManualUi.prototype.applyFilter = function(event) {
        var inputValue = $.trim(this.$searchInput.val()).toLowerCase();
        event.preventDefault();
        this.filteredData = this.dataManager.filterDataByRefAndTitle(inputValue);
    };

    /**
     * setResultTitle decide the title based on if any filter is applied
     * @memberof iwc.comp.watchfinder.module.manualUi.ManualUi
     * @public
     * @param {boolean} anyFilterApplied
     * @param {number} filteredDataCount
     */
    ManualUi.prototype.setResultTitle = function(anyFilterApplied, filteredDataCount) {
        if (anyFilterApplied) {
            this.$resultTitle.text(filteredDataCount + ' ' + this.i18n.resultTitleWithFilter);
        } else {
            this.$resultTitle.text(this.i18n.resultTitleWithoutFilter);
        }
    };


    /**
     * initialise do finder UI setup
     * @memberof iwc.comp.watchfinder.module.manualUi.ManualUi
     * @public
     */
    ManualUi.prototype.init = function() {

        this.$searchButton = this.$comp.find(this.selectors.searchButton);
        this.$searchInput = this.$comp.find(this.selectors.searchInput);
        this.$showMore = this.$comp.find(this.selectors.showMoreButton);
        this.$resultBox = this.$comp.find(this.selectors.resultBox);
        this.$resultTitle = this.$comp.find(this.selectors.resultTitle);

        this.i18n = {
            showWatches: this.$comp.data('i18n-show-watches'),
            search: this.$comp.data('i18n-search'),
            resultTitleWithFilter: this.$resultTitle.data('title-with-filter'),
            resultTitleWithoutFilter: this.$resultTitle.data('title-without-filter')
        };

        this.filteredData = this.dataManager.productData;

        this.showMoreJump = util.matchmedia.narrow.matches ? this.CONST.showMoreJumpMobile : this.CONST.showMoreJumpDesktop;

        this.bindEvents();
    };

    /**
     * Watch finder UI module
     * @namespace iwc.comp.watchfinder.module.manualUi
     * @memberof iwc.comp.watchfinder.module
     */
    iwc.comp.watchfinder.module.manualUi = (function() {

        /**
         * initialise watch finder UI
         * @public
         * @memberOf iwc.comp.watchfinder.module.manualUi
         * @param {jQuery} $comp watchfinder component
         * @param {Object} filterManger an instance of contructor
         * @param {Object} dataManager an instance of contructor
         */
        function init($comp, filterManager, dataManager) {
            return new ManualUi($comp, filterManager, dataManager);
        }

        return {
            init: init
        };

    })();

}(iwc.$, iwc.util));

/*global iwc*/

/**
 * Filter Manager module
 */

(function($) {
    'use strict';

    /**
     * FilterManager
     * @constructor
     * @memberof iwc.comp.watchfinder.module.filterManager
     * @private
     * @param {jQuery} $comp watchfinder component
     */
    function FilterManager($comp) {
        this.$comp = $comp;
        this.count = 0;
        this.selections = {};

        this.selectors = {
            collectionTab: '.iwc-finder-category[data-toggle="iwc-finder-collections"]',
            collectionContent: '.iwc-finder-collections',
            designTab: '.iwc-finder-category[data-toggle="iwc-finder-design"]',
            designContent: '.iwc-finder-design',
            mechanismTab: '.iwc-finder-category[data-toggle="iwc-finder-mechanism"]',
            mechanismContent: '.iwc-finder-mechanism',
            finderHeading: '.iwc-finder-heading',
            filterAppliedCount: '.iwc-finder-filters-count',
            filterAppliedNumber: '.iwc-finder-number'
        };

        this.cssClasses = {
            nonZeroNumber: 'iwc-finder-nonzero'
        };

        this.filterCollections = {
            collection: {},
            design: {},
            mechanism: {}
        };

        this.init();

    }

    /**
     * displayCount Display's count to the markup
     * @memberof iwc.comp.watchfinder.module.filterManager.FilterManager
     * @public
     */
    FilterManager.prototype.displayCount = function() {
        this.$header.find(this.selectors.filterAppliedNumber).text(this.count);

        this.$header
            .find(this.selectors.filterAppliedCount)
            .toggleClass(this.cssClasses.nonZeroNumber, (this.count > 0));
    };

    /**
     * collectionChange handler/observer of collection changes
     * @memberof iwc.comp.watchfinder.module.filterManager.FilterManager
     * @public
     */
    FilterManager.prototype.collectionChange = function(collectionData) {
        this.count = this.count + (collectionData.newCount - collectionData.oldCount);

        this.displayCount();

        this.selections = $.extend(this.selections, collectionData.values);

        this.selectionPruning();

        $.publish('iwc:watchfinder:filters:changed', [this.selections]);
    };

    /**
     * deSelectFilter a value in the list of a filter
     * @memberof iwc.comp.watchfinder.module.filterManager.FilterManager
     * @public
     * @param {string} filterId Identifier of a filter
     * @param {string} filterValueTag value to be deSelected
     */
    FilterManager.prototype.deSelectFilter = function(filterId, filterValueTag) {
        var collectionName = filterId.split('_')[0];
        this.filterCollections[collectionName].deSelectFilter(filterId, filterValueTag);
    };

    /**
     * selectFilter a value in the list of a filter
     * @memberof iwc.comp.watchfinder.module.filterManager.FilterManager
     * @public
     * @param {string} filterId Identifier of a filter
     * @param {string} filterValueTag value to be selected
     */
    FilterManager.prototype.selectFilter = function(filterId, filterValueTag) {
        var collectionName = filterId.split('_')[0];
        this.filterCollections[collectionName].selectFilter(filterId, filterValueTag);
    };

    /**
     * selectionPruning remove empty filters
     * @memberof iwc.comp.watchfinder.module.filterManager.FilterManager
     * @public
     */
    FilterManager.prototype.selectionPruning = function() {
        Object.keys(this.selections).forEach((function(key) {
            if (this.selections[key].values.length === 0) {
                delete this.selections[key];
            }
        }).bind(this));
    };


    /**
     * clear Reset all filter collections
     * @memberof iwc.comp.watchfinder.module.filterManager.FilterManager
     * @public
     */
    FilterManager.prototype.clear = function() {
        this.filterCollections.collection.clear();
        this.filterCollections.design.clear();
        this.filterCollections.mechanism.clear();
        this.count = 0;
        this.displayCount();
        this.selections = {};
        $.publish('iwc:watchfinder:filters:changed', [this.selections]);
    };

    /**
     * init Do filter manager setup
     * @memberof iwc.comp.watchfinder.module.filterManager.FilterManager
     * @public
     */
    FilterManager.prototype.init = function() {
        var $tab, $content,
            FilterCollection = iwc.comp.watchfinder.module.filterCollection;

        this.$header = this.$comp.find(this.selectors.finderHeading);

        $tab = this.$comp.find(this.selectors.collectionTab);
        $content = this.$comp.find(this.selectors.collectionContent);
        this.filterCollections.collection = new FilterCollection.init('collection', $tab, $content, this.collectionChange.bind(this));

        $tab = this.$comp.find(this.selectors.designTab);
        $content = this.$comp.find(this.selectors.designContent);
        this.filterCollections.design = new FilterCollection.init('design', $tab, $content, this.collectionChange.bind(this));

        $tab = this.$comp.find(this.selectors.mechanismTab);
        $content = this.$comp.find(this.selectors.mechanismContent);
        this.filterCollections.mechanism = new FilterCollection.init('mechanism', $tab, $content, this.collectionChange.bind(this));
    };

    /**
     * Filter Manager module
     * @namespace iwc.comp.watchfinder.module.filterManager
     * @memberof iwc.comp.watchfinder.module
     */
    iwc.comp.watchfinder.module.filterManager = (function() {

        /**
         * initialise watch finder
         * @public
         * @memberOf iwc.comp.watchfinder.module.filterManager
         * @param {jQuery} $comp the component
         */
        function init($comp) {
            return new FilterManager($comp);
        }

        return {
            init: init
        };

    })();

}(iwc.$));

/*global iwc*/

/**
 * Filter Collection module
 */

(function() {
    'use strict';

    /**
     * FilterCollection
     * @constructor
     * @memberof iwc.comp.watchfinder.module.filterCollection
     * @private
     * @param {string} name collection name
     * @param {jQuery} $tab element acting as head of the collection
     * @param {jQuery} $content element having collection's content i.e. filters
     * @param {function} collectionObserver callback
     */
    function FilterCollection(name, $tab, $content, collectionObserver) {
        this.name = name;
        this.$tab = $tab;
        this.$content = $content;
        this.count = 0;
        this.oldCount = 0;
        this.filters = [];
        this.selections = {};
        this.collectionObserver = collectionObserver;

        this.selectors = {
            filter: '.iwc-finder-filter',
            filterAppliedCount: '.iwc-finder-filters-count',
            filterAppliedNumber: '.iwc-finder-number'
        };

        this.cssClasses = {
            nonZeroNumber: 'iwc-finder-nonzero'
        };

        this.init();
    }

    /**
     * reportCollectionObserver send changed data to observer
     * @memberof iwc.comp.watchfinder.module.filterCollection.FilterCollection
     * @public
     */
    FilterCollection.prototype.reportCollectionObserver = function() {
        //TODO : a better approach to notify about the change
        var data = {};
        data.name = this.name;
        data.oldCount = this.oldCount;
        data.newCount = this.count;
        data.values = this.selections;
        this.collectionObserver(data);
    };

    /**
     * displayCount Display's count to the markup
     * @memberof iwc.comp.watchfinder.module.filterCollection.FilterCollection
     * @public
     */
    FilterCollection.prototype.displayCount = function() {
        this.$tab.find(this.selectors.filterAppliedNumber).text(this.count);

        this.$tab
            .find(this.selectors.filterAppliedCount)
            .toggleClass(this.cssClasses.nonZeroNumber, (this.count > 0));
    };

    /**
     * filterObserver handler/observer of filter changes
     * @memberof iwc.comp.watchfinder.module.filterCollection.FilterCollection
     * @public
     */
    FilterCollection.prototype.filterObserver = function(filterData) {
        this.oldCount = this.count;
        this.count = this.count + (filterData.newCount - filterData.oldCount);

        this.displayCount();

        this.selections[filterData.name] = {
            category: filterData.category,
            title: filterData.title,
            values: filterData.values
        };

        this.reportCollectionObserver();
    };

    /**
     * deSelectFilter a value in the list of a filter
     * @memberof iwc.comp.watchfinder.module.filterCollection.FilterCollection
     * @public
     * @param {string} filterId Identifier of a filter
     * @param {string} filterValueTag value to be deSelected
     */
    FilterCollection.prototype.deSelectFilter = function(filterId, filterValueTag) {
        var filterIndex = this.filters.findIndex(function(filter) {
                                return filter.name === filterId;
                            });
        this.filters[filterIndex].deSelect(filterValueTag);
    };

    /**
     * selectFilter a value in the list of a filter
     * @memberof iwc.comp.watchfinder.module.filterCollection.FilterCollection
     * @public
     * @param {string} filterId Identifier of a filter
     * @param {string} filterValueTag value to be deSelected
     */
    FilterCollection.prototype.selectFilter = function(filterId, filterValueTag) {
        var filterIndex = this.filters.findIndex(function(filter) {
                                return filter.name === filterId;
                            });
        this.filters[filterIndex].select(filterValueTag);
    };

    /**
     * clear Reset all filters in the collection
     * @memberof iwc.comp.watchfinder.module.filterCollection.FilterCollection
     * @public
     */
    FilterCollection.prototype.clear = function() {
        this.filters.forEach(function(filter) {
            filter.clear();
        });
        this.oldCount = this.count;
        this.count = 0;
        this.selections = {};

        this.displayCount();
    };

    /**
     * init Do collection setup
     * @memberof iwc.comp.watchfinder.module.filterCollection.FilterCollection
     * @public
     */
    FilterCollection.prototype.init = function() {
        var self = this,
            filterInstance = {},
            $filters = this.$content.find(this.selectors.filter),
            Filter = iwc.comp.watchfinder.module.filter,
            filterName = '';

        $filters.each(function(index) {
            filterName = self.name + '_filter' + index;
            filterInstance = new Filter.init(filterName , $filters.eq(index), self.filterObserver.bind(self));
            self.filters.push(filterInstance);
        });
    };


    /**
     * Filter Collection module
     * @namespace iwc.comp.watchfinder.module.filterCollection
     * @memberof iwc.comp.watchfinder.module
     */
    iwc.comp.watchfinder.module.filterCollection = (function() {

        /**
         * initialise filter collection
         * @public
         * @param {string} name collection name
         * @param {jQuery} $tab element acting as head of the collection
         * @param {jQuery} $content element having collection's content i.e. filters
         * @param {function} collectionObserver callback
         */
        function init(name, $tab, $content, collectionObserver) {
            return new FilterCollection(name, $tab, $content, collectionObserver);
        }

        return {
            init: init
        };

    })();

}(iwc.$));

/*global iwc*/

/**
 * Filter module
 */

(function($) {
    'use strict';

    /**
     * Filter
     * @constructor
     * @memberof iwc.comp.watchfinder.module.filter
     * @private
     * @param {jQuery} $comp filter component element
     * @param {function} filterObserver callback function
     */
    function Filter(name, $comp, filterObserver) {
        this.$comp = $comp;
        this.$title = {};
        this.category = '';
        this.title = '';
        this.name = name;
        this.observer = filterObserver;
        this.selections = [];
        this.oldCount = 0;
        this.count = 0;

        this.selectors = {
            filterAppliedCount: '.iwc-finder-filters-count',
            filterAppliedNumber: '.iwc-finder-number',
            filterOption: '.iwc-finder-filterlink',
            filterCategory: '[data-filter-category]',
            filterTitle: '.iwc-finder-filter-title',
            filterCheckbox: '.iwc-finder-checkbox'
        };

        this.cssClasses = {
            optionSelected: 'selected',
            nonZeroNumber: 'iwc-finder-nonzero'
        };

        this.init();
    }

    /**
     * displayCount Display's count to the markup
     * @memberof iwc.comp.watchfinder.module.filter.Filter
     * @public
     */
    Filter.prototype.displayCount = function() {
        this.$title.find(this.selectors.filterAppliedNumber).text(this.count);

        this.$title
            .find(this.selectors.filterAppliedCount)
            .toggleClass(this.cssClasses.nonZeroNumber, (this.count > 0));
    };

    /**
     * reportFilterObserver send changed data to observer
     * @memberof iwc.comp.watchfinder.module.filter.Filter
     * @public
     */
    Filter.prototype.reportFilterObserver = function() {
        var data = {};
        data.name = this.name;
        data.oldCount = this.oldCount;
        data.newCount = this.count;
        data.category = this.category;
        data.title = this.title;
        data.values = this.selections.slice();
        //TODO : a better approach to notify about the change
        this.observer(data);
    };

    /**
     * optionChanged event handler on selection of filter's options
     * @memberof iwc.comp.watchfinder.module.filter.Filter
     * @public
     * @param {event} event
     */
    Filter.prototype.optionChanged = function(event) {
        if (event.target.type !== 'checkbox' && (event.keyCode === 13 || event.keyCode === undefined)) {
            var $target = $(event.currentTarget);
            this.toggleSelection($target);
        }
    };

    /**
     * deSelect a value in the list
     * @memberof iwc.comp.watchfinder.module.filter.Filter
     * @public
     * @param {string} value to be deSelected
     */
    Filter.prototype.deSelect = function(filterValueTag) {
        var $target = this.$comp.find(this.selectors.filterOption + '[data-tag-id="' + filterValueTag + '"]');
        $target.find('checkbox').attr('checked', false);
        this.toggleSelection($target);
    };

    /**
     * select a value in the list
     * @memberof iwc.comp.watchfinder.module.filter.Filter
     * @public
     * @param {string} value to be selected
     */
    Filter.prototype.select = function(filterValueTag) {
        var $target = this.$comp.find(this.selectors.filterOption + '[data-tag-id="' + filterValueTag + '"]');
        $target.find('checkbox').attr('checked', true);
        this.toggleSelection($target);
    };

    /**
     * toggleSelection change the $target's selection
     * @memberof iwc.comp.watchfinder.module.filter.Filter
     * @public
     * @param {jQuery} $target whose selection to be changed
     */
    Filter.prototype.toggleSelection = function($target) {
        var optionValue = $target.data('tag-id'),
            optionText = $target.data('text'),
            isSelected = $target.hasClass(this.cssClasses.optionSelected),
            existingIndex = -1;

        this.oldCount = this.count;

        if (isSelected) {
            this.count--;
            $target.removeClass(this.cssClasses.optionSelected);
            existingIndex = this.selections.findIndex(function(selection) {
                                return selection.tag === optionValue;
                            });
            this.selections.splice(existingIndex, 1);
        } else {
            this.count++;
            $target.addClass(this.cssClasses.optionSelected);
            this.selections.push({
                tag: optionValue,
                text: optionText
            });
        }

        this.displayCount();
        this.reportFilterObserver();
    };


    /**
     * clear Reset filter options
     * @memberof iwc.comp.watchfinder.module.filter.Filter
     * @public
     */
    Filter.prototype.clear = function() {
        this.$comp
            .find(this.selectors.filterOption)
            .removeClass(this.cssClasses.optionSelected);
        this.oldCount = this.count;
        this.count = 0;
        this.selections = [];

        this.displayCount();
    };

    /**
     * init Do filter setup
     * @memberof iwc.comp.watchfinder.module.filter.Filter
     * @public
     */
    Filter.prototype.init = function() {
        var $filterWrapper = this.$comp.find(this.selectors.filterCategory);
        this.category = $filterWrapper.data('filter-category');
        this.title = $filterWrapper.data('filter-title');
        this.$title = this.$comp.find(this.selectors.filterTitle);

        this.$comp
            .find(this.selectors.filterOption)
            .on('click keydown', this.optionChanged.bind(this));
    };

    /**
     * Filter module
     * @namespace iwc.comp.watchfinder.module.filter
     * @memberof iwc.comp.watchfinder.module
     */
    iwc.comp.watchfinder.module.filter = (function() {

        /**
         * init initialise filter component
         * @public
         * @memberOf iwc.comp.watchfinder.module.filter
         * @param {string} name of the filter
         * @param {jQuery} $comp the component
         * @param {function} filterObserver callback
         */
        function init(name, $comp, filterObserver) {
            return new Filter(name, $comp, filterObserver);
        }

        return {
            init: init
        };

    })();

}(iwc.$));

/*global iwc, JSON*/

/**
 * Watchfinder Data Manager module
 */

(function($) {
    'use strict';

    /**
     * DataManager
     * @constructor
     * @memberof iwc.comp.watchfinder.module.dataManager
     * @private
     * @param {jQuery} $comp watchfinder component
     */
    function DataManager($comp) {
        this.$comp = $comp;
        this.productData = [];
        this.filteredData = [];

        this.selectors = {
            dataContainer: '.iwc-finder-data'
        };

        this.init();

    }

    /**
     * loadData reads productss JSON data
     * @memberof iwc.comp.watchfinder.module.dataManager.DataManager
     * @public
     */
    DataManager.prototype.loadData = function() {
        var dataString = this.$comp.find(this.selectors.dataContainer).text();
        try {
            this.productData = JSON.parse(dataString);
        } catch (err) {
            console.error(err);
            this.productData = [];
        }

    };

    /**
     * filterData filters the product data based on input filters
     * @memberof iwc.comp.watchfinder.module.dataManager.DataManager
     * @param {Object} filters combined object
     * @public
     * @returns {Array} list of products
     */
    DataManager.prototype.filterData = function(appliedFilters) {
        var self = this,
            partialData = this.productData;
        $.each(appliedFilters, function(key, appliedFilter) {
            var filterCategory = appliedFilter.category;

            partialData = partialData.filter(function(product) {
                if (!product[filterCategory]) {
                    return false;
                }

                return self.isAnyFilterValueApply(appliedFilter.values, product[filterCategory]);
            });
        });
        this.filteredData = partialData;
        return this.filteredData;
    };

    /**
     * isAnyFilterValueApply Check if any filter value is present in a product's properties
     * @memberof iwc.comp.watchfinder.module.dataManager.DataManager
     * @param {Array} filterValues having values to search
     * @param {Array} productValues values to search in
     * @public
     * @returns {boolean}
     */
    DataManager.prototype.isAnyFilterValueApply = function(filterValues, productValues) {
        return filterValues.some(function(filterValue) {
            return productValues.indexOf(filterValue.tag) > -1;
        });
    };


    /**
     * filterDataByRef filters the product data for reference number only
     * @memberof iwc.comp.watchfinder.module.dataManager.DataManager
     * @param {string} reference number
     * @public
     * @returns {Array} list of products
     */
    DataManager.prototype.filterDataByRef = function(refNumber) {
        return this.productData.filter(function(product) {
            return product.REFERENCE[0] && product.REFERENCE[0].toLowerCase().indexOf(refNumber) > -1;
        });
    };

    /**
     * filterDataByRefAndTitle filters the product data for reference number and title
     * @memberof iwc.comp.watchfinder.module.dataManager.DataManager
     * @param {string} input string to search
     * @public
     * @returns {Array} list of products
     */
    DataManager.prototype.filterDataByRefAndTitle = function(searchInput) {
        return this.productData.filter(function(product) {
            return (product.REFERENCE[0] && product.REFERENCE[0].toLowerCase().indexOf(searchInput) > -1) ||
                    (product.TITLE[0] && product.TITLE[0].toLowerCase().indexOf(searchInput) > -1);
        });
    };

    /**
     * init Do filter manager setup
     * @memberof iwc.comp.watchfinder.module.dataManager.DataManager
     * @public
     */
    DataManager.prototype.init = function() {
        this.loadData();
    };

    /**
     * Filter Manager module
     * @namespace iwc.comp.watchfinder.module.dataManager
     * @memberof iwc.comp.watchfinder.module
     */
    iwc.comp.watchfinder.module.dataManager = (function() {

        /**
         * initialise watch finder
         * @public
         * @memberOf iwc.comp.watchfinder.module.dataManager
         * @param {jQuery} $comp the component
         */
        function init($comp) {
            return new DataManager($comp);
        }

        return {
            init: init
        };

    })();

}(iwc.$));

/*global iwc, JSON*/

/**
 * Watchfinder Deep link utility
 * Note: This utility may be modified to become global utility.
 */

(function() {
    'use strict';

    /**
     * Watch finder's deep link utility
     * @namespace iwc.comp.watchfinder.utility.deeplink
     * @memberof iwc.comp.watchfinder.utility
     */
    iwc.comp.watchfinder.utility.deeplink = (function($) {

        var $window = $(window);

        /**
         * informHashChange publish hash change
         * @memberof iwc.comp.watchfinder.utility
         * @public
         */
        function informHashChange() {
            $.publish('iwc:watchfinder:hash:changed');
        }

        /**
         * set
         * @memberof iwc.comp.watchfinder.utility
         * @public
         * @param {Object} object to be stored
         */
        function set(object) {
            var objectString = JSON.stringify(object),
            encodedObjectString = encodeURIComponent(objectString);
            $window.off('hashchange');
            document.location.hash = encodedObjectString;
            window.setTimeout(function() {
                $window.on('hashchange', informHashChange);
            }, 0);

        }

        /**
         * get
         * @memberof iwc.comp.watchfinder.utility
         * @public
         * @returns {Object} object retreived
         */
        function get() {
            var hashValue = document.location.hash.substr(1),
            decodedString = '',
            hashObject = {};
            if (hashValue) {
                try {
                    decodedString = decodeURIComponent(hashValue);
                    hashObject = JSON.parse(decodedString);
                } catch (err) {
                    console.error(err);
                }
            }
            return hashObject;
        }

        /**
         * init initialise deeplink utility to listen changes in hash value
         * @memberof iwc.comp.watchfinder.utility
         * @public
         */
        function init() {
            $window.on('hashchange', informHashChange);
        }

        return {
            set: set,
            get: get,
            init: init
        };

    })(iwc.$);

}());

/*global iwc, base */
/**
 * Change Boutique Map component
 */
(function() {
    'use strict';

    /*
     * Change boutique map component
     * @namespace changeboutique
     * @memberof iwc.comp
     */
    iwc.comp.changeboutique = (function($, util) {

        var $body,
            $overlay,
            $component,
            $mapWrapper,
            $cancelBtn,
            $infoWindowTemplate,
            $changeMessage,
            selectors = {
                overlay: '.iwc-lightbox-content',
                component: '.iwc-changebtq',
                mapWrapper: '.iwc-changebtq-map',
                cancelBtn: '.iwc-changebtq-cancel',
                infoWindowTemplate: '.iwc-changebtq-tmpl-marker-infowindow',
                selectBtn: '.iwc-changebtq-btn',
                changeMessage: '.iwc-changebtq-message',
                preferredBoutiqueComponent: '.iwc-pref-btq',
                openingTime: '.iwc-changebtq-time'
            },
            cssClass = {
                changeboutique: 'iwc-change-boutique',
                hide: 'iwc-hidden',
                error: 'iwc-error',
                success: 'iwc-success',
                expanded: 'iwc-expanded'
            },
            boutiques,
            useMapMarker = util.mapOptions.config.markerIconImage,
            map,
            $markers = [],
            markerlatlng,
            $infowindow = [],
            $openedInfoWindow,
            boutiqueId,
            defaultZoom,
            defaultLat = util.mapOptions.config.map.defaultLat,
            defaultLng = util.mapOptions.config.map.defaultLng;

        /**
         * Close infowindow
         * @function closeInfoWindow
         * @private
         * @memberOf iwc.comp.changeboutique
         */
        function closeInfoWindow() {
            if ($openedInfoWindow) {
                $openedInfoWindow.close();
            }
        }

        /**
         * Open infowindow
         * @function openInfoWindow
         * @private
         * @param {Object} target marker
         * @memberOf iwc.comp.changeboutique
         */
        function openInfoWindow(target) {
            closeInfoWindow();
            $infowindow[target.id].open(map, target);
            map.setCenter(target.getPosition());
            map.setZoom(util.mapOptions.config.map.zoomForInfoWindow);
            $openedInfoWindow = $infowindow[target.id];
        }

        /**
         * Load map showing all boutiques pins
         * @function loadwMap
         * @private
         * @memberOf iwc.comp.changeboutique
         */
        function loadMap() {
            base.util.googlemaps.loadGoogleMaps(function() {
                if (util.matchmedia.narrow.matches) {
                    defaultZoom = util.mapOptions.config.map.defaultZoomMobile;
                } else {
                    defaultZoom = util.mapOptions.config.map.defaultZoom;
                }

                var latLng = new window.google.maps.LatLng(defaultLat, defaultLng),
                    mapOptions = {
                        zoom: defaultZoom,
                        center: latLng,
                        scrollwheel: false,
                        mapTypeControl: false,
                        streetViewControl: false,
                        mapTypeId: window.google.maps.MapTypeId.ROADMAP
                    };
                map = new window.google.maps.Map($(selectors.mapWrapper)[0], mapOptions);
                map.setOptions({
                    styles: util.mapOptions.config.map.type.defaultStyles
                });

                $.each(boutiques, function(i) {
                    markerlatlng = new window.google.maps.LatLng(boutiques[i].location.latitude, boutiques[i].location.longitude);

                    var openingHoursItems = '';
                    $.each(boutiques[i].openingHours, function(i, val) {
                        openingHoursItems += ('<dd class="iwc-changebtq-opening-time">' + val.dayOfWeek + ': ' + val.openingTime + ' - ' + val.closingTime + '</dd>');
                    });

                    var infowindow = new window.google.maps.InfoWindow({
                            id: i,
                            maxWidth: 250
                        }),
                        contentString = $infoWindowTemplate.html()
                            .replace('{{id}}', boutiques[i].id)
                            .replace(/{{name}}/g, boutiques[i].name)
                            .replace('{{street}}', boutiques[i].address.street || '')
                            .replace('{{city}}', boutiques[i].address.city || '')
                            .replace('{{zip}}', boutiques[i].address.zipCode || '')
                            .replace('{{country}}', boutiques[i].address.state || boutiques[i].address.country || '')
                            .replace('{{phone}}', boutiques[i].phoneNumber || '')
                            .replace('{{latitude}}', boutiques[i].location.latitude)
                            .replace('{{longitude}}', boutiques[i].location.longitude)
                            .replace('{{openingHours}}', openingHoursItems || '')
                            .trim(),
                        markers = new window.google.maps.Marker({
                            id: i,
                            position: markerlatlng,
                            map: map,
                            icon: useMapMarker
                        });

                    infowindow.setContent(contentString);
                    $markers[i] = markers;
                    $infowindow[i] = infowindow;

                    // bind marker click event, to open infoWindow
                    window.google.maps.event.addListener($markers[i], 'click', (function($target) {
                        return function() {
                            openInfoWindow($target);
                        };
                    })($markers[i]));
                });
                // map click handler
                window.google.maps.event.addDomListener(map, 'click', closeInfoWindow);
            });
        }

        /**
         * Close lightbox
         * @function closeLightBox
         * @private
         * @memberOf iwc.comp.changeboutique
         */
        function closeLightBox() {
            util.lightbox.closeLightbox();
        }

        /**
         * show feedback message for success case
         * @function showSuccess
         * @private
         * @memberOf iwc.comp.changeboutique
         */
        function showSuccess() {
            $changeMessage.addClass(cssClass.success).removeClass(cssClass.hide);
            if ($body.find(selectors.preferredBoutiqueComponent).length) {
                iwc.comp.preferredboutique.update(boutiqueId);
                util.ajaxloader.hide();
                closeLightBox();
            } else {
                window.location.reload();
            }
        }

        /**
         * show feedback message for error case
         * @function showError
         * @private
         * @param {Object} data ajax response
         * @memberOf iwc.comp.changeboutique
         */
        function showError(data) {
            $changeMessage.addClass(cssClass.error).removeClass(cssClass.hide).text(data.values.errorMessage);
            util.ajaxloader.hide();
        }

        /**
         * Set Boutique callback function for success
         * @function setBoutiqueSuccess
         * @private
         * @param {Object} data ajax response
         * @memberOf iwc.comp.changeboutique
         */
        function setBoutiqueSuccess(data) {
            if (data) {
                data.status.toLowerCase() === 'success' ? showSuccess() : showError(data);
            }
        }

        /**
         * Set Boutique callback function for error
         * @function setBoutiqueError
         * @private
         * @memberOf iwc.comp.changeboutique
         */
        function setBoutiqueError() {
            var errorMessage = util.formError.getdefault();
            $changeMessage.html(errorMessage).addClass(cssClass.error).removeClass(cssClass.hide);
            util.ajaxloader.hide();
        }

        /**
         * Set Boutique function
         * @function setBoutique
         * @private
         * @param {Object} e event
         * @memberOf iwc.comp.changeboutique
         */
        function setBoutique(e) {
            util.ajaxloader.show();
            var $target = $(e.currentTarget),
                setBoutiqueUrl = util.dataStore.getCurrentPagePath() + '.update-boutique.json?cacheburst=' + new Date().getTime();
            boutiqueId = $target.data('id');
            $.post(setBoutiqueUrl, { boutiqueId: boutiqueId })
                .done(setBoutiqueSuccess)
                .fail(setBoutiqueError);
        }

        /**
         * Toggle Opening Hours
         * @function toggleOpeningHours
         * @private
         * @memberOf iwc.comp.changeboutique
         */
        function toggleOpeningHours() {
            $component.find(selectors.openingTime).toggleClass(cssClass.expanded);
        }

        /**
         * Destroy changeboutique
         * @function destroy
         * @public
         * @param {HTMLObject} pageName
         * @memberOf iwc.comp.changeboutique
         */
        function destroy(pageName) {
            if (pageName === name) {
                $.each([$component, $mapWrapper, $cancelBtn], function(index, item) {
                    item = null;
                });
            }
        }

        /**
         * Bind Events
         * @function bindEvents
         * @private
         * @memberOf iwc.comp.changeboutique
         */
        function bindEvents() {
            $cancelBtn.on('click', closeLightBox);
            $component.on('click', selectors.selectBtn, setBoutique);
            $component.on('click', selectors.openingTime, toggleOpeningHours);
        }

        /**
         * Initialize Change Boutique component
         * @function init
         * @public
         * @memberOf iwc.comp.changeboutique
         */
        function init() {
            $body = $('body');
            $overlay = $(selectors.overlay);
            $component = $overlay.find(selectors.component);
            $mapWrapper = $overlay.find(selectors.mapWrapper);
            $cancelBtn = $overlay.find(selectors.cancelBtn);
            $infoWindowTemplate = $overlay.find(selectors.infoWindowTemplate);
            $changeMessage = $overlay.find(selectors.changeMessage);
            $body.addClass(cssClass.changeboutique);
            // set boutique data and load map
            util.dataStore.getBoutiqueData().then(function(response) {
                boutiques = response;
                loadMap();
            });

            bindEvents();

            $.subscribe('iwc:lightbox:close', destroy);
        }

        return {
            init: init
        };

    })(iwc.$, iwc.util, base);
}());

/*global iwc*/
/**
 * Teaser component js
 */

(function($, util) {
    'use strict';

    /**
     * Constructor for Teaser
     * @memberof iwc.comp
     * @private
     * @constructor
     * @param {HTMLElement} elem Teaser element
     * @param {string} name user for binding data
     */
    var Teaser = function(elem, name) {

        this.$elem = $(elem);
        this.name = name;
        this.slideNo = 0;
        this.duration = parseInt(this.$elem.data('teaser-duration'), 10) || 10000;
        this.selectors = {
            slider: '.iwc-teaser-carousel',
            slides: '.iwc-teaser-carousel-container',
            carouselBtn: '.iwc-teaser-btn',
            teaserControls: '.iwc-teaser-controls',
            teaserButton: '.iwc-teaser-btn',
            indicator: '.iwc-slide-indicator',
            videoEl: '.iwc-responsive-video-js'
        };
        this.currentText = this.$elem.find(this.selectors.teaserControls).data('currentitem-text') || '';
        this.cssClass = {
            slickInit: 'slick-initialized',
            indicator: 'loader',
            selected: 'selected',
            hide: 'iwc-hidden'
        };

        this.init.apply(this);
    };

    Teaser.prototype = {
        /**
         * Reset animation
         * @function resetIndicator
         * @private
         * @memberOf iwc.comp.teaser
         */
        resetIndicator: function() {
            // bail out if progress bar is hidden
            if (this.$indicator.hasClass(this.cssClass.hide)) {
                return;
            }

            this.$indicator.css('width', 0);
            this.$indicator.animate({
                width: '100%'
            },
            {
                queue: false,
                duration: this.duration,
                easing: 'linear'
            });
        },
        /**
         * Handler for slide change
         * @function clickChangeSlide
         * @param {object} e event object
         * @private
         * @memberOf iwc.comp.teaser
         */
        clickChangeSlide: function(e) {
            var $target = $(e.target);
            e.preventDefault();
            e.stopPropagation();

            this.slideNo = this.$teaserButton.filter($target).index() - 1;
            this.updatePaging();
        },
        /**
         * Highlight pager and update carousel slide
         * @function updatePaging
         * @return {[type]} [description]
         */
        updatePaging: function() {

            this.resetIndicator();

            this.$teaserButton
            .removeClass(this.cssClass.selected)
            .attr('aria-selected', false)
            .find('span').text('');

            this.$teaserButton.eq(this.slideNo)
            .addClass(this.cssClass.selected)
            .attr('aria-selected', true)
            .find('span').text(this.currentText);

            if (this.$teaser.hasClass(this.cssClass.slickInit) && this.$teaser.slick('slickCurrentSlide') !== this.slideNo) {
                this.$teaser.slick('slickGoTo', this.slideNo);
            }
        },
        /**
         * Bind Teaser specific events
         * bindEvents
         * @private
         * @memberOf iwc.comp.teaser
         */
        bindEvents: function() {
            var self = this;
            this.$teaser
            .on('init', function() {
                self.resetIndicator();
                self.$teaserButton.eq(0).addClass(self.cssClass.selected).attr('aria-selected', true).find('span').text(self.currentText);
            })
            .slick({
                infinite: true,
                autoplay: true,
                autoplaySpeed: this.duration,
                slidesToShow: 1,
                arrows: false,
                pauseOnHover: false,
                pauseOnFocus: false
            })
            .on('afterChange', function(event, slick, currentSlide) {
                self.slideNo = currentSlide;
                self.updatePaging();
                util.lazyLoadImage.checkImages();
                util.videoPlayer.playVisible();
                $(window).trigger('scroll.videojs');
            });
            this.$teaserButton.on('click.' + this.name, this.clickChangeSlide.bind(this));
        },
        /**
         * Initialise Teaser
         * @memberOf iwc.comp.teaser
         */
        init: function() {
            this.$teaser = this.$elem.find(this.selectors.slider);
            this.$teaserSlides = this.$teaser.find(this.selectors.slides);
            this.$controls = this.$elem.find(this.selectors.teaserControls);
            this.$teaserButton = this.$controls.find(this.selectors.teaserButton);
            this.$indicator = this.$controls.find(this.selectors.indicator);
            // hide progress bar if only 1 slide
            if (this.$teaserSlides.length < 2) {
                this.$indicator.addClass(this.cssClass.hide);
            }

            util.animatable.init();
            util.scroll.init();
            util.lazyLoadImage.checkImages();

            this.bindEvents();
        }
    };

    /**
     * Initialise a Teaser
     * @memberOf iwc.comp
     */
    iwc.comp.teaser = (function() {
        var name = 'teaser';
        /**
         * Provides an instance of Teaser
         * @public
         * @param {HTMLElement} elem
         * @param {string} name for binding events
         * @return {Object} an instance of Teaser
         * @memberOf iwc.comp.teaser
         */
        function init(elem) {
            return new Teaser(elem, name);
        }

        return {
            init: init
        };

    })();
}(iwc.$, iwc.util));

/*global iwc, JSON*/
/**
 * functionality for the nearest boutique
 */

(function() {
    'use strict';

    /*
     * Preferred boutique component
     * @namespace nearestboutique
     * @memberof iwc.comp
     */
    iwc.comp.nearestboutique = (function($, util) {
        var selectors = {
                nearestBoutiqueTemplate: '.nearest-boutique-template',
                address: '.iwc-boutique-address',
                appointment: '.iwc-nearest-boutique-appointment',
                nav: '.iwc-navigationlinks',
                menu: '[data-menu=menu]',
                megaMenu: '[data-menu=iwc-mega-menu]'
            },
            cssClass = {
                hide: 'iwc-hidden',
                navhide: 'iwc-menu-nav-hide',
                active: 'active ',
                useBaidu: 'iwc-use-baidu'
            },
            $body = $('body'),
            $nearestBoutique,
            $boutiqueTemplate,
            $nav,
            userLocationLat,
            userLocationLng,
            boutiqueData = [],
            nearestBoutiqueData = [],
            singleBoutiqueData,
            targetBoutiqueId,
            isBaidu = $body.hasClass(cssClass.useBaidu);

        /**
         * Getting specific boutique data [e.g. boutique id]
         * @function updateBoutiqueData
         * @private
         * @param {number} boutiqueId Boutique id
         * @memberOf iwc.comp.preferredboutique
         */
        function getSpecificBoutiqueData(boutiqueId) {
            for (var i = 0; i < boutiqueData.length; i++) {
                if (parseInt(boutiqueData[i].id, 10) === parseInt(boutiqueId, 10)) {
                    singleBoutiqueData = boutiqueData[i];
                    return singleBoutiqueData;
                }
            }
        }

        /**
         * set nearest/preferred boutique data
         * @function setBoutiqueData
         * @private
         * @param {data} data Nearest boutique/preferred boutique
         * @param {$boutique} current instance of component
         * @memberOf iwc.comp.nearestboutique
         */
        function setBoutiqueData($boutique, data) {
            if (data) {
                var boutiqueFinderPath = $body.data('boutiqueFinderPath'),
                    boutiqueTpl = $boutiqueTemplate.html()
                                .replace('{{ name }}', data.name)
                                .replace('{{ street }}', data.address.street)
                                .replace('{{ city }}', data.address.city)
                                .replace('{{ zipCode }}', data.address.zipCode)
                                .replace(/{{ boutiqueFinderPath }}/g, boutiqueFinderPath)
                                .replace('{{ country }}', data.address.country);

                $boutique.find(selectors.address).html(boutiqueTpl);

                targetBoutiqueId = data.id;
            }
        }
        /**
         * Execute when location getting is success
         * @function geoSuccess
         * @private
         * @param {Object} browser position
         * @param {$boutique} current instance of component
         * @memberOf iwc.comp.nearestBoutique
         */

        /*function geoSuccess(position, $boutique) {
            userLocationLat = position.coords.latitude;
            userLocationLng = position.coords.longitude;
            nearestBoutiqueData = util.userlocation.nearestBoutique(userLocationLat, userLocationLng, boutiqueData);
            setBoutiqueData($boutique, nearestBoutiqueData);
            util.webstorage.set('storeData', JSON.stringify(nearestBoutiqueData));
        }*/

        /**
         * Get user's location using HTML Geo Location
         * @function useHTMLGeoLocation
         * @private
         * @memberOf iwc.comp.nearestBoutique
         * @param {$boutique} current instance of component
         */

        /*function useHTMLGeoLocation($boutique) {
            if ('geolocation' in navigator) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    geoSuccess(position, $boutique);
                });
            }
        }*/



        /**
         * mapBoutiqueId
         * For a list of boutique id, method provides list of corresponding boutique data
         * @private
         * @memberOf iwc.comp.buyingoptions
         * @param  {Array} boutiqueIdList
         * @param  {Array} boutiqueData list of all boutique data
         * @returns {Array} list of boutique data respective to boutiqueIdList
         */
        function mapBoutiqueId(boutiqueIdList, boutiqueData) {
            return boutiqueIdList.map(function(boutiqueId) {
                        var boutiqueIndex = boutiqueData.findIndex(function(data) { return data.id === boutiqueId;});
                        return (boutiqueIndex > -1) ? boutiqueData[boutiqueIndex] : undefined;
                    }).filter(function(data) {
                        return !!data;
                    });
        }
        /**
         * showBoutiqueId
         * Works to show a boutique's data for provided a boutique id
         * @private
         * @memberOf iwc.comp.nearestBoutique
         * @param {string} boutiqueId
         * @param {$boutique} current instance of component
         */
        function showBoutiqueId($boutique, boutiqueId) {
            util.dataStore.getBoutiqueData().done(function(boutiqueData) {
                var boutiqueIdString = boutiqueId && boutiqueId.toString(),
                    mappedBoutiqueData = mapBoutiqueId([boutiqueIdString], boutiqueData);
                setBoutiqueData($boutique, mappedBoutiqueData[0]);
            });
        }
        /**
         * showFlagshipBoutique
         * @private
         * @param {$boutique} current instance of component
         * @memberOf iwc.comp.nearestBoutique
         */
        function showFlagshipBoutique($boutique) {
            var flagshipBoutiqueId = $nearestBoutique.data('flagship-boutique');
            showBoutiqueId($boutique, flagshipBoutiqueId);
        }


        /**
         * Get user's location
         * @function getUserLocation
         * @private
         * @memberOf iwc.comp.nearestBoutique
         * @param {$boutique} current instance of component
         */
        function getUserLocation($boutique) {
            if (!isBaidu) {
                util.userlocation.get().done(function(response) {
                    userLocationLat = response.latitude;
                    userLocationLng = response.longitude;
                    nearestBoutiqueData = util.userlocation.nearestBoutique(userLocationLat, userLocationLng, boutiqueData);
                    setBoutiqueData($boutique, nearestBoutiqueData);
                    // set session storage for limiting network hits
                    util.webstorage.set('storeData', JSON.stringify(nearestBoutiqueData));
                }).fail(function() {
                    $boutique.addClass(cssClass.hide);
                });
            } else {

                /* Since iOS is not supporting HTML Geolocation API
                 * Using flagship boutique for China
                 * Hiding it for now
                 * useHTMLGeoLocation($boutique);
                 */
                showFlagshipBoutique($boutique);
            }
        }

        /**
         * Passing object to set data into template
         * based on condition if perferred boutique has value.
         * @function updateNearestBoutique
         * @private
         * @memberOf iwc.comp.nearestBoutique
         * @param {$boutique} current instance of component
         */
        function updateNearestBoutique($boutique) {
            // TODO: uncomment the code below to show peferred boutique (if available)
            // iwc.comp.account.customerDetailsData().done(function(data) {
            //     var preferredBoutiqueId = data.values.customerDetails.preferredBoutique,
            // As per IWCE-7476, preffered boutique functionality is removed.
            /*iwc.comp.account.customerDetailsData().done(function() {
                var preferredBoutiqueId = null,
                    boutiqueToDisplay;
                if (preferredBoutiqueId) {
                    boutiqueToDisplay = getSpecificBoutiqueData(preferredBoutiqueId);
                    setBoutiqueData($boutique, boutiqueToDisplay);
                } else {
                    getUserLocation($boutique);
                }
            });*/
            getUserLocation($boutique);
        }

        /**
         * Open appointment form in lightbox
         * @function openAppointmentForm
         * @private
         * @memberOf iwc.comp.nearestBoutique
         * @param {Object} e Event object
         */
        function openAppointmentForm(e) {
            e.preventDefault();
            e.stopImmediatePropagation();
            var targetUrl = e.currentTarget + targetBoutiqueId,
                $targetBtn = $(e.currentTarget);
            util.lightbox.openUrlInLightbox(targetUrl, $targetBtn);
            $nav.find(selectors.megaMenu).addClass(cssClass.navhide);
            $nav.find(selectors.menu).removeClass(cssClass.active);
            // Tracking
            util.tracking.publish($targetBtn);
        }

        /**
         * Bind Events
         * @function bindEvents
         * @private
         * @memberOf iwc.comp.nearestBoutique
         */
        function bindEvents() {
            $(selectors.appointment).on('click', openAppointmentForm);
        }

        /**
         * Initialise a nearestBoutique element
         * @function init
         * @public
         * @memberOf iwc.comp.nearestBoutique
         * @param {HTMLElement} elem element
         */
        function init(elem) {
            $nearestBoutique = $(elem);
            $nav = $(selectors.nav);
            $boutiqueTemplate = $nearestBoutique.find(selectors.nearestBoutiqueTemplate);

            // extracting boutique data and user location to find out nearest boutique if not available.
            if (!('storeData' in util.webstorage.storage())) {
                util.dataStore.getBoutiqueData().done((function($boutique, response) {
                    boutiqueData = response;
                    updateNearestBoutique($boutique);
                }).bind(undefined, $nearestBoutique));
            } else {
                setBoutiqueData($nearestBoutique, JSON.parse(util.webstorage.get('storeData')));
            }
            bindEvents();
        }

        return {
            init: init
        };
    })(iwc.$, iwc.util);
}());

/*global iwc, base*/
/**
 * Boutique appointment component js
 */

(function() {
    'use strict';

    /**
     * Boutique appointment component
     * @namespace appointment
     * @memberof iwc.comp
     */
    iwc.comp.appointment = (function($, util) {

        var selectors = {
            overlay: '.iwc-lightbox-content',
            appointment: '.iwc-appointment',
            confirm: '.iwc-appointment-confirm',
            formWrapper: '.iwc-appointment-form',
            close: '.iwc-appointment-close',
            emailContainer: '.iwc-appointment-confirm-email',
            emailElement: 'input[name="email"]',
            cancel: 'input[type="reset"]',
            formsConfirmation: '.base-forms-confirmation',
            appointmentLabel: '.label_preferredDate',
            appointmentDate: '.base-forms-datepicker',
            captchaWrapper: '.base-recaptchav2',
            aemCaptchaWrapper: '.base-aemcaptcha'
        },
        cssClass = {
            hide: 'iwc-hidden',
            appointmentOpened: 'iwc-appointment-open'
        },
        $overlay,
        $body,
        $form,
        $email,
        $formWrapper,
        $appointment,
        $confirm,
        $appointmentLabel,
        $appointmentDate,
        $emailContainer,
        $captchaWrapper,
        $aemCaptchaWrapper;

        /**
         * showConfirmation
         * @function showConfirmation
         * @private
         * @param {Object} form Form element
         * @param {boolean} success Response true/false
         * @memberof iwc.comp.appointment
         */
        function showConfirmation(form, success) {
            $email = $(form).find(selectors.emailElement);
            $emailContainer = $confirm.find(selectors.emailContainer);
            if (success) {
                $emailContainer.html($email.val());
                $formWrapper.addClass(cssClass.hide);
                $confirm.removeClass(cssClass.hide);
                // Tracking
                var appointmentString = $formWrapper.find(selectors.formsConfirmation).text(),
                    appointmentTemplate = $.parseHTML(appointmentString),
                    appointmentId = $(appointmentTemplate[0]).data('trackingRcms_appointmentid'),
                    dataToPush = {
                        'event': 'boutiqueAppointment',
                        'rcms_appointmentId': appointmentId
                    };
                util.tracking.iwcCustomTracking(dataToPush);
            }
        }

        /**
         * Destroy appointment
         * @function destroy
         * @public
         * @param {string} pageName
         * @memberOf iwc.comp.appointment
         */
        function destroy(pageName) {

            if (pageName === name) {

                $.each([$appointment, $form], function(index, item) {
                    item = null;
                });

                $form.off('submit.' + name);
                $.unsubscribe('iwc:forms:reinit');
                $.unsubscribe('iwc:lightbox:close');
            }
            $body.removeClass(cssClass.appointmentOpened);
        }

        /**
         * Form reinit
         * @function formInitHandler
         * @private
         * @param {Object} form Form element
         * @param {boolean} success Response true/false
         * @memberOf iwc.comp.appointment
         */
        function formInitHandler(form, success) {
            iwc.comp.forms.init($(form));
            showConfirmation(form, success);
            iwc.util.formsAnimation.reInit($overlay);
            base.comp.formfield.countryDropdown.init($appointment);
            base.comp.captcha.captcha.init();

            // condition applied for dropping two captcha on a form, only one will be rendered.
            if (!$aemCaptchaWrapper.length && $captchaWrapper.length) {
                base.comp.captcha.recaptchav2.init($captchaWrapper);
            }
        }

        /**
         * Bind events
         * @function bindEvents
         * @private
         * @memberOf iwc.comp.appointment
        */
        function bindEvents() {
            $appointment.on('click', selectors.close + ' , ' + selectors.cancel, util.lightbox.closeLightbox);
            $appointmentLabel.on('click', function() {
                $appointmentDate.trigger('focus');
            });
        }

        /**
         * initialise appointment component
         * @function init
         * @public
         * @memberOf iwc.comp.appointment
         */
        function init() {
            $body = $('body');
            $overlay = $(selectors.overlay);
            $appointment = $overlay.find(selectors.appointment).length > 0 ? $overlay.find(selectors.appointment) : $body.find(selectors.appointment);
            $confirm = $overlay.find(selectors.confirm).length > 0 ? $overlay.find(selectors.confirm) : $body.find(selectors.confirm);
            $formWrapper = $overlay.find(selectors.formWrapper).length > 0 ? $overlay.find(selectors.formWrapper) : $body.find(selectors.formWrapper);
            $appointmentLabel = $appointment.find(selectors.appointmentLabel);
            $appointmentDate = $appointment.find(selectors.appointmentDate);
            $captchaWrapper = $appointment.find(selectors.captchaWrapper);
            $aemCaptchaWrapper = $appointment.find(selectors.aemCaptchaWrapper);
            //appointment form
            $form = $appointment.find('form');
            $body.addClass(cssClass.appointmentOpened);
            //intialise form
            iwc.comp.forms.init($form);
            util.formsAnimation.reInit($overlay);
            util.lightbox.reInit($overlay);
            base.comp.formfield.countryDropdown.init($appointment);
            // captcha 1 call disabled.
            // base.comp.captcha.captcha.init();

            if ($aemCaptchaWrapper.length) {
                base.comp.captcha.aemCaptcha.init($aemCaptchaWrapper);
            }
            // condition applied for dropping two captcha on a form, only one will be rendered.
            if (!$aemCaptchaWrapper.length && $captchaWrapper.length) {
                base.comp.captcha.recaptchav2.init($captchaWrapper);
            }
            bindEvents();
            $.subscribe('iwc:forms:reinit', formInitHandler);
            $.subscribe('iwc:lightbox:close', destroy);
        }

        return {
            init: init
        };
    })(iwc.$, iwc.util, base);
}());

/*global iwc*/
/**
 * functionality for the contact concierge component
 */

(function() {
    'use strict';

    /*
     * contact concierge component
     * @namespace contactconcierge
     * @memberof iwc.comp
     */
    iwc.comp.contactconcierge = (function($) {
        var selectors = {
                countryDrpDwn: '.iwc-contact-concierge-country',
                phoneElement: '.iwc-contact-concierge-phone',
                whatsappElement: '.iwc-contact-concierge-whatsapp',
                contactControlSection: '.iwc-contact-concierge-controls',
                dataLabel: '.iwc-contact-concierge-data-label',
                countryTimings : '.iwc-contact-concierge-timings',
                dummyOption: '.iwc-contact-concierge-option-dummy',
                dummyCountry : '.iwc-contact-concierge-country-dummy'
            },
            cssClass = {
                hide: 'iwc-hidden'
            };

        /*
         * Update the values based on country dropdown
         * @memberOf iwc.comp.contactconcierge
         * @param {HTMLElement} $contactconcierge current section
         * @param {jQuery} $currentDropdown current country dropdown
         * @function updateConcierge
         */
        function updateConcierge($contactconcierge, $currentDropdown) {
            var phoneNumber = $currentDropdown.find(':selected').data('phone'),
            whatsappNumber = $currentDropdown.find(':selected').data('whatsapp'),
            countryCode = $currentDropdown.find(':selected').val(),
            selectedOptText = $currentDropdown.eq(0).find(':selected').text(),
            whatsappUrl = 'intent://send/' + whatsappNumber + '#Intent;scheme=smsto;package=com.whatsapp;action=android.intent.action.SENDTO;end';

            $contactconcierge.find(selectors.dummyOption).html(selectedOptText);
            setTimeout(function() {
                $currentDropdown.width($contactconcierge.find(selectors.dummyCountry).width() + 4);
            }, 0);
            $contactconcierge.find(selectors.countryTimings).addClass(cssClass.hide);
            $contactconcierge.find('[data-country=' + countryCode + ']').removeClass(cssClass.hide);

            $contactconcierge.find(selectors.phoneElement).attr('href', 'tel:' + phoneNumber);
            $contactconcierge.find(selectors.phoneElement).find(selectors.dataLabel).text(phoneNumber);

            $contactconcierge.find(selectors.whatsappElement).attr('href', whatsappUrl);
            $contactconcierge.find(selectors.whatsappElement).find(selectors.dataLabel).text(whatsappNumber);
        }

        /**
         * Initialise a contact concierge element.
         * @memberOf iwc.comp.contactconcierge
         * @param {HTMLElement} element
         * @public
         */
        function init(element) {
            var $contactconcierge = $(element),
            $countryDrpDwn = $contactconcierge.find(selectors.countryDrpDwn);

            updateConcierge($contactconcierge, $countryDrpDwn);

            $contactconcierge.on('change', selectors.countryDrpDwn, (function($contactconcierge, event) {
                updateConcierge($contactconcierge, $(event.currentTarget));
            }).bind(undefined, $contactconcierge));

        }

        return {
            init: init
        };
    })(iwc.$);
}());

/*global iwc, base*/
/**
 * Send to a Friend component js
 */

(function() {
    'use strict';

    /**
     * Send to a Friend component
     * @namespace sendtofriend
     * @memberof iwc.comp
     */
    iwc.comp.sendtofriend = (function($, util, base) {

        var name = 'sendtofriend',
            selectors = {
            overlay: '.iwc-lightbox-content',
            sendtofriend: '.iwc-sendtofriend',
            confirm: '.iwc-sendtofriend-confirm',
            formWrapper: '.iwc-sendtofriend-form',
            close: '.iwc-sendtofriend-close',
            cancel: 'input[type="reset"]',
            productWrapper: '.iwc-product',
            productId: 'input[name="productId"]',
            configuratorProductWrapper: '.configurator-cfg-product-details',
            engravingRef: '#engravingId',
            engravingText: '#engravingText',
            textarea: '.base-forms-textarea',
            counterElement: '.iwc-sendtofriend-count',
            wishListName: 'input[name="wishListName"]',
            aemCaptchaWrapper: '.base-aemcaptcha'
        },
        cssClass = {
            hide: 'iwc-hidden'
        },
        $overlay,
        $body,
        $form,
        $formWrapper,
        $sendtofriend,
        $confirm,
        $productWrapper,
        $productId,
        $wishListName,
        $engravingRef,
        $engravingText,
        $textarea,
        $counterElement,
        $aemCaptchaWrapper;

        /**
         * showConfirmation
         * @function showConfirmation
         * @private
         * @memberof iwc.comp.sendtofriend
         */
        function showConfirmation() {
            $formWrapper.addClass(cssClass.hide);
            $confirm.removeClass(cssClass.hide);
        }

        /**
         * Destroy sendtofriend
         * @function destroy
         * @public
         * @param {string} pageName
         * @memberOf iwc.comp.sendtofriend
         */
        function destroy(pageName) {

            if (pageName === name) {

                $.each([$sendtofriend, $form], function(index, item) {
                    item = null;
                });

                $form.off('submit.' + name);
                $.unsubscribe('iwc:forms:reinit');
                $.unsubscribe('iwc:lightbox:close');
                $.unsubscribe('iwc:lightbox:content:set');
            }
        }

        /**
         * Form reinit
         * @function formInitHandler
         * @private
         * @param {Object} form Form element
         * @param {boolean} success Response true/false
         * @memberOf iwc.comp.sendtofriend
         */
        function formInitHandler(form, success) {
            if (success) {
                showConfirmation();
            } else {
                iwc.comp.forms.init($(form));
                util.formsAnimation.reInit($overlay);
            }
        }

        /*
         * Count charaters on type/copy/paste
         * @function countChar
         * @private
         * @param {Object} e - Event object
         * @memberof iwc.comp.sendtofriend
         */
        function countChar(e) {
            var $target = $(e.target),
                currentLength = $target.val().length,
                maxChars = $textarea.prop('maxlength');
            if (currentLength >= maxChars) {
                $target.val($target.val().substr(0, maxChars));
            }
            $counterElement.text(maxChars - $target.val().length);
        }

        /**
         * Bind events
         * @function bindEvents
         * @private
         * @memberOf iwc.comp.sendtofriend
        */
        function bindEvents() {
            $sendtofriend.on('click', selectors.close + ' , ' + selectors.cancel, util.lightbox.closeLightbox);
            $textarea.on('keyup change blur', countChar);
        }

        /*
         * Map DOM elements within component
         * @function mapDomElements
         * @private
         * @memberof iwc.comp.sendtofriend
         */
        function mapDomElements() {
            $sendtofriend = $overlay.find(selectors.sendtofriend);
            $confirm = $overlay.find(selectors.confirm);
            $formWrapper = $overlay.find(selectors.formWrapper);
            if ($body.find(selectors.productWrapper).length) {
                $productWrapper = $body.find(selectors.productWrapper);
            } else if ($body.find(selectors.configuratorProductWrapper).length) {
                $productWrapper = $body.find(selectors.configuratorProductWrapper);
            }
            //sendtofriend form
            $form = $sendtofriend.find('form');
            $productId = $form.find(selectors.productId);
            $textarea = $form.find(selectors.textarea);
            $counterElement = $form.find(selectors.counterElement);
            $wishListName = $form.find(selectors.wishListName);
            //engraving data
            $engravingRef = $form.find(selectors.engravingRef);
            $engravingText = $form.find(selectors.engravingText);
        }

        /*
         * Update data in form
         * @function updateData
         * @private
         * @memberof iwc.comp.sendtofriend
         */
        function updateData() {
            // safe check if product wrapper is undefined
            if ($productWrapper) {
                $productId.val($productWrapper.attr('data-productid'));
                $engravingRef.val($productWrapper.attr('data-engravingid') || '');
                $engravingText.val($productWrapper.attr('data-engravingtext') || '');
            }
        }

        /**
         * initialise sendtofriend component
         * @function init
         * @public
         * @memberOf iwc.comp.sendtofriend
         */
        function init() {
            $body = $('body');
            $overlay = $(selectors.overlay);
            $aemCaptchaWrapper = $overlay.find(selectors.aemCaptchaWrapper);
            mapDomElements();
            updateData();
            //intialise form
            iwc.comp.forms.init($form);
            util.formsAnimation.reInit($overlay);
            util.lightbox.reInit($overlay);
            // captcha 1 call disabled.
            // iwc.comp.captcha.init();
            if ($aemCaptchaWrapper.length) {
                base.comp.captcha.aemCaptcha.init($aemCaptchaWrapper);
            }
            bindEvents();
            $.subscribe('iwc:lightbox:content:set', function(data) {
                $wishListName.val(data.target ? data.target.data('emailwishlist') : '');
            });
            $.subscribe('iwc:forms:reinit', formInitHandler);
            $.subscribe('iwc:lightbox:close', destroy);

            // added described by attribute for accessibilty
            $counterElement.parent().attr('id', 'iwc-sendtofriend-char-limit');
            $textarea.attr('aria-describedby', 'iwc-sendtofriend-char-limit');
        }

        return {
            init: init
        };
    })(iwc.$, iwc.util, base);
}());

/*global iwc*/
/**
 * contactus component
 */

(function() {
    'use strict';

    /**
     * contactus component
     * @namespace contactus
     * @memberof iwc.comp
     */

    iwc.comp.contactus = (function($) {

        var selectors = {
                successMessage: '.iwc-contactus-success-block',
                formWrapper: '.iwc-contactus-form-wrapper',
                baseHiddenField: '.system_form_hidden.section input[type="hidden"]',
                salutationDropdown: 'select[name="salutation"]',
                firstName: 'input[name="firstName1"]',
                lastName: 'input[name="lastName1"]',
                email: 'input[name="email"]',
                confirmEmail: 'input[name="confirm-email"]'
            },
            cssClass = {
                hide: 'iwc-hidden'
            },
            $contactus,
            $successMessageWrapper,
            $formWrapper,
            customerType,
            $hiddenFields;

        /**
         * Setup form for checked in user
         * @function loggedinUserSetup
         * @param {string | Number} customerType Form element
         * @param {object} $wrapperElement Form element
         * @privtae
         * @memberOf iwc.comp.contactus
         */
        function loggedinUserSetup(customerType, $wrapperElement) {
            if (customerType !== 'Guest') {
                $wrapperElement.find(selectors.salutationDropdown).prop('disabled', true);
                $wrapperElement.find(selectors.firstName).prop('readonly', true);
                $wrapperElement.find(selectors.lastName).prop('readonly', true);
                $wrapperElement.find(selectors.email).prop('readonly', true);
                $wrapperElement.find(selectors.confirmEmail).prop('readonly', true);
            } else {
                $hiddenFields.remove();
            }
        }

        /**
         * Form reinit
         * @function formInitHandler
         * @param {object} form Form element
         * @param {Boolean} data Success true/false
         * @memberOf iwc.comp.contactus
         */
        function formInitHandler(form, data) {
            iwc.comp.forms.init($(form));
            iwc.util.formsAnimation.reInit($contactus);
            if (data) {
                $formWrapper.addClass(cssClass.hide);
                $successMessageWrapper.removeClass(cssClass.hide);
            }
            loggedinUserSetup(customerType, $(form));
        }

        /**
         * initialise contactus component
         * @function init
         * @public
         * @param {HTMLElement} element
         * @memberOf iwc.comp.contactus
         */
        function init(elem) {
            $contactus = $(elem);
            $formWrapper = $contactus.find(selectors.formWrapper);
            $successMessageWrapper = $contactus.find(selectors.successMessage);
            customerType = $contactus.data('customerId');
            $hiddenFields = $contactus.find(selectors.baseHiddenField);
            $.subscribe('iwc:forms:reinit', formInitHandler);
            loggedinUserSetup(customerType, $contactus);
        }

        return {
            init: init
        };
    })(iwc.$);
}());

/*global iwc*/
/**
 * @fileOverview Provides functionality for the inpagesubnav component
 */

(function() {
    'use strict';

    /**
     * inpagesubnav component
     * @namespace inpagesubnav
     * @memberof iwc.comp
     */
    iwc.comp.inpagesubnav = (function($, util) {

        var $elem,
            $navWrapper,
            $navItem,
            navWrappeHeight = 0,
            selectors = {
                navWrapper: '.iwc-inpagesubnav-controls',
                navItem: '.iwc-inpagesubnav-cta-link'
            },
            cssClass = {
                selected: 'iwc-selected',
                floated: 'iwc-floated'
            };

        /**
         * Scroll page to Div from attribe href
         * @private
         * @memberOf iwc.comp.inpagesubnav
         * @param {Object} e event object
         * @function scrollTo
        */
        function scrollTo(e) {
            e.preventDefault();
            var $target = $(e.target),
                scrollElemId = $target.attr('href'),
                $scrolElem = $(scrollElemId),
                scrollTop = 0,
                offsetTop = $scrolElem.offset().top;

            $navItem.removeClass(cssClass.selected);
            $target.addClass(cssClass.selected);

            scrollTop = offsetTop - navWrappeHeight;

            util.toggle.close($navWrapper);
            util.smoothScroll.init(scrollTop, 700);
        }
        /**
         * Toggle subnavigation floating on scroll
         * @private
         * @memberOf iwc.comp.inpagesubnav
         * @function onWindowScrolled
        */
        function onWindowScrolled(e) {
            var rect = $elem[0].getBoundingClientRect();
            $navWrapper.toggleClass(cssClass.floated, (rect.top <= 0));

            $navItem.each(function() {
                var currNavItem = $(this),
                    currSection = $(currNavItem.attr('href'));
                if (currSection.position().top <= e && currSection.position().top + currSection.height() > e) {
                    $navItem.removeClass(cssClass.selected);
                    currNavItem.addClass(cssClass.selected);
                }
            });
        }

        /**
         * Initialise a inpagesubnav element.
         * @param {HTMLObject} elem
         * @memberOf iwc.comp.inpagesubnav
         */
        function init(elem) {

            $elem = $(elem);
            $navWrapper = $elem.find(selectors.navWrapper);
            $navItem = $navWrapper.find(selectors.navItem);

            $navItem.on('click', scrollTo);
            $.subscribe('scroll', onWindowScrolled);

            navWrappeHeight = parseInt($navWrapper.height(), 10) || 0;

            util.animatable.init();
            util.scroll.init();
        }

        return {
            init: init
        };
    })(iwc.$, iwc.util);
}());

/*global iwc*/
/**
 * @fileOverview Provides functionality for the banner component
 */

(function() {
    'use strict';

    /**
     * banner component
     * @namespace banner
     * @memberof iwc.comp
     */
    iwc.comp.banner = (function($, util) {

        var $banner,
            $scrollButton,
            $googleStoreLink,
            $appleStoreLink,
            selectors = {
                base: '.iwc-banner',
                scrollButton: '.iwc-banner-scroll-down',
                googleStoreLink: '.iwc-google-store-link',
                appleStoreLink: '.iwc-apple-store-link'
            },
            cssClass = {
                hide: 'iwc-hide'
            };
        /**
         * Scoll window to banner bottom
         * @function onScrollButtonClick
         * @private
         * @memberOf iwc.comp.banner
         */
        function onScrollButtonClick() {
            var offset = $banner.offset().top + $banner.height();
            util.smoothScroll.init(offset, 700);
        }
        function showHideDownloadButtons() {
            if (util.osDetect.isiOS()) {
                $googleStoreLink.addClass(cssClass.hide);
            } else if (util.osDetect.isAndroid()) {
                $appleStoreLink.addClass(cssClass.hide);
            }
        }
        /**
         * Initialise a banner element.
         * @function init
         * @public
         * @param {HTMLObject} elem
         * @memberOf iwc.comp.banner
         */
        function init(elem) {
            $banner = $(elem) || $(selectors.base);
            $googleStoreLink = $banner.find(selectors.googleStoreLink);
            $appleStoreLink = $banner.find(selectors.appleStoreLink);
            showHideDownloadButtons();
            $scrollButton = $banner.find(selectors.scrollButton);
            $scrollButton.on('click', onScrollButtonClick);
            util.animatable.init();
            util.lazyLoadImage.checkImages();
        }

        return {
            init: init
        };
    })(iwc.$, iwc.util);
}());

/*global iwc*/
/**
 * @fileOverview Provides functionality for the universe component
 */

(function() {
    'use strict';

    /**
     * universe component
     * @namespace universe
     * @memberof iwc.comp
     */
    iwc.comp.universe = (function($, util) {
        var $comp,
            $campaignLinks,
            $campaignLink,
            $campaignCTA,
            selector = {
                campaignLinks: '.iwc-campaign-links',
                campaignLink: '.iwc-campaign-link',
                campaignCTA: '.iwc-campaign-cta'
            },
            countryCode;

        /**
         * Update links based on location and OS
         * @function updateLinks
         * @public
         * @memberOf iwc.comp.universe
         * @param  {String} countryCode - Country code string
         */
        function updateLinks(countryCode) {
            if (countryCode === 'CN') {
                var youkuLink = $campaignLink.data('chinaLink'),
                    youkuText = $campaignLink.data('chinaText');
                $campaignLink.attr('href', youkuLink).text(youkuText);
            }
            if (util.osDetect.isiOS()) {
                var iOSLink = $campaignCTA.data('iosCta');
                $campaignCTA.attr('href', iOSLink);

            } else if (util.osDetect.isAndroid()) {
                var androidLink = $campaignCTA.data('androidCta');
                $campaignCTA.attr('href', androidLink);
            }
        }
        /**
         * Get user location if campaign is enabled
         * @function getUserLocation
         * @public
         * @memberOf iwc.comp.universe
         */
        function getUserLocation() {
            $.getJSON('//freegeoip.net/json/', function(data) {
                /* jshint ignore:start */
                /* jscs:disable*/
                countryCode = data.country_code;
                /* jscs:enable*/
                /* jshint ignore:end */
                updateLinks(countryCode);
            });
        }
        /**
         * Mapping DOM elements on the component.
         * @function mapDOMElements
         * @public
         * @memberOf iwc.comp.universe
         */
        function mapDOMElements() {
            $campaignLinks = $comp.find(selector.campaignLinks);
            $campaignLink = $comp.find(selector.campaignLink);
            $campaignCTA = $comp.find(selector.campaignCTA);
        }
        /**
         * Initialise a Universe component.
         * @function init
         * @public
         * @memberOf iwc.comp.universe
         * @param  {HTMLObject} elem the HTML object
         */
        function init(elem) {
            $comp = $(elem);
            mapDOMElements();
            util.lazyLoadImage.checkImages();
            if ($campaignLinks) {
                getUserLocation();
            }
        }

        return {
            init: init
        };
    })(iwc.$, iwc.util);
}());

/*jshint loopfunc:true */
/*global iwc*/
/**
 * Generic Table component js
 */

(function() {
    'use strict';

    /**
     * Generic Table component
     * @namespace generictable
     * @memberof iwc.comp
     */
    iwc.comp.generictable = (function($, comp, util) {

        var FourColumnTable = function() {

            var $instance,
                narrow = true,
                $labels,
                $values,
                $dotsContainer,
                $contentContainer,
                $labelContainer,
                $tableContainer,
                $valueInstances,
                labelWidth = 0,
                _slickInit = false;

            /**
             * Initialises a new FourColumnTable
             * @memberOf iwc.comp.generictable
             * @param elem DOMElement the DOM element to initalise a FourColumnTable for.
             * */
            this.init = function(elem, isNarrow) {
                narrow = isNarrow;

                $instance = $(elem);
                $tableContainer = $instance.find('.iwc-generic-table-four-column-wrapper');
                $labelContainer = $instance.find('.iwc-generic-table-labels');
                $labels = $labelContainer.find('.iwc-generic-table-label');
                $values = $instance.find('.iwc-generic-table-values');
                $valueInstances = $values.find('.iwc-generic-table-value');
                $dotsContainer = $instance.find('.iwc-generic-table-dots');
                $contentContainer = $instance.find('.iwc-generic-table-four-column-tbody');

                if (narrow) {
                    this.update(true);
                }
            };

            /**
             * Initalises Slick on the content container
             * @memberOf iwc.comp.readmore
             */
            function initSlick() {
                var isFirst = true;

                $values.each(function(index, elem) {
                    $(elem).slick({
                        arrows:false,
                        dots: isFirst,
                        appendDots: $dotsContainer,
                        mobileFirst: true,
                        infinite: false,
                        variableWidth: true,
                        asNavFor: '.iwc-generic-table-values'
                    });

                    isFirst = false;
                });

                _slickInit = true;
            }

            /**
             * Destroys the Slick instance if already created
             * @memberOf iwc.comp.readmore
             */
            function disableSlick() {
                if (_slickInit) {
                    $values.each(function(index, elem) {
                        $(elem).slick('unslick');
                    });
                    _slickInit = false;
                }
            }

            /**
             * Refreshes the layout of the table.
             * @memberOf iwc.comp.generictable
             * @param isNarrow Boolean Flags whether the current layout is narrow or not
             * */
            this.update = function(isNarrow) {
                narrow = isNarrow;

                if (narrow) {
                    if (!_slickInit) {
                        initSlick();
                    }

                    this.updateNarrow();
                } else {
                    if (_slickInit) {
                        disableSlick();
                    }

                    this.updateWide();
                }
            };

            /**
             * Adds the correct styles for the narrow table layout
             * @memberOf iwc.comp.generictable
             * */
            this.updateNarrow = function() {
                labelWidth = $(window).width() - $labelContainer.width() - parseInt($tableContainer.css('marginRight'), 10);

                $labels.each(function(index, elem) {
                    var currentLabel = $(elem),
                        currentValue = $($values.get(index));

                    currentLabel.removeAttr('style');
                    currentValue.removeAttr('style');

                    $values.children().each(function(index, elem) {
                        $(elem).removeAttr('style');
                    });

                    var labelHeight = currentLabel.innerHeight(),
                        valuesHeight = currentValue.innerHeight();

                    if (labelHeight > valuesHeight) {
                        currentValue.css('height', labelHeight + 'px');
                    } else {
                        currentLabel.css('height', valuesHeight + 'px');
                    }

                    currentValue.css('width', labelWidth, 'px');

                    $valueInstances.each(function(index, elem) {
                        $(elem).css('width', labelWidth, 'px');
                    });
                });

                if (_slickInit) {
                    var current = -1;

                    $values.each(function(index, elem) {
                        current = $(elem).slick('slickCurrentSlide');
                        $(elem).slick('slickGoTo', current, false);
                    });
                }
            };

            /**
             * Adds the correct styles for the wide table layout
             * @memberOf iwc.comp.generictable
             * */
            this.updateWide = function() {
                var largestValueCount = 0,
                    largestValueHeight = 0;

                if ($instance.attr('data-table-fixed-width') === 'true') {
                    this.setEqualWidth();
                    return;
                }

                $labels.each(function(index, elem) {
                    var currentLabel = $(elem),
                        currentValue = $($values.get(index));

                    currentLabel.removeAttr('style');
                    currentValue.removeAttr('style');

                    $valueInstances.each(function(index, elem) {
                        $(elem).removeAttr('style');
                    });

                    var labelWidth = currentLabel.innerWidth(),
                        valuesWidth = currentValue.innerWidth();

                    if (labelWidth > valuesWidth) {
                        currentValue.css('width', labelWidth + 'px');
                    } else {
                        currentLabel.css('width', valuesWidth + 'px');
                    }
                });

                /*
                 * Find out the column which has the most amount of values so we don't miss any out.
                 */
                $values.each(function(index, elem) {
                    var childrenLength = $(elem).children().length;
                    largestValueCount = (childrenLength > largestValueCount) ? childrenLength : largestValueCount;
                });

                /*
                 * Loop through each row of values up until the last in the table,
                 * finding the one with the biggest height add assigning that to all
                 * other values in that row to keep them inline.
                 */
                for (var i = 0; i < largestValueCount; ++i) {
                    $values.each(function(index, elem) {
                        var $value = $($(elem).children().eq(i)),
                            height = 0;

                        if ($value.length) {
                            height = $value.outerHeight();
                            largestValueHeight = (height > largestValueHeight) ? height : largestValueHeight;
                        }
                    });

                    $values.each(function(index, elem) {
                        var $value = $($(elem).children().eq(i));

                        if ($value.length) {
                            $value.css('height', largestValueHeight + 'px');
                        }
                    });

                    largestValueHeight = 0;
                }
            };

            this.setEqualWidth = function() {
                var splitWidth = $instance.width() / $labels.length;

                $labels.each(function(index, elem) {
                    var currentLabel = $(elem),
                        currentValue = $($values.get(index));

                    currentValue.css('width', splitWidth + 'px');
                    currentLabel.css('width', splitWidth + 'px');
                });
            };

        },
            SimpleTable = function() {

                var $body = $('body'),
                    $instance,
                    narrow = true,
                    $labels,
                    $values,
                    numValues;

                /**
                 * Initialises a new FourColumnTable
                 * @memberOf iwc.comp.generictable
                 * */
                this.init = function(elem) {
                    $instance = $(elem);
                    $labels = $instance.find('.iwc-generic-table-label, .iwc-generic-table-value');
                    $values = $instance.find('.iwc-generic-table-row-outer');
                    numValues = $values.length;
                };

                /**
                 * Refreshes the layout of the table.
                 * @memberOf iwc.comp.generictable
                 * @param isNarrow Boolean Flags whether the current layout is narrow or not
                 * */
                this.update = function(isNarrow) {
                    narrow = isNarrow;

                    if (!narrow) {
                        this.updateWide();
                    }
                };

                /**
                 * Adds the correct styles for the wide table layout
                 * @memberOf iwc.comp.generictable
                 * */
                this.updateWide = function() {
                    var largestValueCount = 0,
                        largestValueHeight = 0,
                        individualAmount = numValues / 3,
                        $elem = 0,
                        height = 0,
                        index = 0,
                        maxWidth = Math.max.apply(null, $labels.map(function() {
                            return $(this).outerWidth(true);
                        }).get());

                    $labels.each(function(index, elem) {
                        $(elem).removeAttr('style');
                    });

                    if (!$body.hasClass('IE-11')) {
                        $labels.css('width', maxWidth + 'px');
                    } else {
                        $labels.css('width', (maxWidth + 1) + 'px');
                    }

                    /*
                     * Find out the column which has the most amount of values so we don't miss any out.
                     */
                    $labels.each(function(index, elem) {
                        var childrenLength = $(elem).children().length;
                        largestValueCount = (childrenLength > largestValueCount) ? childrenLength : largestValueCount;
                    });

                    /*
                     * Loop through each row of values up until the last in the table,
                     * finding the one with the biggest height add assigning that to all
                     * other values in that row to keep them inline.
                     */
                    for (var i = 0; i < individualAmount; ++i) {
                        for (var j = 0; j < 3; ++j) {
                            index = (j * individualAmount) + i;
                            $elem = $values.children().eq(index);
                            height = parseInt(getComputedStyle($elem[0]).getPropertyValue('height'), 10) || $elem.innerHeight();
                            largestValueHeight = (height > largestValueHeight) ? height : largestValueHeight;
                        }

                        for (var k = 0; k < 3; ++k) {
                            index = (k * individualAmount) + i;
                            $values.children().eq(index).css('height', largestValueHeight + 'px');
                        }

                        largestValueHeight = 0;
                    }
                };

            },
            tables = [],
            _init = false;

        /**
         * Validate if the breakpoint isNarrow
         * @memberOf iwc.comp.generictable
         * @return {Boolean}  return if mobile viewport
         */
        function isNarrow() {
            return util.matchmedia.narrow.matches || false;
        }

        /**
         * Called when the iwc:resize event is published.
         * @memberOf iwc.comp.generictable
         */
        function onResize() {
            for (var i = 0, len = tables.length; i < len; ++i) {
                tables[i].update(isNarrow());
            }
        }

        /**
         * Creates a new FourColumnTable object.
         * @memberOf iwc.comp.generictable
         * @param elem DOMElement the DOM element to initialize a table for.
         */
        function createFourColumnTable(elem) {
            var table = new FourColumnTable();

            table.init(elem, isNarrow());
            tables.push(table);
        }

        /**
         * Creates a new FourColumnTable object.
         * @memberOf iwc.comp.generictable
         * @param elem DOMElement the DOM element to initialize a table for.
         */
        function createSimpleTable(elem) {
            var table = new SimpleTable();

            table.init(elem);
            tables.push(table);
        }

        /**
         * Adds all required event listeners.
         * @memberOf iwc.comp.generictable
         */
        function addEventListeners() {
            $.subscribe('iwc:resize', function() {
                onResize();
            });

            $(document).ready(function() {
                onResize();
            });
        }

        /**
         * initialise generic table
         * @memberOf iwc.comp.generictable
         */
        function init(element) {
            if (!_init) {
                addEventListeners();
                _init = true;
            }

            if ($(element).attr('data-table-layout') === 'four-column') {
                createFourColumnTable(element);
            } else {
                createSimpleTable(element);
            }
        }

        return {
            init: init
        };
    })(iwc.$, iwc.comp, iwc.util);
}());

/*global iwc*/
/**
 * functionality for Generic Sub Navigation
 */

(function() {
    'use strict';

    /*
     * genericsubnav component
     * @namespace genericsubnav
     * @memberof iwc.comp
     */
    iwc.comp.genericsubnav = (function($) {
        /**
         * Initialise a genericsubnav element.
         * @memberOf iwc.comp.genericsubnav
         */
        var $body = $('body'),
            $elem,
            $subNav,
            $activeLink,
            $template,
            $currentPageLink,
            $nextLink,
            $prevLink,
            $subNavLinks,
            selectors = {
                activeLink: '.iwc-first-row-active-link',
                currentPageLink: '.iwc-genericsubnav-current-item',
                template: '.iwc-genericsubnav-links-template',
                subNavLinks: '.iwc-second-row-item',
                subNavLinkParent: '.iwc-genericsubnav-parent',
                subNav: '.iwc-genericsubnav-nav',
                secondRowLink: '.iwc-second-row-link',
                pageHeader: '.iwc-header'
            },
            cssClass = {
                openNav: 'iwc-genericsubnav-opened',
                showGenericNav: 'iwc-generic-nav'
            },
            template,
            pageHeaderHeight = $(selectors.pageHeader).outerHeight();

        /**
         * Hide navigation when clicked anywhere on page
         * @function hideNavigation
         * @private
         * @memberOf iwc.comp.genericsubnav
        */
        function hideNavigation() {
            $elem.removeClass(cssClass.openNav);
        }
        /**
         * Update Next/Previous Links
         * @function setNextPrevLinks
         * @param {jQuery} elem - element to get data from
         * @return {String} Next/Prev
         * @memberOf iwc.comp.genericsubnav
         */
        function setNextPrevLinks(elem, position) {
            var $target = $(elem).find(selectors.secondRowLink),
                href = $target.attr('href'),
                text = $target.text(),
                updatedTemplate = template
                            .replace('{{href}}', href)
                            .replace('{{text}}', text)
                            .replace(/{{position}}/g, position);

            if (position === 'prev') {
                $subNav.prepend(updatedTemplate);
            } else {
                $subNav.append(updatedTemplate);
            }
        }
        /**
         * Bind click events
         * @function bindEvents
         * @private
         * @memberOf iwc.comp.genericsubnav
        */
        function bindEvents() {
            $activeLink.on('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                $elem.toggleClass(cssClass.openNav);
            });
            $body.on('click', hideNavigation);
        }
        /**
         * Generating prev/next links
         * @function createNextPrevLinks
         * @private
         * @memberOf iwc.comp.genericsubnav
        */
        function createNextPrevLinks() {
            var currentPageLinkIndex = $currentPageLink.index(),
                subNavLength = $subNavLinks.length;

            if (subNavLength > 1) {
                $prevLink = $subNavLinks.eq(currentPageLinkIndex - 1);
                $prevLink = $prevLink.length ? $prevLink : $subNavLinks.eq(subNavLength);
                setNextPrevLinks($prevLink, 'prev');

                $nextLink = $subNavLinks.eq(currentPageLinkIndex + 1);
                $nextLink = $nextLink.length ? $nextLink : $subNavLinks.eq(0);
                setNextPrevLinks($nextLink, 'next');
            }
        }

        /**
         * Mapping DOM elements for chaching
         * @function mapDomElements
         * @private
         * @memberOf iwc.comp.genericsubnav
        */
        function mapDomElements() {
            $activeLink = $elem.find(selectors.activeLink);
            $currentPageLink = $elem.find(selectors.currentPageLink);
            $template = $elem.find(selectors.template);
            $subNav = $elem.find(selectors.subNav);
            $subNavLinks = $elem.find(selectors.subNavLinks).not(selectors.subNavLinkParent);
        }
        /**
         * Show generic nav based on scroll after header is passed
         * @function showGenericNav
         * @private
         * @param {Event} e - event object
         * @memberOf iwc.comp.genericsubnav
        */
        function showGenericNav(e) {
            if ($elem.hasClass(cssClass.openNav)) {
                hideNavigation();
            }

            if (e > pageHeaderHeight) {
                $body.addClass(cssClass.showGenericNav);
            } else {
                $body.removeClass(cssClass.showGenericNav);
            }
        }
        /**
         * Initialize generic sub navigation
         * @function init
         * @private
         * @param {HTMLObject} element
         * @memberOf iwc.comp.genericsubnav
        */
        function init(element) {
            $elem = $(element);
            mapDomElements();
            template = $template.text();
            createNextPrevLinks();
            bindEvents();
            $.subscribe('scroll', showGenericNav);
        }

        return {
            init: init
        };

    })(iwc.$, iwc.util);
}());

/*global iwc*/
/**
 * accordion component js
 */

(function() {
    'use strict';

    /**
     * Accordion component
     * @namespace accordion
     * @memberof iwc.comp
     */
    iwc.comp.accordion = (function($, utils) {

        var Accordion = function() {
            var $elem,
                $sections,
                _self = this,
                _currentIndex = -1,
                _anchorValue = window.location.hash;

            function addEventListeners() {
                $sections.each(function(index, elem) {
                    $(elem).find('.iwc-accordion-header').click(function(evt) {
                        var targetSection = $(evt.currentTarget).parent('.iwc-accordion-section').attr('data-section-id'),
                            $accordionButton = $(elem).find('.iwc-accordion-header-container'),
                            $accordionSection = $(elem).find('.iwc-accordion-content');
                        _self.closeSection();

                        if (targetSection !== _currentIndex) {
                            _self.openSection(targetSection);

                        } else {
                            $accordionButton.attr('aria-expanded', 'false');
                            $accordionSection.attr('hidden', 'true');
                            _currentIndex = -1;
                        }
                    });
                });

                $.subscribe('iwc:resize', function() {
                    _self.onResize();
                });
            }

            function isVisible(elem) {
                var docViewTop = $(window).scrollTop(),
                    docViewBottom = docViewTop + $(window).height(),
                    elemTop = $(elem).offset().top,
                    elemBottom = elemTop + $(elem).height();

                return ((elemBottom <= docViewBottom) && (elemTop >= docViewTop));
            }

            this.init = function($element) {
                $elem = $element;
                $sections = $elem.find('.iwc-accordion-section');
                _anchorValue = _anchorValue.substr(1);
                var $openSection = $elem.find('.iwc-accordion-section[data-section-anchor="' + _anchorValue + '"]');

                addEventListeners();
                if ($openSection.data('sectionId')) {
                    _self.openSection($openSection.data('sectionId'));
                } else {
                    _self.openFirst();
                }
            };

            this.onResize = function() {
                if (_currentIndex !== -1) {
                    this.setHeight(_currentIndex);
                }
            };

            this.setHeight = function(index) {
                var $e = $sections.eq(index),
                    $content = $e.find('.iwc-accordion-content'),
                    $innerContent = $e.find('.iwc-accordion-inner-content');
                $content.removeAttr('hidden');
                $content.css('min-height', ($innerContent.outerHeight() + parseInt($innerContent.css('margin-bottom'), 10)) + 'px');
            };

            this.openSection = function(index) {
                var $e = $sections.eq(index),
                    $header = $e.find('.iwc-accordion-header');

                $header.find('.iwc-accordion-header-container').attr('aria-expanded', 'true');
                $e.addClass('iwc-accordion-active');

                this.setHeight(index);

                /* Used to keep up with the animation duration defined in the CSS */
                setTimeout(function() {
                    if (!isVisible($header[0])) {
                        utils.scrollTo.position($header.offset().top - 50, 500);
                    }
                }, 500);

                _currentIndex = index;
            };

            this.closeSection = function() {
                $sections.each(function(index,elem) {
                    var $e = $(elem),
                        $content = $e.find('.iwc-accordion-content');

                    $e.removeClass('iwc-accordion-active');
                    $content.removeAttr('style');
                });
            };

            this.openFirst = function() {
                var $e = $sections.eq(0);
                $e.addClass('iwc-accordion-active');
                $e.find('.iwc-accordion-header-container').attr('aria-expanded', 'true');
                this.setHeight(0);
                _currentIndex = 0;
            };
        },
            accordions = [];

        function createAccordion(elem) {
            var $elem = $(elem),
                accordion = new Accordion();

            accordion.init($elem);
            accordions.push(accordion);
        }

        /**
         * initialise accordion page
         * @memberOf iwc.comp.accordion
         */
        function init(element) {
            createAccordion(element);
        }

        return {
            init: init
        };

    })(iwc.$, iwc.util);
}());

/*global iwc*/
/**
 * functionality for the Generic Related Watches Section
 */

(function() {
    'use strict';
    /*
     * genericrelatedwatches component
     * @namespace genericrelatedwatches
     * @memberof iwc.comp
     */
    iwc.comp.genericrelatedwatches = (function($, util) {
        /**
         * Initialise a genericrelatedwatches element.
         * @memberOf iwc.comp.genericrelatedwatches
         */
        var $body = $('body'),
            $component,
            $slickWrapper,
            $slide,
            selectors = {
                slickWrapper: '.iwc-related-watches-slides',
                slide: '.iwc-related-watches-slide'
            },
            cssClass = {
                editMode: 'iwc-edit-mode',
                singleSlide: 'single-slide'
            },
            isMobile = util.matchmedia.narrow.matches,
            centerMode = false;

        /**
         * Initialize slick slider in mobile view
         * @function mobileSubNav
         * @private
         * @memberOf iwc.comp.genericrelatedwatches
        */
        function initCarousel() {
            if ($slide.length === 1 && isMobile) {
                centerMode = false;
                $slickWrapper.addClass(cssClass.singleSlide);
            } else if ($slide.length > 1 && isMobile) {
                centerMode = true;
            }
            $slickWrapper.slick({
                infinite: true,
                slidesToShow: 5,
                slidesToScroll: 1,
                responsive: [
                    {
                        breakpoint: 1281,
                        settings: {
                            slidesToShow: 4,
                            slidesToScroll: 1
                        }
                    },{
                        breakpoint: 1024,
                        settings: {
                            slidesToShow: 3,
                            slidesToScroll: 1
                        }
                    },{
                        breakpoint: 480,
                        settings: {
                            arrows: false,
                            infinite: true,
                            centerMode: centerMode,
                            centerPadding: '25%',
                            slidesToShow: 1
                        }
                    }
                ]
            });
        }

        /**
         * Mapping DOM elements for chaching
         * @function mapDomElements
         * @private
         * @param {HTMLElement} element
         * @memberOf iwc.comp.genericrelatedwatches
        */
        function mapDomElements(element) {
            $component = $(element);
            $slickWrapper = $component.find(selectors.slickWrapper);
            $slide = $slickWrapper.find(selectors.slide);
        }

        /**
         * Initialize Generic Related Watches Component
         * @function init
         * @public
         * @param {HTMLElement} element
         * @memberOf iwc.comp.genericrelatedwatches
        */
        function init(element) {
            mapDomElements(element);
            if (!$body.hasClass(cssClass.editMode)) {
                initCarousel();
            }
        }

        return {
            init: init
        };

    })(iwc.$, iwc.util);
}());

/*global iwc*/
/**
 * Header Fragment component js
 */

(function() {
    'use strict';

    /**
     * Header component
     * @namespace headerfragment
     * @memberof iwc.comp
     */
    iwc.comp.headerfragment = (function($) {

        var $header,
            $navItems,
            $navContainer,
            $accountIcn,
            $navContentWrapper;

        /**
         * Opens the navigation.
         * @memberOf iwc.comp.headerfragment
         */
        function onNavOpened() {
            // TODO: to be removed later after confirmation
            // $header.addClass('iwc-header-active');
        }

        /**
         * Closes the navigation.
         * @memberOf iwc.comp.headerfragment
         */
        function onNavClosed() {
            // TODO: to be removed later after confirmation
            // $header.removeClass('iwc-header-active');
        }

        /**
         * Adds all required event listeners.
         * @memberOf iwc.comp.headerfragment
         */
        function addEventListeners() {
            $.subscribe('iwc:navigationClosed', function() {
                onNavClosed();
            });

            $.subscribe('iwc:navigationOpen', function() {
                onNavOpened();
            });

            $accountIcn.on('click', function(evt) {
                var $icnElem = $(evt.currentTarget);

                if ($icnElem.hasClass('active')) {
                    onNavClosed();
                } else {
                    onNavOpened();
                }
            });
        }

        /**
         * initialise generic table
         * @memberOf iwc.comp.headerfragment
         * @param element DOMElement the header DOM element
         */
        function init(element) {
            $header = $(element);

            $navContainer = $header.find('.iwc-navigationlinks');
            $navContentWrapper = $header.find('.iwc-menu-nav-wrapper');
            $navItems = $navContainer.find('.iwc-main-navigation-list-item-link');
            $accountIcn = $header.find('.iwc-account-menu-btn');

            addEventListeners();
        }

        return {
            init: init
        };
    })(iwc.$);
}());

/*global iwc*/
/**
 * accordion component js
 */

(function() {
    'use strict';

    /**
     * Read more component
     * @namespace readmore
     * @memberof iwc.comp
     */
    iwc.comp.readmore = (function($, util) {

        var ReadMore = function() {
            var $elem,
                $dotsContainer,
                $contentContainer,
                $headings,
                narrow = -1,
                largestHeight = 0,
                textWithoutCurrent,
                textWithCurrent,
                seeSlideLabel,
                currentSlideLabel,
                _slickInit = false;

            /**
             * For adding custom labels on slickdots button
             * @memberOf iwc.comp.readmore
             * @param element slideToOmit the slide element to ignore
             */
            function customPaging(slideToOmit) {
                $dotsContainer.find('li').each(function(i) {
                    if (i !== slideToOmit) {
                        textWithoutCurrent = seeSlideLabel + (i + 1);
                        $(this).children('button').text(textWithoutCurrent);
                    }
                });
            }
            /**
             * Initalises Slick on the content container
             * @memberOf iwc.comp.readmore
             */
            function initSlick() {
                $contentContainer
                .on('init', function() {
                    textWithCurrent = seeSlideLabel + '1' + currentSlideLabel;
                    customPaging(0);
                    $dotsContainer.find('li').eq(0).children('button').text(textWithCurrent);
                })
                .slick({
                    arrows:false,
                    dots: true,
                    appendDots: $dotsContainer,
                    mobileFirst: true
                })
                .on('afterChange', function(event, slick, currentSlide) {
                    textWithCurrent = seeSlideLabel + (currentSlide + 1) + currentSlideLabel;
                    customPaging(currentSlide);
                    $dotsContainer.find('li').eq(currentSlide).children('button').text(textWithCurrent);
                });

                _slickInit = true;
            }

            /**
             * Destroys the Slick instance if already created
             * @memberOf iwc.comp.readmore
             */
            function disableSlick() {
                if (_slickInit) {
                    $contentContainer.slick('unslick');
                    _slickInit = false;
                }
            }

            /**
             * Initalise read more functionality on a DOM element
             * @memberOf iwc.comp.readmore
             * @param element DOMElement the DOM element to initalise
             * @param isNarrow Boolean flag to know whether we are on a narrow breakpoint or not
             */
            this.update = function(isNarrow) {
                if (isNarrow !== narrow) {
                    if (isNarrow) {
                        initSlick();
                    } else {
                        disableSlick();
                    }
                }

                $headings.each(function(index, elem) {
                    $(elem).removeAttr('style');
                });

                $headings.each(function(index, elem) {
                    var height = $(elem).height();
                    largestHeight = (height > largestHeight) ? height : largestHeight;
                });

                $headings.each(function(index, elem) {
                    $(elem).css('height', largestHeight + 'px');
                });

                largestHeight = -1;
                narrow = isNarrow;
            };

            /**
             * Initalised read more functionality on a DOM element
             * @memberOf iwc.comp.readmore
             * @param $element DOMElement the DOM element to initalise
             * @param isNarrow Boolean flag to know whether we are on a narrow breakpoint or not
             */
            this.init = function($element, isNarrow) {
                $elem = $element;
                $contentContainer = $elem.find('.iwc-read-more-links');
                $headings = $elem.find('.iwc-read-more-article-heading');
                $dotsContainer = $elem.find('.iwc-read-more-dots');
                seeSlideLabel = $dotsContainer.data('see-slide-label');
                currentSlideLabel = $dotsContainer.data('current-item-label');

                this.update(isNarrow);
            };
        },
            elements = [];

        /**
         * Validate if the breakpoint isNarrow
         * @memberOf iwc.comp.generictable
         * @return {Boolean}  return if mobile viewport
         */
        function isNarrow() {
            return util.matchmedia.narrow.matches || false;
        }

        /**
         * Called when the page resizes
         * @memberOf iwc.comp.readmore
         */
        function onResize() {
            for (var i = 0, len = elements.length; i < len; ++i) {
                elements[i].update(isNarrow());
            }
        }

        /**
         * Adds all required event listeners
         * @memberOf iwc.comp.readmore
         */
        function addEventListeners() {
            $.subscribe('iwc:resize', function() {
                onResize();
            });
        }

        /**
         * initialise a new ReadMore object for a given DOM element
         * @memberOf iwc.comp.readmore
         * @param element DOMElement the DOM element to initalise
         */
        function createReadMore(element) {
            var $elem = $(element),
                readMoreInstance = new ReadMore();

            readMoreInstance.init($elem, isNarrow());
            elements.push(readMoreInstance);
        }

        /**
         * initialise read more component
         * @memberOf iwc.comp.readmore
         * @param element DOMElement the DOM element to initalise
         */
        function init(element) {
            $.publish('iwc:animatable:in-view');

            util.animatable.init();
            util.scroll.init();

            createReadMore(element);
            addEventListeners();
        }

        return {
            init: init
        };

    })(iwc.$, iwc.util);
}());

/*global iwc*/
/**
 * Header Fragment component js
 */

(function() {
    'use strict';

    /**
     * Header component
     * @namespace articleheader
     * @memberof iwc.comp
     */
    iwc.comp.articleheader = (function($) {

        var $elem,
            $image,
            $heading,
            $overlay,
            $window,
            imageHeight = 0,
            headingHeight = 0,
            viewportHeight = 0,
            newImageHeight = 0;

        /**
         * Resizes the header image so there is always enough space
         * for the article title & info to be visible without scrolling.
         * @memberOf iwc.comp.articleheader
         */
        function setSize() {
            viewportHeight = $window.height();
            imageHeight = $image.outerHeight(true);
            headingHeight = $heading.outerHeight(true);

            newImageHeight = viewportHeight - headingHeight;

            $image.css('height', newImageHeight + 'px').addClass('active');

            if ($overlay.length) {
                $overlay.css('height', newImageHeight + 'px');
            }
        }
        /**
         * Called when iwc:resize is published.
         * @memberOf iwc.comp.articleheader
         */
        function onResize() {
            setSize();
        }

        /**
         * Adds all required event listeners.
         * @memberOf iwc.comp.articleheader
         */
        function addEventListeners() {
            $.subscribe('iwc:resize', function() {
                onResize();
            });
        }

        /**
         * initialise article header
         * @memberOf iwc.comp.articleheader
         * @param element DOMElement the header DOM element
         */
        function init(element) {
            $elem = $(element);
            $window = $(window);
            $image = $elem.find('.iwc-article-header-image');
            $heading = $elem.find('.iwc-header-text-content');
            $overlay = $elem.find('.iwc-content-overlay');

            addEventListeners();
            setSize();
        }

        return {
            init: init
        };
    })(iwc.$);
}());

/*global iwc*/
/**
 * Header Fragment component js
 */

(function() {
    'use strict';

    /**
     * Header component
     * @namespace articleheader
     * @memberof iwc.comp
     */
    iwc.comp.videoarticleheader = (function($) {

        var $elem,
            $image,
            $heading,
            $nav,
            $window,
            $globalNav,
            imageHeight = 0,
            navHeight = 0,
            globalNavHeight = 0,
            headingHeight = 0,
            viewportHeight = 0,
            newImageHeight = 0;

        /**
         * Resizes the header image so there is always enough space
         * for the article title & info to be visible without scrolling.
         * @memberOf iwc.comp.articleheader
         */
        function setSize() {
            viewportHeight = $window.height();
            imageHeight = $image.outerHeight(true);
            headingHeight = $heading.outerHeight(true);
            navHeight = $nav.outerHeight(true);
            globalNavHeight = $globalNav.outerHeight(true);

            newImageHeight = viewportHeight - globalNavHeight;

            $image.css('height', newImageHeight + 'px').addClass('active');
        }
        /**
         * Called when iwc:resize is published.
         * @memberOf iwc.comp.articleheader
         */
        function onResize() {
            setSize();
        }

        /**
         * Adds all required event listeners.
         * @memberOf iwc.comp.articleheader
         */
        function addEventListeners() {
            $.subscribe('iwc:resize', function() {
                onResize();
            });
        }

        /**
         * initialise article header
         * @memberOf iwc.comp.articleheader
         * @param element DOMElement the header DOM element
         */
        function init(element) {
            var $body = $('body');

            $elem = $(element);
            $window = $(window);
            $image = $elem.find('.iwc-video-article-header-image');
            $nav = $elem.find('.iwc-video-article-header-nav');
            $heading = $elem.find('.iwc-header-text-content');
            $globalNav = $body.find('.iwc-header');

            addEventListeners();
            setSize();
        }

        return {
            init: init
        };
    })(iwc.$);
}());

/*global iwc*/
/**
 * Header Fragment component js
 */

(function() {
    'use strict';

    /**
     * Header component
     * @namespace articleheader
     * @memberof iwc.comp
     */
    iwc.comp.eventarticleheader = (function($, util) {

        var $elem,
            $image,
            $heading,
            $window,
            $globalNav,
            imageHeight = 0,
            globalNavHeight = 0,
            headingHeight = 0,
            viewportHeight = 0,
            newImageHeight = 0;

        /**
         * Validate if the breakpoint isNarrow
         * @memberOf iwc.comp.generictable
         * @return {Boolean}  return if mobile viewport
         */
        function isNarrow() {
            return util.matchmedia.narrow.matches || false;
        }

        /**
         * Resizes the header image so there is always enough space
         * for the article title & info to be visible without scrolling.
         * @memberOf iwc.comp.articleheader
         */
        function setSize() {
            viewportHeight = $window.height();
            imageHeight = $image.outerHeight(true);
            headingHeight = $heading.outerHeight(true);
            globalNavHeight = $globalNav.outerHeight(true);

            newImageHeight = viewportHeight - (headingHeight + globalNavHeight);

            $image.css('height', newImageHeight + 'px').addClass('active');
        }
        /**
         * Called when iwc:resize is published.
         * @memberOf iwc.comp.articleheader
         */
        function onResize() {
            setSize();
        }

        /**
         * Adds all required event listeners.
         * @memberOf iwc.comp.articleheader
         */
        function addEventListeners() {
            $.subscribe('iwc:resize', function() {
                onResize();
            });
        }

        /**
         * initialise event article header
         * @memberOf iwc.comp.articleheader
         * @param element DOMElement the header DOM element
         */
        function init(element) {
            var $body = $('body');

            if (!isNarrow()) {
                return;
            }

            $elem = $(element);
            $window = $(window);
            $image = $elem.find('.iwc-event-article-header-image');
            $heading = $elem.find('.iwc-header-text-content');
            $globalNav = $body.find('.iwc-header');

            addEventListeners();
            setSize();
        }

        return {
            init: init
        };
    })(iwc.$, iwc.util);
}());

/*global iwc*/
/**
 * Exclusive Boutiques on PDP
 */

(function() {
    'use strict';

    /**
     * PDP Exclusive boutiques
     * @namespace pdpexclusiveboutiques
     * @memberof iwc.comp
     */
    iwc.comp.pdpexclusiveboutiques = (function($, util) {

        /**
         * Validate if the breakpoint isNarrow
         * @memberOf iwc.comp.pdpexclusiveboutiques
         * @return {Boolean}  return if mobile viewport
         */
        function isNarrow() {
            return util.matchmedia.narrow.matches || false;
        }

        /**
         * Initialise boutique excolusive component
         * @function init
         * @publish
         * @param {jQuery} jQuery object
         * @memberof iwc.comp.pdpexclusiveboutiques
         */
        function init(elem) {
            var $slickElement = $(elem).find('.iwc-stores-list'),
                slideItems = $slickElement.find('.iwc-stores-item').length;

            if (isNarrow() && slideItems > 1) {
                $slickElement.slick({
                    slidesToShow: 1
                });
                $slickElement.on('afterChange', function() {
                    util.lazyLoadImage.checkImages();
                });
            } else if (slideItems > 2) {
                $slickElement.slick({
                    slidesToShow: 3
                });
                $slickElement.on('afterChange', function() {
                    util.lazyLoadImage.checkImages();
                });
            }
        }

        return {
            init: init
        };

    })(iwc.$, iwc.util);
}());

/*global iwc*/
/**
 * functionality for the longdescription Section
 */

(function() {
    'use strict';

    /*
     * longdescription component
     * @namespace longdescription
     * @memberof iwc.comp
     */
    iwc.comp.longdescription = (function($) {
        var selectors = {
                descriptionText: '.iwc-description-text',
                readMoreButton: '.iwc-description-button',
                textContainer: '.iwc-inner'
            },
            CONST = {
                textHeight: 140,
                maxHeight: '140px'
            },
            cssClass = {
                hide: 'iwc-hidden',
                innerHeight: 'iwc-inner-height',
                contracted: 'iwc-contracted'
            },
            $longdescriptionSection,
            $descriptionText,
            $readMoreButton,
            $textContainer;

        /**
         * handle read more button based on
         * number of lines
         * @function handleShowMore
         * @private
         * @memberOf iwc.comp.longdescription
        */

        function handleShowMore() {
            $readMoreButton.removeClass(cssClass.hide);
            $descriptionText.addClass(cssClass.contracted);
            setTimeout(function() {
                $textContainer.removeClass(cssClass.innerHeight);
            }, 550);
        }

        /**
         * Initialise a longdescription element.
         * @function init
         * @public
         * @param {HTMLObject} element
         * @memberOf iwc.comp.longdescription
        */
        function init(element) {
            $longdescriptionSection = $(element);
            $textContainer = $longdescriptionSection.find(selectors.textContainer);
            $readMoreButton = $longdescriptionSection.find(selectors.readMoreButton);
            $descriptionText = $longdescriptionSection.find(selectors.descriptionText);

            if ($descriptionText.outerHeight() > CONST.textHeight) {
                handleShowMore();
            }

        }

        return {
            init: init
        };

    })(iwc.$);
}());

/*global iwc*/
/**
 * Journal Article Teaser component js
 */

(function() {
    'use strict';

    /**
     * Journal Article Teaser component
     * @namespace articleteaser
     * @memberof iwc.comp
     */
    iwc.comp.articleteaser = (function($, util) {
        var selectors = {
            teaserList: '.iwc-journal-teaser-list',
            teaserItem: '.iwc-journal-teaser-item',
            teaserImg:  '.iwc-journal-teaser-wide'
        },
        $articleTeaserList,
        $articleTeaserListItem;

        /**
         * loadWideView to load wide view
         * @private
         * @memberOf iwc.comp.articleteaser
         */
        function loadWideView() {
            var $images = $articleTeaserList.find(selectors.teaserImg),
                loadedImagesCount = 0;
            // Check images loaded
            $images.on('load', function() {
                loadedImagesCount++;
                if (loadedImagesCount === $images.length) {
                    // Tiles in wide view
                    if ($articleTeaserListItem.length > 3) {
                        $articleTeaserList.masonry({
                            itemSelector: selectors.teaserItem,
                            percentPosition: true,
                            horizontalOrder: true
                        });
                    }
                }
            }).each(function() {
                if (this.complete) {
                    $(this).trigger('load');
                }
            });
        }

        /**
         * initialise articleteaser page
         * @memberOf iwc.comp.articleteaser
         * @public
         * @param {HTMLElement} elem HTML element
         */
        function init(elem) {
            $articleTeaserList = $(elem).find(selectors.teaserList);
            $articleTeaserListItem = $articleTeaserList.find(selectors.teaserItem);
            if (util.matchmedia.narrow.matches) {
                // Carousel in narrow view
                util.carousel.contextualInit($articleTeaserList);
            } else {
                loadWideView();
            }
        }

        return {
            init: init
        };

    })(iwc.$, iwc.util);
}());

/*global iwc*/
/**
 * Journal Generic Teaser component js
 */

(function() {
    'use strict';

    /**
     * Journal Generic Teaser component
     * @namespace genericteaser
     * @memberof iwc.comp
     */
    iwc.comp.genericteaser = (function($, util) {
        var selectors = {
            teaserList: '.iwc-journal-generic-teaser-list'
        },
        $genericTeaserList;


        /**
         * initialise genericteaser page
         * @memberOf iwc.comp.genericteaser
         * @param {HTMLElement} elem HTML element
         */
        function init(elem) {
            $genericTeaserList = $(elem).find(selectors.teaserList);
            if (util.matchmedia.narrow.matches) {
                util.carousel.contextualInit($genericTeaserList);
            }
        }

        return {
            init: init
        };

    })(iwc.$, iwc.util);
}());

/*global iwc*/
/**
 * Journal Article Listing component js
 */

(function() {
    'use strict';

    /**
     * Journal Article Listing component
     * @namespace articlelisting
     * @memberof iwc.comp
     */
    iwc.comp.articlelisting = (function($, util) {
        var selectors = {
            articleList: '.iwc-journal-listing-list',
            articleItem: '.iwc-journal-listing-item',
            loadMoreBtn: '.iwc-journal-listing-loadmore'
        },
        cssClass = {
            visible: 'iwc-visible',
            hidden: 'iwc-hidden'
        },
        $body = $('body'),
        $articleListComp,
        $articleList,
        $loadMoreBtn,
        pagination = 8,
        totalArticles = 0,
        articlesUrl,
        startRange = 1,
        endRange = 1,
        remainingArticles = 0,
        scrollHeight = 0,
        articleListHeight = 0;

        /**
         * Get Listing Data
         * @function getData
         * @private
         * @param {Number} start, end of list items
         * @param {String} state of getting data. clicked or load
         * @memberOf iwc.comp.articlelisting
         */
        function getData(start, end, state) {
            articlesUrl = iwc.util.dataStore.getCurrentPagePath() + 'data.' + start + '.' + end + '.html';

            // make call
            $.get(articlesUrl)
                .done(function(response) {
                    if (response !== '') {
                        articleListHeight = $articleList.height();
                        $articleList.append(response);
                        $articleList.find(selectors.articleItem).addClass(cssClass.visible);

                        if (state === 'clicked') {
                            scrollHeight = $articleList.offset().top + articleListHeight - 80;
                            util.scrollTo.position(scrollHeight, 500);
                        }
                    }
                    util.ajaxloader.hide();
                }).fail(function() {
                    util.ajaxloader.hide();
                });
        }

        /**
         * On Load More Button Click
         * @function onLoadMore
         * @private
         * @memberOf iwc.comp.articlelisting
         */
        function onLoadMore() {
            util.ajaxloader.show();
            remainingArticles = totalArticles - endRange;
            startRange = endRange + 1;

            if (remainingArticles <= pagination) {
                endRange = endRange + remainingArticles;
                $loadMoreBtn.addClass(cssClass.hidden);
            } else {
                endRange = endRange + pagination;
            }
            getData(startRange, endRange, 'clicked');
        }

        /**
         * Bind events
         * @function bindEvents
         * @private
         * @memberOf iwc.comp.articlelisting
         */
        function bindEvents() {
            $loadMoreBtn.on('click', onLoadMore);
        }

        /**
         * Initialize Article Listing
         * @function init
         * @public
         * @param {HTMLElement} elem HTML element
         * @memberOf iwc.comp.articlelisting
         */
        function init(elem) {
            $articleListComp = $(elem);
            $articleList = $articleListComp.find(selectors.articleList);
            $loadMoreBtn = $articleListComp.find(selectors.loadMoreBtn);
            totalArticles = $articleListComp.data('total-articles');

            // set pagination value on the basis of viewport
            if (util.matchmedia.narrow.matches) {
                pagination = $articleListComp.data('pagination-mobile');
            } else {
                pagination = $articleListComp.data('pagination-desktop');
            }

            if (totalArticles <= pagination) {
                endRange = totalArticles;
                $loadMoreBtn.addClass(cssClass.hidden);
            } else {
                endRange = pagination;
                $loadMoreBtn.removeClass(cssClass.hidden);
            }

            util.scrollTo.position($body.offset().top, 500);
            util.ajaxloader.show();
            // load data on page load
            getData(startRange, endRange, 'load');

            bindEvents();
        }

        return {
            init: init
        };

    })(iwc.$, iwc.util);
}());

/*global iwc*/
/**
 * Journal Navigation component js
 */
(function() {
    'use strict';
    /**
     * Journal Navigation component
     * @namespace journalNavigation
     * @memberof iwc.comp
     */
    iwc.comp.journalNavigation = (function($, util) {
        var $html = $('html'),
            $component,
            selectors = {
                toggleGroups: '[data-toggle-group]'
            },
            cssClass = {
                stickyNav: 'journalStickyNav'
            },
            isMobile = util.matchmedia.narrow.matches,
            navOffset;
        /**
         * journalStickyNav to make navigation stick to header
         * @private
         * @memberOf iwc.comp.journalNavigation
         * @param {Event} event object
         */
        function journalStickyNav(e) {
            if (e > navOffset) {
                $html.addClass(cssClass.stickyNav);
            } else {
                $html.removeClass(cssClass.stickyNav);
            }
        }
        /**
         * initialise journal navigation
         * @memberOf iwc.comp.journalNavigation
         * @param {HTMLElement} elem HTML element
         */
        function init(elem) {
            $component = $(elem);
            navOffset = $component.offset().top;
            $.subscribe('scroll', journalStickyNav);
            if (isMobile) {
                util.toggle.init($component.find(selectors.toggleGroups));
            }
        }
        return {
            init: init
        };

    })(iwc.$, iwc.util);
}());

/*global iwc*/
/**
 * Series Article Teaser Component
 */

(function() {
    'use strict';

    /**
     * Series Article Teaser component
     * @namespace seriesarticleteaser
     * @memberof iwc.comp
     */
    iwc.comp.seriesarticleteaser = (function($, util) {
        var selectors = {
            teaserList: '.iwc-series-teaser-list',
            teaserItem: '.iwc-series-teaser-item'
        },
        $articleTeaserList;


        /**
         * Initialise series article teaser
         * @function init
         * @public
         * @memberOf iwc.comp.seriesarticleteaser
         * @param {HTMLElement} elem HTML element
         */
        function init(elem) {
            $articleTeaserList = $(elem).find(selectors.teaserList);
            if (util.matchmedia.narrow.matches) {
                // Carousel in narrow view
                util.carousel.contextualInit($articleTeaserList);
            }
        }

        return {
            init: init
        };

    })(iwc.$, iwc.util);
}());

/*global iwc*/
/**
 * Category Article Teaser Component
 */

(function() {
    'use strict';

    /**
     * Category Article Teaser component
     * @namespace categoryarticleteaser
     * @memberof iwc.comp
     */
    iwc.comp.categoryarticleteaser = (function($, util) {
        var selectors = {
            teaserList: '.iwc-category-teaser-list',
            teaserItem: '.iwc-category-teaser-item'
        },
        $articleTeaserList;


        /**
         * Initialise category article teaser
         * @function init
         * @public
         * @memberOf iwc.comp.categoryarticleteaser
         * @param {HTMLElement} elem HTML element
         */
        function init(elem) {
            $articleTeaserList = $(elem).find(selectors.teaserList);
            if (util.matchmedia.narrow.matches) {
                // Carousel in narrow view
                util.carousel.contextualInit($articleTeaserList);
            }
        }

        return {
            init: init
        };

    })(iwc.$, iwc.util);
}());

/*global iwc*/
/**
 * functionality for the everything shoppable component
 */

(function($, util) {
    'use strict';

    /**
     * Constructor for Everythingshoppable
     * @memberof iwc.comp
     * @private
     * @constructor
     * @param {HTMLElement} elem Everythingshoppable element
     * @param {string} name used for binding data
     */
    var Everythingshoppable = function(elem, name) {
        var $win = $(window),
            selectors = {
                defaultObject: '.iwc-everything-shoppable',
                shoppableImage: '.iwc-ev-shp-product-img',
                tooltip: '.iwc-ev-shp-tooltip',
                shoppableButton: '.iwc-ev-shp-see-watch',
                productCard: '.iwc-ev-shp-card',
                cardClose: '.iwc-ev-card-close',
                watchPrice: '.iwc-ev-card-price'
            },
            cssClass = {
                hide: 'iwc-hidden',
                hideShoppable: 'iwc-hide-btn',
                fadeShow: 'iwc-fade-show',
                expanded: 'iwc-expanded',
                tooltipR: 'iwc-ev-shp-tooltip-right',
                tooltipL: 'iwc-ev-shp-tooltip-left'
            },
            CONST = {
                BUFFER: 300,
                eCommerseDetail: 'productinfo',
                hideShpBtnTime: 5000
            },
            $evShoppable,
            $imageMap,
            $hotspotArea,
            $tooltip,
            $shoppableButton,
            $shoppableImage,
            $productCard,
            $cardCloseBtn,
            $watchPrice,
            ecommEnabled,
            pdpPath,
            productId,
            instanceName,
            priceAvailable = false,
            tooltipHovered = false,
            mapareaHovered = false;

        /**
         * getWatchPrice
         * getWatchPrice for the product card watch
         * @private
         * @memberOf iwc.comp.everythingshoppable
         */
        function getWatchPrice() {
            var priceCallPath = pdpPath + '.' + CONST.eCommerseDetail + '.json',
            priceData;

            $.get(priceCallPath, function(data) {
                priceData = data[productId] ? data[productId] : {};
                if (priceData) {
                    $watchPrice.text(priceData.formattedPrice).removeClass(cssClass.hide);
                    priceAvailable = true;
                }
            });
        }

        /**
         * handleShoppableBtn
         * manage the presence of shoppable button
         * @private
         * @memberOf iwc.comp.everythingshoppable
         * @param {String} state
         */
        function handleShoppableBtn(state, time) {
            if (state === 'hide') {
                $shoppableButton.delay(time).queue(function(hideButton) {
                    hideButton();
                    $shoppableButton.addClass(cssClass.hideShoppable);
                });
            } else if (state === 'show') {
                $shoppableButton.removeClass(cssClass.hideShoppable);
            }
        }

        /**
         * inViewportCheck
         * check if the module is in the viewport
         * @private
         * @memberOf iwc.comp.everythingshoppable
         */
        function inViewportCheck() {
            if (util.elemInViewPort($shoppableImage[0], CONST.BUFFER)) {
                handleShoppableBtn('hide', CONST.hideShpBtnTime);
                $win.off('scroll.' + name);
            }
        }

        /**
         * positionTooltip
         * position the watch tag with the hotspot area
         * @private
         * @memberOf iwc.comp.everythingshoppable
         */
        function positionTooltip() {
            var coords = $hotspotArea.attr('coords').split(','),
            tooltip = $tooltip[0].getBoundingClientRect(),
            container = $evShoppable[0].getBoundingClientRect(),
            positionTooltip,
            positionTooltipRight,
            positionTooltipLeft,
            containerMiddle = Math.ceil(container.width / 2),
            mapAreaCenter = {
                top: parseInt(coords[1],10) + (parseInt(coords[3],10) - parseInt(coords[1],10)) / 2,
                left: parseInt(coords[0],10) + (parseInt(coords[2],10) - parseInt(coords[0],10)) / 2
            };

            positionTooltipRight = {
                    top: parseInt(coords[1],10) + (parseInt(coords[3],10) - parseInt(coords[1],10)) / 2,
                    left: parseInt(coords[0],10) + (parseInt(coords[2],10) - parseInt(coords[0],10)) / 2
                };

            positionTooltipLeft = {
                    top: parseInt(coords[1],10) + (parseInt(coords[3],10) - parseInt(coords[1],10)) / 2,
                    left: parseInt(coords[0],10) - parseInt(tooltip.width,10) - 30 + ((parseInt(coords[2],10) - parseInt(coords[0],10)) / 2)
                };

            if (mapAreaCenter.left <= containerMiddle) {
                positionTooltip = positionTooltipRight;
                $tooltip.addClass(cssClass.tooltipR);
            } else if (mapAreaCenter.left > containerMiddle) {
                positionTooltip = positionTooltipLeft;
                $tooltip.addClass(cssClass.tooltipL);
            }

            $tooltip.css(positionTooltip);
        }

        /**
         * hideTooltip
         * handle hiding of tooltip
         * @private
         * @memberOf iwc.comp.everythingshoppable
         */
        function hideTooltip() {
            setTimeout(function() {
                if (!$tooltip.hasClass(cssClass.expanded) && !tooltipHovered && !mapareaHovered) {
                    $tooltip.removeClass(cssClass.fadeShow);
                }
            }, 0);
        }

        /*
         * Initialised bind events.
         * @memberOf iwc.comp.everythingshoppable
         * @private
         */
        function bindEvents() {
            inViewportCheck();
            $imageMap.rwdImageMaps();
            if (ecommEnabled && !priceAvailable) {
                getWatchPrice();
            }

            // open card on tooltip click
            $tooltip.on('click', function() {
                var _this = $(this);

                $productCard.addClass(cssClass.fadeShow);
                _this.addClass(cssClass.expanded);

                if (_this.hasClass(cssClass.expanded)) {
                    handleShoppableBtn('hide', 0);
                }
            });

            //close card on close click
            $cardCloseBtn.on('click', function() {
                $productCard.removeClass(cssClass.fadeShow);
                handleShoppableBtn('show');
                $tooltip.removeClass(cssClass.fadeShow).delay(500).queue(function(removeExpand) {
                    removeExpand();
                    $tooltip.removeClass(cssClass.expanded);
                });
            });

            //event for shoppable btn
            $shoppableButton.on('click', function() {
                positionTooltip();
                handleShoppableBtn('hide', 0);
                $tooltip.addClass(cssClass.fadeShow);
            });

            //event for shoppable image
            $shoppableImage.on('click', function() {
                handleShoppableBtn('show');
                $tooltip.removeClass(cssClass.fadeShow).delay(500).queue(function(removeExpand) {
                    removeExpand();
                    $tooltip.removeClass(cssClass.expanded);
                });
                $productCard.removeClass(cssClass.fadeShow);
            });

            //mouse over event for hotspot area
            $hotspotArea.mouseenter(function() {
                positionTooltip();
                $tooltip.addClass(cssClass.fadeShow);
                mapareaHovered = true;

            }).mouseleave(function() {
                hideTooltip();
                mapareaHovered = false;
            });

            $tooltip.mouseenter(function() {
                tooltipHovered = true;
            }).mouseleave(function() {
                tooltipHovered = false;
                hideTooltip();
            });

        }

        /**
         * Initialise a everythingshoppable element.
         * @memberOf iwc.comp.everythingshoppable
         * @public
         * @param {HTMLElement} elem HTML element
         */
        function init(elem, name) {
            instanceName = name;
            $evShoppable = $(elem);
            $shoppableImage = $evShoppable.find(selectors.shoppableImage);
            $imageMap = $evShoppable.find('img[usemap]');
            $hotspotArea = $evShoppable.find('area');
            $tooltip = $evShoppable.find(selectors.tooltip);
            $shoppableButton = $evShoppable.find(selectors.shoppableButton);
            $productCard = $evShoppable.find(selectors.productCard);
            $cardCloseBtn = $evShoppable.find(selectors.cardClose);
            $watchPrice = $evShoppable.find(selectors.watchPrice);
            ecommEnabled = $evShoppable.data('ecommerceEnabled') || false ;
            pdpPath = $watchPrice.data('url');
            productId = $watchPrice.data('productRef');
            bindEvents();
            $win.on('scroll.' + name, util.debounce(inViewportCheck, 100));
        }
        init(elem, name);
    };

    /**
     * Initialise a Everythingshoppable
     * @memberOf iwc.comp
     */
    iwc.comp.everythingshoppable = (function() {

        /**
         * Provides an instance of Everythingshoppable
         * @public
         * @param {HTMLElement} elem
         * @return {Object} an instance of Everythingshoppable
         * @memberOf iwc.comp.everythingshoppable
         */
        function init(elem) {
            var name = 'everythingshoppable' + Math.floor(Math.random() * 999) + 1;
            return new Everythingshoppable(elem, name);
        }

        return {
            init: init
        };

    })();
}(iwc.$, iwc.util));

/*global iwc, watchDetails*/
/**
 * Accessories Selector component
 */

(function() {
    'use strict';

    /**
     * strapSelector component
     * @namespace strapSelector
     * @memberof iwc.comp
     */
    iwc.comp.strapSelector = (function($, comp, util) {

        var $component,
            $journeyOptions,
            $journeyOptionLinks,
            $accessoryJourneyWrapper,
            $generatedWrapper,
            $contactConcierge,
            $journeyThumbnails,
            $sizeDropDown,
            $bucklePaging,
            $journeyOptionsList,
            selectors = {
                journeyOptions: '.iwc-ss-options',
                journeyOptionLinks: '.iwc-ss-links',
                accessoryThumbsLink: '.iwc-ss-thumb-link',
                accessoryJourneyWrapper: '.iwc-accessory-journey-wrapper',
                generatedWrapper: '.iwc-generated-wrapper',
                journeyOptionsList: '.iwc-journey-options-list',
                journeyOptionsItem: '.iwc-journey-options-item',
                addtobagForm: '.iwc-addtobag-form',
                iwcAddtobag: '.iwc-ss-addtobag',
                toggleGroups: '[data-toggle-group]',
                contactConcierge: '.iwc-contact-concierge-clone',
                ssContactConcierge: '.iwc-ss-contact-concierge',
                contactConciergeOptions: '.iwc-contact-concierge-buyingOpt',
                contentArea: '.iwc-ss-content',
                journeyThumbnails: '.iwc-journey-thumbnails',
                bucklePaging: '.iwc-buckle-paging',
                next: '.iwc-next-btn',
                sizeDropDown: '.iwc-size-dropdown',
                sizeDD: '.iwc-size-dd'
            },
            cssClass = {
                hide: 'iwc-hidden',
                active: 'active'
            },
            filteredData,
            buckleData,
            buckleDataPrice = false,
            pinBuckleData = [],
            pinBuckleDataPrice = false,
            claspBuckleData = [],
            claspBuckleDataPrice = false,
            thumbnailsCreated = false,
            ecommerceEnabled,
            maxAccessoriesLimit,
            wrapperData,
            $deferredDataJob = new $.Deferred(),
            progressClass = '';
        /**
         * Create carousel for straps
         * @function createStrapsCarousel
         * @private
         * @param {HTMLElement} elem - html for carousel
         * @memberOf iwc.comp.strapSelector
         */
        function createStrapsCarousel(elem, buckleDataForStraps) {
            $journeyOptionsList = $(elem);
            var itemsCount = $journeyOptionsList.find(selectors.journeyOptionsItem).length;
            if (itemsCount > 3 || buckleDataForStraps) {
                $journeyOptionsList.slick({
                    speed: 300,
                    slidesToShow: 8,
                    slidesToScroll: 8,
                    infinite: false,
                    responsive: [{
                        breakpoint: 667,
                        settings: {
                            variableWidth: true,
                            slidesToShow: 3,
                            slidesToScroll: 3
                        }
                    }]
                });
            }
        }
        /**
         * Show active item post creation
         * @function showActiveItem
         * @private
         * @param {String} itemRef - reference of the accessory
         * @param {Object} markup - filtered json object
         * @param {String} journye type e.g. Strap or Buckle
         * @param {String} progressClass - classes to be added to markup
         * @memberOf iwc.comp.strapSelector
         */
        function showActiveItem(itemRef, markup, availability) {
            var $itemMarkup = $(markup);
            if (availability !== 'buy.button.option.buy') {
                util.toggle.init($itemMarkup.find(selectors.toggleGroups));
                comp.contactconcierge.init($itemMarkup.find(selectors.contactConciergeOptions));
            }
            $accessoryJourneyWrapper.removeClass(cssClass.hide).find(selectors.contentArea).html($itemMarkup);
            $generatedWrapper.attr('class', 'iwc-generated-wrapper ' + progressClass);
            $journeyOptions.addClass(cssClass.hide);
        }
        /**
         * Creat accessory markup
         * @function createTemplateView
         * @private
         * @param {String} accessoryRef - reference of the accessory
         * @param {Object} dataObj - json object
         * @param {String} journeyType - e.g. Strap or Buckle
         */
        function createTemplateView(accessoryRef, dataObj, journeyType) {
            var createView = comp.strapSelector.markupTemplate.createView(dataObj, journeyType, accessoryRef, wrapperData, undefined, ecommerceEnabled),
                selectedAccessoryRef = createView.selected.globalRef,
                availability = createView.selected.availability,
                journeyMarkup = createView.markup;
            showActiveItem(selectedAccessoryRef, journeyMarkup, availability);
        }
        /**
         * Get price for each product
         * @function getPrice
         * @private
         * @param {Array} array object
         * @memberOf iwc.comp.strapSelector
         */
        function getPrice(data) {
            var currentPageURL = util.dataStore.getCurrentPagePath(),
                refs = [],
                dataLength = data.length;
            currentPageURL = currentPageURL.split('.')[0];
            $deferredDataJob = new $.Deferred();
            for (var i = 0; i < dataLength; i++) {
                refs.push(data[i].globalRef);
            }
            var getURL = currentPageURL + '.ecommerce-accessory-details.json?productId=' + refs + '&cacheburst=' + new Date().getTime();
            $.get(getURL).done(function(data) {
                $deferredDataJob.resolve(data);
            }).fail(function() {
                console.log('something went wrong!');
            });
        }
        /**
         * Create size drop down based on available sizes
         * @function createSizeDropDown
         * @private
         * @param {Object} buckleData - data object
         * @memberOf iwc.comp.strapSelector
         */
        function createSizeDropDown(buckleData, sizeRef, itemRef) {
            var sizeKeys = Object.keys(buckleData),
                sizeKeysLength = sizeKeys.length,
                sizeKeyName,
                items = [],
                selectedItem = itemRef,
                $currentSlide,
                currentSlideURL;
            for (var i = 0; i < sizeKeysLength; i++) {
                sizeKeyName = sizeKeys[i].toLowerCase();
                items.push('<option value="' + sizeKeys[i] + '">' + wrapperData[sizeKeyName] + '</option>');
            }
            var dropDown = '<select class="iwc-size-dd">' + items.join('') + '</select>',
                selectedSize = sizeRef || sizeKeys[0];
            $sizeDropDown.removeClass(cssClass.hide).find('.iwc-select-wrapper').html(dropDown);
            $sizeDropDown.find('.iwc-size-dd').on('change', function(e) {
                $journeyOptionsList.slick('slickUnfilter');
                $journeyOptionsList.slick('slickFilter', '.' + e.currentTarget.value);
                $journeyOptionsList.find('.slick-slide').removeClass(cssClass.active);
                if (selectedItem) {
                    $currentSlide = $journeyOptionsList.find('.slick-slide[data-ref="' + selectedItem + '"]');
                    selectedItem = undefined;
                } else {
                    $currentSlide = $journeyOptionsList.find('.slick-current');
                }
                currentSlideURL = $currentSlide.find('a').attr('href');
                $currentSlide.addClass(cssClass.active);
                window.location.hash = currentSlideURL;
            });
            setTimeout(function() {
                $sizeDropDown.find(selectors.sizeDD).val(selectedSize).prop('selected', true).trigger('change');
            }, 300);
        }
        /**
         * Create thumbnail for Straps & Buckles
         * @function createThumbnailCarousel
         * @private
         * @param {Object} buckleData object
         * @param {String} journeyType
         * @param {String} itemRef
         * @memberOf iwc.comp.strapSelector
         */
        function createThumbnailCarousel(buckleData, journeyType, itemRef, buckleDataForStraps) {
            if (!thumbnailsCreated) {
                var thumbs = comp.strapSelector.markupTemplate.accessoryThumbnails(buckleData, journeyType, itemRef),
                    $thumbs = $(thumbs),
                    $carouselMarkup = $thumbs.find(selectors.journeyOptionsList),
                    activeThumb = $thumbs.find(selectors.journeyOptionsItem);
                if (itemRef === '' || itemRef === undefined) {
                    $(activeThumb[0]).addClass(cssClass.active);
                }
                $journeyThumbnails.html($thumbs);
                createStrapsCarousel($carouselMarkup, buckleDataForStraps);
                thumbnailsCreated = true;
                if (buckleDataForStraps) {
                    var selectedSize;
                    if (itemRef) {
                        selectedSize = buckleData.filter(function(data) {
                            if (data.globalRef === itemRef) {
                                return data;
                            }
                        });
                        selectedSize = selectedSize[0].sizeCode;
                    }
                    createSizeDropDown(buckleDataForStraps, selectedSize, itemRef);
                }
            }
        }
        /**
         * Create buckle data based on its type
         * @function showBuckles
         * @private
         * @param {Array} linkParams object
         * @memberOf iwc.comp.strapSelector
         */
        function showBuckles(linkParams) {
            var accessoryRef = linkParams[1],
                journeyType;
            journeyType = 'buckleforstrap=';
            filteredData = watchDetails.strapWithBuckleTypes;
            var data = filteredData[0],
                claspAvailablity = Object.values(data.clasp).length ? 'clasp' : undefined,
                pinAvailablity = Object.values(data.pinBuckle).length ? 'pinBuckle' : undefined,
                buckles = [],
                buckleType,
                buckleData = [],
                entry,
                description,
                imagePath,
                globalRef,
                buckleKey,
                createView;
            if (claspAvailablity) {
                buckles.push(claspAvailablity);
            }
            if (pinAvailablity) {
                buckles.push(pinAvailablity);
            }
            progressClass = 'iwc-buckleforstrap';
            for (var i = 0; i < buckles.length; i++) {
                buckleType = buckles[i] === 'clasp';
                buckleKey = buckleType ? 'clasp' : 'pinBuckle';
                imagePath = buckleType ? wrapperData.claspBuckleImage : wrapperData.pinBuckleImage;
                globalRef = buckleType ? 'CLASP' : 'PIN';
                description = buckleType ? wrapperData.claspBuckleTitle : wrapperData.pinBuckleTitle;
                entry = {
                    availability: '',
                    description: description,
                    imagePath: imagePath,
                    globalRef: globalRef,
                    data: data[buckleKey]
                };
                buckleData.push(entry);
            }
            createThumbnailCarousel(buckleData, journeyType, accessoryRef);
            createView = comp.strapSelector.markupTemplate.createView(buckleData, journeyType, accessoryRef, wrapperData, 'straps');
            var selectedAccessoryRef = createView.selected.globalRef,
                availability = createView.selected.availability,
                journeyMarkup = createView.markup;
            showActiveItem(selectedAccessoryRef, journeyMarkup, availability, progressClass);
        }
        /**
         * Show buckles from data
         * @function purchaseBuckles
         * @private
         * @param {Array} linkParams object
         * @memberOf iwc.comp.strapSelector
         */
        function purchaseBuckles(linkParams) {
            var accessoryRef = linkParams[1],
                journeyType;
            journeyType = 'purchasebuckle=';
            buckleData = watchDetails.buckles;
            progressClass = 'iwc-' + journeyType.slice(0, -1);
            createThumbnailCarousel(buckleData, journeyType, accessoryRef);
            var buckleDataLength = buckleData.length;
            if (ecommerceEnabled && !buckleDataPrice) {
                getPrice(buckleData);
                $deferredDataJob.done(function(data) {
                    var accessoryWithPrice = data.accessoriesEcommDetails,
                        accessoryWithPriceLength = accessoryWithPrice.length;
                    for (var i = 0; i < buckleDataLength; i++) {
                        for (var j = 0; j < accessoryWithPriceLength; j++) {
                            if (accessoryWithPrice[j].productId === buckleData[i].globalRef) {
                                buckleData[i].price = accessoryWithPrice[j].formattedPrice;
                                buckleData[i].availability = accessoryWithPrice[j].buttonOptions.key;
                            }
                        }
                    }
                    buckleDataPrice = true;
                    createTemplateView(accessoryRef, buckleData, journeyType);
                });

            } else {
                createTemplateView(accessoryRef, buckleData, journeyType);
            }
        }
        /**
         * Check type of Buckle and update strap screen
         * @function strapsScreen
         * @private
         * @param {Object} buckleData object
         * @param {String} buckleRef
         * @param {String} accessoryRef
         * @param {String} journeyType
         * @memberOf iwc.comp.strapSelector
         */
        function strapsScreen(buckleData, buckleRef, accessoryRef, journeyType) {
            var accessorySize = Object.keys(buckleData),
                accessorySizeLength = accessorySize.length,
                accessorySizeKey,
                commonData,
                claspIndex = 0,
                claspIndexJ = 0,
                pinIndex = 0,
                pinIndexJ = 0;
            if (buckleRef === 'CLASP') {
                if (!claspBuckleData.length) {
                    for (claspIndex = 0; claspIndex < accessorySizeLength; claspIndex++) {
                        accessorySizeKey = accessorySize[claspIndex];
                        for (claspIndexJ = 0; claspIndexJ < buckleData[accessorySizeKey].length; claspIndexJ++) {
                            claspBuckleData.push(buckleData[accessorySizeKey][claspIndexJ]);
                        }
                    }
                }
                commonData = claspBuckleData;
            } else if (buckleRef === 'PIN') {
                if (!pinBuckleData.length) {
                    for (pinIndex = 0; pinIndex < accessorySizeLength; pinIndex++) {
                        accessorySizeKey = accessorySize[pinIndex];
                        for (pinIndexJ = 0; pinIndexJ < buckleData[accessorySizeKey].length; pinIndexJ++) {
                            pinBuckleData.push(buckleData[accessorySizeKey][pinIndexJ]);
                        }
                    }
                }
                commonData = pinBuckleData;
            }
            createThumbnailCarousel(commonData, journeyType, accessoryRef, buckleData);
            if (ecommerceEnabled) {
                if (buckleRef === 'CLASP' && !claspBuckleDataPrice) {
                    getPrice(commonData);
                    $deferredDataJob.done(function(data) {
                        var accessoryWithPrice = data.accessoriesEcommDetails,
                            accessoryWithPriceLength = accessoryWithPrice.length,
                            buckleDataLength = commonData.length;
                        for (var i = 0; i < buckleDataLength; i++) {
                            for (var j = 0; j < accessoryWithPriceLength; j++) {
                                if (accessoryWithPrice[j].productId === commonData[i].globalRef) {
                                    commonData[i].price = accessoryWithPrice[j].formattedPrice;
                                    commonData[i].availability = accessoryWithPrice[j].buttonOptions.key;
                                }
                            }
                        }
                        createTemplateView(accessoryRef, commonData, journeyType);
                        claspBuckleDataPrice = true;
                    });
                }
                if (buckleRef === 'PIN' && !pinBuckleDataPrice) {
                    getPrice(commonData);
                    $deferredDataJob.done(function(data) {
                        var accessoryWithPrice = data.accessoriesEcommDetails,
                            accessoryWithPriceLength = accessoryWithPrice.length,
                            buckleDataLength = commonData.length;
                        for (var i = 0; i < buckleDataLength; i++) {
                            for (var j = 0; j < accessoryWithPriceLength; j++) {
                                if (accessoryWithPrice[j].productId === commonData[i].globalRef) {
                                    commonData[i].price = accessoryWithPrice[j].formattedPrice;
                                    commonData[i].availability = accessoryWithPrice[j].buttonOptions.key;
                                }
                            }
                        }
                        createTemplateView(accessoryRef, commonData, journeyType);
                        pinBuckleDataPrice = true;
                    });
                }
                if (pinBuckleDataPrice || claspBuckleDataPrice) {
                    createTemplateView(accessoryRef, commonData, journeyType);
                }
            } else {
                createTemplateView(accessoryRef, commonData, journeyType);
            }
        }
        /**
         * Get buckle reference specific data
         * @function purchaseStarps
         * @private
         * @param {Array} linkParams object
         * @param {Array} urlParams object
         * @memberOf iwc.comp.strapSelector
         */
        function purchaseStarps(linkParams, urlParams) {
            var buckleReferenceForStraps = urlParams[0].split('=')[1],
                accessoryRef = linkParams[1],
                journeyType = 'buckleforstrap=' + buckleReferenceForStraps + '&straps=',
                buckleRef = buckleReferenceForStraps === 'CLASP' ? 'clasp' : 'pinBuckle',
                buckleData = watchDetails.strapWithBuckleTypes[0][buckleRef];
            progressClass = 'iwc-purchasestraps';
            $bucklePaging.attr('href', '#buckleforstrap=' + buckleReferenceForStraps);
            strapsScreen(buckleData, buckleReferenceForStraps, accessoryRef, journeyType);
        }
        /**
         * Detect if any change made in hash in url
         * @function viewType
         * @private
         * @param {Array} linkParams object
         * @memberOf iwc.comp.strapSelector
         */
        function viewType(linkParams, urlParams) {
            if (linkParams[0] === 'purchasebuckle') {
                $sizeDropDown.addClass(cssClass.hide).find('.iwc-select-wrapper').html('');
                purchaseBuckles(linkParams);
            } else if (linkParams[0] === 'buckleforstrap') {
                $sizeDropDown.addClass(cssClass.hide).find('.iwc-select-wrapper').html('');
                showBuckles(linkParams);
            } else {
                purchaseStarps(linkParams, urlParams);
            }
        }
        /**
         * Defect if any change made in hash in url
         * @function hashChangeCheck
         * @param {Array} array object
         * @private
         * @memberOf iwc.comp.strapSelector
         */
        function getJourneyInput(urlParams) {
            var viewParams = [urlParams.slice(-1)[0]];
            viewParams.forEach(function(key) {
                var dividedParams = key.split('=');
                viewType(dividedParams, urlParams);
            });
        }
        /**
         * Check if URL has hash with values
         * @function getJourneyParams
         * @private
         * @memberOf iwc.comp.strapSelector
         */
        function getJourneyParams() {
            var url = window.location.hash.substr(1),
                urlParams = url.split('&');
            if (urlParams[0] === '') {
                $accessoryJourneyWrapper.addClass(cssClass.hide).find(selectors.contentArea).empty();
                $journeyOptions.removeClass(cssClass.hide);
            } else {
                getJourneyInput(urlParams);
            }
        }
        /**
         * Defect if any change made in hash in url
         * @function hashChangeCheck
         * @private
         * @memberOf iwc.comp.strapSelector
         */
        function hashChangeCheck() {
            window.onhashchange = function() {
                if (window.innerDocClick) {
                    window.innerDocClick = false;
                } else {
                    if (window.location.hash !== '#undefined') {
                        if (window.location.hash === '') {
                            thumbnailsCreated = false;
                        }
                        getJourneyParams();
                    } else {
                        history.pushState('', document.title, window.location.pathname);
                        location.reload();
                    }
                }
            };
        }
        /**
         * Set thumbnails creation to false
         * @function setFalseState
         * @private
         * @memberOf iwc.comp.strapSelector
         */
        function setFalseState() {
            thumbnailsCreated = false;
        }
        /**
         * Set active class to clicked body
         * @function setFalseState
         * @private
         * @param {event} e - event object
         * @memberOf iwc.comp.strapSelector
         */
        function setActiveClass(e) {
            var $this = $(e.currentTarget),
                $siblings = $this.siblings();
            $siblings.removeClass(cssClass.active);
            $this.addClass(cssClass.active);
        }
        /**
         * Bind click events
         * @function bindEvents
         * @private
         * @memberOf iwc.comp.strapSelector
         */
        function bindEvents() {
            $component.on('click', selectors.iwcAddtobag, iwc.comp.buyingoptions.addProductToBag);
            $component.on('click', selectors.next, setFalseState);
            $bucklePaging.on('click', setFalseState);
            $component.on('click', selectors.journeyOptionsItem, setActiveClass);
        }
        /**
         * setProductCartData based on cart data from login status
         * @private
         * @memberOf iwc.comp.strapSelector
         * @param  {object} loginStatusData
         */
        function setProductCartData(loginStatusData) {
            var addedAccessoryCount = loginStatusData.values.cartStatus.accessoryCount || 0;
            iwc.comp.cartState.set({
                accessoryCount: addedAccessoryCount,
                accessoryLimit: maxAccessoriesLimit
            });
        }
        /**
         * onStateChangeHandler update the button based on the cart state
         * @private
         * @memberOf iwc.comp.strapSelector
         * @param  {object} state
         */
        function onStateChangeHandler(state) {
            if (state.accessoryCount === state.accessoryLimit) {
                var $button = $component.find(selectors.iwcAddtobag);
                $button.prop('disabled', true).text($button.data('limitReached'));
            }
        }
        /**
         * Return contact concierge from page
         * @function contactConciergeMarkup
         * @public
         * @memberof iwc.comp.strapSelector
         */
        function contactConciergeMarkup() {
            return $contactConcierge;
        }
        /**
         * Map DOM elements on page
         * @function mapDOMElements
         * @private
         * @memberof iwc.comp.strapSelector
         */
        function mapDOMElements() {
            $journeyOptions = $component.find(selectors.journeyOptions);
            $journeyOptionLinks = $journeyOptions.find(selectors.journeyOptionLinks);
            $accessoryJourneyWrapper = $component.find(selectors.accessoryJourneyWrapper);
            $contactConcierge = $component.find(selectors.contactConcierge).html();
            $journeyThumbnails = $component.find(selectors.journeyThumbnails);
            $generatedWrapper = $component.find(selectors.generatedWrapper);
            $bucklePaging = $component.find(selectors.bucklePaging);
            $sizeDropDown = $component.find(selectors.sizeDropDown);
            wrapperData = $accessoryJourneyWrapper.data();
            maxAccessoriesLimit = wrapperData.maxItems;
        }
        /**
         * initialise strapSelector template
         * @function init
         * @public
         * @param {HTMLElement} element
         * @memberOf iwc.comp.strapSelector
         */
        function init(elem) {
            $component = $(elem);
            ecommerceEnabled = $component.data('ecomm') !== undefined ? true : false;
            mapDOMElements();
            getJourneyParams();
            bindEvents();
            hashChangeCheck();
            util.animatable.init();
            comp.account.customerDetailsData().done(setProductCartData);
            $.subscribe('iwc:state:changed', onStateChangeHandler);
        }
        return {
            init: init,
            contactConciergeMarkup: contactConciergeMarkup
        };
    })(iwc.$, iwc.comp, iwc.util);
}());

/*global iwc*/
/**
 * Strap Selector Progress bar component
 */

(function() {
    'use strict';

    /**
     * markupTemplate component
     * @namespace strapSelector
     * @memberof iwc.comp.strapSelector
     */
    iwc.comp.strapSelector.markupTemplate = (function($, comp) {

        var accessoryData,
            selectedAccessory,
            pageData,
            accessoryDetails,
            ecommerceEnabled;
        /**
         * Create thumbnails for straps/buckles
         * @function accessoryThumbnails
         * @public
         * @param {string} url string
         * @memberOf iwc.comp.strapSelector.markupTemplate
         */
        function responsiveImage(imagePath, config, ext, cssClass) {
            var image = ['<picture class="iwc-picture-tag">',
                '<source srcset="' + imagePath + config + ext + ', ' + imagePath + config + '_2x' + ext + ' 2x" media="(min-width: 1000px)">',
                '<source srcset="' + imagePath + config + ext + ', ' + imagePath + config + '_2x' + ext + ' 2x" media="(min-width: 750px)">',
                '<source srcset="' + imagePath + config + '_2x' + ext + '">',
                '<img class="' + cssClass + '" srcset="' + imagePath + config + '_2x' + ext + '" alt="">',
            '</picture>'];
            return image.join('');
        }
        /**
         * Create thumbnails for straps/buckles
         * @function accessoryThumbnails
         * @public
         * @param {string} url string
         * @memberOf iwc.comp.strapSelector.markupTemplate
         */
        function accessoryThumbnails(data, journey, itemRef) {
            var items = [],
                ref,
                image,
                buckleCount = data.length,
                activeClass;
            for (var i = 0; i < buckleCount; i++) {
                ref = data[i].globalRef;
                activeClass = ref === itemRef ? ' active' : '';
                image = responsiveImage(data[i].imagePath, '.transform.accessory_thumb_image_height_56', '.jpeg', 'iwc-ss-thumb-img');
                var itemToPush = ['<li class="iwc-journey-options-item ' + data[i].sizeCode + activeClass + '" data-ref="' + ref + '">',
                    '<a class="iwc-journey-options-link" href="#' + journey + ref + '"',
                    'data-ref="' + ref + '"',
                    'class="iwc-ss-thumb-link">',
                    image,
                    '</a>',
                '</li>'].join('');
                items.push(itemToPush);
            }
            return '<div class="iwc-journey-options"><ul class="iwc-journey-options-list">' + items.join('') + '</ul></div>';
        }
        /**
         * Get contact concierge markup from page
         * @function getContactConcierge
         * @private
         * @memberOf iwc.comp.strapSelector.markupTemplate
         */
        function getContactConcierge() {
            return comp.strapSelector.contactConciergeMarkup();
        }
        /**
         * Created add to bag button
         * @function getAddToBag
         * @private
         * @memberOf iwc.comp.strapSelector.markupTemplate
         */
        function getAddToBag() {
            var button = ['<div class="iwc-addtobag-form" data-url="' + pageData.url + '"',
                        'data-product-added-text="' + pageData.productAddedText + '"',
                        'data-another-product="' + pageData.anotherProduct + '"',
                        'data-destination-link-text="' + pageData.destinationLinkText + '">',
                    '<button type="button" data-tracking-event="addToBag" data-tracking-product-ref="' + selectedAccessory.globalRef + '" data-productid="' + selectedAccessory.globalRef + '" class="iwc-btn-lrg-primary-light iwc-ss-addtobag"" data-limit-reached="' + pageData.maxItems + ' ' + pageData.limitReached + '">',
                        '' + pageData.bagButtonText + '</button>',
                    '<div class="iwc-error iwc-hidden" aria-hidden="true" data-default="' + pageData.defaultErrorMsg + '"></div>',
                '</div>'].join('');
            return button;
        }
        /**
         * Created markup for buckle with Straps
         * @function buckleTypeView
         * @private
         * @param {string} journey - type of view
         * @memberOf iwc.comp.strapSelector.markupTemplate
         */
        function buckleTypeView(journey) {
            var image = responsiveImage(selectedAccessory.imagePath, '.transform.accessory_main_image_width_290', '.jpeg', 'iwc-ss-main-img'),
                item = ['<div class="iwc-journey-details"><div class="iwc-journey-column iwc-journey-image">',
                    image,
                    '</div>',
                    '<div class="iwc-journey-column iwc-journey-info">',
                    '<div class="iwc-journey-sub-title">' + selectedAccessory.description + '</div>',
                    '<a class="iwc-btn-lrg-primary-light iwc-next-btn" href="#' + journey + selectedAccessory.globalRef + '&straps=">Next</a>',
            '</div></div>'].join('');
            accessoryDetails = item;
        }
        function getEcommData() {
            var data = {
                price: '<div class="iwc-journey-price">' + selectedAccessory.price + '</div>',
                addToBag: getAddToBag()
            };
            return data;
        }
        /**
         * Created markup for accessory section
         * @function getAccessoryDetails
         * @private
         * @param {string} viewType - type of view
         * @param {string} journey - type of view
         * @memberOf iwc.comp.strapSelector.markupTemplate
         */
        function getAccessoryDetails(viewType, journey) {
            var ecommData,
                price,
                addToBag;
            if (ecommerceEnabled) {
                ecommData = getEcommData();
                price = ecommData.price;
                addToBag = ecommData.addToBag;
            }

            if (viewType === 'straps') {
                buckleTypeView(journey);
            } else {

                var material = selectedAccessory.material;
                material = material ? material.toLowerCase() : '';
                material = pageData[material] ? '<li class="iwc-journey-bullet">' + pageData[material] + '</li>' : '';

                var ecomm = selectedAccessory.availability === 'buy.button.option.buy' ? true : false,
                    CTA = ecomm ? addToBag : getContactConcierge(),
                    image = responsiveImage(selectedAccessory.imagePath, '.transform.accessory_main_image_width_290', '.jpeg', 'iwc-ss-main-img'),
                    item = ['<div class="iwc-journey-details"><div class="iwc-journey-column iwc-journey-image">',
                        image,
                        '</div>',
                        '<div class="iwc-journey-column iwc-journey-info">',
                        '<div class="iwc-journey-ref">' + selectedAccessory.localRef + '</div>',
                        '<div class="iwc-journey-sub-title">' + selectedAccessory.description + '</div>',
                        price,
                        '<ul class="iwc-journey-list iwc-hide">',
                        '<li class="iwc-journey-bullet">' + pageData.originalStrap + ' ' + pageData.watchName + '</li>',
                        material,
                    '</ul><div class="iwc-ss-contact-concierge">' + CTA + '</div>',
                '</div></div>'].join('');
                accessoryDetails = item;
            }
        }
        /**
         * Updated selected accessory data
         * @function getSelectedAccessory
         * @private
         * @param {string} ref - reference of the accessory
         * @memberOf iwc.comp.strapSelector.markupTemplate
         */
        function getSelectedAccessory(ref) {
            var buckleCount = accessoryData.length,
                updatedAccessory;
            for (var i = 0; i < buckleCount; i++) {
                if (accessoryData[i].globalRef === ref) {
                    updatedAccessory = accessoryData[i];
                }
            }
            updatedAccessory = updatedAccessory || accessoryData[0];
            selectedAccessory = updatedAccessory;
        }
        /**
         * Create whole view
         * @function createView
         * @public
         * @param {object} data - recieved json
         * @param {string} journey - type of view
         * @param {string} ref - reference of the accessory
         * @param {string} deepLink - for deep linking
         * @param {object} wrapperData - on page data like, button names, etc.
         * @memberOf iwc.comp.strapSelector.markupTemplate
         */
        function createView(data, journey, ref, wrapperData, viewType, ecommerce) {
            ecommerceEnabled = ecommerce;
            accessoryData = data;
            pageData = wrapperData;
            getSelectedAccessory(ref);
            getAccessoryDetails(viewType, journey);

            return {'markup': accessoryDetails, 'selected': selectedAccessory};
        }

        return {
            createView: createView,
            accessoryThumbnails: accessoryThumbnails
        };
    })(iwc.$, iwc.comp);
}());

/*global iwc*/
/**
 * Login Link component
 */

(function() {
    'use strict';

    /**
     * Login Link component
     * @namespace loginlink
     * @memberof iwc.comp
     */
    iwc.comp.loginlink = (function($,util) {

        var loginUrl,
            userLoggedIn = false,
            loginUrlSuffix = '/_jcr_content/par.html';

        /**
        * Redirects user based upon logged in status
        * @function userLoggedInCheck
        * @private
        * @memberOf iwc.comp.loginlink
        */
        function userLoggedInCheck(redirectUrl) {
            if (userLoggedIn) {
                window.location.href = redirectUrl;
            } else {
                $(document.body).attr('data-login-link-url',redirectUrl);
                util.lightbox.openUrlInLightbox(loginUrl);
            }
        }

        /**
         * initialise editorial template
         * @function init
         * @private
         * @memberOf iwc.comp.loginlink
         */
        function init(ele) {
            var linkEle =  $(ele),
                redirectUrl = linkEle.data('url2');
            loginUrl = window.location.origin + linkEle.data('url') + loginUrlSuffix;
            iwc.comp.account.customerDetailsData().done(function(data) {
                if (data.values.customerDetails.customerId !== 0) {
                    userLoggedIn = true;
                }
            });

            linkEle.on('click',function(event) {
                event.preventDefault();
                userLoggedInCheck(redirectUrl);
            });
        }

        return {
            init: init
        };
    })(iwc.$,iwc.util);
}());

/*global iwc*/
/**
 * Contact Brand component
 */

(function() {
    'use strict';

    /**
     * Newsletters component
     * @namespace contactbrand
     * @memberof iwc.comp
     */
    iwc.comp.contactbrand = (function($) {

        var selectors = {
            contactBrandCheckbox: '.iwc-contactbrand-checkbox',
            errorWrapper: '.iwc-error'
        },
        $contactbrand,
        $contactBrandCheckbox,
        formUrl = iwc.util.dataStore.getCurrentPagePath() + '.contactByBrand.json?cacheburst=' + new Date().getTime();

        /**
         * show error
         * @function onPageLoad
         * @private
         * @param {string} errorText ajax response
         * @memberOf iwc.comp.contactbrand
        */
        function showError(errorText) {
            $contactbrand.find(selectors.errorWrapper).text(errorText);
        }

        /**
         * On contactbrand checkbox click
         * @function onContactBrandCheckboxClick
         * @private
         * @param {Object} e event
         * @memberOf iwc.comp.contactbrand
        */
        function onContactBrandCheckboxClick(e) {
            var isChecked = false;

            if ($(e.currentTarget).is(':checked')) {
                isChecked = true;
            }

            // make call
            $.ajax({
                url: formUrl,
                type: 'POST',
                data: {
                    contactByBrand: isChecked
                }
            })
            .done(function(response) {
                if (response.status.toLowerCase() === 'success') {
                    $contactbrand.find(selectors.errorWrapper).empty();
                    // Required for Tracking for contactbrand
                    // if (isChecked === true) {
                    //     util.tracking.iwcCustomTracking({'event': 'contactbrandubscription', 'newsletter': 'subscription'});
                    // } else {
                    //     util.tracking.iwcCustomTracking({'event': 'contactbrandubscription', 'newsletter': 'unsubscription'});
                    // }
                } else {
                    showError(response.values.errorMessage);
                }
            })
            .fail(function(jqXHR, textStatus, errorText) {
                showError(errorText);
            });
        }

        /**
         * Bind events
         * @function bindEvents
         * @private
         * @memberOf iwc.comp.contactbrand
        */
        function bindEvents() {
            $contactBrandCheckbox.on('click', onContactBrandCheckboxClick);
        }

        /**
         * initialise contactbrand component
         * @function init
         * @public
         * @param {HTMLElement} element
         * @memberOf iwc.comp.contactbrand
         */
        function init(elem) {
            $contactbrand = $(elem);
            $contactBrandCheckbox = $contactbrand.find(selectors.contactBrandCheckbox);
            bindEvents();
        }

        return {
            init: init
        };
    })(iwc.$);
}());

/*global iwc*/
/**
 * functionality for the wishlist disclaimer
 */

(function() {
    'use strict';

    /*
     * wishlist disclaimer component
     * @namespace wishlistDisclaimer
     * @memberof iwc.comp
     */
    iwc.comp.wishlistDisclaimer = (function($, comp, util) {
        var $body = $('body'),
            $confirm,
            $cancel,
            $component,
            $overlay,
            selectors = {
                overlay: '.iwc-lightbox-content',
                confirm: '.iwc-btn-confirm',
                cancel: '.iwc-btn-cancel',
                component: '.iwc-wishlist-disclaimer-wrapper'
            };

        /*
         * close the lightbox.
         * @memberOf iwc.comp.wishlistDisclaimer
         */
        function closeLightbox() {
            util.lightbox.closeLightbox();
        }

        /*
         * Trigger move to wishlist functionality.
         * @memberOf iwc.comp.triggerMoveToWishlist
         */
        function triggerMoveToWishlist() {
            closeLightbox();
            comp.buyingoptions.moveProductToWishlist();
        }
        /*
         * Initialised bind events.
         * @memberOf iwc.comp.wishlistDisclaimer
         * @param  {Object} $slider the object
         */
        function bindEvents() {
            $confirm.on('click', triggerMoveToWishlist);
            $cancel.on('click', closeLightbox);
        }

        /**
         * Initialise a watchhero element.
         * @memberOf iwc.comp
         */
        function init(element) {
            $overlay = $body.find(selectors.overlay);
            $component = $(element) || $(selectors.component);
            $confirm = $overlay.find(selectors.confirm);
            $cancel = $overlay.find(selectors.cancel);
            bindEvents();
        }

        return {
            init: init
        };
    })(iwc.$, iwc.comp, iwc.util);
}());

/*global iwc*/
/*global base*/
/**
 * Shopping Bag Mini Cart Component
 */

(function() {
    'use strict';

    /**
     * minicart component
     * @namespace minicart
     * @memberof iwc.comp
     */
    iwc.comp.minicart = (function($, util, baseUtil) {
        var selectors =  {btnAddToBag:'.iwc-addtobag-eu'},
        $submit = $(selectors.btnAddToBag),
        $deferredCustomerDataJob = new $.Deferred();

        /**
         * returns promise with contetx hub summary data
         * @function customerDetailsData
         * @memberOf iwc.comp.minicart
         * @private
         */
        function customerDetailsData() {
            return $deferredCustomerDataJob.promise();
        }
        /**
         * Open Generic error handler for ajax errors published by base
         * @function openErrorLightBox
         * @memberOf iwc.comp.minicart
         * @param {res} The res contains error message which need to show.
         * @private
         */
        function openErrorLightBox(res) {
            if (res.responseText) {
                var errorCode = res.responseText[0].code  || '';
                if (errorCode === 'checkout.exception.cart.threshold.count' || errorCode === 'checkout.exception.cart.availability.nostock') {
                    var lightboxContent = $('<p>').text(res.responseText[0].errorMessage).attr('class','iwc-error-popup-msg');
                    baseUtil.lightbox.openLightBoxWithContent(lightboxContent);
                }
            }
        }

        /**
         * Bind events
         * @function bindEvents
         * @memberOf iwc.comp.minicart
         * @private
         */
        function bindEvents() {
            // In case of Login/Register do not appear
            $.publish('iwc:eu:shoppingbag:changed');
            $.subscribe(baseUtil.customEvents.CART_UPDATED, function(data) {
                $deferredCustomerDataJob.resolve(data);
                // subscriber attached in buyingoptions.js to update add to cart button
                $.publish('iwc:eu:checkCartState',[$submit,data]);
                // add to Bag functinality triggered
                if (data.reqData && data.reqData['operation:'] === 'add') {
                    // subscriber attached in buyingoptions.js to update add to cart button
                    $.publish('iwc:eu:buyingOptions:updated', [data.reqData]);
                    // Updated Add to Bag state on product getting added
                    $.publish('iwc:eu:checkCartState',[$submit,data]);
                }
                util.tracking.publish($submit);
                // subscriber attached in account.js to update shopping bag count
                $.publish('iwc:eu:shoppingbag:changed', [data]);

            });
            $.subscribe('base:checkout:cart:operation:failed',function(data) {
                $deferredCustomerDataJob.reject('Cart Data not available');
                console.error(data);
            });
            //subscribe generic error handler for base util.customEvents.AJAX_ERROR_OCCURRED
            $.subscribe(baseUtil.customEvents.AJAX_ERROR_OCCURRED, openErrorLightBox);
        }

        /**
         * initialise minicart component
         * @function init
         * @private
         * @memberOf iwc.comp.minicart
         */
        function init() {
            bindEvents();
        }

        return {
            init: init,
            customerDetailsData: customerDetailsData
        };
    })(iwc.$, iwc.util, base.util);
}());

/*global iwc, JSON*/
/**
 * Currency selector ppc component js
 */

(function() {
    'use strict';

    /**
     * Currency selector ppc component
     * @namespace currencyselectorppc
     * @memberof iwc.comp
     */
    iwc.comp.currencyselectorppc = (function($, util) {

        var $body = $('body'),
            homePageUrl = $body.data('homePageUrl'),
            languagesJSONData,
            countryCode,
            newRedirectUrl,
            selectedCountryCode,
            selectedCurrencySymbol,
            currData,
            selectors = {
                currencyDropdown: '.iwc-cu-dropdown',
                currencySelectControl: '.iwc-cu-select',
                currencyOptionsList: '.iwc-cu-list',
                currencyLocationsList: '.iwc-cu-location-list',
                currencyLocationNonStoreItem: '.iwc-cu-location-list li[data-store!="true"]',
                currencyLanguagesList: '.iwc-cu-language-list',
                languagesJSONWrapper: '.languagesJSONWrapper',
                filterByStore: '#filterByStore',
                ppcApplyButton: '.iwc-cu-apply-btn button',
                ppcWrapper: '.iwc-ppc-wrapper',
                currencylocationWrapper: '.iwc-ppc-currency-selector-location-wrapper',
                currencylanguageWrapper: '.iwc-ppc-currency-selector-language-wrapper'
            },
            cssClass = {
                selected: 'selected',
                open: 'open',
                iwcHidden: 'iwc-hidden'
            },
            $ppcWrapper,
            $currencyDropdown,
            $currencyOptionsList,
            $currencyLocationsList,
            $currencyLocationNonStoreItem,
            $currencyLanguagesList,
            $filterByStore,
            $ppcApplyButton,
            $currencylanguageWrapper,
            $currencylocationWrapper;
        /**
         * populate language dropdown
         * @function populateLanguagesDropdown
         * @private
         * @memberOf iwc.util.currencyselectorppc
         * @param  {object} languageData
         */
        function populateLanguagesDropdown(data) {
            $currencyLanguagesList.empty();
            $currencyLanguagesList.prev().html('Select language');
            $.each(data, function(i, v) {
                $currencyLanguagesList.append('<li data-language="' + v.languageUrl + '">' + v.language + '</li>');
            });
        }

        /**
         * check countrycode in local storage
         * @function checkCountryCodeLS
         * @public
         * @memberOf iwc.util.currencyselectorppc
         */
        function checkCountryCodeLS() {
            // if ecomm enabled then set global country code as countrycode
            if (util.dataStore.isCommerceEnabled()) {
                countryCode = $body.data('globalCountrycode');
            } else {
                // if ecom disabled, check for countrycode in localstorage
                currData = JSON.parse(localStorage.getItem('ccData'));
                countryCode = currData ? currData.countryCode : '';
                if (countryCode === '') {
                    countryCode = $body.data('globalCountrycode');
                }
            }
            return countryCode.trim().toUpperCase();
        }

        /**
         * set country code in localstorage
         * @function setCountryCode
         * @private
         * @memberOf iwc.util.currencyselectorppc
         * @param  string cCode
         */
        function setCountryCode(cCode, cSymbol) {
            var ccData = {
                countryCode: cCode,
                currencySymbol: cSymbol
            };
            localStorage.removeItem('countryCode');
            localStorage.setItem('ccData', JSON.stringify(ccData));
        }

        /**
         * handle expansion/collapse behavior of ppc dropdowns
         * @function currencyListDropDown
         * @private
         * @memberOf iwc.util.currencyselectorppc
         */
        function currencyListDropDown(e) {
            var $dropdownItem = $(e.currentTarget),
                $ul = $dropdownItem.closest('ul');
            $ul.children().removeClass(cssClass.selected);
            $dropdownItem.addClass(cssClass.selected);
            $dropdownItem.closest(selectors.currencyDropdown).removeClass(cssClass.open);
            $ul.prev('span').html($dropdownItem.html());

            //set the countrycode in localstorage irrespective of redirect url.
            if ($dropdownItem.data('countryCode')) {

                //clear newRedirectUrl
                newRedirectUrl = '';
                selectedCountryCode = $dropdownItem.data('countryCode');
                selectedCurrencySymbol = $dropdownItem.data('currencySymbol');
            }

            // if redirecturl is there then redirect it to the mentioned location.
            if ($dropdownItem.data('redirectUrl')) {
                setCountryCode(selectedCountryCode, selectedCurrencySymbol);
                window.location.href = $dropdownItem.data('redirectUrl');
            }


            // create language dropdown when country is selected.
            if ($dropdownItem.find(selectors.languagesJSONWrapper).length) {
                languagesJSONData = $dropdownItem.find(selectors.languagesJSONWrapper).text();
                if (languagesJSONData !== '') {
                    languagesJSONData = $.parseJSON(languagesJSONData);

                    //populate language dropdown
                    populateLanguagesDropdown(languagesJSONData);
                }
            }

            if ($dropdownItem.data('language')) {
                newRedirectUrl = window.location.href.replace(homePageUrl.split('home')[0], '/' + $dropdownItem.data('language') + '/');
            }
        }
        /**
         * Bind events
         * @function bindEvents
         * @private
         * @memberOf iwc.comp.currencyselectorppc
        */
        function bindEvents() {
            $currencyDropdown.on('click', selectors.currencySelectControl, function() {
                $(this).closest(selectors.currencyDropdown).toggleClass(cssClass.open);
            });
            $currencyOptionsList.on('click', 'li', currencyListDropDown);

            $filterByStore.on('change', function() {
                $currencyLocationsList.prev().html($currencylocationWrapper.data('locationLabel'));
                $currencyLanguagesList.empty();
                $currencyLanguagesList.prev().html($currencylanguageWrapper.data('languageLabel'));
                if (this.checked) {
                    $currencyLocationNonStoreItem.addClass(cssClass.iwcHidden);
                } else {
                    $currencyLocationNonStoreItem.removeClass(cssClass.iwcHidden);
                }
            });

            $ppcApplyButton.on('click', function() {
                if (newRedirectUrl && selectedCountryCode) {
                    setCountryCode(selectedCountryCode, selectedCurrencySymbol);
                    window.location.href = newRedirectUrl;
                }
            });
        }

        /**
         * initialise appointment component
         * @function init
         * @public
         * @memberOf iwc.comp.currencyselectorppc
         */
        function init() {
            $ppcWrapper = $body.find(selectors.ppcWrapper);
            $currencyDropdown = $ppcWrapper.find(selectors.currencyDropdown);
            $currencyOptionsList = $currencyDropdown.find(selectors.currencyOptionsList);
            $filterByStore = $ppcWrapper.find(selectors.filterByStore);
            $currencyLocationsList = $currencyDropdown.find(selectors.currencyLocationsList);
            $currencyLanguagesList = $currencyDropdown.find(selectors.currencyLanguagesList);
            $currencyLocationNonStoreItem = $currencyDropdown.find(selectors.currencyLocationNonStoreItem);
            $ppcApplyButton = $ppcWrapper.find(selectors.ppcApplyButton);
            $currencylanguageWrapper = $ppcWrapper.find(selectors.currencylanguageWrapper);
            $currencylocationWrapper = $ppcWrapper.find(selectors.currencylocationWrapper);

            bindEvents();
        }

        return {
            init: init,
            checkCountryCodeLS: checkCountryCodeLS
        };
    })(iwc.$, iwc.util);
}());

/*globals iwc, objectFitImages, base */
// initialisation file for iwc

// initialise components
(function($, util, base) {
    'use strict';

    $(function() {

        //remove IWC form js if base form js is needed
        if (window.useBaseform) {
            iwc.comp.forms = (function() {
                return {
                    init: function init() {
                    }
                };
            })();
        }

        // IE Ployfill for Object-fit
        objectFitImages();

        //Lazy Load Image
        util.lazyLoadImage.init();

        // initialise scrollTo utility before everything
        // else as it needs to listen to whether any
        // components change the scroll offset
        util.scrollTo.init();
        // initialise scroll binding
        util.scroll.init();

        //initialise ajaxloader
        util.ajaxloader.init();

        // initialise components
        util.initialise(document);

        // Initialise resize function on page load
        util.resize.init();

        //initialise button animations
        util.cta.init();

        //initialise lightboxes
        util.lightbox.init();

        //initialise notification
        util.notification.init();

        var $toggleGroups = $('[data-toggle-group]');
        $toggleGroups.each(function(index) {
            if (!$toggleGroups.eq(index).hasClass('iwc-toggle-defer')) {
                util.toggle.init($toggleGroups.eq(index));
            }
        });

        $.subscribe(base.util.customEvents.DOM_UPDATED, function($response) {
            util.formsAnimation.htmlInit($response);
        });

        $.subscribe(base.util.customEvents.FORMS_SUCCESS, function() {
            util.formsAnimation.reInit();
        });

        //initialise wishlist
        util.wishlist.init();

        //initialise videos
        util.videoPlayer.init();

    });
})(iwc.$, iwc.util, base);

